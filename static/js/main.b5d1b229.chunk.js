/*! For license information please see main.b5d1b229.chunk.js.LICENSE.txt */
(this["webpackJsonpxc-live-viewer"]=this["webpackJsonpxc-live-viewer"]||[]).push([[0],{151:function(t){t.exports=JSON.parse('[{"featureType":"all","stylers":[{"visibility":"simplified"},{"saturation":-40}]},{"featureType":"administrative.land_parcel","stylers":[{"visibility":"off"}]},{"featureType":"administrative.neighborhood","stylers":[{"visibility":"off"}]},{"featureType":"poi","elementType":"labels.text","stylers":[{"visibility":"off"}]},{"featureType":"road","elementType":"labels","stylers":[{"visibility":"off"}]},{"featureType":"water","elementType":"labels.text","stylers":[{"visibility":"off"}]}]')},190:function(t,e,n){t.exports=n(289)},216:function(t,e,n){},245:function(t,e,n){},246:function(t,e,n){},259:function(t,e){},261:function(t,e){},283:function(t,e,n){},289:function(t,e,n){"use strict";n.r(e);var i=n(0),a=n.n(i),s=n(12),o=n.n(s),l=n(7),r=n(354),c=n(148),h=n.n(c),p=n(21),u=n(332),d=n(351),m=n(352),g=n(173),f=n.n(g),b=n(172),v=n.n(b),C=(n(216),n(8)),y=n(149);let w=null;function loadGoogleMapsApi(){return null===w&&(w=new y.a({apiKey:"AIzaSyC5OWWO88aWQ07Ag0ywIeBAXhyxj1LIq5k"}).load()),w}var E=n(320),k=n(52),P=n(323),S=n(150),O=n.n(S);const x=Object(E.a)(t=>({progress:{margin:t.spacing(2)}})),LoadingPage=({message:t,hideIf:e,subRef:n})=>{const i=x();return a.a.createElement(r.a,{width:"100%",height:"100%",display:e?"none":"flex",alignItems:"center",justifyContent:"center",ref:n},a.a.createElement(r.a,{textAlign:"center"},a.a.createElement(P.a,{className:i.progress}),a.a.createElement(k.a,null,t)))},ErrorPage=({message:t,hideIf:e})=>{const n=x();return a.a.createElement(r.a,{width:"100%",height:"100%",display:e?"none":"flex",alignItems:"center",justifyContent:"center"},a.a.createElement(r.a,{textAlign:"center"},a.a.createElement(O.a,{fontSize:"large",color:"error",className:n.progress}),a.a.createElement(k.a,{color:"error"},t)))};var _=n(151),M=n(17);class PersistentState_PersistentState{constructor(t,e){this.getValue=()=>{const t=localStorage.getItem(this.key);this.locallyCachedJson!==t&&(this.locallyCachedJson=t,this.locallyCachedValue=JSON.parse(t));const e=this.locallyCachedValue;return null===e?this.initialValue:e},this._notifyAll=()=>{const t=this.getValue();var e,n=Object(M.a)(this.callbacks);try{for(n.s();!(e=n.n()).done;){(0,e.value)(t)}}catch(i){n.e(i)}finally{n.f()}},this.registerCallback=t=>{this.callbacks.includes(t)||this.callbacks.push(t)},this.unregisterCallback=t=>{const e=this.callbacks.indexOf(t);e>=0&&this.callbacks.splice(e,1)},this.setValue=t=>{null==t?localStorage.removeItem(this.key):localStorage.setItem(this.key,JSON.stringify(t)),this._notifyAll()},this.updateValue=t=>{this.setValue(t(this.getValue()))},this.use=()=>{const t=Object(i.useState)(this.getValue),e=Object(l.a)(t,2),n=e[0],a=e[1];return Object(i.useEffect)(()=>{const cb=t=>{a(t)};return this.registerCallback(cb),()=>this.unregisterCallback(cb)},[]),[n,this.setValue]},this.key=t,this.initialValue=e,this.callbacks=[],this.locallyCachedJson=null,this.locallyCachedValue=null}}const registerPersistentState=(t,e)=>new PersistentState_PersistentState(t,e),T="PATH_LENGTH",A="LIMIT_PATHS",I="LOW_LATENCY",L="ANIMATION_DELAY",D="FPS_LIMIT",F="FPS_RATE",R="GPS_ENABLED",j="GPS_SHOWN",V="PREVENT_SLEEP",N="SHOW_OFFLINE_PILOTS",createSetting=(t,e)=>registerPersistentState("SETTINGS_"+t,e),G={PATH_LENGTH:createSetting(T,15),LIMIT_PATHS:createSetting(A,!1),LOW_LATENCY:createSetting(I,!1),ANIMATION_DELAY:createSetting(L,80),FPS_LIMIT:createSetting(D,!0),FPS_RATE:createSetting(F,10),GPS_ENABLED:createSetting(R,!0),GPS_SHOWN:createSetting(j,!0),PREVENT_SLEEP:createSetting(V,!1),SHOW_OFFLINE_PILOTS:createSetting(N,!1)},getSetting=t=>G[t];class XContestSocket_XContestSocket{constructor(t,e,n,i){this.formatSubscribedFlights=()=>this.subscribedFlights.map(([t,e])=>({flightUuid:t,start:null===e?null:new Date(1e3*e).toISOString()})),this.refreshSubscribedFlights=()=>{if(this.sock.readyState===WebSocket.OPEN&&this.connected){const t=this.formatSubscribedFlights();this.sock.send(JSON.stringify({tag:"WebFollow",contents:t}))}},this.setSubscribedFlights=t=>{this.subscribedFlights=t,this.refreshSubscribedFlights()},this.onOpen=()=>{this.handleReset(),console.debug("WebSocket: Open!"),this.setConnectionState(X.ESTABLISHED),this.connected=!0,this.sock.send(JSON.stringify({tag:"WebFilterArea",area:[{lat:-90,lon:-180},{lat:90,lon:180}]})),this.sock.send(JSON.stringify({tag:"WebFilterContest",contents:"alpha9999"}));const t=this.formatSubscribedFlights();this.sock.send(JSON.stringify({tag:"WebFollow",contents:t}))},this.onMessage=t=>{this.setConnectionState(X.ACTIVE);let e=JSON.parse(t.data);clearTimeout(this.watchdog),this.watchdog=setTimeout(()=>{this.setConnectionState(X.INACTIVE)},7e4),this.processMessage(e)},this.onClose=t=>{this.connected=!1,console.debug("WebSocket: Close!"),this.setConnectionState(X.NO_CONNECTION),setTimeout(this.connect.bind(this),1e3)},this.onError=t=>{this.connected=!1,console.debug("WebSocket: Error!")},this.handleReset=()=>{console.log("TODO: handle reset!")},this.processMessage=t=>{if("tag"in t)switch(t.tag){case"LiveFlightInfos":this.dispatchInfoMessage(t.contents);break;case"LiveFlightChunk":this.dispatchTracklogMessage(t);break;case"LiveFlightLanded":this.dispatchFlightLandedMessage(t.flightUuid);break;default:console.warn("Warning: Unknown message tag '".concat(t.tag,"'!"),t)}else console.warn("Warning: Invalid message format!",t)},this.setConnectionState=t,this.dispatchInfoMessage=e,this.dispatchTracklogMessage=n,this.dispatchFlightLandedMessage=i,this.subscribedFlights=[],this.connect(),this.connected=!1,getSetting(T).registerCallback(this.refreshSubscribedFlights),getSetting(A).registerCallback(this.refreshSubscribedFlights)}connect(){"WebSocket"in window?(this.connected=!1,this.setConnectionState(X.CONNECTING),this.sock=new WebSocket("wss://live.xcontest.org/websock/webclient"),this.sock.onopen=this.onOpen,this.sock.onmessage=this.onMessage,this.sock.onclose=this.onClose,this.sock.onerror=this.onError):(this.setConnectionState(X.ERROR),alert("WebSocket NOT supported by your Browser!"))}}class RunningDerivation{constructor(t,e=((t,e)=>e-t),n=(t=>null===t)){this.computeDiff=e,this.isInvalid=n,this.old_val=null,this.old_t=null,this.running_avg=null,this.smoothingFactor=t}update(t,e){if(null===this.old_val||null===t||null===this.old_t||null===e||this.isInvalid(this.old_val)||this.isInvalid(t)||this.old_t===this.new_t)return this.old_val=t,this.old_t=e,null;let n=e-this.old_t,i=this.computeDiff(this.old_val,t)/n,a=Math.pow(this.smoothingFactor,n);return null===this.running_avg?this.running_avg=i:this.running_avg=a*this.running_avg+(1-a)*i,this.old_val=t,this.old_t=e,this.running_avg}reset(){this.old_val=null,this.old_t=null,this.running_avg=null}}var W=n(28);var FindBisect=(t,e,n)=>{if(e<1)return 0;let i=-1,a=e,s=0,o=null;for(;i<a-1;)s=(i+a)/2|0,o=n(s),o<t?i=s:a=s;return a};const parseTime=t=>Math.round(Date.parse(t)/1e3);class FlightAnimationData_FlightAnimationData{constructor(){this.at=t=>this.data[t],this.findBisect=t=>FindBisect(t,this.data.length,t=>this.data[t].t),this.findForwardSwipe=(t,e)=>{let n=e;for(;n<this.data.length&&this.data[n].t<t;)n+=1;return n},this.getNewestTimestamp=()=>this.data.length<1?null:this.data[this.data.length-1].t,this.data=[],this.counter_gpsVario=new RunningDerivation(.7),this.counter_baroVarion=new RunningDerivation(.7),this.counter_velocity=new RunningDerivation(.7,(t,e)=>Object(W.getDistance)(t,e,.01),()=>!1)}clear(){this.data=[],this.counter_gpsVario=new RunningDerivation(.7),this.counter_baroVarion=new RunningDerivation(.7),this.counter_velocity=new RunningDerivation(.7,(t,e)=>Object(W.getDistance)(t,e,.01),()=>!1)}get length(){return this.data.length}isAfterLastElement(t){return this.data.length<=0||this.data[this.data.length-1].t<t}append(t){var e,n=Object(M.a)(t);try{for(n.s();!(e=n.n()).done;){const t=e.value,n=parseTime(t.timestamp),i={lat:t.lat,lng:t.lon},a=0===t.baroAlt?null:t.baroAlt,s=0===t.gpsAlt?null:t.gpsAlt,o=this.counter_gpsVario.update(s,n),l=this.counter_baroVarion.update(a,n),r=this.counter_velocity.update(i,n),c={baroAlt:a,gpsAlt:s,elevation:t.elevation,pos:i,gpsVario:o,baroVario:l,velocity:r,t:n};this.data.push(c)}}catch(i){n.e(i)}finally{n.f()}}replace(t){this.clear(),this.append(t)}insert(t){const e=[];var n,i=Object(M.a)(t);try{for(i.s();!(n=i.n()).done;){const t=n.value,i=parseTime(t.timestamp),a={lat:t.lat,lng:t.lon},s={baroAlt:0===t.baroAlt?null:t.baroAlt,gpsAlt:0===t.gpsAlt?null:t.gpsAlt,elevation:t.elevation,pos:a,gpsVario:null,baroVario:null,velocity:null,t:i};e.push(s)}}catch(c){i.e(c)}finally{i.f()}const a=this.data;this.data=[];let s=0,o=0;for(;!(s>=a.length&&o>=e.length);)if(s>=a.length)this.data.push(e[o]),o+=1;else if(o>=e.length)this.data.push(a[s]),s+=1;else{const t=a[s],n=e[o];n.t<t.t?(this.data.push(n),o+=1):t.t<n.t?(this.data.push(t),s+=1):(this.data.push(n),s+=1,o+=1)}this.counter_gpsVario.reset(),this.counter_baroVarion.reset(),this.counter_velocity.reset();var l,r=Object(M.a)(this.data);try{for(r.s();!(l=r.n()).done;){let t=l.value;const e=this.counter_gpsVario.update(t.gpsAlt,t.t),n=this.counter_baroVarion.update(t.baroAlt,t.t),i=this.counter_velocity.update(t.pos,t.t);t.gpsVario=e,t.baroVario=n,t.velocity=i}}catch(c){r.e(c)}finally{r.f()}}}const H=registerPersistentState("chosen-pilots",{}),getChosenPilotsObject=()=>H;function getChosenPilots(){return H.getValue()}function setChosenPilots(t){console.log("Selected pilots updated: ",t),H.setValue(t)}function setChosenPilotsAndUpdateInfos(t=null){let e=!0;null===t&&(t=Object(C.a)({},getChosenPilots()),e=!1);const n=getXContestInterface().getPilotInfos();for(const i in t)if(i in n){const a=n[i].info.user.fullname;a!==t[i].name&&(t[i].name=a,e=!0);const s=n[i].lastFix,o=t[i].lastFix;o&&o.t===s.timestamp||(t[i].lastFix={t:parseTime(s.timestamp),lat:s.lat,lon:s.lon,landed:n[i].landed},e=!0)}e&&setChosenPilots(t)}const setPilotShown=(t,e)=>{const n=Object(C.a)({},getChosenPilots());if(t in n){const i=n[t];i.shown!==e&&(i.shown=e,setChosenPilots(n))}},defaultPilotEntry=t=>({name:t,shown:!0,lastFix:null}),addPilots=t=>{const e=Object(C.a)({},getChosenPilots());let n=!1;var i,a=Object(M.a)(t);try{for(a.s();!(i=a.n()).done;){const t=i.value;t in e||(e[t]=defaultPilotEntry(t),n=!0)}}catch(s){a.e(s)}finally{a.f()}n&&setChosenPilotsAndUpdateInfos(e)},lerp=(t,e,n)=>null===e?t:null===t?e:(1-n)*t+n*e,spline=(t,e,n,i,a,s,o,l,r)=>{s-=e,l-=e;const c=((n-t)*(r-=e)+t*(i-=e)-n*(e=0))/(i-e),h=((a-n)*r+n*s-a*i)/(s-i),p=((o-a)*r+a*l-o*s)/(l-s),u=((h-c)*r+c*s-h*e)/(s-e),d=((p-h)*r+h*l-p*i)/(l-i);return((d-u)*r+u*s-d*i)/(s-i)},splineDerivative=(t,e,n,i,a,s,o,l,r)=>{s-=e,l-=e;const c=((n-t)*(r-=e)+t*(i-=e)-n*(e=0))/(i-e),h=((a-n)*r+n*s-a*i)/(s-i),p=((o-a)*r+a*l-o*s)/(l-s),u=(n-t)/(i-e),d=(a-n)/(s-i),m=(o-a)/(l-s),g=(d*r+h-u*r-c+u*s-d*e)/(s-e),f=(m*r+p-d*r-h+d*l-m*i)/(l-i);return(f*r+((p-h)*r+h*l-p*i)/(l-i)-g*r-((h-c)*r+c*s-h*e)/(s-e)+g*s-f*i)/(s-i)};class FlightAnimationDataCache{constructor(){this.reset=()=>{this.currentArrayPos=null,this.mapsPath=[],this.mapsPathNewestPos=0},this.currentArrayPos=null,this.mapsPath=[],this.mapsPathNewestPos=0}}class FlightAnimation_DataGens{static takeData(t){return{baroAlt:t.baroAlt,gpsAlt:t.gpsAlt,elevation:t.elevation,pos:{lat:t.pos.lat,lng:t.pos.lng},gpsVario:t.gpsVario,baroVario:t.baroVario,velocity:t.velocity}}static blendData(t,e,n){const i=(n-t.t)/(e.t-t.t);return{baroAlt:lerp(t.baroAlt,e.baroAlt,i),gpsAlt:lerp(t.gpsAlt,e.gpsAlt,i),elevation:lerp(t.elevation,e.elevation,i),pos:{lat:lerp(t.pos.lat,e.pos.lat,i),lng:lerp(t.pos.lng,e.pos.lng,i)},gpsVario:lerp(t.gpsVario,e.gpsVario,i),baroVario:lerp(t.baroVario,e.baroVario,i),velocity:lerp(t.velocity,e.velocity,i)}}static blendDataSpline(t,e,n,i,a){const s=(a-e.t)/(n.t-e.t);return{baroAlt:lerp(e.baroAlt,n.baroAlt,s),gpsAlt:lerp(e.gpsAlt,n.gpsAlt,s),elevation:lerp(e.elevation,n.elevation,s),pos:{lat:spline(t.pos.lat,t.t,e.pos.lat,e.t,n.pos.lat,n.t,i.pos.lat,i.t,a),lng:spline(t.pos.lng,t.t,e.pos.lng,e.t,n.pos.lng,n.t,i.pos.lng,i.t,a)},gpsVario:lerp(e.gpsVario,n.gpsVario,s),baroVario:lerp(e.baroVario,n.baroVario,s),velocity:lerp(e.velocity,n.velocity,s)}}static computeLinearVelocity(t,e){const n=t.t,i=e.t;if(n===i)return null;const a=i-n,s=t.pos,o=e.pos;return{lat:(o.lat-s.lat)/a,lng:(o.lng-s.lng)/a}}static computeSplineVelocity(t,e,n,i,a){const s=t.t,o=e.t,l=n.t,r=i.t,c=t.pos,h=e.pos,p=n.pos,u=i.pos;return{lat:splineDerivative(c.lat,s,h.lat,o,p.lat,l,u.lat,r,a),lng:splineDerivative(c.lng,s,h.lng,o,p.lng,l,u.lng,r,a)}}}FlightAnimation_DataGens.fallbackData=t=>({baroAlt:t.lastFix.baroAlt,gpsAlt:t.lastFix.gpsAlt,elevation:t.lastFix.elevation,pos:{lat:t.lastFix.lat,lng:t.lastFix.lon},gpsVario:null,baroVario:null,velocity:null}),FlightAnimation_DataGens.offlineData=t=>({baroAlt:null,gpsAlt:null,elevation:null,pos:{lat:t.lastFix.lat,lng:t.lastFix.lon},gpsVario:null,baroVario:null,velocity:null});var z=class FlightAnimation_FlightAnimation{constructor(t){this.destroy=()=>{getSetting(L).unregisterCallback(this.updateSettings),getSetting(I).unregisterCallback(this.updateSettings),getSetting(T).unregisterCallback(this.updateSettings),getSetting(A).unregisterCallback(this.updateSettings)},this.updateSettings=()=>{this.settings={timeOffsetSeconds:getSetting(L).getValue(),lowLatencyMode:getSetting(I).getValue(),trackLengthMinutes:getSetting(T).getValue(),limitTracks:getSetting(A).getValue()},this.liveDataCache.reset(),this.flightInfoDataCache.reset()},this.updateInfos=t=>{this.landed|=t.landed,this.flightInfos=t,this.flightInfoData.replace(t.track),this.flightInfoDataCache.reset()},this.updateData=t=>{if(t.length<1)return;const e=parseTime(t[0].timestamp);this.liveData.isAfterLastElement(e)?this.liveData.append(t):(this.liveData.insert(t),this.liveDataCache.reset())},this.updateLanded=()=>{console.log("Received flight landed message!"),this.landed=!0},this.getInterpolatedData=(t,e,n)=>{if(t.length<1)return null;null===e.currentArrayPos?e.currentArrayPos=t.findBisect(n):e.currentArrayPos=t.findForwardSwipe(n,e.currentArrayPos);let i=null,a=!1,s=!1,o=null;if(e.currentArrayPos<=0)i=FlightAnimation_DataGens.takeData(t.at(0)),t.length>=2&&(o=FlightAnimation_DataGens.computeLinearVelocity(t.at(0),t.at(1))),s=!0;else if(e.currentArrayPos>=t.length)i=FlightAnimation_DataGens.takeData(t.at(t.length-1)),t.length>=2&&(o=FlightAnimation_DataGens.computeLinearVelocity(t.at(t.length-2),t.at(t.length-1))),a=!0;else{const a=t.at(e.currentArrayPos-1),s=t.at(e.currentArrayPos),l=e.currentArrayPos-2>=0?t.at(e.currentArrayPos-2):Object(C.a)({},a,{t:a.t-1}),r=e.currentArrayPos+1<t.length?t.at(e.currentArrayPos+1):Object(C.a)({},s,{t:s.t+1});i=FlightAnimation_DataGens.blendDataSpline(l,a,s,r,n),o=FlightAnimation_DataGens.computeSplineVelocity(l,a,s,r,n)}return[i,s,a,t.at(t.length-1).t,o]},this.getFallbackData=()=>[FlightAnimation_DataGens.fallbackData(this.flightInfos),!1,!0,parseTime(this.flightInfos.lastFix.timestamp),null],this.computeTrack=(t,e,n)=>{if(t.length<1)return null;const i=n-60*this.settings.trackLengthMinutes;let a=e.mapsPath;for(;e.mapsPathNewestPos<t.length&&t.at(e.mapsPathNewestPos).t<n;){const n=t.at(e.mapsPathNewestPos);a.push({lat:n.pos.lat,lng:n.pos.lng,timestamp:n.t,altitude:null!==n.gpsAlt?n.gpsAlt:n.baroAlt,elevation:n.elevation}),e.mapsPathNewestPos+=1}if(this.settings.limitTracks){const t=32;let n=0;for(;n+t-1<a.length&&a[n+t-1].timestamp<i;)n+=t;n>0&&(a=a.slice(n),e.mapsPath=a)}return a},this.updateAnimation=t=>{const e=this.settings.lowLatencyMode?t/1e3:t/1e3-this.settings.timeOffsetSeconds;let n=this.getInterpolatedData(this.liveData,this.liveDataCache,e);n||(n=this.getInterpolatedData(this.flightInfoData,this.flightInfoDataCache,e)),n||(n=this.getFallbackData());let i=this.computeTrack(this.liveData,this.liveDataCache,e);i||(i=this.computeTrack(this.flightInfoData,this.flightInfoDataCache,e)),i||(i=[]);let a=n,s=Object(l.a)(a,5),o=s[0],r=s[1],c=s[2],h=s[3],p=s[4];this.settings.lowLatencyMode&&(c=!!this.landed||h<e-80);let u=e;return c&&this.landed&&(u=h),Object(C.a)({},o,{startOfTrack:r,endOfTrack:c,landed:this.landed,name:this.flightInfos.info.user.fullname,newestDataTimestamp:h,track:i,velocityVec:p,lastPotentialAirTime:Math.round(u),offline:!1})},this.getNewestTimestamp=()=>this.liveData.getNewestTimestamp(),this.liveData=new FlightAnimationData_FlightAnimationData,this.liveDataCache=new FlightAnimationDataCache,this.flightInfos=null,this.flightInfoData=new FlightAnimationData_FlightAnimationData,this.flightInfoDataCache=new FlightAnimationDataCache,this.landed=t.landed,this.updateInfos(t),this.settings={},this.updateSettings(),getSetting(L).registerCallback(this.updateSettings),getSetting(I).registerCallback(this.updateSettings),getSetting(T).registerCallback(this.updateSettings),getSetting(A).registerCallback(this.updateSettings)}};var U=class HighPrecisionTimeSync{constructor(t=20){this.get=(t,e)=>{let n=t+this.offset;const i=n-e;return(i>this.tolerance||i<-this.tolerance)&&(this.offset-=i,n=t+this.offset),n},this.offset=0,this.tolerance=t}};class XContestAnimation_XContestAnimation{constructor(t){this._nextUpdate=Date.now(),this.animationLoop=()=>{const t=Date.now(),e=1e3/this._setting_fps;if(!this._setting_limitFps||t>=this._nextUpdate){this._setting_limitFps&&(this._nextUpdate+=e,t>this._nextUpdate&&(this._nextUpdate=t));const n={},i={};Object.entries(this._subscribedPilots).forEach(([e,a])=>{if(e in this._pilotInfos){const s=this._pilotInfos[e].flightId;if(s in this._flightAnimations){const o=this._flightAnimations[s].updateAnimation(t);n[e]=o,a.shown&&(i[e]=o)}}else if(this._setting_showOfflinePilots&&null!=a.lastFix&&a.lastFix.landed){const t=((t,e)=>{const n=e.lastFix.landed;return Object(C.a)({},FlightAnimation_DataGens.offlineData(e),{startOfTrack:!n,endOfTrack:n,landed:n,name:null==e.name?t:e.name,newestDataTimestamp:e.lastFix.t,track:[],velocityVec:null,lastPotentialAirTime:e.lastFix.t,offline:!0})})(e,a);n[e]=t,a.shown&&(i[e]=t)}}),this._submitAnimationFrame({pilotData:n,pilotData_filtered:i})}requestAnimationFrame(this.animationLoop)},this._submitAnimationFrame=t=>{this._currentAnimationData=t;var e,n=Object(M.a)(this._callbacks);try{for(n.s();!(e=n.n()).done;){(0,e.value)(t)}}catch(i){n.e(i)}finally{n.f()}},this.setSubscribedPilots=t=>{this._subscribedPilots=t,this._updateImportantFlights()},this.pushNewInfo=t=>{console.log("newInfo: ",t),this._pilotInfos=t,this._updateImportantFlights(),Object.values(t).forEach(t=>{const e=t.flightId;e in this._flightAnimations&&this._flightAnimations[e].updateInfos(t)})},this.pushNewData=(t,e)=>{console.log("newTrackdata: ",t,e),t in this._flightAnimations&&this._flightAnimations[t].updateData(e)},this.pushFlightLanded=t=>{t in this._flightAnimations&&this._flightAnimations[t].updateLanded()},this.registerCallback=t=>{this._callbacks.includes(t)||this._callbacks.push(t),t(this._currentAnimationData)},this.unregisterCallback=t=>{const e=this._callbacks.indexOf(t);e>=0&&this._callbacks.splice(e,1)},this.getData=()=>this._currentAnimationData,this._updateImportantFlights=()=>{let t={};Object.values(this._pilotInfos).filter(t=>t.info.user.username in this._subscribedPilots).forEach(e=>{t[e.flightId]=e});let e=new Set(Object.keys(t));{const e=[];for(const n in this._flightAnimations)n in t||e.push(n);for(var n=0,i=e;n<i.length;n++){const t=i[n];console.log("Removing flightAnimation of '"+t+"' ..."),this._flightAnimations[t].destroy(),delete this._flightAnimations[t]}}if(Object.entries(t).forEach(([t,e])=>{t in this._flightAnimations||(this._flightAnimations[t]=new z(e))}),!function eqSet(t,e){if(t.size!==e.size)return!1;var n,i=Object(M.a)(t);try{for(i.s();!(n=i.n()).done;){const t=n.value;if(!e.has(t))return!1}}catch(a){i.e(a)}finally{i.f()}return!0}(e,this._subscribedFlights)){this._subscribedFlights=e;let t=[];console.log(this._flightAnimations),e.forEach(e=>{console.log(e,this._flightAnimations[e]),t.push([e,this._flightAnimations[e].getNewestTimestamp()])}),console.log("Changing flight subscribtion: ",this._subscribedFlights,e),this._setSubscribedFlightsCallback(t)}},this._currentAnimationData={pilotData:{},pilotData_filtered:{}},this._callbacks=[],this._subscribedPilots=getChosenPilots(),this._subscribedFlights=new Set,this._pilotInfos={},this._flightAnimations={},this._highPrecisionTimeSync=new U;const e=getSetting(D),n=getSetting(F),i=getSetting(N);this._setting_limitFps=e.getValue(),this._setting_fps=n.getValue(),this._setting_showOfflinePilots=i.getValue(),e.registerCallback(t=>{this._setting_limitFps=t}),n.registerCallback(t=>{this._setting_fps=t}),i.registerCallback(t=>{this._setting_showOfflinePilots=t}),this._setSubscribedFlightsCallback=e=>{t(Array.from(e))},getChosenPilotsObject().registerCallback(this.setSubscribedPilots),requestAnimationFrame(this.animationLoop)}}var B=class EventfulState_EventfulState{constructor(t){this.set=t=>{this._callbackData=t;var e,n=Object(M.a)(this._callbacks);try{for(n.s();!(e=n.n()).done;){(0,e.value)(t)}}catch(i){n.e(i)}finally{n.f()}},this.getValue=()=>this._callbackData,this.registerCallback=t=>{this._callbacks.includes(t)||this._callbacks.push(t)},this.unregisterCallback=t=>{const e=this._callbacks.indexOf(t);e>=0&&this._callbacks.splice(e,1)},this.use=()=>{const t=Object(i.useState)(this._callbackData),e=Object(l.a)(t,2),n=e[0],a=e[1];return Object(i.useEffect)(()=>(this.registerCallback(a),()=>this.unregisterCallback(a)),[]),n},this._callbacks=[],this._callbackData=t}};const X={CONNECTING:"connecting",ERROR:"error",ESTABLISHED:"established",ACTIVE:"active",INACTIVE:"inactive",NO_CONNECTION:"no connection",NO_INFORMATION:"no information"};class XContestInterface_XContestInterface{constructor(){this.setSubscribedFlights=t=>{this.socket.setSubscribedFlights(t)},this.getPilotInfos=()=>this.pilots,this.onConnectionStateChanged=t=>{this.connectionState.set(t)},this.onInfoMessageReceived=t=>{this.pilots={};var e,n=Object(M.a)(t);try{for(n.s();!(e=n.n()).done;){const t=Object(l.a)(e.value,2),n=t[0],i=t[1];i.overriden||(i.flightId=n,this.pilots[i.info.user.username]=i)}}catch(i){n.e(i)}finally{n.f()}this.animation.pushNewInfo(this.pilots),this.pilotInfos.set(this.pilots),setChosenPilotsAndUpdateInfos()},this.onTracklogMessageReceived=t=>{this.animation.pushNewData(t.flightUuid,t.trackChunk)},this.onFlightLandedMessageReceived=t=>{this.animation.pushFlightLanded(t)},this.pilots=[],this.connectionState=new B(X.NO_INFORMATION),this.pilotInfos=new B([]),this.socket=new XContestSocket_XContestSocket(this.onConnectionStateChanged,this.onInfoMessageReceived,this.onTracklogMessageReceived,this.onFlightLandedMessageReceived),this.animation=new XContestAnimation_XContestAnimation(this.setSubscribedFlights)}}let J=null;const getXContestInterface=()=>(J||(J=new XContestInterface_XContestInterface),J);function createRng(t){const e=function xmur3(t){for(var e=0,n=1779033703^t.length;e<t.length;e++)n=(n=Math.imul(n^t.charCodeAt(e),3432918353))<<13|n>>>19;return function(){return n=Math.imul(n^n>>>16,2246822507),n=Math.imul(n^n>>>13,3266489909),(n^=n>>>16)>>>0}}(t);return function sfc32(t,e,n,i){return function(){var a=(t>>>=0)+(e>>>=0)|0;return t=e^e>>>9,e=(n>>>=0)+(n<<3)|0,n=(n=n<<21|n>>>11)+(a=a+(i=(i>>>=0)+1|0)|0)|0,(a>>>0)/4294967296}}(e(),e(),e(),e())}var Y=n(152),q=n.n(Y);function string2color(t,e){const n=createRng(t),i=Math.min(Math.max(360*n(),0),360);return"#"+q.a.hsl.hex(i,100,e)}const getPilotIconColor=t=>string2color(t,70),getPilotIcon=(t,e,n,i,a,s)=>{if(e)return n?{path:"m 12.66,19.78 6.46,-4.61 C 19.67,14.78 20,14.15 20,13.48 20,11.77 18.08,10.79 16.7,11.77 L 12,15.12 7.3,11.77 c -1.38,-0.99 -3.3,0 -3.3,1.71 0,0.67 0.33,1.31 0.88,1.7 l 6.46,4.62 c 0.4,0.27 0.93,0.27 1.33,-0.01 z m 0,-8 6.46,-4.6 C 19.67,6.78 20,6.15 20,5.48 20,3.77 18.08,2.78 16.7,3.77 L 12,7.12 7.3,3.77 C 5.92,2.78 4,3.77 4,5.48 4,6.15 4.33,6.79 4.88,7.18 l 6.46,4.62 c 0.4,0.27 0.93,0.27 1.33,-0.01 z",fillColor:s,fillOpacity:1,anchor:{x:12,y:20},strokeWeight:1,scale:1.2}:{path:"M 12.747,2 C 12.492,1.998 12.234,2.006 11.973,2.023 8.105,2.256 6.071,4.458 5.904,8.427 H 9.806 C 9.839,7.06 10.64,6.025 12.041,5.859 c 1.401,-0.133 2.735,0.2 3.135,1.134 0.434,1.034 -0.534,2.234 -1.001,2.734 -0.867,0.934 -2.268,1.634 -3.002,2.635 -0.7,1.001 -0.834,2.302 -0.901,3.902 h 3.435 c 0.033,-1.034 0.1,-2.001 0.567,-2.635 0.767,-1.034 1.901,-1.501 2.835,-2.335 0.9,-0.767 1.868,-1.701 2.001,-3.168 C 19.642,4.093 16.568,2.023 12.747,2 Z M 12.074,17.731 A 2.168,2.134 0 0 0 9.906,19.865 2.168,2.134 0 0 0 12.074,22 2.168,2.134 0 0 0 14.242,19.865 2.168,2.134 0 0 0 12.074,17.731 Z",fillColor:s,fillOpacity:1,anchor:{x:12,y:12},strokeWeight:1,scale:1.2};if(t)return{path:"M 12,2 C 8.13,2 5,5.13 5,9 c 0,5.25 7,13 7,13 0,0 7,-7.75 7,-13 0,-3.87 -3.13,-7 -7,-7",fillColor:s,fillOpacity:1,anchor:{x:12,y:22},strokeWeight:1,scale:1.2};return{path:"M12.93 4.26l6.15 14.99c.34.83-.51 1.66-1.33 1.29l-5.34-2.36c-.26-.11-.55-.11-.81 0l-5.34 2.36c-.82.36-1.67-.46-1.33-1.29l6.15-14.99c.33-.83 1.51-.83 1.85 0z",fillColor:s,fillOpacity:1,anchor:{x:12,y:12},strokeWeight:1,scale:1.2,rotation:null===a?0:Object(W.getRhumbLineBearing)(i,{lat:i.lat+a.lat,lng:i.lng+a.lng})}};class MapViewportControllerService_MapViewportControllerService{constructor(){this.setState=t=>{this.state=Object(C.a)({},this.state,{},t)},this.setFreeMode=()=>{this.setState({enabled:!1})},this.setSinglePilotMode=t=>{this.setState({enabled:!0,followSinglePilot:t}),this._emitZoomToSinglePilot()},this.setFollowMode=()=>{this.setState({enabled:!0,followSinglePilot:null})},this._emitZoomToSinglePilot=()=>{var t,e=Object(M.a)(this.mapControllers);try{for(e.s();!(t=e.n()).done;){t.value.zoomToSinglePilot()}}catch(n){e.e(n)}finally{e.f()}},this.onSelfShownChanged=t=>{this.setState({includeSelf:t})},this.onAnimationFrame=({pilotData_filtered:t})=>{const e=this.state,n=Object(C.a)({},e);n.pilots=Object(C.a)({},n.pilots);for(const o in e.pilots)o in t||delete n.pilots[o];for(const o in t)o in n.pilots||(n.pilots[o]=!0);this.state=n;var i,a=Object(M.a)(this.mapControllers);try{for(a.s();!(i=a.n()).done;){i.value.onAnimationFrame(t,this.state)}}catch(s){a.e(s)}finally{a.f()}},this.registerMapController=t=>{this.mapControllers.includes(t)||this.mapControllers.push(t)},this.unregisterMapController=t=>{const e=this.mapControllers.indexOf(t);e>=0&&this.mapControllers.splice(e,1)},this.mapControllers=[],this.state={includeSelf:getSetting(j).getValue(),enabled:!0,followSinglePilot:null,pilots:{}},getXContestInterface().animation.registerCallback(this.onAnimationFrame),getSetting(j).registerCallback(this.onSelfShownChanged)}}let Z=null;const getMapViewportControllerService=()=>(Z||(Z=new MapViewportControllerService_MapViewportControllerService),Z);class GoogleMapsTrack_GoogleMapsTrack{constructor(t,e,n,i,a,s,o){this.computeIconBottomLeftCornerPos=t=>{const e=t.target;let n=t.pageX,i=t.pageY;!("touches"in t)||void 0!==n&&void 0!==i||(n=t.touches[0].pageX,i=t.touches[0].pageY);let a=e.x,s=e.y,o=e.width,l=e.height,isValid=()=>n>=a&&n<=a+o&&i>=s&&i<=s+l;if(a=e.x,s=e.y,o=e.width,l=e.height,isValid()||(console.log("First result invalid! Trying android version..."),a=e.x/window.devicePixelRatio,s=e.y/window.devicePixelRatio,o=e.width,l=e.height),!isValid())return console.log("Second result invalid! Returning raw mouse coords."),{left:n,top:i};return{left:a+o/2-13,top:s+l/2+13}},this.setMap=t=>{this.marker.setMap(t),this.track.setMap(t),this.newestTrackSegment.setMap(t)},this._updateTrack=t=>{if(!t||t.length<1)return;const e=t.length,n=t[0].timestamp,i=t[e-1].timestamp;if(n!==this.currentTrackVersion.startTime||i!==this.currentTrackVersion.endTime||e!==this.currentTrackVersion.length){if(n===this.currentTrackVersion.startTime&&e>this.currentTrackVersion.length&&i>this.currentTrackVersion.endTime){let n=this.track.getPath(),a=n.getLength();for(;a<e;){const e=t[a];a=n.push(new this.google.maps.LatLng(e.lat,e.lng))}return this.currentTrackVersion.endTime=i,void(this.currentTrackVersion.length=e)}this.currentTrackVersion.startTime=n,this.currentTrackVersion.endTime=i,this.currentTrackVersion.length=e,this.track.setPath(t)}},this._updateNewestSegment=(t,e)=>{null===this.newestTrackSegmentData&&(this.newestTrackSegment.setPath([t,e]),this.newestTrackSegmentData=[t,e]);const n=Object(l.a)(this.newestTrackSegmentData,2),i=n[0],a=n[1];this.newestTrackSegmentData=[t,e];const s=this.newestTrackSegment.getPath();if(t.lat!==i.lat||t.lng!==i.lng){const e=new this.google.maps.LatLng(t.lat,t.lng);s.setAt(0,e)}if(a.lat!==e.lat||a.lng!==e.lng){const t=new this.google.maps.LatLng(e.lat,e.lng);s.setAt(1,t)}},this.updateData=t=>{this.marker.setPosition(t.pos);let e=this.marker.getIcon();const n=getPilotIcon(t.startOfTrack,t.endOfTrack,t.landed,t.pos,t.velocityVec,this.pilotColor);if(((t,e)=>{for(let n in t)if(!(n in e))return!0;for(let n in e){if(!(n in t))return!0;if("anchor"===n){if(t[n].x!==e[n].x||t[n].y!==e[n].y)return!0}else if(t[n]!==e[n])return!0}return!1})(e,n)&&this.marker.setIcon(n),t.track.length>0){const e=t.track[t.track.length-1],n=t.pos;this._updateNewestSegment(n,e)}this._updateTrack(t.track)},this.google=t,this.pilotInfoWindow=a,this.pilotColor=getPilotIconColor(n),this.trackColor=string2color(n,40),this.pilotIcon=getPilotIcon(i.startOfTrack,i.endOfTrack,i.landed,i.pos,i.velocityVec,this.pilotColor),this.marker=new this.google.maps.Marker({map:e,position:i.pos,title:i.name,icon:this.pilotIcon}),this.marker.addListener("click",()=>{o()&&this.pilotInfoWindow.open(this.map,this.marker,n)}),this.marker.addListener("dblclick",()=>{getMapViewportControllerService().setSinglePilotMode(n)}),this.marker.addListener("mousedown",({tb:t})=>{s(!0,this.computeIconBottomLeftCornerPos(t))}),this.marker.addListener("mouseup",()=>{s(!1,null)}),this.marker.addListener("mouseover",({tb:t})=>{s(!0,this.computeIconBottomLeftCornerPos(t))}),this.marker.addListener("mouseout",()=>{s(!1,null)}),this.track=new this.google.maps.Polyline({map:e,path:[],strokeColor:this.trackColor}),this.currentTrackVersion={startTime:null,endTime:null,length:null},this.newestTrackSegment=new this.google.maps.Polyline({map:e,path:[],strokeColor:this.trackColor}),this.newestTrackSegmentData=null}}class MapPilotInfoWindow{constructor(t){this.open=(t,e,n)=>{this.currentPilot=n,this.infoWindow.open(t,e),this.updateContent()},this.close=()=>{this.infoWindow.close(),this.currentPilot=null,this.updateContent()},this.update=t=>{this.data=t,this.updateContent()},this.updateContent=()=>{if(null==this.infoWindow.anchor)return void(this.currentPilot=null);if(null===this.currentPilot)return;if(!(this.currentPilot in this.data))return this.currentPilot=null,void this.infoWindow.close();const t=this.data[this.currentPilot],e=null===t.gpsAlt?t.baroAlt:t.gpsAlt,n=Math.max(e-t.elevation,0);let i="";if(i+="<b>"+t.name+"</b>",null!==e&&null!==n&&(i+="<br>",i+=Math.round(e)+"m (",i+=Math.round(n)+"m)<br>"),null!==t.baroVario&&(!t.endOfTrack||!t.landed)){const e=Math.round(10*t.baroVario);let n=Math.abs(e);n>99&&(n=99),i+="<span>"+((e>=0?"&plus;":"&minus;")+Math.floor(n/10)+"."+n%10+"m/s")+"</span>&nbsp;&nbsp;"}null===t.velocity||t.endOfTrack&&t.landed||(i+=Math.round(3.6*t.velocity)+"km/h"),this.infoWindow.getContent()!==i&&this.infoWindow.setContent(i)},this.google=t,this.infoWindow=new t.maps.InfoWindow({content:"- ERROR -",pixelOffset:new t.maps.Size(0,-5),disableAutoPan:!0}),this.data={},this.currentPilot=null}}class MapAnimator_MapAnimator{constructor(t,e,n){this.cleanupOldTracks=t=>{const e=[];for(const a in this.tracks)a in t||e.push(a);for(var n=0,i=e;n<i.length;n++){const t=i[n];this.tracks[t].setMap(null),delete this.tracks[t]}},this.onMouseOver=(t,e,n)=>{e?(t in this.currentMouseOvers||(this.currentMouseOvers[t]={num:0,pos:{left:0,top:0}}),this.currentMouseOvers[t].num+=1,null!=n&&(this.currentMouseOvers[t].pos=n)):t in this.currentMouseOvers&&(this.currentMouseOvers[t].num-=1,this.currentMouseOvers[t].num<=0&&delete this.currentMouseOvers[t])},this.update=({pilotData_filtered:t})=>{this.cleanupOldTracks(t),Object.entries(t).forEach(([t,e])=>{t in this.tracks||(this.tracks[t]=new GoogleMapsTrack_GoogleMapsTrack(this.google,this.map,t,e,this.infoWindow,(e,n)=>this.onMouseOver(t,e,n),this.canReceiveMouseClicks)),this.tracks[t].updateData(e)}),this.infoWindow.update(t)},this.map=t,this.google=e,this.tracks={},this.infoWindow=new MapPilotInfoWindow(e),this.currentMouseOvers={},this.canReceiveMouseClicks=n}}n(245);class GPSProvider_GPSProvider{constructor(){this._updateGPSState=()=>{let t=getSetting(R).getValue(),e=this._callbacks.length>0,n=t&&e;null===this._watchId&&n&&navigator.geolocation&&(this._watchId=navigator.geolocation.watchPosition(this._onNewGPSData,this._onGPSError,{enableHighAccuracy:!0}),console.log("GPS: On")),null===this._watchId||n||(navigator.geolocation.clearWatch(this._watchId),this._watchId=null,this._setGPSData(null),console.log("GPS: Off"))},this._setGPSData=t=>{this._gpsData=t;var e,n=Object(M.a)(this._callbacks);try{for(n.s();!(e=n.n()).done;){(0,e.value)(t)}}catch(i){n.e(i)}finally{n.f()}},this._onNewGPSData=t=>{this._setGPSData(t)},this._onGPSError=()=>{this._setGPSData(null)},this.registerCallback=t=>{this._callbacks.includes(t)||this._callbacks.push(t),this._updateGPSState(),t(this._gpsData)},this.unregisterCallback=t=>{const e=this._callbacks.indexOf(t);e>=0&&this._callbacks.splice(e,1),this._updateGPSState()},this.getData=()=>this._gpsData,this._callbacks=[],this._watchId=null,this._gpsData=null,getSetting(R).registerCallback(this._updateGPSState),this._updateGPSState()}}let K=null;const getGPSProvider=()=>(K||(K=new GPSProvider_GPSProvider),K);class GoogleMapsController_GoogleMapsController{constructor(t,e){this.zoomToSinglePilot=()=>{this.insideMapsApiFunction=!0,this.map.getZoom()<12&&this.map.setZoom(12),this.insideMapsApiFunction=!1},this.shutdown=()=>{getGPSProvider().unregisterCallback(this.onGpsUpdate)},this.onGpsUpdate=t=>{this.gpsState=t},this.onUserInput=()=>{this.insideMapsApiFunction||getMapViewportControllerService().setFreeMode()},this.updateViewport=t=>{const e=this.singlePersonMode;if(this.singlePersonMode=!1,0===t.length)return;if(1===t.length)return this.insideMapsApiFunction=!0,this.map.panTo(t[0]),this.insideMapsApiFunction=!1,e||this.zoomToSinglePilot(),void(this.singlePersonMode=!0);let n=new this.google.maps.LatLngBounds(t[0],t[0]);t.forEach(t=>n.extend(t)),this.insideMapsApiFunction=!0,this.map.fitBounds(n),this.insideMapsApiFunction=!1},this.onAnimationFrame=(t,e)=>{if(!this.viewportInitialized){let e=[];for(var n=0,i=Object.entries(t);n<i.length;n++){const t=Object(l.a)(i[n],2)[1];e.push(t.pos)}this.gpsState&&e.push({lat:this.gpsState.coords.latitude,lng:this.gpsState.coords.longitude}),0!==e.length&&(this.updateViewport(e),this.viewportInitialized=!0)}if(!e.enabled)return void this.updateViewport([]);if(null!==e.followSinglePilot){const n=e.followSinglePilot;if(n in t)return void this.updateViewport([t[n].pos])}let a=[];e.includeSelf&&this.gpsState&&a.push({lat:this.gpsState.coords.latitude,lng:this.gpsState.coords.longitude});for(var s=0,o=Object.entries(e.pilots);s<o.length;s++){const e=Object(l.a)(o[s],2),n=e[0];e[1]&&n in t&&a.push(t[n].pos)}this.updateViewport(a)},this.google=t,this.map=e,this.lastUpdate=Date.now(),this.gpsState=getGPSProvider().getData(),getGPSProvider().registerCallback(this.onGpsUpdate),this.viewportInitialized=!1,this.singlePersonMode=!1,this.userInputListeners=[e.addListener("dragstart",this.onUserInput)],this.insideMapsApiFunction=!1}}n(246);const createButtonIcon=(t,e)=>{const n="http://www.w3.org/2000/svg";let i=document.createElementNS(n,"svg");i.setAttribute("width","24"),i.setAttribute("height","24"),i.setAttribute("viewBox",e);let a=document.createElementNS(n,"path");return a.setAttribute("d",t),i.appendChild(a),i};function createSatelliteMapButton(t,e){var n=document.createElement("div"),i=document.createElement("div");return i.classList.add("custom-google-maps-button"),i.title="Toggle satellite view",i.appendChild(createButtonIcon("M8.57 6H6v2.58c1.42 0 2.57-1.16 2.57-2.58zM12 6h-1.71c0 2.36-1.92 4.29-4.29 4.29V12c3.32 0 6-2.69 6-6zm2.14 5.86l-3 3.87L9 13.15 6 17h12z","0 0 24 24")),n.appendChild(i),n.onclick=()=>{e.getMapTypeId()===t.maps.MapTypeId.HYBRID?e.setMapTypeId(t.maps.MapTypeId.TERRAIN):e.setMapTypeId(t.maps.MapTypeId.HYBRID)},n}function createFocusCameraMapButton(t,e){var n=document.createElement("div"),i=document.createElement("div");return i.classList.add("custom-google-maps-button"),i.title="Focus camera",i.appendChild(createButtonIcon("M10 30h-4v8c0 2.21 1.79 4 4 4h8v-4h-8v-8zm0-20h8v-4h-8c-2.21 0-4 1.79-4 4v8h4v-8zm28-4h-8v4h8v8h4v-8c0-2.21-1.79-4-4-4zm0 32h-8v4h8c2.21 0 4-1.79 4-4v-8h-4v8zm-14-22c-4.42 0-8 3.58-8 8s3.58 8 8 8 8-3.58 8-8-3.58-8-8-8zm0 12c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4z","-10 -10 68 68")),n.appendChild(i),n.onclick=()=>{getMapViewportControllerService().setFollowMode()},n}function updateGpsMapButton(t,e){let n=t.firstChild;null===n&&(n=document.createElement("div"),n.classList.add("custom-google-maps-button"),n.title="Toggle GPS",n.appendChild(createButtonIcon("M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3c-.46-4.17-3.77-7.48-7.94-7.94V1h-2v2.06C6.83 3.52 3.52 6.83 3.06 11H1v2h2.06c.46 4.17 3.77 7.48 7.94 7.94V23h2v-2.06c4.17-.46 7.48-3.77 7.94-7.94H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z","-6 -6 36 36")),n.appendChild(createButtonIcon("M20.94 11c-.46-4.17-3.77-7.48-7.94-7.94V1h-2v2.06c-1.13.12-2.19.46-3.16.97l1.5 1.5C10.16 5.19 11.06 5 12 5c3.87 0 7 3.13 7 7 0 .94-.19 1.84-.52 2.65l1.5 1.5c.5-.96.84-2.02.97-3.15H23v-2h-2.06zM3 4.27l2.04 2.04C3.97 7.62 3.25 9.23 3.06 11H1v2h2.06c.46 4.17 3.77 7.48 7.94 7.94V23h2v-2.06c1.77-.2 3.38-.91 4.69-1.98L19.73 21 21 19.73 4.27 3 3 4.27zm13.27 13.27C15.09 18.45 13.61 19 12 19c-3.87 0-7-3.13-7-7 0-1.61.55-3.09 1.46-4.27l9.81 9.81z","-6 -6 36 36")),t.appendChild(n)),e?(n.childNodes[0].style.display=null,n.childNodes[1].style.display="none"):(n.childNodes[0].style.display="none",n.childNodes[1].style.display=null)}const $=(-1!==navigator.platform.indexOf("iPhone")||-1!==navigator.platform.indexOf("iPad")||navigator.platform.indexOf("iPod"),400);class ContextMenuHandler{constructor(t){this.onTouchStart=t=>{this.contextMenuPossible=!0;const e=t.touches[0];this.currentTouch=e,this.longPressCountdown=setTimeout(()=>{this.contextMenuPossible=!1,this.callback(e)},$)},this.onTouchMove=t=>{const e=t.touches[0];if(null!==this.currentTouch){const t=this.currentTouch.pageX-e.pageX,n=this.currentTouch.pageY-e.pageY;if(t*t+n*n<100)return}clearTimeout(this.longPressCountdown)},this.onTouchCancel=t=>{this.currentTouch=null,this.contextMenuPossible=!1,clearTimeout(this.longPressCountdown)},this.onTouchEnd=t=>{this.currentTouch=null,this.contextMenuPossible=!1,clearTimeout(this.longPressCountdown)},this.onContextMenu=t=>{this.contextMenuPossible=!1,clearTimeout(this.longPressCountdown),this.callback(t),t.preventDefault()},this.callback=t,this.longPressCountdown=null,this.contextMenuPossible=!1,this.currentTouch=null}}var Q=n(324),tt=n(326),et=n(327),nt=n(358),it=n(328),at=n(329),st=n(153),ot=n.n(st),lt=n(155),rt=n.n(lt),ct=n(71),ht=n.n(ct),pt=n(154),ut=n.n(pt);const dt=registerPersistentState("global.tab_id",1);var mt={TabID:dt,switchToMap:()=>{dt.setValue(0)}};class ContextMenu_ContextMenu extends a.a.PureComponent{constructor(...t){super(...t),this.generateMenuEntry=(t,e,n,i=!1)=>a.a.createElement(Q.a,{button:!0,onClick:i?void 0:n,disabled:i},a.a.createElement(tt.a,null,t),a.a.createElement(et.a,null,e)),this.close=()=>{this.props.onClose()},this.onDelete=()=>{(t=>{const e=Object(C.a)({},getChosenPilots());let n=!1;var i,a=Object(M.a)(t);try{for(a.s();!(i=a.n()).done;){const t=i.value;t in e&&(delete e[t],n=!0)}}catch(s){a.e(s)}finally{a.f()}n&&setChosenPilots(e)})([this.props.data.pilotId]),this.close()},this.onNavigateTo=()=>{const t=this.props.data.pilotInfo.lastFix;!function navigateTo(t){-1!==navigator.platform.indexOf("iPhone")||-1!==navigator.platform.indexOf("iPad")||-1!==navigator.platform.indexOf("iPod")?window.open("https://maps.apple.com/maps?q="+t.lat.toString()+","+t.lng.toString()):window.open("https://maps.google.com/maps?q="+t.lat.toString()+","+t.lng.toString())}({lat:t.lat,lng:t.lon}),this.close()},this.onShowOnMap=()=>{const t=this.props.data.pilotId;mt.switchToMap(),getMapViewportControllerService().setSinglePilotMode(t),this.close()},this.onHidePilot=()=>{const t=this.props.data.pilotId;setPilotShown(t,!1),this.close()},this.onUnhidePilot=()=>{const t=this.props.data.pilotId;setPilotShown(t,!0),this.close()}}render(){const t=this.props.data,e="onMap"in this.props,n=null!==t?t.offline:null,i=null!==t?t.pilotInfo.lastFix:null;return a.a.createElement(nt.a,{open:null!==t&&t.open,anchorReference:"anchorPosition",anchorPosition:null===t?null:t.pos,transformOrigin:{vertical:"top",horizontal:"right"},onClose:this.close},a.a.createElement(it.a,{dense:!0,subheader:e&&null!==t?a.a.createElement(at.a,null,null===t?null:t.pilotInfo.name):null},e||n?null:this.generateMenuEntry(a.a.createElement(ot.a,null),"Show Pilot on Map",this.onShowOnMap),n?null:null!==t&&t.pilotInfo.shown?this.generateMenuEntry(a.a.createElement(ht.a,null),"Hide Pilot",this.onHidePilot):this.generateMenuEntry(a.a.createElement(ht.a,null),"Unhide Pilot",this.onUnhidePilot),this.generateMenuEntry(a.a.createElement(ut.a,null),n?"Last Observed Position":"Open in Maps",this.onNavigateTo,null===i),this.generateMenuEntry(a.a.createElement(rt.a,null),"Remove Pilot",this.onDelete)))}}class LiveMap_LiveMap extends a.a.PureComponent{constructor(){super(),this.initializeGoogleMapsApi=()=>{const t={canceled:!1};this.cleanups.push(()=>{t.canceled=!0}),loadGoogleMapsApi().then(()=>{t.canceled||(this.google=window.google,this.setState({mapReady:!0}))}).catch(e=>{t.canceled||(console.log("Map error:",e),this.setState({mapError:!0}))})},this.initializeMapIfNecessary=()=>{if(!this.state.mapReady||this.state.mapError)return;if(null!==this.map)return;this.map=new this.google.maps.Map(this.mapsRef.current,{center:{lat:46.509012,lng:11.827984},mapTypeId:"terrain",zoom:5,maxZoom:15,disableDefaultUI:!0,zoomControl:!0,scaleControl:!0,fullscreenControl:!0,styles:_});const t=this.map,e=this.google;t.addListener("maptypeid_changed",()=>{t.getMapTypeId()===e.maps.MapTypeId.TERRAIN?t.setOptions({maxZoom:15}):t.setOptions({maxZoom:50})}),t.controls[e.maps.ControlPosition.TOP_LEFT].push(createSatelliteMapButton(e,t));const n=function createDisplayGpsMapButton(t,e){var n=document.createElement("div");return n.onclick=()=>{const t=getSetting(j);t.setValue(!t.getValue())},updateGpsMapButton(n,getSetting(j).getValue()),n}();t.controls[e.maps.ControlPosition.TOP_LEFT].push(n),t.controls[e.maps.ControlPosition.RIGHT_TOP].push(createFocusCameraMapButton());let mapButtonUpdater=t=>{updateGpsMapButton(n,t)};getSetting(j).registerCallback(mapButtonUpdater),this.cleanups.push(()=>{getSetting(j).unregisterCallback(mapButtonUpdater)}),this.mapAnimator=new MapAnimator_MapAnimator(t,e,()=>null===this.state.contextMenu||!this.state.contextMenu.open);const i=this.mapAnimator.update;getXContestInterface().animation.registerCallback(i),this.cleanups.push(()=>{getXContestInterface().animation.unregisterCallback(i)});const a=function createGeolocationMarker(t,e){class GeolocationMarker extends t.maps.MVCObject{constructor(e,n,i,a){super(),this.outerMarker_=null,this.marker_=null,this.circle_=null,this.watchId_=-1;var s={clickable:!1,cursor:"pointer",draggable:!1,flat:!0,icon:{path:t.maps.SymbolPath.CIRCLE,fillColor:"#C8D6EC",fillOpacity:.7,scale:12,strokeWeight:0},position:new t.maps.LatLng(0,0),title:"Current location",zIndex:2},o={clickable:!1,cursor:"pointer",draggable:!1,flat:!0,icon:{path:t.maps.SymbolPath.CIRCLE,fillColor:"#4285F4",fillOpacity:1,scale:6,strokeColor:"white",strokeWeight:2},optimized:!1,position:new t.maps.LatLng(0,0),title:"Current location",zIndex:3};n&&(s=this.copyOptions_(s,n)),i&&(o=this.copyOptions_(o,i));var l={clickable:!1,radius:0,strokeColor:"1bb6ff",strokeOpacity:.4,fillColor:"61a0bf",fillOpacity:.4,strokeWeight:1,zIndex:1};a&&(l=this.copyOptions_(l,a)),this.outerMarker_=new t.maps.Marker(s),this.marker_=new t.maps.Marker(o),this.circle_=new t.maps.Circle(l),t.maps.MVCObject.prototype.set.call(this,"accuracy",null),t.maps.MVCObject.prototype.set.call(this,"position",null),t.maps.MVCObject.prototype.set.call(this,"map",null),this.set("minimum_accuracy",null),this.set("position_options",{enableHighAccuracy:!0,maximumAge:1e3}),this.circle_.bindTo("map",this.outerMarker_),this.circle_.bindTo("map",this.marker_),e&&this.setMap(e)}set(e,n){if(GeolocationMarker.invalidPropertiesExpr_.test(e))throw new Error("'"+e+"' is a read-only property.");"map"===e?this.setMap(n):t.maps.MVCObject.prototype.set.call(this,e,n)}getMap(){return this.get("map")}getPositionOptions(){return this.get("position_options")}setPositionOptions(t){this.set("position_options",t)}getPosition(){return this.get("position")}getBounds(){return this.get("position")?this.circle_.getBounds():null}getAccuracy(){return this.get("accuracy")}getMinimumAccuracy(){return this.get("minimum_accuracy")}setMinimumAccuracy(t){this.set("minimum_accuracy",t)}setMap(e){t.maps.MVCObject.prototype.set.call(this,"map",e),e?this.watchPosition_():(this.outerMarker_.unbind("position"),this.marker_.unbind("position"),this.circle_.unbind("center"),this.circle_.unbind("radius"),t.maps.MVCObject.prototype.set.call(this,"accuracy",null),t.maps.MVCObject.prototype.set.call(this,"position",null),navigator.geolocation.clearWatch(this.watchId_),this.watchId_=-1,this.outerMarker_.setMap(e),this.marker_.setMap(e))}setOuterMarkerOptions(t){this.outerMarker_.setOptions(this.copyOptions_({},t))}setMarkerOptions(t){this.marker_.setOptions(this.copyOptions_({},t))}setCircleOptions(t){this.circle_.setOptions(this.copyOptions_({},t))}updatePosition_(e){var n=new t.maps.LatLng(e.coords.latitude,e.coords.longitude),i=null==this.marker_.getMap();if(i){if(null!=this.getMinimumAccuracy()&&e.coords.accuracy>this.getMinimumAccuracy())return;this.outerMarker_.setMap(this.getMap()),this.marker_.setMap(this.getMap()),this.outerMarker_.bindTo("position",this),this.marker_.bindTo("position",this),this.circle_.bindTo("center",this,"position"),this.circle_.bindTo("radius",this,"accuracy")}this.getAccuracy()!==e.coords.accuracy&&t.maps.MVCObject.prototype.set.call(this,"accuracy",e.coords.accuracy),!i&&null!=this.getPosition()&&this.getPosition().equals(n)||t.maps.MVCObject.prototype.set.call(this,"position",n)}watchPosition_(){navigator.geolocation&&(this.watchId_=navigator.geolocation.watchPosition(this.updatePosition_.bind(this),this.geolocationError_.bind(this),this.getPositionOptions()))}geolocationError_(e){t.maps.event.trigger(this,"geolocation_error",e)}copyOptions_(t,e){for(var n in e)!0!==GeolocationMarker.DISALLOWED_OPTIONS[n]&&(t[n]=e[n]);return t}}return GeolocationMarker.DISALLOWED_OPTIONS={map:!0,position:!0,radius:!0},GeolocationMarker.invalidPropertiesExpr_=/^(?:position|accuracy)$/i,new GeolocationMarker(e)}(e,null);a.setPositionOptions({enableHighAccuracy:!0});const geolocationMarkerUpdateState=()=>{let e=getSetting(R).getValue(),n=getSetting(j).getValue();if(e&&n){a.setMap(t);const e=getGPSProvider().getData();null!==e&&a.updatePosition_(e)}else a.setMap(null)};geolocationMarkerUpdateState(),getSetting(R).registerCallback(geolocationMarkerUpdateState),getSetting(j).registerCallback(geolocationMarkerUpdateState),this.cleanups.push(()=>{getSetting(R).unregisterCallback(geolocationMarkerUpdateState),getSetting(j).unregisterCallback(geolocationMarkerUpdateState),a.setMap(null)});let s=new GoogleMapsController_GoogleMapsController(e,t);getMapViewportControllerService().registerMapController(s),this.cleanups.push(()=>{getMapViewportControllerService().unregisterMapController(s),s.shutdown()}),this.mapInitialized=!0},this.onContextMenu=t=>{if(null==this.mapAnimator)return;const e=Object.keys(this.mapAnimator.currentMouseOvers);if(e.length<1)return;const n=e[0],i=this.mapAnimator.currentMouseOvers[n].pos,a=getChosenPilots();if(!(n in a))return;const s=a[n];this.setState({contextMenu:{pilotId:n,pos:i,pilotInfo:s,open:!0}})},this.hideContextMenu=()=>{this.setState({contextMenu:Object(C.a)({},this.state.contextMenu,{open:!1})})},this.map=null,this.google=null,this.mapAnimator=null,this.mapsRef=a.a.createRef(),this.cleanups=[],this.state={mapReady:!1,mapError:!1,contextMenu:null},this.contextMenuHandler=new ContextMenuHandler(this.onContextMenu),this.initializeGoogleMapsApi()}componentDidMount(){this.initializeMapIfNecessary()}componentDidUpdate(){this.initializeMapIfNecessary()}componentWillUnmount(){[...this.cleanups].reverse().forEach(t=>t())}render(){return a.a.createElement(a.a.Fragment,null,a.a.createElement(r.a,{width:"100%",height:"100%",display:this.state.mapReady&&!this.state.mapError?"block":"none",ref:this.mapsRef,onWheel:()=>{getMapViewportControllerService().setFreeMode()},onTouchStart:this.contextMenuHandler.onTouchStart,onTouchMove:this.contextMenuHandler.onTouchMove,onTouchCancel:this.contextMenuHandler.onTouchCancel,onTouchEnd:this.contextMenuHandler.onTouchEnd,onContextMenu:t=>{this.contextMenuHandler.onContextMenu(t),t.preventDefault()}}),a.a.createElement(LoadingPage,{message:"Loading Maps ...",hideIf:this.state.mapReady||this.state.mapError}),a.a.createElement(ErrorPage,{message:"Unable to load map!",hideIf:!this.state.mapError}),a.a.createElement(ContextMenu_ContextMenu,{onMap:!0,data:this.state.contextMenu,onClose:this.hideContextMenu}))}}var gt=n(342),ft=n(162),bt=n.n(ft),vt=n(333),Ct=n(9),yt=n(353),wt=n(334),Et=n(335),kt=n(330);const Pt=[];window.addEventListener("popstate",()=>{0===Pt.length&&console.warn("History was already 0!");const t=Pt.pop();Pt.length>0&&window.history.pushState({},""),t&&t()},{passive:!0});var util_SubWindow=t=>{const e=Object(i.useState)(!1),n=Object(l.a)(e,2),s=n[0],o=n[1],r=Object(i.useState)(!1),c=Object(l.a)(r,2),h=c[0],p=c[1],u={push:t=>{const e=Pt.length;Pt.push(t),0===e&&window.history.pushState({},"")},pop:()=>{window.history.back()}};return a.a.useEffect(()=>{t.open&&!s&&(h?t.onClose():(u.push(()=>{o(!1),t.onClose()}),o(!0),p(!0)))}),!h||s||t.open||p(!1),s&&!t.open&&u.pop(),a.a.createElement(kt.a,{open:s,onClose:()=>{t.onClose()},fullScreen:t.fullScreen,maxWidth:t.maxWidth,fullWidth:t.fullWidth,classes:t.classes},t.children)};var St=n(331);const getRotationStyle=t=>{const e="rotate("+t.toString()+"deg)";return{transform:e,WebkitTransform:e,MozTransform:e,msTransform:e,OTransform:e}};class LastFixState_LastFixState extends a.a.PureComponent{constructor(t){super(t),this.getMessage=({timestamp:t,endOfTrack:e,landed:n,relative:i,showLastFix:a})=>{if(null==t)return["","never"];let s=new Date(t).getTime()-Date.now(),o="";return o=i?function formatTimeDiff(t){let e="";t<0&&(t=-t,e="-");let n=Math.floor(t/1e3);if(n<90)return e+n+" sec";let i=Math.floor(n/60);if(i<60)return e+i+" min";let a=Math.floor(i/60);if(i-=60*a,a<24)return e+a+":"+i.toString().padStart(2,"0")+" h";let s=Math.floor(a/24);return a-=24*s,e+s+"d "+a+":"+i.toString().padStart(2,"0")+" h"}(s):function timestampToTimeString(t){return new Date(t).toLocaleTimeString()}(t),e&&n?["#346B8F","\u2714 "+o]:-s<12e4&&!e?i?a?["green","\u26ab LIVE ("+o+")"]:["green","\u26ab LIVE"]:["green","\u26ab "+o]:i?["red","! LIVE ("+o+")"]:["red","! "+o]},this.shallowRerender=t=>{if(null!==this.msgRef.current){const e=this.msgRef.current,n=this.getMessage(t),i=Object(l.a)(n,2),a=i[0],s=i[1];Object.assign(e.style,{color:a}),e.innerHTML!==s&&(e.innerHTML=s)}},this.msgRef=a.a.createRef()}render(){const t=this.getMessage(this.props),e=Object(l.a)(t,2),n=e[0],i=e[1];return a.a.createElement("span",{style:{color:n},ref:this.msgRef},i)}}class LastFixState_LastFixArrow extends a.a.PureComponent{constructor(t){super(t),this.onNewGPSDataReceived=t=>{this.gpsData=t,this.updateThroughRef()},this.setFix=t=>{this.lastFix=t,this.updateThroughRef()},this.updateThroughRef=()=>{if(this.arrowRef.current){const t=LastFixState_LastFixArrow.getArrowRotationStyle(this.gpsData,this.lastFix);Object.assign(this.arrowRef.current.style,t)}if(this.distanceRef.current){const t=LastFixState_LastFixArrow.getDistance(this.gpsData,this.lastFix);t!==this.distanceRef.current.innerHTML&&(this.distanceRef.current.innerHTML=t)}},this.gpsData=getGPSProvider().getData(),this.distanceRef=a.a.createRef(),this.arrowRef=a.a.createRef(),this.lastFix=this.props.lastFix}componentDidMount(){getGPSProvider().registerCallback(this.onNewGPSDataReceived)}componentWillUnmount(){getGPSProvider().unregisterCallback(this.onNewGPSDataReceived)}static getDistance(t,e){if(null===t||null===e)return"--km";const n=Object(W.getDistance)({lat:t.coords.latitude,lng:t.coords.longitude},e);return(Math.round(n/100)/10).toString()+"km"}static getArrowRotationStyle(t,e){if(null===t||null===e)return getRotationStyle(0);const n=Object(W.getRhumbLineBearing)({lat:t.coords.latitude,lng:t.coords.longitude},e);return getRotationStyle(n)}render(){return this.lastFix=this.props.lastFix,a.a.createElement(a.a.Fragment,null,a.a.createElement("span",{ref:this.distanceRef},LastFixState_LastFixArrow.getDistance(this.gpsData,this.lastFix))," ",a.a.createElement("div",{ref:this.arrowRef,style:Object(C.a)({display:"inline-block"},LastFixState_LastFixArrow.getArrowRotationStyle(this.gpsData,this.lastFix))},"\u2191"))}}const TableHeader=()=>a.a.createElement(St.a,{component:"div",variant:"head",className:"MuiTableCell-stickyHeader",style:{height:37,display:"flex",alignItems:"center",boxSizing:"border-box"}},a.a.createElement("div",{style:{flex:"1"}},"Name"),a.a.createElement("div",{style:{width:"25%",textAlign:"right"}},"State"),a.a.createElement("div",{style:{width:"27%",textAlign:"right"}},"Country"));class PilotSelectorListRenderer_PilotSelectorListRow extends a.a.PureComponent{render(){const t=this.props,e=t.fullname,n=t.username,i=t.lastFix,s=t.timestamp,o=t.landed,l=t.iso,c=t.disabled;return a.a.createElement("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",boxSizing:"border-box",filter:c?"grayscale(100%) opacity(30%)":void 0}},a.a.createElement(r.a,{flex:"1",paddingLeft:1,paddingTop:1,paddingBottom:1},a.a.createElement(k.a,{variant:"body2"},e),a.a.createElement(k.a,{variant:"caption",color:"textSecondary",style:{paddingLeft:".5em"}},"[",n,"]")),a.a.createElement("div",{style:{width:"25%",textAlign:"right"}},a.a.createElement("div",null,a.a.createElement(k.a,{variant:"caption"},a.a.createElement(LastFixState_LastFixState,{timestamp:s,landed:o,endOfTrack:o,relative:!0}))),a.a.createElement("div",null,a.a.createElement(k.a,{variant:"caption"},a.a.createElement(LastFixState_LastFixArrow,{lastFix:i})))),a.a.createElement("div",{style:{width:"27%",textAlign:"right"}},a.a.createElement(r.a,{paddingRight:1,paddingLeft:1},l,a.a.createElement(r.a,{fontSize:"large",marginLeft:"4px",boxShadow:1,style:{verticalAlign:"middle"},className:"flag-icon flag-icon-"+l.toLowerCase()}))))}}const renderRow=({data:t,index:e,style:n})=>{const i=t.keys[e],s=t.data[i],o=s?s.info.user.fullname:"Offline User",l=s?s.info.user.username:i,r=s?s.lastFix:null,c=s?s.lastFix.timestamp:null,h=s?s.landed:null,p=s?s.info.user.nationality.iso:"--",u=-1!==t.selected.indexOf(i),d=-1!==t.alreadyAdded.indexOf(i);return a.a.createElement(St.a,{component:"div",variant:"body",padding:"none",style:Object(C.a)({},n,{backgroundColor:u&&!d?"rgba(0, 0, 0, 0.04)":void 0}),onClick:()=>{d||t.onPilotClicked(i)}},a.a.createElement(PilotSelectorListRenderer_PilotSelectorListRow,{fullname:o,username:l,lastFix:r,timestamp:c,landed:h,iso:p,disabled:d}))};var Ot=n(175),xt=n(156);const sortPilotList=(t,e)=>{if(e){const n={lat:e.coords.latitude,lng:e.coords.longitude};let i=Object.entries(t).map(([t,e])=>[t,Object(W.getDistance)(n,e.lastFix)]);return i.sort((t,e)=>t[1]-e[1]),i.map(t=>t[0])}{let e=Object.keys(t);return e.sort(),e}};class PilotSelectorList_PilotSelectorList extends a.a.PureComponent{constructor(t){super(t),this.startRendering=()=>{this.setState(t=>Object(C.a)({},t,{didMount:!0}))},this.updatePilotListIfNecessary=()=>{const t=sortPilotList(this.state.pilotInfos,this.gpsData);(function arraysEqual(t,e){if(!t||!e)return!1;if(t.length!==e.length)return!1;for(var n=0,i=t.length;n<i;n++)if(t[n]!==e[n])return!1;return!0})(this.state.sortedPilotList,t)||this.setState(e=>Object(C.a)({},e,{sortedPilotList:t}))},this.onNewGpsData=t=>{this.gpsData=t,this.updatePilotListIfNecessary()},this.onNewPilotInfos=t=>{this.setState(e=>Object(C.a)({},e,{pilotInfos:t,sortedPilotList:sortPilotList(t,this.gpsData)}))},this.onPilotClicked=t=>{this.props.onPilotClicked&&this.props.onPilotClicked(t)},this.gpsData=getGPSProvider().getData();const e=getXContestInterface().pilotInfos.getValue();this.state={didMount:!1,pilotInfos:e,sortedPilotList:sortPilotList(e,this.gpsData)}}componentDidMount(){getXContestInterface().pilotInfos.registerCallback(this.onNewPilotInfos),getGPSProvider().registerCallback(this.onNewGpsData),setTimeout(this.startRendering)}componentWillUnmount(){getXContestInterface().pilotInfos.unregisterCallback(this.onNewPilotInfos),getGPSProvider().unregisterCallback(this.onNewGpsData)}render(){if(!this.state.didMount)return a.a.createElement("div",{style:{width:"100%",display:"flex",justifyContent:"center",overflow:"hidden"}},a.a.createElement(P.a,{disableShrink:!0,style:{margin:"2em"}}));const t=((t,e,n)=>{const matchesSearch=t=>""===n||t.toLowerCase().includes(n.toLowerCase());let i=t.filter(t=>matchesSearch(e[t].info.user.username)||matchesSearch(e[t].info.user.fullname));return 0===i.length&&!/\s/.test(n)&&n.length>0&&i.push(n),i})(this.state.sortedPilotList,this.state.pilotInfos,this.props.search);return a.a.createElement(a.a.Fragment,null,a.a.createElement(TableHeader,null),a.a.createElement("div",{style:{flex:"1"}},a.a.createElement(xt.a,null,({height:e,width:n})=>a.a.createElement(Ot.a,{width:n,height:e,itemCount:t.length,itemSize:57,itemData:{keys:t,data:this.state.pilotInfos,selected:this.props.selected,alreadyAdded:this.props.alreadyAdded,onPilotClicked:this.onPilotClicked},itemKey:(t,{keys:e})=>e[t]},renderRow))))}}var _t=n(37);const Mt=Object(E.a)({fullHeightWindow:{height:"100%"}});var Tt=Object(_t.a)(t=>{const e=Mt(),n=Object(p.a)(),s=Object(u.a)(n.breakpoints.down("xs")),o=Object(i.useState)([]),c=Object(l.a)(o,2),h=c[0],d=c[1],m=Object(i.useState)(""),g=Object(l.a)(m,2),f=g[0],b=g[1],v=h.length,closeWindow=()=>{b(""),d([]),t.onClose()};return a.a.createElement(util_SubWindow,{open:t.open,onClose:closeWindow,fullScreen:s,maxWidth:"xs",fullWidth:!0,classes:{paper:e.fullHeightWindow}},a.a.createElement(vt.a,{style:0===v?{}:"light"===n.palette.type?{color:n.palette.secondary.main,backgroundColor:Object(Ct.d)(n.palette.secondary.light,.85)}:{color:n.palette.text.primary,backgroundColor:n.palette.secondary.dark}},v>0?a.a.createElement(k.a,{component:"div",color:"inherit",variant:"subtitle1"},v," selected"):a.a.createElement(k.a,{component:"div",variant:"h6",id:"tableTitle"},"Add new pilots:")),a.a.createElement(r.a,{paddingLeft:"1em",paddingRight:"1em",paddingTop:"4px"},a.a.createElement(yt.a,{margin:"dense",autoComplete:"off",variant:"outlined",id:"search_field",label:"Search",type:"search",fullWidth:!0,onChange:t=>b(t.target.value)})),a.a.createElement(r.a,{flex:"1 1 auto",marginY:"8px",display:"flex",flexDirection:"column",alignItems:"stretch"},a.a.createElement(PilotSelectorList_PilotSelectorList,{alreadyAdded:t.alreadyAdded,selected:h,onPilotClicked:t=>{const e=h.indexOf(t);let n=[];-1===e?n=n.concat(h,t):0===e?n=n.concat(h.slice(1)):e===h.length-1?n=n.concat(h.slice(0,-1)):e>0&&(n=n.concat(h.slice(0,e),h.slice(e+1))),d(n)},search:f})),a.a.createElement(wt.a,null,a.a.createElement(Et.a,{onClick:closeWindow,color:"primary"},"Cancel"),a.a.createElement(Et.a,{disabled:0===v,onClick:()=>{t.onAddPilots(h),closeWindow()},color:"primary"},"Add")))}),At=n(4),It=n(357),Lt=n(336),Dt=n(337),Ft=n(95),Rt=n.n(Ft),jt=n(322),Vt=n(291),Nt=n(159),Gt=n.n(Nt),Wt=n(160),Ht=n.n(Wt),zt=n(161),Ut=n.n(zt);class ElevationHistogram_ElevationHistogram extends a.a.PureComponent{constructor(t){super(t),this.prepareCanvasAndComputeLimits=(t,e)=>{const n=window.devicePixelRatio||1,i=t.getBoundingClientRect();if(t.width=i.width*n,t.height=i.height*n,e.endOfTrack&&e.landed&&e.track.length>0){const t=e.lastPotentialAirTime,n=e.track[0].timestamp;return Math.max(1,t-n)}return 900},this.renderCanvas=(t,e,n,i,a,s,o)=>{const r=window.devicePixelRatio||1,c=t.width,h=t.height,getCoord=(t,e)=>[c*(1-(s-t)/a),h*(1-(e-n)/(i-n))],p=getCoord(0,o),u=Object(l.a)(p,2)[1];let d=t.getContext("2d",{alpha:!1});d.fillStyle=this.COLOR_GROUND,d.fillRect(0,0,c,h),d.fillStyle=this.COLOR_SKY,d.strokeStyle=this.COLOR_PILOT,d.beginPath(),d.moveTo(0,0),d.lineTo(c,0),d.lineTo(c,u);let m=u;for(let g=e.length-1;g>=0;g--){const t=e[g];if(t.timestamp<s-a)break;const n=getCoord(t.timestamp,t.elevation),i=Object(l.a)(n,2),o=i[0],r=i[1];d.lineTo(o,r),m=r}d.lineTo(0,m),d.fill(),d.lineWidth=1.5*r,d.lineJoin="round",d.lineCap="round",d.beginPath();for(let g=e.length-1;g>=0;g--){const t=e[g];if(t.timestamp<s-a)break;const n=getCoord(t.timestamp,t.altitude),i=Object(l.a)(n,2),o=i[0],r=i[1];g===e.length-1?d.moveTo(o,r):d.lineTo(o,r)}d.stroke()},this.shallowRerender=(t,e=!1)=>{if(!(this.props.pilot in t))return;if(null===this.canvasRef.current)return;const n=this.canvasRef.current,i=t[this.props.pilot],a=i.track,s=i.elevation,o=i.lastPotentialAirTime,l=a.length>0?a[0].timestamp:null;if(!e&&this.lastRenderedTimestamp===o&&this.lastRenderedTrackStart===l)return;this.lastRenderedTimestamp=o,this.lastRenderedTrackStart=l;const r=null!==i.gpsAlt?i.gpsAlt:i.baroAlt;if(null===r)return;const c=this.prepareCanvasAndComputeLimits(n,i);let h=s,p=r;for(let u=a.length-1;u>=0;u--){const t=a[u];if(t.timestamp<o-c)break;h=Math.min(h,t.elevation),p=Math.max(p,t.altitude)}p+=this.HEIGHT_MARGIN,h-=this.HEIGHT_MARGIN,p=this.HEIGHT_STEPS*Math.ceil(p/this.HEIGHT_STEPS),h=this.HEIGHT_STEPS*Math.floor(h/this.HEIGHT_STEPS),this.renderCanvas(n,a,h,p,c,o,s),null!==this.maxValueRef.current&&(this.maxValueRef.current.textContent=p.toString()),null!==this.minValueRef.current&&(this.minValueRef.current.textContent=h.toString())},this.onNewAnimationData=({pilotData:t})=>{this.shallowRerender(t)},this.shallowFetchDataAndRerender=(t=!1)=>{this.shallowRerender(getXContestInterface().animation.getData().pilotData,t)},this.componentDidMount=()=>{this.shallowFetchDataAndRerender(),getXContestInterface().animation.registerCallback(this.onNewAnimationData),window.addEventListener("resize",this.onSizeChanged)},this.componentDidUpdate=()=>{this.shallowFetchDataAndRerender()},this.onSizeChanged=()=>{this.shallowFetchDataAndRerender(!0)},this.canvasRef=a.a.createRef(),this.maxValueRef=a.a.createRef(),this.minValueRef=a.a.createRef(),this.HEIGHT_MARGIN=50,this.HEIGHT_STEPS=100,this.COLOR_SKY="#aac7ff",this.COLOR_GROUND="#92b465",this.COLOR_PILOT="#e11",this.lastRenderedTimestamp=0,this.lastRenderedTrackStart=null}componentWillUnmount(){window.removeEventListener("resize",this.onSizeChanged),getXContestInterface().animation.unregisterCallback(this.onNewAnimationData)}render(){return a.a.createElement("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"stretch"}},a.a.createElement("div",{style:{flex:"0 0 auto",width:"4em",paddingRight:".2em",display:"flex",flexDirection:"column",justifyContent:"space-between",alignItems:"flex-end"}},a.a.createElement("div",{ref:this.maxValueRef,style:{fontSize:".8em",marginTop:"-.7em"}}),a.a.createElement("div",{ref:this.minValueRef,style:{fontSize:".8em",marginBottom:"-.75em"}})),a.a.createElement("div",{style:{flex:"1 1 0",overflow:"hidden",position:"relative"},ref:this.canvasParentRef},a.a.createElement("canvas",{ref:this.canvasRef,style:{position:"absolute",width:"100%",height:"100%"}})))}}const Bt=Object(jt.a)(k.a)({overflow:"hidden",flex:"1"}),Xt=Object(jt.a)(k.a)({marginRight:".2em",marginLeft:".5em"}),Jt=Object(jt.a)(k.a)({display:"flex",justifyContent:"space-between",paddingLeft:".5em"}),Yt=Object(Vt.a)({root:{paddingLeft:"12px"},content:{overflow:"hidden",alignItems:"center",whiteSpace:"nowrap"}})(Lt.a),qt=Object(Vt.a)({root:{display:"flex",alignItems:"stretch",justifyContent:"space-between",MozUserSelect:"none",WebkitUserSelect:"none",msUserSelect:"none"}})(Dt.a),Zt=Object(jt.a)(k.a)({flex:"1 0 0",display:"flex",justifyContent:"flex-start",flexDirection:"column",alignItems:"flex-start",paddingRight:"1em"}),Kt=Object(jt.a)(k.a)({flex:"2 1 0",display:"flex"}),$t=Object(jt.a)(k.a)({display:"flex",justifyContent:"flex-start",alignItems:"center",whiteSpace:"nowrap"}),Qt=Object(Vt.a)({root:{paddingRight:".2em",width:".6em",height:".6em"}})(Gt.a),te=Object(Vt.a)({root:{paddingRight:".2em",width:".6em",height:".6em"}})(Ht.a),ee=Object(Vt.a)({root:{paddingRight:".2em",width:".6em",height:".6em"}})(Ut.a);class AnimatedPilotListEntry_AnimatedPilotListEntry extends a.a.PureComponent{constructor(t){super(t),this.extractImportantProps=t=>({height:null!==t.gpsAlt?t.gpsAlt:t.baroAlt,elevation:t.elevation,vario:t.baroVario,startOfTrack:t.startOfTrack,endOfTrack:t.endOfTrack,landed:t.landed,newestDataTimestamp:t.newestDataTimestamp,lat:t.pos.lat,lng:t.pos.lng,velocityLat:null===t.velocityVec?null:t.velocityVec.lat,velocityLng:null===t.velocityVec?null:t.velocityVec.lng,velocity:t.velocity,lastPotentialAirTime:t.lastPotentialAirTime,offline:t.offline}),this.propsChanged=t=>{const e=this.pilotProps;for(let n in e)if(!(n in t))return!0;for(let n in t){if(!(n in e))return!0;if(e[n]!==t[n])return!0}return!1},this.onNewGPSDataReceived=t=>{this.gpsData=t},this.onNewDataReceived=({pilotData:t})=>{if(!(this.props.pilotId in t))return;const e=t[this.props.pilotId],n=this.extractImportantProps(e);this.state.offline===n.offline?this.propsChanged(n)?(this.pilotProps=n,this.shallowRerender(!0)):this.shallowRerender(!1):this.setState({offline:n.offline})},this.onNewPilotInfos=t=>{const e=this.stateChangesFromPilotInfos(this.state,t);0!==Object.keys(e).length&&this.setState(e)},this.stateChangesFromPilotInfos=(t,e)=>{const n={},processInfo=(e,i)=>{e in t&&t[e]===i||(n[e]=i)};if(this.props.pilotId in e){const t=e[this.props.pilotId];if(processInfo("launchSite",t.info.launch),processInfo("launchTime",parseTime(t.info.launchPoint.timestamp)),"contest"in t&&"score"in t.contest){const e=t.contest.score;null!=e.distance&&processInfo("scoreDistance",e.distance.toFixed(1)),"type"in e&&processInfo("scoreType",e.type.tag)}}return n},this.shallowRerender=t=>{if(null!==this.heightRef.current&&t){const t=AnimatedPilotListEntry_AnimatedPilotListEntry.renderHeight(this.pilotProps);t!==this.heightRef.current.innerHTML&&(this.heightRef.current.innerHTML=t)}if(null!==this.lastFixRef.current&&t&&this.lastFixRef.current.setFix({lat:this.pilotProps.lat,lng:this.pilotProps.lng}),null!==this.iconRef.current&&t){let t=this.iconRef.current;const e=getPilotIcon(this.pilotProps.startOfTrack,this.pilotProps.endOfTrack,this.pilotProps.landed,{lat:this.pilotProps.lat,lng:this.pilotProps.lng},{lat:this.pilotProps.velocityLat,lng:this.pilotProps.velocityLng});if(t.childNodes.length>0){const n=t.childNodes[0];n.getAttribute("d")!==e.path&&n.setAttribute("d",e.path)}const n=void 0===e.rotation?0:e.rotation;Object.assign(t.style,getRotationStyle(n))}if(null!==this.liveStateRef.current&&this.liveStateRef.current.shallowRerender({timestamp:1e3*this.pilotProps.newestDataTimestamp,landed:this.pilotProps.landed,endOfTrack:this.pilotProps.endOfTrack,relative:!0,showLastFix:getSetting(I).getValue()}),null!==this.flightDurationRef.current&&t){const t=AnimatedPilotListEntry_AnimatedPilotListEntry.renderFlightDuration(this.state.launchTime,this.pilotProps.lastPotentialAirTime);t!==this.flightDurationRef.current.innerHTML&&(this.flightDurationRef.current.innerHTML=t)}},this.gpsData=getGPSProvider().getData(),this.pilotColor=getPilotIconColor(this.props.pilotId),this.state={launchSite:null,launchTime:null,scoreDistance:null,scoreType:null,offline:!0},Object.assign(this.state,this.stateChangesFromPilotInfos(this.state,getXContestInterface().getPilotInfos())),this.lastFixRef=a.a.createRef(),this.heightRef=a.a.createRef(),this.liveStateRef=a.a.createRef(),this.iconRef=a.a.createRef(),this.flightDurationRef=a.a.createRef(),this.contextMenuHandler=new ContextMenuHandler(t=>{this.props.onContextMenuHandler(this.props.pilotId,{left:t.pageX,top:t.pageY})})}componentDidMount(){getXContestInterface().animation.registerCallback(this.onNewDataReceived),getXContestInterface().pilotInfos.registerCallback(this.onNewPilotInfos),getGPSProvider().registerCallback(this.onNewGPSDataReceived)}componentWillUnmount(){getXContestInterface().animation.unregisterCallback(this.onNewDataReceived),getXContestInterface().pilotInfos.unregisterCallback(this.onNewPilotInfos),getGPSProvider().unregisterCallback(this.onNewGPSDataReceived)}static renderHeight(t){const e=t.height;return null==e?"--m (--m)":Math.round(e)+"m ("+Math.round(Math.max(0,e-t.elevation))+"m)"}static renderFlightDuration(t,e){if(null==t||null==e)return"-:-- h";const n=Math.round((e-t)/60),i=(n%60).toString().padStart(2,"0");return Math.floor(n/60)+":"+i+" h"}static renderScore(t,e){return t+" km "+(e in AnimatedPilotListEntry_AnimatedPilotListEntry.scoreTypes?AnimatedPilotListEntry_AnimatedPilotListEntry.scoreTypes[e]:e)}render(){{const t=getXContestInterface().animation.getData().pilotData,e=this.props.pilotId in t?t[this.props.pilotId]:null;this.pilotProps=this.extractImportantProps(e)}const t=getPilotIcon(this.pilotProps.startOfTrack,this.pilotProps.endOfTrack,this.pilotProps.landed,{lat:this.pilotProps.lat,lng:this.pilotProps.lng},{lat:this.pilotProps.velocityLat,lng:this.pilotProps.velocityLng}),e=void 0===t.rotation?0:t.rotation;return a.a.createElement(It.a,{TransitionProps:{unmountOnExit:!0},onContextMenu:this.contextMenuHandler.onContextMenu,onTouchStart:this.contextMenuHandler.onTouchStart,onTouchCancel:this.contextMenuHandler.onTouchCancel,onTouchEnd:this.contextMenuHandler.onTouchEnd,onTouchMove:this.contextMenuHandler.onTouchMove,style:{filter:this.props.shown?void 0:"grayscale(100%) opacity(70%)"}},a.a.createElement(Yt,{expandIcon:a.a.createElement(Rt.a,null)},a.a.createElement("svg",{width:"30px",height:"30px",viewBox:"0 0 24 24",display:"block",style:Object(C.a)({flex:"0 0 auto"},getRotationStyle(e)),ref:this.iconRef},a.a.createElement("path",{d:t.path,fill:this.pilotColor,stroke:"black"})),a.a.createElement("div",{style:{flex:"1 1 auto",overflow:"hidden",marginLeft:"10px"}},a.a.createElement("div",{style:{width:"100%",display:"flex",overflow:"hidden"}},a.a.createElement(Bt,{variant:"body2"},this.props.pilotName),a.a.createElement(Xt,{variant:"caption"},a.a.createElement(LastFixState_LastFixArrow,{ref:this.lastFixRef,lastFix:{lat:this.pilotProps.lat,lng:this.pilotProps.lng}}))),a.a.createElement(Jt,{variant:"caption"},a.a.createElement(LastFixState_LastFixState,{timestamp:1e3*this.pilotProps.newestDataTimestamp,landed:this.pilotProps.landed,endOfTrack:this.pilotProps.endOfTrack,relative:!0,ref:this.liveStateRef,showLastFix:getSetting(I).getValue()}),a.a.createElement("span",{ref:this.heightRef},AnimatedPilotListEntry_AnimatedPilotListEntry.renderHeight(this.pilotProps))))),this.state.offline?null:a.a.createElement(qt,null,a.a.createElement(Zt,null,a.a.createElement($t,{variant:"caption"},a.a.createElement(Qt,null),a.a.createElement("span",{ref:this.flightDurationRef},AnimatedPilotListEntry_AnimatedPilotListEntry.renderFlightDuration(this.state.launchTime,this.pilotProps.lastPotentialAirTime))),a.a.createElement($t,{variant:"caption"},a.a.createElement(te,null),AnimatedPilotListEntry_AnimatedPilotListEntry.renderScore(this.state.scoreDistance,this.state.scoreType)),a.a.createElement($t,{variant:"caption"},a.a.createElement(ee,null)," ",this.state.launchSite)),a.a.createElement(Kt,{variant:"caption"},a.a.createElement(ElevationHistogram_ElevationHistogram,{pilot:this.props.pilotId}))))}}AnimatedPilotListEntry_AnimatedPilotListEntry.scoreTypes={FlatTriangle:" (flat)",FaiTriangle:" (fai)",FreeFlight:" (free)"};var ne=AnimatedPilotListEntry_AnimatedPilotListEntry,ie=n(177);const ae=Object(At.a)({root:{display:"flex",backgroundColor:"#ccc",padding:".8em"}})(ie.a);class OfflinePilotEntry_OfflinePilotEntry extends a.a.PureComponent{constructor(t){super(t),this.contextMenuHandler=new ContextMenuHandler(t=>{this.props.onContextMenuHandler(this.props.pilotId,{left:t.pageX,top:t.pageY})})}render(){return a.a.createElement(ae,{className:"MuiExpansionPanel-rounded MuiExpansionPanel-root",onContextMenu:this.contextMenuHandler.onContextMenu,onTouchStart:this.contextMenuHandler.onTouchStart,onTouchCancel:this.contextMenuHandler.onTouchCancel,onTouchEnd:this.contextMenuHandler.onTouchEnd,onTouchMove:this.contextMenuHandler.onTouchMove},a.a.createElement(k.a,{variant:"body2"},this.props.pilotName),a.a.createElement(k.a,{variant:"caption",color:"textSecondary",style:{paddingLeft:".5em"}},"[",this.props.pilotId,"]"))}}const se=Object(At.a)({root:{backgroundColor:"#ddd"}})(It.a);class AnimatedPilotList_AnimatedPilotList extends a.a.PureComponent{constructor(t){super(t),this.getSortedPilotList=t=>{if(null===this.gpsData)return Object.keys(t);const e={lat:this.gpsData.coords.latitude,lng:this.gpsData.coords.longitude};let n=Object.entries(t).map(([t,n])=>[t,Object(W.getDistance)(e,n.pos)]);return n.sort((t,e)=>t[1]-e[1]),n.map(t=>t[0])},this.onAnimationFrame=({pilotData:t})=>{const e=this.getSortedPilotList(t),n=e.filter(e=>t[e].endOfTrack&&t[e].landed),i=e.filter(e=>!(t[e].endOfTrack&&t[e].landed)).concat(n);let a=!1;if(i.length===this.state.onlinePilots.length){for(let s=0;s<i.length;s++)if(i[s]!==this.state.onlinePilots[s]){a=!0;break}}else a=!0;a&&this.setState(t=>Object(C.a)({},t,{onlinePilots:i}))},this.onNewGPSDataReceived=t=>{this.gpsData=t},this.showContextMenu=(t,e)=>{const n=getChosenPilots();if(!(t in n))return;const i=n[t];this.setState({contextMenu:{open:!0,pilotId:t,pos:e,pilotInfo:i}})},this.showContextMenuOffline=(t,e)=>{const n=getChosenPilots();if(!(t in n))return;const i=n[t];this.setState({contextMenu:{open:!0,pilotId:t,pos:e,pilotInfo:i,offline:!0}})},this.hideContextMenu=()=>{this.setState({contextMenu:Object(C.a)({},this.state.contextMenu,{open:!1})})},this.state={onlinePilots:[],contextMenu:null},this.gpsData=getGPSProvider().getData()}componentDidMount(){getXContestInterface().animation.registerCallback(this.onAnimationFrame),getGPSProvider().registerCallback(this.onNewGPSDataReceived)}componentWillUnmount(){getXContestInterface().animation.unregisterCallback(this.onAnimationFrame),getGPSProvider().unregisterCallback(this.onNewGPSDataReceived)}render(){let t=new Set(this.state.onlinePilots);const e=this.state.onlinePilots.filter(t=>t in this.props.pilots&&this.props.pilots[t].shown),n=this.state.onlinePilots.filter(t=>t in this.props.pilots&&!this.props.pilots[t].shown),i=Object.keys(this.props.pilots).filter(e=>!t.has(e)),getPilotName=t=>{const e=this.props.pilots[t];return void 0===e||null===e?t:e.name};return a.a.createElement(r.a,{height:"100%",bgcolor:"#eeeef5",overflow:"auto",onContextMenu:t=>t.preventDefault()},e.length>0?a.a.createElement(r.a,{margin:1,marginBottom:2},e.map(t=>a.a.createElement(ne,{shown:!0,key:t,pilotId:t,pilotName:getPilotName(t),onContextMenuHandler:this.showContextMenu}))):null,n.length>0?a.a.createElement(r.a,{margin:1,marginBottom:2},n.map(t=>a.a.createElement(ne,{shown:!1,key:t,pilotId:t,pilotName:getPilotName(t),onContextMenuHandler:this.showContextMenu}))):null,i.length>0?a.a.createElement(r.a,{margin:1,onContextMenu:()=>!1},a.a.createElement(se,null,a.a.createElement(Lt.a,{expandIcon:a.a.createElement(Rt.a,null)},a.a.createElement(k.a,null,"Offline Pilots")),a.a.createElement(Dt.a,{style:{flexDirection:"column"}},i.map(t=>a.a.createElement(OfflinePilotEntry_OfflinePilotEntry,{key:t,pilotId:t,pilotName:getPilotName(t),onContextMenuHandler:this.showContextMenuOffline}))))):null,a.a.createElement(ContextMenu_ContextMenu,{data:this.state.contextMenu,onClose:this.hideContextMenu}))}}var oe=AnimatedPilotList_AnimatedPilotList,le=n(341),re=n(338),ce=n(339),he=n(340),pe=n(355);class PilotMultipleChoiceList_PilotMultipleChoiceList extends a.a.PureComponent{constructor(t){super(t),this.startRendering=()=>{this.setState({didMount:!0})},this.onPilotClicked=t=>{this.props.onPilotClicked&&this.props.onPilotClicked(t)},this.getSortedPilotIds=()=>{const t=Object.keys(this.props.pilots);return t.sort((t,e)=>{const n=this.props.pilots[t].name,i=this.props.pilots[e].name;return n<i?-1:n>i?1:0}),t},this.state={didMount:!1}}componentDidMount(){setTimeout(this.startRendering)}render(){if(!this.state.didMount)return a.a.createElement("div",{style:{width:"100%",display:"flex",justifyContent:"center",overflow:"hidden"}},a.a.createElement(P.a,{disableShrink:!0,style:{margin:"2em"}}));const t=this.getSortedPilotIds();return a.a.createElement(r.a,{overflow:"auto"},a.a.createElement(re.a,{style:{width:"100%"}},a.a.createElement(ce.a,null,t.map(t=>a.a.createElement(he.a,{key:t,onClick:()=>this.onPilotClicked(t),selected:t in this.props.selected},a.a.createElement(St.a,{padding:"checkbox"},a.a.createElement(pe.a,{checked:t in this.props.selected})),a.a.createElement(St.a,{component:"th",scope:"row",padding:"none"},a.a.createElement(k.a,{variant:"body2",component:"span"},this.props.pilots[t].name),a.a.createElement(k.a,{variant:"caption",color:"textSecondary",style:{paddingLeft:".5em"},component:"span"},"[",t,"]")))))))}}class VisibilitySelector_VisibilitySelector extends a.a.PureComponent{constructor(t){super(t),this.pilotClicked=t=>{const e=Object(C.a)({},this.state.selected);t in e?delete e[t]:e[t]=!0,this.setState({selected:e})},this.closeWindow=()=>{this.props.onClose()},this.reset=()=>{let t={};Object.keys(this.props.pilots).forEach(e=>{t[e]=!0}),this.setState({selected:t})},this.clear=()=>{this.setState({selected:{}})},this.state={selected:{},open:!1}}render(){const t=Object.keys(this.props.pilots).length===Object.keys(this.state.selected).length;return a.a.createElement(util_SubWindow,{open:this.props.open,onClose:this.closeWindow,fullScreen:!1,maxWidth:"xs",fullWidth:!0},a.a.createElement(vt.a,null,a.a.createElement(k.a,{component:"div",variant:"h6",id:"tableTitle"},"Select shown pilots:")),a.a.createElement(le.a,null),a.a.createElement(PilotMultipleChoiceList_PilotMultipleChoiceList,{pilots:this.props.pilots,selected:this.state.selected,onPilotClicked:this.pilotClicked}),a.a.createElement(wt.a,null,a.a.createElement(Et.a,{onClick:t?this.clear:this.reset,color:"primary"},t?"Clear":"Reset"),a.a.createElement(Et.a,{onClick:this.closeWindow,color:"primary"},"Cancel"),a.a.createElement(Et.a,{disabled:!1,onClick:()=>{this.props.onUpdateVisibility(Object.keys(this.state.selected)),this.closeWindow()},color:"primary"},"Save")))}}VisibilitySelector_VisibilitySelector.getDerivedStateFromProps=(t,e)=>{if(t.open!==e.open){if(!1===t.open)return{open:t.open};let e={};return Object.entries(t.pilots).forEach(([t,n])=>{n.shown&&(e[t]=!0)}),{open:t.open,selected:e}}return null};var ue=VisibilitySelector_VisibilitySelector;class Pilots_Pilots extends a.a.Component{constructor(t){super(t),this.openPilotSelector=()=>{!1===this.state.pilotSelectorOpen&&this.setState({pilotSelectorOpen:!0})},this.closePilotSelector=()=>{!0===this.state.pilotSelectorOpen&&this.setState({pilotSelectorOpen:!1})},this.openVisibilitySelector=()=>{!1===this.state.visibilitySelectorOpen&&this.setState({visibilitySelectorOpen:!0})},this.closeVisibilitySelector=()=>{!0===this.state.visibilitySelectorOpen&&this.setState({visibilitySelectorOpen:!1})},this.chosenPilotsChanged=t=>{this.setState({chosenPilots:t})},this.state={pilotSelectorOpen:!1,visibilitySelectorOpen:!1,chosenPilots:getChosenPilots()}}componentDidMount(){getChosenPilotsObject().registerCallback(this.chosenPilotsChanged)}componentWillUnmount(){getChosenPilotsObject().unregisterCallback(this.chosenPilotsChanged)}render(){return a.a.createElement(a.a.Fragment,null,a.a.createElement(oe,{pilots:this.state.chosenPilots}),a.a.createElement(r.a,{position:"absolute",bottom:"68px",right:"16px"},a.a.createElement(gt.a,{size:"small",color:"primary",onClick:this.openVisibilitySelector},a.a.createElement(ht.a,null))),a.a.createElement(r.a,{position:"absolute",bottom:"16px",right:"16px"},a.a.createElement(gt.a,{size:"small",color:"primary",onClick:this.openPilotSelector},a.a.createElement(bt.a,null))),a.a.createElement(Tt,{open:this.state.pilotSelectorOpen,onClose:this.closePilotSelector,onAddPilots:addPilots,alreadyAdded:Object.keys(this.state.chosenPilots)}),a.a.createElement(ue,{open:this.state.visibilitySelectorOpen,onClose:this.closeVisibilitySelector,onUpdateVisibility:t=>{(t=>{const e=Object(C.a)({},getChosenPilots());let n=!1;for(const i in e){const a=-1!==t.indexOf(i);a!==e[i].shown&&(e[i].shown=a,n=!0)}n&&setChosenPilots(e)})(t)},pilots:this.state.chosenPilots}))}}var de=Pilots_Pilots,me=n(346),ge=n(179),fe=n(350),be=n(171),ve=n.n(be),Ce=n(169),ye=n.n(Ce),we=n(168),Ee=n.n(we),ke=n(170),Pe=n.n(ke),Se=n(74),Oe=n.n(Se),xe=n(356),_e=n(165),Me=n.n(_e),Te=n(166),Ae=n.n(Te),Ie=n(167),Le=n.n(Ie),De=n(344),Fe=n(345),Re=n(343);class NumberInput_NumberInput extends a.a.PureComponent{constructor(...t){super(...t),this.state={internalUpdate:!1,value:null}}static getDerivedStateFromProps(t,e){const n=Object(C.a)({},e,{internalUpdate:!1});return e.internalUpdate||(n.value=t.value),n}render(){return a.a.createElement(yt.a,{onChange:t=>{const e=t.target.value;e<this.props.min?(this.props.onChange(this.props.min),this.setState(t=>Object(C.a)({},t,{internalUpdate:!0,value:e}))):e>this.props.max?this.props.onChange(this.props.max):this.props.onChange(e)},variant:"outlined",disabled:this.props.disabled,margin:"dense",hiddenLabel:!0,type:"number",value:this.state.value,InputProps:{endAdornment:a.a.createElement(Re.a,{position:"end"},this.props.unit)},inputProps:{min:this.props.min,max:this.props.max}})}}const je=Object(_t.a)(t=>{const e=getSetting(t.setting).use(),n=Object(l.a)(e,2),i=n[0],s=n[1],flipSetting=()=>s(!i);return a.a.createElement(Q.a,{button:!0,onClick:flipSetting},a.a.createElement(et.a,{primary:t.primaryText,secondary:t.secondaryText}),a.a.createElement(De.a,null,a.a.createElement(Fe.a,{edge:"end",onChange:flipSetting,checked:i})))}),Ve=Object(_t.a)(t=>{const e=getSetting(t.setting).use(),n=Object(l.a)(e,2),i=n[0],s=n[1];return a.a.createElement(Q.a,{disabled:t.disabled},a.a.createElement(et.a,{primary:t.primaryText,secondary:t.secondaryText}),a.a.createElement(De.a,null,a.a.createElement(NumberInput_NumberInput,{value:i,onChange:s,disabled:t.disabled,unit:t.unit,min:t.min,max:t.max})))});var Ne=n(347),Ge=n(348),We=n(349),He=n(163),ze=n.n(He),Ue=n(164),Be=n.n(Ue);var Xe=Object(_t.a)(t=>{const e=Object(i.useState)(!1),n=Object(l.a)(e,2),s=n[0],o=n[1];return a.a.createElement(a.a.Fragment,null,a.a.createElement(me.a,{style:{position:"static"}},a.a.createElement(vt.a,null,a.a.createElement(ge.a,{edge:"start",color:"inherit",onClick:t.onClose},a.a.createElement(ze.a,null)),a.a.createElement(r.a,{marginLeft:2,flexGrow:1},a.a.createElement(k.a,{variant:"h6"},"Settings")),a.a.createElement(ge.a,{edge:"end",color:"inherit",onClick:()=>o(!0)},a.a.createElement(Be.a,null)))),a.a.createElement(util_SubWindow,{open:s,onClose:()=>o(!1)},a.a.createElement(Ne.a,null,"Reset all settings?"),a.a.createElement(Ge.a,null,a.a.createElement(We.a,null,"This sets all settings to their default values.")),a.a.createElement(wt.a,null,a.a.createElement(Et.a,{onClick:()=>{Object.values(G).forEach(t=>t.setValue(null)),o(!1)},color:"primary"},"Yes"),a.a.createElement(Et.a,{onClick:()=>o(!1),color:"primary",autoFocus:!0},"No"))))});var SettingsPage_SettingsPage=t=>{const e=getSetting(A).use(),n=Object(l.a)(e,1)[0],i=getSetting(D).use(),s=Object(l.a)(i,1)[0];return a.a.createElement(util_SubWindow,{fullScreen:!0,open:t.open,onClose:t.onClose},a.a.createElement(Xe,{onClose:t.onClose}),a.a.createElement(it.a,{style:{overflow:"auto"}},a.a.createElement(je,{setting:I,primaryText:"Low Latency Mode",secondaryText:"disables animations"}),a.a.createElement(le.a,null),a.a.createElement(je,{setting:A,primaryText:"Limit Track Length",secondaryText:"prevents map clutter"}),a.a.createElement(Ve,{primaryText:"Track Length",secondaryText:"Valid: 1-999 min",setting:T,disabled:!n,unit:"min",min:1,max:999}),a.a.createElement(le.a,null),a.a.createElement(je,{setting:D,primaryText:"Limit Framerate",secondaryText:"reduces energy consumption"}),a.a.createElement(Ve,{primaryText:"Framerate",secondaryText:"Valid: 1-60 fps",setting:F,disabled:!s,unit:"fps",min:1,max:60}),a.a.createElement(le.a,null),a.a.createElement(je,{setting:R,primaryText:"Enable GPS",secondaryText:"required for advanced features"}),a.a.createElement(le.a,null),a.a.createElement(je,{setting:V,primaryText:"Prevent Sleep",secondaryText:"Keeps display on. Useful for driving."}),a.a.createElement(le.a,null),a.a.createElement(je,{setting:N,primaryText:"Show Offline Pilots",secondaryText:"Displays last observed landing spot."})))};function LinkPopup(t){const copyToClipboard=()=>{navigator.clipboard.writeText(t.link).then((function(){alert("Copied link to clipboard!")}),(function(t){alert("Can't copy to clipboard:",t)}))};return a.a.createElement(kt.a,{open:null!==t.link,onClose:t.onClose},a.a.createElement(Ne.a,null,"Shareable Link:"),a.a.createElement(Ge.a,null,a.a.createElement(We.a,null,a.a.createElement("a",{style:{wordWrap:"break-word",wordBreak:"break-all"},onClick:()=>(copyToClipboard(),window.event.preventDefault(),!1),href:t.link},t.link))),a.a.createElement(wt.a,null,a.a.createElement(Et.a,{onClick:copyToClipboard,color:"primary",autoFocus:!0},"Copy"),a.a.createElement(Et.a,{onClick:t.onClose,color:"primary",autoFocus:!0},"Close")))}var Je=n(73);class LinkCreator_LinkCreator extends a.a.PureComponent{constructor(t){super(t),this.pilotClicked=t=>{const e=Object(C.a)({},this.state.selected);t in e?delete e[t]:e[t]=!0,this.setState({selected:e})},this.closeWindow=()=>{this.props.onClose()},this.createLink=t=>{const e={},n=getChosenPilots();t.forEach(t=>{t in n&&null!=n[t].name?e[t]=n[t].name:e[t]=null});const i=Object(Je.c)(e),a=window.location.href+"?g="+i;this.setState({createdLink:a})},this.state={selected:{},createdLink:null,open:t.open}}render(){return a.a.createElement(a.a.Fragment,null,a.a.createElement(util_SubWindow,{open:this.props.open,onClose:this.closeWindow,fullScreen:!1,maxWidth:"xs",fullWidth:!0},a.a.createElement(vt.a,null,a.a.createElement(k.a,{component:"div",variant:"h6",id:"tableTitle"},"Choose Pilots to share:")),a.a.createElement(le.a,null),a.a.createElement(PilotMultipleChoiceList_PilotMultipleChoiceList,{pilots:getChosenPilots(),selected:this.state.selected,onPilotClicked:this.pilotClicked}),a.a.createElement(wt.a,null,a.a.createElement(Et.a,{onClick:this.closeWindow,color:"primary"},"Cancel"),a.a.createElement(Et.a,{disabled:!1,onClick:()=>{this.closeWindow(),this.createLink(Object.keys(this.state.selected))},color:"primary"},"Create Link"))),a.a.createElement(LinkPopup,{link:this.state.createdLink,onClose:()=>{this.setState({createdLink:null})}}))}}LinkCreator_LinkCreator.getDerivedStateFromProps=(t,e)=>t.open!==e.open?!1===t.open?{open:t.open}:{open:t.open,selected:{}}:null;var Ye=LinkCreator_LinkCreator;var pages_MainMenu=t=>{const e=Object(p.a)(),n=Object(i.useState)(!1),s=Object(l.a)(n,2),o=s[0],c=s[1],h=Object(i.useState)(!1),u=Object(l.a)(h,2),d=u[0],m=u[1];return a.a.createElement(a.a.Fragment,null,a.a.createElement(xe.a,{disableSwipeToOpen:!0,open:t.open,onOpen:()=>{},onClose:t.onClose},a.a.createElement(vt.a,{style:{backgroundColor:e.palette.primary.light,minWidth:"200px"},onClick:t.onClose},a.a.createElement(r.a,{flexGrow:1,clone:!0},a.a.createElement(k.a,{variant:"h6"},"Menu")),a.a.createElement(ge.a,{edge:"end",color:"inherit"},a.a.createElement(Me.a,null))),a.a.createElement(it.a,null,a.a.createElement(Q.a,{button:!0,onClick:()=>{t.onClose(),c(!0)}},a.a.createElement(tt.a,null,a.a.createElement(Ae.a,null)),a.a.createElement(et.a,{primary:"Settings"})),a.a.createElement(Q.a,{button:!0,onClick:()=>{t.onClose(),m(!0)}},a.a.createElement(tt.a,null,a.a.createElement(Le.a,null)),a.a.createElement(et.a,{primary:"Create Pilot Link"}))),a.a.createElement(k.a,{variant:"caption",style:{fontSize:"0.6rem",textAlign:"center",position:"absolute",bottom:"0px",width:"100%"}},"Icon made by ",a.a.createElement("a",{href:"https://www.flaticon.com/authors/freepik"},"Freepik")," from ",a.a.createElement("a",{href:"https://www.flaticon.com/"},"www.flaticon.com"))),a.a.createElement(SettingsPage_SettingsPage,{open:o,onClose:()=>c(!1)}),a.a.createElement(Ye,{open:d,onClose:()=>m(!1)}))};const qe=Object(E.a)(t=>({popover:{padding:t.spacing(1),align:"right"}})),LoadingBadge=t=>a.a.createElement(fe.a,{anchorOrigin:{vertical:"bottom",horizontal:"right"},badgeContent:a.a.createElement(P.a,{disableShrink:t.disableShrink,color:"secondary",size:15,thickness:10})},t.children);var Ze=Object(_t.a)(()=>{const t=qe(),e=getXContestInterface().connectionState.use(),n=a.a.useRef(),s=Object(i.useState)(null),o=Object(l.a)(s,2),c=o[0],h=o[1],p=Object(i.useState)(!1),u=Object(l.a)(p,2),d=u[0],m=u[1];a.a.useLayoutEffect(()=>{n.current&&n.current.updatePosition()},[e,c]);return a.a.createElement("div",null,a.a.createElement(me.a,{position:"static"},a.a.createElement(vt.a,null,a.a.createElement(ge.a,{edge:"start",color:"inherit",onClick:()=>m(!0)},a.a.createElement(ve.a,null)),a.a.createElement(r.a,{marginLeft:2,flexGrow:1},a.a.createElement(k.a,{variant:"h6"},"XC Live Viewer")),a.a.createElement(ge.a,{edge:"end",color:"inherit",onClick:t=>h(t.currentTarget)},(()=>{switch(e){case X.ACTIVE:return a.a.createElement(Ee.a,null);case X.CONNECTING:return a.a.createElement(LoadingBadge,null,a.a.createElement(Oe.a,null));case X.ERROR:return a.a.createElement(ye.a,{color:"error"});case X.ESTABLISHED:return a.a.createElement(LoadingBadge,{disableShrink:!0},a.a.createElement(Oe.a,null));case X.INACTIVE:return a.a.createElement(Pe.a,null);case X.NO_CONNECTION:default:return a.a.createElement(Oe.a,null)}})()))),a.a.createElement(nt.a,{open:Boolean(c),anchorEl:c,onClose:()=>h(null),anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},action:n},a.a.createElement(r.a,{className:t.popover},a.a.createElement(k.a,null,e))),a.a.createElement(pages_MainMenu,{open:d,onClose:()=>m(!1)}))});var src_MainPage=()=>{const t=mt.TabID.use(),e=Object(l.a)(t,2),n=e[0],i=e[1],s=a.a.useState(0),o=Object(l.a)(s,2),c=o[0],g=o[1],b=Object(p.a)(),C=Object(u.a)(b.breakpoints.down("sm")),updateWindowHeight=()=>{g(window.innerHeight)};a.a.useLayoutEffect(()=>(updateWindowHeight(),window.addEventListener("resize",updateWindowHeight),()=>{window.removeEventListener("resize",updateWindowHeight)}),[]);const y=C?a.a.createElement(a.a.Fragment,null,a.a.createElement(r.a,{flexGrow:1,clone:!0,display:"flex"},a.a.createElement(h.a,{disabled:!0,index:n},a.a.createElement(r.a,{width:"100%",height:"100%",position:"relative"},a.a.createElement(LiveMap_LiveMap,null)),a.a.createElement(r.a,{width:"100%",height:"100%",position:"relative"},a.a.createElement(de,null)))),a.a.createElement(r.a,{zIndex:100,boxShadow:3},a.a.createElement(d.a,{value:n,onChange:(t,e)=>{i(e)},showLabels:!0},a.a.createElement(m.a,{label:"Map",icon:a.a.createElement(v.a,null)}),a.a.createElement(m.a,{label:"Pilots",icon:a.a.createElement(f.a,null)})))):a.a.createElement(r.a,{width:"100%",flexGrow:1,display:"flex",overflow:"hidden"},a.a.createElement(r.a,{flexGrow:1,height:"100%"},a.a.createElement(LiveMap_LiveMap,null)),a.a.createElement(r.a,{width:"400px",height:"100%",zIndex:50,boxShadow:3},a.a.createElement(de,null)));return a.a.createElement(r.a,{height:c,display:"flex",flexDirection:"column",overflow:"hidden"},a.a.createElement(r.a,{zIndex:100},a.a.createElement(Ze,null)),y)};var src_App=()=>a.a.createElement("div",{className:"App"},a.a.createElement(src_MainPage,null));n(283);n(284);const Ke=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function registerValidSW(t,e){navigator.serviceWorker.register(t).then(t=>{t.onupdatefound=()=>{const n=t.installing;null!=n&&(n.onstatechange=()=>{"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),e&&e.onUpdate&&e.onUpdate(t)):(console.log("Content is cached for offline use."),e&&e.onSuccess&&e.onSuccess(t)))})}}).catch(t=>{console.error("Error during service worker registration:",t)})}function processGroupData(t){let e=Object(C.a)({},getChosenPilots());Object.entries(t).forEach(([t,n])=>{t in e?null!=n&&(e[t]=Object(C.a)({},e[t],{name:n})):e[t]=defaultPilotEntry(null!=n?n:t)}),Object.keys(e).forEach(n=>{e[n]=Object(C.a)({},e[n],{shown:n in t})}),setChosenPilots(e)}var $e=n(174),Qe=n.n($e);n(286).config(),function resolveBreakingChanges(){!function fixChosenPilots(){let t=Object(C.a)({},getChosenPilots()),e=!1;for(var n=0,i=[...Object.keys(t)];n<i.length;n++){let a=i[n],s=t[a];s!==Object(s)&&("string"==typeof s?(t[a]=defaultPilotEntry(s),e=!0):(t[a]=defaultPilotEntry(a),e=!0))}e&&setChosenPilots(t)}()}(),function processUrlParameters(){const t=new URLSearchParams(window.location.search);t.has("group")&&function groupParameterJson(t){processGroupData(Object(Je.b)(t))}(t.get("group")),t.has("g")&&function groupParameter(t){processGroupData(Object(Je.a)(t))}(t.get("g")),window.location.href!==window.location.href.split("?")[0]&&(window.location.href=window.location.href.split("?")[0])}(),function startNoSleepService(){const t=new Qe.a,enableNoSleep=()=>{console.debug("Enable nosleep!"),t.enable()},e=getSetting(V),initiator=()=>{document.removeEventListener("mousedown",initiator,!1),document.removeEventListener("touchstart",initiator,!1),e.getValue()&&enableNoSleep()};document.addEventListener("mousedown",initiator,!1),document.addEventListener("touchstart",initiator,!1),e.registerCallback(e=>{e?enableNoSleep():(console.debug("Disable nosleep!"),t.disable())})}(),o.a.render(a.a.createElement(src_App,null),document.getElementById("root")),function register(t){if("serviceWorker"in navigator){if(new URL("/XCLiveViewer",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",()=>{const e="".concat("/XCLiveViewer","/service-worker.js");Ke?(!function checkValidServiceWorker(t,e){fetch(t).then(n=>{const i=n.headers.get("content-type");404===n.status||null!=i&&-1===i.indexOf("javascript")?navigator.serviceWorker.ready.then(t=>{t.unregister().then(()=>{window.location.reload()})}):registerValidSW(t,e)}).catch(()=>{console.log("No internet connection found. App is running in offline mode.")})}(e,t),navigator.serviceWorker.ready.then(()=>{console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")})):registerValidSW(e,t)})}}()},73:function(t,e,n){"use strict";(function(t){n.d(e,"c",(function(){return encodeBase64})),n.d(e,"a",(function(){return decodeBase64})),n.d(e,"b",(function(){return decodeBase64Json}));var i=n(99),a=n(100);const encodeBase64=e=>{const n=t.from(a.encode(e)),s=t.from(Object(i.deflate)(n)),o=t.concat([t.from([1]),n]),l=t.concat([t.from([2]),s]);return l.length<o.length?l.toString("base64"):o.toString("base64")},decodeBase64=e=>{const n=t.from(e,"base64"),s=n.slice(0,1)[0],o=n.slice(1);switch(s){case 1:return a.decodeFirstSync(o);case 2:const e=t.from(Object(i.inflate)(o));return a.decodeFirstSync(e);default:return null}},decodeBase64Json=e=>{const a=t.from(e,"base64"),s=function decodeUtf8(t){if("undefined"===typeof TextDecoder){return new(0,n(56).TextDecoder)("utf-8").decode(t)}return new TextDecoder("utf-8").decode(t)}(Object(i.inflate)(a));return JSON.parse(s)}}).call(this,n(31).Buffer)}},[[190,1,2]]]);
//# sourceMappingURL=main.b5d1b229.chunk.js.map