{"version":3,"sources":["common/GoogleMapsApiLoader.js","pages/StatusPages.jsx","common/PersistentState/PersistentState.js","common/PersistentState/Settings.js","location_provider/XContest/XContestSocket.js","common/PersistentState/ChosenPilots.js","util/Interpolation.js","util/RunningDerivation.js","util/FindBisect.js","location_provider/XContest/FlightAnimationData.js","location_provider/XContest/FlightAnimation.js","util/HighPrecisionTimeSync.js","location_provider/XContest/XContestAnimation.js","util/EventfulState.js","location_provider/XContest/XContestInterface.js","pages/GoogleMapsTrack.js","pages/MapAnimator.js","pages/LiveMap.jsx","util/LastFixState.jsx","pages/PilotSelector.jsx","pages/AnimatedPilotList.jsx","pages/Pilots.jsx","util/NumberInput.jsx","pages/SettingsPage.jsx","pages/MainMenu.jsx","pages/TitleBar.jsx","MainPage.jsx","App.jsx","serviceWorker.jsx","index.js"],"names":["googleMapsApiPromise","useGoogleMapsApi","useState","ready","error","state","setState","useEffect","Promise","resolve","_reject","console","log","script","document","createElement","src","async","addEventListener","body","appendChild","then","success","window","google","useStyles","makeStyles","theme","progress","margin","spacing","LoadingPage","message","hideIf","subRef","classes","Box","width","height","display","alignItems","justifyContent","ref","textAlign","CircularProgress","className","Typography","ErrorPage","fontSize","color","PersistentState","key","initialValue","getValue","value","JSON","parse","localStorage","getItem","_notifyAll","callbacks","cb","registerCallback","includes","push","unregisterCallback","index","indexOf","splice","setValue","removeItem","setItem","stringify","use","newValue","this","registerPersistentState","name","Settings","PATH_LENGTH","LIMIT_PATHS","LOW_LATENCY","ANIMATION_DELAY","FPS_LIMIT","FPS_RATE","createSetting","settingsObjects","getSetting","XContestSocket","onStateChanged","onInfoMessage","onTracklogMessage","onFlightLanded","formatSubscribedFlights","setting_pathLength","setting_limitPath","startIsoDate","startDate","Date","now","setMilliseconds","toISOString","subscribedFlights","map","flight","flightUuid","start","refreshSubscribedFlights","sock","readyState","WebSocket","OPEN","connected","send","tag","contents","setSubscribedFlights","flights","onOpen","handleReset","debug","setConnectionState","ConnectionState","ESTABLISHED","area","lat","lon","onMessage","evt","ACTIVE","msg","data","clearTimeout","watchdog","setTimeout","INACTIVE","processMessage","onClose","NO_CONNECTION","connect","bind","onError","dispatchInfoMessage","dispatchTracklogMessage","dispatchFlightLandedMessage","warn","CONNECTING","onopen","onmessage","onclose","onerror","ERROR","alert","persistentChosenPilots","lerp","val1","val2","pct","RunningDerivation","smoothingFactor","derivation_func","a","b","invalid_func","computeDiff","isInvalid","old_val","old_t","running_avg","new_val","new_t","dt","deriv","weight","Math","pow","findBisect","targetValue","length","dataFn","minIndex","maxIndex","currentIndex","parseTime","isoStr","round","FlightAnimationData","at","timestamp","pos","t","findForwardSwipe","startPos","counter_gpsVario","counter_baroVarion","counter_velocity","end","getDistance","elem","lng","baroAlt","gpsAlt","gpsVario","update","baroVario","velocity","newElem","elevation","clear","append","newElements","oldElements","oldPos","newPos","oldEl","newEl","reset","FlightAnimationDataCache","currentArrayPos","mapsPath","mapsPathNewestPos","DataGens","data1","data2","data0","data3","fallbackData","flightInfos","lastFix","FlightAnimation","updateInfos","infos","landed","flightInfoData","replace","track","flightInfoDataCache","updateData","data_start_time","liveData","isAfterLastElement","insert","liveDataCache","updateLanded","getInterpolatedData","cache","timeStamp","blendedData","endOfTrack","startOfTrack","takeData","blend","blendData","getFallbackData","computeTrack","limitTrack","trackLengthSeconds","oldestTimestamp","numRemove","slice","updateAnimation","animationTimeMillis","lowLatencyMode","trackLengthMinutes","animationTimeSeconds","animationResult","HighPrecisionTimeSync","tolerance","get","currentHighPrecisionTime","currentTime","estimatedTime","offset","offBy","XContestAnimation","_nextUpdate","animationLoop","absTime","frameTimeDelta","_setting_fps","_setting_limitFps","offsetTime","_setting_timeOffset","newAnimationData","Object","keys","_subscribedPilots","forEach","pilot","_pilotInfos","flightId","_flightAnimations","flightAnim","_setting_lowLatencyMode","_setting_limitTracks","_setting_trackLength","_submitAnimationFrame","requestAnimationFrame","_currentAnimationData","_callbacks","setSubscribedPilots","subscribedPilots","_updateImportantFlights","pushNewInfo","pilotInfo","values","flightInfo","pushNewData","trackId","trackData","pushFlightLanded","useAnimatedData","importantFlights","filter","val","info","user","username","importantFlightSet","Set","toRemove","entries","as","bs","size","has","eqSet","_subscribedFlights","_setSubscribedFlightsCallback","_highPrecisionTimeSync","settings_timeOffset","settings_lowLatencyMode","settings_limitFps","settings_fps","settings_trackLength","settings_limitTracks","Array","from","EventfulState","set","_callbackData","NO_INFORMATION","XContestInterface","socket","getPilotInfos","pilots","onConnectionStateChanged","connectionState","onInfoMessageReceived","overriden","animation","pilotInfos","onTracklogMessageReceived","trackChunk","onFlightLandedMessageReceived","_instance","getXContestInterface","GoogleMapsTrack","initialData","setMap","marker","_updateTrack","startTime","endTime","currentTrackVersion","setPath","setPosition","maps","Marker","position","title","fullname","Polyline","path","MapAnimator","cleanupOldTracks","tracks","pilotData","LiveMap","mapReady","mapError","mapsRef","useRef","useLayoutEffect","Map","current","center","mapTypeId","zoom","maxZoom","disableDefaultUI","scaleControl","fullscreenControl","styles","mapStyle","mapAnimatorUpdateCallback","Fragment","LastFixArrow","props","style","transform","WebkitTransform","MozTransform","msTransform","OTransform","LastFixState","relative","time_diff","timeStr","millis","negative","secs","floor","mins","hours","toString","padStart","days","formatTimeDiff","toLocaleTimeString","timestampToTimeString","role","aria-hidden","columns","id","label","render","row","paddingLeft","paddingTop","paddingBottom","variant","align","paddingRight","nationality","iso","marginLeft","boxShadow","verticalAlign","toLowerCase","PilotSelector","useTheme","pilotList","selected","setSelected","search","setSearch","numSelected","closeWindow","fullScreen","useMediaQuery","breakpoints","down","matchesSearch","filteredPilots","userData","test","login","gender","Dialog","open","Toolbar","palette","type","secondary","main","backgroundColor","lighten","light","text","primary","dark","component","TextField","autoComplete","fullWidth","onChange","event","target","flex","marginY","overflowY","Table","stickyHeader","TableHead","TableRow","column","TableCell","TableBody","isItemSelected","isSelected","itemDisabled","alreadyAdded","wasAlreadyAdded","columnContent","padding","onClick","_event","selectedIndex","newSelected","concat","handleClick","DialogActions","Button","disabled","onAddPilots","AnimatedPilotList","animatedData","content","pilotId","pilotName","displayedName","pilotDebugOutput","animatedPilotData","removePilots","Pilots","pilotSelectorOpen","setPilotSelectorOpen","chosenPilots","setChosenPilots","pilotIds","newPilotState","changed","useChosenPilots","addPilots","bottom","right","Fab","NumberInput","internalUpdate","min","max","hiddenLabel","InputProps","endAdornment","InputAdornment","unit","inputProps","resultState","Component","SettingsPage","resetAllSettingsDialogOpen","setResetAllSettingsDialogOpen","settingPathLength","setSettingPathLength","settingLimitPaths","setSettingLimitPaths","settingLowLatency","setSettingLowLatency","settingAnimationDelay","setSettingAnimationDelay","settingFpsLimit","setSettingFpsLimit","settingFpsRate","setSettingFpsRate","flipLimitPaths","flipLowLatency","flipFpsLimit","AppBar","IconButton","edge","flexGrow","DialogTitle","DialogContent","DialogContentText","settingsObj","autoFocus","List","ListItem","button","ListItemText","ListItemSecondaryAction","Switch","checked","Divider","MainMenu","settingsOpen","setSettingsOpen","SwipeableDrawer","disableSwipeToOpen","minWidth","clone","ListItemIcon","popover","LoadingBadge","Badge","anchorOrigin","vertical","horizontal","badgeContent","disableShrink","thickness","children","TitleBar","popoverActions","React","connectionPopAnchor","setConnectionPopAnchor","mainMenuOpen","setMainMenuOpen","updatePosition","currentTarget","renderConnectionIcon","Popover","Boolean","anchorEl","transformOrigin","action","MainPage","tabId","setTabId","windowHeight","setWindowHeight","updateWindowHeight","innerHeight","removeEventListener","flexDirection","zIndex","BottomNavigation","showLabels","BottomNavigationAction","icon","App","location","hostname","match","require","config","ReactDOM","getElementById","navigator","serviceWorker","registration","unregister"],"mappings":"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","file":"static/js/main.d51a2586.chunk.js","sourcesContent":["import { useState, useEffect } from \"react\";\n\n// Hook\nlet googleMapsApiPromise = null;\nfunction useGoogleMapsApi() {\n  // Keeping track of script loaded and error state\n  const [state, setState] = useState({\n    ready: false,\n    error: false\n  });\n\n  useEffect(\n    () => {\n      if (googleMapsApiPromise === null) {\n        googleMapsApiPromise = new Promise((resolve, _reject) => {\n          console.log(\"Loading Google Maps API ...\");\n          // Create script\n          let script = document.createElement(\"script\");\n          script.src =\n            \"https://maps.googleapis.com/maps/api/js?key=\" +\n            process.env.REACT_APP_GAPI_KEY;\n          script.async = true;\n\n          script.addEventListener(\"load\", () => resolve(true));\n          script.addEventListener(\"error\", () => resolve(false));\n\n          // Add script to document body\n          document.body.appendChild(script);\n        });\n      }\n\n      googleMapsApiPromise.then(success => {\n        if (success) {\n          console.log(\"Google Maps API loaded.\");\n          setState({\n            ready: true,\n            error: false\n          });\n        } else {\n          console.log(\"Error: Cannot load Google Maps API.\");\n          setState({\n            ready: false,\n            error: true\n          });\n        }\n      });\n    },\n    [] // Don't re-run\n  );\n\n  return [state.ready, state.error, state.ready ? window.google : null];\n}\n\nexport default useGoogleMapsApi;\n","import React from \"react\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport { Box, Typography } from \"@material-ui/core\";\nimport CircularProgress from \"@material-ui/core/CircularProgress\";\nimport ErrorIcon from \"@material-ui/icons/Error\";\n\nconst useStyles = makeStyles(theme => ({\n  progress: {\n    margin: theme.spacing(2)\n  }\n}));\n\nexport const LoadingPage = ({ message, hideIf, subRef }) => {\n  const classes = useStyles();\n  return (\n    <Box\n      width=\"100%\"\n      height=\"100%\"\n      display={hideIf ? \"none\" : \"flex\"}\n      alignItems=\"center\"\n      justifyContent=\"center\"\n      ref={subRef}\n    >\n      <Box textAlign=\"center\">\n        <CircularProgress className={classes.progress} />\n        <Typography>{message}</Typography>\n      </Box>\n    </Box>\n  );\n};\n\nexport const ErrorPage = ({ message, hideIf }) => {\n  const classes = useStyles();\n  return (\n    <Box\n      width=\"100%\"\n      height=\"100%\"\n      display={hideIf ? \"none\" : \"flex\"}\n      alignItems=\"center\"\n      justifyContent=\"center\"\n    >\n      <Box textAlign=\"center\">\n        <ErrorIcon\n          fontSize=\"large\"\n          color=\"error\"\n          className={classes.progress}\n        />\n        <Typography color=\"error\">{message}</Typography>\n      </Box>\n    </Box>\n  );\n};\n","import { useState, useEffect } from \"react\";\n\nclass PersistentState {\n  constructor(key, initialValue) {\n    this.key = key;\n    this.initialValue = initialValue;\n    this.callbacks = [];\n  }\n\n  getValue = () => {\n    const value = JSON.parse(localStorage.getItem(this.key));\n    if (value === null) return this.initialValue;\n    return value;\n  };\n\n  _notifyAll = () => {\n    const value = this.getValue();\n    for (const cb of this.callbacks) {\n      cb(value);\n    }\n  };\n\n  registerCallback = cb => {\n    if (!this.callbacks.includes(cb)) this.callbacks.push(cb);\n  };\n\n  unregisterCallback = cb => {\n    const index = this.callbacks.indexOf(cb);\n    if (index >= 0) {\n      this.callbacks.splice(index, 1);\n    }\n  };\n\n  setValue = value => {\n    if (value == null) {\n      localStorage.removeItem(this.key);\n    } else {\n      localStorage.setItem(this.key, JSON.stringify(value));\n    }\n\n    this._notifyAll();\n  };\n\n  use = () => {\n    const [value, setValue] = useState(this.getValue);\n\n    useEffect(() => {\n      const cb = newValue => {\n        // trigger component update on change\n        setValue(newValue);\n      };\n\n      this.registerCallback(cb);\n      return () => this.unregisterCallback(cb);\n    }, []);\n\n    return [value, this.setValue];\n  };\n}\n\nexport const registerPersistentState = (name, initialValue) => {\n  return new PersistentState(name, initialValue);\n};\n","import { registerPersistentState } from \"./PersistentState\";\n\n// Keys\nexport const Settings = {\n  PATH_LENGTH: \"PATH_LENGTH\",\n  LIMIT_PATHS: \"LIMIT_PATHS\",\n  LOW_LATENCY: \"LOW_LATENCY\",\n  ANIMATION_DELAY: \"ANIMATION_DELAY\",\n  FPS_LIMIT: \"FPS_LIMIT\",\n  FPS_RATE: \"FPS_RATE\"\n};\n\n// Wrapper for simplification\nconst createSetting = (key, value) =>\n  registerPersistentState(\"SETTINGS_\" + key, value);\n\n// Settings objects\nconst settingsObjects = {\n  PATH_LENGTH: createSetting(Settings.PATH_LENGTH, 15),\n  LIMIT_PATHS: createSetting(Settings.LIMIT_PATHS, true),\n  LOW_LATENCY: createSetting(Settings.LOW_LATENCY, false),\n  ANIMATION_DELAY: createSetting(Settings.ANIMATION_DELAY, 80),\n  FPS_LIMIT: createSetting(Settings.FPS_LIMIT, true),\n  FPS_RATE: createSetting(Settings.FPS_RATE, 10)\n};\n\nexport const getSetting = key => settingsObjects[key];\n\nexport const resetAllSettings = () => {\n  Object.values(settingsObjects).forEach(settingsObj =>\n    settingsObj.setValue(null)\n  );\n};\n","import { ConnectionState } from \"./XContestInterface\";\nimport { getSetting, Settings } from \"../../common/PersistentState/Settings\";\n\nexport default class XContestSocket {\n  constructor(\n    onStateChanged,\n    onInfoMessage,\n    onTracklogMessage,\n    onFlightLanded\n  ) {\n    this.setConnectionState = onStateChanged;\n    this.dispatchInfoMessage = onInfoMessage;\n    this.dispatchTracklogMessage = onTracklogMessage;\n    this.dispatchFlightLandedMessage = onFlightLanded;\n    this.subscribedFlights = [];\n    this.connect();\n    this.connected = false;\n\n    // Register hooks, so we get notified when these settings change\n    getSetting(Settings.PATH_LENGTH).registerCallback(\n      this.refreshSubscribedFlights\n    );\n    getSetting(Settings.LIMIT_PATHS).registerCallback(\n      this.refreshSubscribedFlights\n    );\n  }\n\n  connect() {\n    if (\"WebSocket\" in window) {\n      this.connected = false;\n      this.setConnectionState(ConnectionState.CONNECTING);\n      this.sock = new WebSocket(\"wss://live.xcontest.org/websock/webclient\");\n      this.sock.onopen = this.onOpen;\n      this.sock.onmessage = this.onMessage;\n      this.sock.onclose = this.onClose;\n      this.sock.onerror = this.onError;\n    } else {\n      this.setConnectionState(ConnectionState.ERROR);\n      // The browser doesn't support WebSocket\n      alert(\"WebSocket NOT supported by your Browser!\");\n    }\n  }\n\n  formatSubscribedFlights = () => {\n    const setting_pathLength = getSetting(Settings.PATH_LENGTH).getValue();\n    const setting_limitPath = getSetting(Settings.LIMIT_PATHS).getValue();\n\n    let startIsoDate = null;\n    if (setting_limitPath) {\n      const startDate = new Date(Date.now() - 1000 * 60 * setting_pathLength);\n      startDate.setMilliseconds(0);\n      startIsoDate = startDate.toISOString();\n    }\n\n    const formattedFlights = this.subscribedFlights.map(flight => {\n      return { flightUuid: flight, start: startIsoDate };\n    });\n\n    return formattedFlights;\n  };\n\n  refreshSubscribedFlights = () => {\n    if (this.sock.readyState === WebSocket.OPEN && this.connected) {\n      this.sock.send(\n        JSON.stringify({\n          tag: \"WebFollow\",\n          contents: this.formatSubscribedFlights()\n        })\n      );\n    }\n  };\n\n  setSubscribedFlights = flights => {\n    this.subscribedFlights = flights;\n    this.refreshSubscribedFlights();\n  };\n\n  onOpen = () => {\n    this.handleReset();\n    console.debug(\"WebSocket: Open!\");\n    this.setConnectionState(ConnectionState.ESTABLISHED);\n    this.connected = true;\n\n    // Set area filter to the entire world\n    this.sock.send(\n      JSON.stringify({\n        tag: \"WebFilterArea\",\n        area: [{ lat: -90, lon: -180 }, { lat: 90, lon: 180 }]\n      })\n    );\n\n    // Use current 'fake' contest that is valid for the current alpha phase.\n    // Primarily sent to match the messages from their reverse engineered websocket\n    this.sock.send(\n      JSON.stringify({ tag: \"WebFilterContest\", contents: \"alpha9999\" })\n    );\n\n    // Tell the webserver which flights we want in more detail. TODO.\n    this.sock.send(\n      JSON.stringify({\n        tag: \"WebFollow\",\n        contents: this.formatSubscribedFlights()\n      })\n    );\n  };\n\n  onMessage = evt => {\n    console.debug(\"WebSocket: Message!\");\n    this.setConnectionState(ConnectionState.ACTIVE);\n\n    let msg = JSON.parse(evt.data);\n\n    // Expect the next message in 60 seconds. If not, change the status message.\n    clearTimeout(this.watchdog);\n    this.watchdog = setTimeout(() => {\n      this.setConnectionState(ConnectionState.INACTIVE);\n    }, 70000);\n\n    // Process the message\n    this.processMessage(msg);\n  };\n\n  onClose = evt => {\n    this.connected = false;\n    console.debug(\"WebSocket: Close!\");\n    this.setConnectionState(ConnectionState.NO_CONNECTION);\n    // websocket is closed.\n    setTimeout(this.connect.bind(this), 1000);\n  };\n\n  onError = evt => {\n    this.connected = false;\n    console.debug(\"WebSocket: Error!\");\n  };\n\n  // Message Processing\n  handleReset = () => {\n    console.log(\"TODO: handle reset!\");\n  };\n  processMessage = msg => {\n    if (!(\"tag\" in msg)) {\n      console.warn(\"Warning: Invalid message format!\", msg);\n      return;\n    }\n    switch (msg.tag) {\n      case \"LiveFlightInfos\":\n        this.dispatchInfoMessage(msg.contents);\n        break;\n      case \"LiveFlightChunk\":\n        this.dispatchTracklogMessage(msg);\n        break;\n      case \"LiveFlightLanded\":\n        this.dispatchFlightLandedMessage(msg.flightUuid);\n        break;\n      default:\n        console.warn(`Warning: Unknown message tag '${msg.tag}'!`, msg);\n    }\n  };\n}\n","import { registerPersistentState } from \"./PersistentState\";\n\nconst persistentChosenPilots = registerPersistentState(\"chosen-pilots\", {});\n\nexport const getChosenPilotsObject = () => persistentChosenPilots;\n\nexport function getChosenPilots() {\n  return persistentChosenPilots.getValue();\n}\n\nexport function useChosenPilots() {\n  const [chosenPilots, setChosenPilots] = persistentChosenPilots.use();\n\n  // Add new pilots\n  const addPilots = pilotIds => {\n    const newPilotState = { ...chosenPilots };\n\n    let changed = false;\n    for (const pilotId of pilotIds) {\n      if (!(pilotId in newPilotState)) {\n        newPilotState[pilotId] = null;\n        changed = true;\n      }\n    }\n\n    if (changed) {\n      setChosenPilots(newPilotState);\n    }\n  };\n\n  // Remove pilots\n  const removePilots = pilotIds => {\n    const newPilotState = { ...chosenPilots };\n\n    let changed = false;\n    for (const pilotId of pilotIds) {\n      if (pilotId in newPilotState) {\n        delete newPilotState[pilotId];\n        changed = true;\n      }\n    }\n\n    if (changed) {\n      setChosenPilots(newPilotState);\n    }\n  };\n\n  return [chosenPilots, addPilots, removePilots];\n}\n","export const lerp = (val1, val2, pct) => {\n  if (val2 === null) {\n    return val1;\n  }\n  if (val1 === null) {\n    return val2;\n  }\n  return (1.0 - pct) * val1 + pct * val2;\n};\n\n// TODO catmull-rom\n","export default class RunningDerivation {\n  constructor(\n    smoothingFactor,\n    derivation_func = (a, b) => b - a,\n    invalid_func = a => a === null\n  ) {\n    this.computeDiff = derivation_func;\n    this.isInvalid = invalid_func;\n    this.old_val = null;\n    this.old_t = null;\n    this.running_avg = null;\n    this.smoothingFactor = smoothingFactor;\n  }\n\n  update(new_val, new_t) {\n    if (\n      this.old_val === null ||\n      new_val === null ||\n      this.old_t === null ||\n      new_t === null ||\n      this.isInvalid(this.old_val) ||\n      this.isInvalid(new_val) ||\n      this.old_t === this.new_t\n    ) {\n      this.old_val = new_val;\n      this.old_t = new_t;\n      return null;\n    }\n\n    let dt = new_t - this.old_t;\n    let diff = this.computeDiff(this.old_val, new_val);\n    let deriv = diff / dt;\n\n    let weight = Math.pow(this.smoothingFactor, dt);\n    if (this.running_avg === null) {\n      this.running_avg = deriv;\n    } else {\n      this.running_avg = weight * this.running_avg + (1.0 - weight) * deriv;\n    }\n\n    this.old_val = new_val;\n    this.old_t = new_t;\n    return this.running_avg;\n  }\n\n  reset() {\n    this.old_val = null;\n    this.old_t = null;\n    this.running_avg = null;\n  }\n}\n","const findBisect = (targetValue, length, dataFn) => {\n  if (length < 1) return 0;\n\n  let minIndex = -1;\n  let maxIndex = length;\n  let currentIndex = 0;\n  let currentValue = null;\n\n  while (minIndex < maxIndex - 1) {\n    currentIndex = ((minIndex + maxIndex) / 2) | 0;\n    currentValue = dataFn(currentIndex);\n\n    if (currentValue < targetValue) {\n      minIndex = currentIndex;\n    } else {\n      maxIndex = currentIndex;\n    }\n  }\n\n  return maxIndex;\n};\n\nexport default findBisect;\n","import RunningDerivation from \"../../util/RunningDerivation\";\nimport { getDistance } from \"geolib\";\nimport findBisect from \"../../util/FindBisect\";\n\nexport const parseTime = isoStr => {\n  return Math.round(Date.parse(isoStr) / 1000);\n};\n\nexport default class FlightAnimationData {\n  constructor() {\n    this.data = [];\n    this.counter_gpsVario = new RunningDerivation(0.7);\n    this.counter_baroVarion = new RunningDerivation(0.7);\n    this.counter_velocity = new RunningDerivation(\n      0.7,\n      (start, end) => getDistance(start, end, 0.01),\n      () => false\n    );\n  }\n\n  at = index => this.data[index];\n\n  clear() {\n    // reset everything\n    this.data = [];\n    this.counter_gpsVario = new RunningDerivation(0.7);\n    this.counter_baroVarion = new RunningDerivation(0.7);\n    this.counter_velocity = new RunningDerivation(\n      0.7,\n      (start, end) => getDistance(start, end, 0.01),\n      () => false\n    );\n  }\n\n  get length() {\n    return this.data.length;\n  }\n\n  isAfterLastElement(timestamp) {\n    if (this.data.length <= 0) return true;\n    return this.data[this.data.length - 1].t < timestamp;\n  }\n\n  append(data) {\n    for (const elem of data) {\n      const timestamp = parseTime(elem.timestamp);\n      const pos = { lat: elem.lat, lng: elem.lon };\n\n      const baroAlt = elem.baroAlt === 0 ? null : elem.baroAlt;\n      const gpsAlt = elem.gpsAlt === 0 ? null : elem.gpsAlt;\n\n      // Compute new running average values\n      const gpsVario = this.counter_gpsVario.update(gpsAlt, timestamp);\n      const baroVario = this.counter_baroVarion.update(baroAlt, timestamp);\n      const velocity = this.counter_velocity.update(pos, timestamp);\n\n      const newElem = {\n        baroAlt: baroAlt,\n        gpsAlt: gpsAlt,\n        elevation: elem.elevation,\n        pos: pos,\n        gpsVario: gpsVario,\n        baroVario: baroVario,\n        velocity: velocity,\n        t: timestamp\n      };\n      this.data.push(newElem);\n    }\n  }\n\n  replace(data) {\n    this.clear();\n    this.append(data);\n  }\n\n  insert(data) {\n    const newElements = [];\n    for (const elem of data) {\n      const timestamp = parseTime(elem.timestamp);\n      const pos = { lat: elem.lat, lng: elem.lon };\n      const baroAlt = elem.baroAlt === 0 ? null : elem.baroAlt;\n      const gpsAlt = elem.gpsAlt === 0 ? null : elem.gpsAlt;\n\n      const newElem = {\n        baroAlt: baroAlt,\n        gpsAlt: gpsAlt,\n        elevation: elem.elevation,\n        pos: pos,\n        gpsVario: null,\n        baroVario: null,\n        velocity: null,\n        t: timestamp\n      };\n      newElements.push(newElem);\n    }\n\n    // Merge\n    const oldElements = this.data;\n    this.data = [];\n\n    let oldPos = 0;\n    let newPos = 0;\n\n    while (true) {\n      if (oldPos >= oldElements.length && newPos >= newElements.length) break;\n      else if (oldPos >= oldElements.length) {\n        this.data.push(newElements[newPos]);\n        newPos += 1;\n      } else if (newPos >= newElements.length) {\n        this.data.push(oldElements[oldPos]);\n        oldPos += 1;\n      } else {\n        const oldEl = oldElements[oldPos];\n        const newEl = newElements[newPos];\n\n        if (newEl.t < oldEl.t) {\n          this.data.push(newEl);\n          newPos += 1;\n        } else if (oldEl.t < newEl.t) {\n          this.data.push(oldEl);\n          oldPos += 1;\n        } else {\n          this.data.push(newEl);\n          oldPos += 1;\n          newPos += 1;\n        }\n      }\n    }\n\n    // Re-compute derivatives\n    this.counter_gpsVario.reset();\n    this.counter_baroVarion.reset();\n    this.counter_velocity.reset();\n    for (let elem of this.data) {\n      const gpsVario = this.counter_gpsVario.update(elem.gpsAlt, elem.t);\n      const baroVario = this.counter_baroVarion.update(elem.baroAlt, elem.t);\n      const velocity = this.counter_velocity.update(elem.pos, elem.t);\n\n      elem.gpsVario = gpsVario;\n      elem.baroVario = baroVario;\n      elem.velocity = velocity;\n    }\n  }\n\n  findBisect = timestamp => {\n    return findBisect(timestamp, this.data.length, pos => this.data[pos].t);\n  };\n\n  findForwardSwipe = (timestamp, startPos) => {\n    let pos = startPos;\n    while (pos < this.data.length && this.data[pos].t < timestamp) {\n      pos += 1;\n    }\n    return pos;\n  };\n}\n","import { lerp } from \"../../util/Interpolation\";\nimport FlightAnimationData, { parseTime } from \"./FlightAnimationData\";\n\nclass FlightAnimationDataCache {\n  // IMPORTANT ASSUMPTION IN THIS ENTIRE FILE:\n  // While the cache exists, new data gets only appended. Whenever existing data changes, the cache\n  // will be invalidated.\n  // I.E., chache invariants:\n  //    - existing data entries don't change, indices always point to the same data\n  //    - data timestamps are monotonic rising, meaning, to get newer data the data array only\n  //      needs to be traversed in forward direction, never backwards.\n  // This enables efficient caching and O(1) lookup times.\n  constructor() {\n    this.currentArrayPos = null;\n    this.mapsPath = [];\n    this.mapsPathNewestPos = 0;\n  }\n\n  reset = () => {\n    this.currentArrayPos = null;\n    this.mapsPath = [];\n    this.mapsPathNewestPos = 0;\n  };\n}\n\nclass DataGens {\n  static fallbackData = flightInfos => {\n    return {\n      baroAlt: flightInfos.lastFix.baroAlt,\n      gpsAlt: flightInfos.lastFix.gpsAlt,\n      elevation: flightInfos.lastFix.elevation,\n      pos: {\n        lat: flightInfos.lastFix.lat,\n        lng: flightInfos.lastFix.lon\n      },\n      gpsVario: null,\n      baroVario: null,\n      velocity: null\n    };\n  };\n\n  static takeData(data) {\n    return {\n      baroAlt: data.baroAlt,\n      gpsAlt: data.gpsAlt,\n      elevation: data.elevation,\n      pos: {\n        lat: data.pos.lat,\n        lng: data.pos.lng\n      },\n      gpsVario: data.gpsVario,\n      baroVario: data.baroVario,\n      velocity: data.velocity\n    };\n  }\n\n  static blendData(data1, data2, pct) {\n    return {\n      baroAlt: lerp(data1.baroAlt, data2.baroAlt, pct),\n      gpsAlt: lerp(data1.gpsAlt, data2.gpsAlt, pct),\n      elevation: lerp(data1.elevation, data2.elevation, pct),\n      pos: {\n        lat: lerp(data1.pos.lat, data2.pos.lat, pct),\n        lng: lerp(data1.pos.lng, data2.pos.lng, pct)\n      },\n      gpsVario: lerp(data1.gpsVario, data2.gpsVario, pct),\n      baroVario: lerp(data1.baroVario, data2.baroVario, pct),\n      velocity: lerp(data1.velocity, data2.velocity, pct)\n    };\n  }\n\n  static blendDataSpline(data0, data1, data2, data3, pct) {\n    // TODO add catmull-rom spline interpolation\n    return null;\n  }\n}\n\nclass FlightAnimation {\n  constructor(flightInfos) {\n    // Live data\n    this.liveData = new FlightAnimationData();\n    this.liveDataCache = new FlightAnimationDataCache();\n\n    // Data from flight infos, used as fallback\n    this.flightInfos = null;\n    this.flightInfoData = new FlightAnimationData();\n    this.flightInfoDataCache = new FlightAnimationDataCache();\n\n    // 'landed' state\n    this.landed = flightInfos.landed;\n\n    // Set flight infos\n    this.updateInfos(flightInfos);\n  }\n\n  updateInfos = infos => {\n    this.landed |= infos.landed;\n    this.flightInfos = infos;\n    this.flightInfoData.replace(infos.track);\n    this.flightInfoDataCache.reset();\n  };\n\n  updateData = data => {\n    if (data.length < 1) return;\n\n    // Compute start time\n    const data_start_time = parseTime(data[0].timestamp);\n    if (this.liveData.isAfterLastElement(data_start_time)) {\n      // If the new data is newer than everything in the existing data, append\n      this.liveData.append(data);\n    } else {\n      // Otherwise, merge\n      this.liveData.insert(data);\n\n      // Reset animation\n      this.liveDataCache.reset();\n    }\n  };\n\n  updateLanded = () => {\n    console.log(\"Received flight landed message!\");\n    this.landed = true;\n  };\n\n  getInterpolatedData = (data, cache, timeStamp) => {\n    if (data.length < 1) return null;\n\n    if (cache.currentArrayPos === null) {\n      cache.currentArrayPos = data.findBisect(timeStamp);\n    } else {\n      // Optimization because we assume that time runs forward and the next value is after the current value\n      cache.currentArrayPos = data.findForwardSwipe(\n        timeStamp,\n        cache.currentArrayPos\n      );\n    }\n\n    // Compute\n    let blendedData = null;\n    let endOfTrack = false;\n    let startOfTrack = false;\n    if (cache.currentArrayPos <= 0) {\n      // If the timestamp is before our track, return first element\n      blendedData = DataGens.takeData(data.at(0));\n      startOfTrack = true;\n    } else if (cache.currentArrayPos >= data.length) {\n      // If the timestamp is after our track, return last element\n      blendedData = DataGens.takeData(data.at(data.length - 1));\n      endOfTrack = true;\n    } else {\n      // If it is in between, return interpolated value\n      const data0 = data.at(cache.currentArrayPos - 1);\n      const data1 = data.at(cache.currentArrayPos);\n      const blend = (timeStamp - data0.t) / (data1.t - data0.t);\n      blendedData = DataGens.blendData(data0, data1, blend);\n    }\n\n    return [blendedData, startOfTrack, endOfTrack];\n  };\n\n  getFallbackData = () => {\n    return [\n      DataGens.fallbackData(this.flightInfos),\n      false,\n      this.flightInfos.landed\n    ];\n  };\n\n  computeTrack = (data, cache, timestamp, limitTrack, trackLengthSeconds) => {\n    if (data.length < 1) return null;\n\n    const oldestTimestamp = timestamp - trackLengthSeconds;\n\n    let track = cache.mapsPath;\n\n    // Append new data\n    while (\n      cache.mapsPathNewestPos < data.length &&\n      data.at(cache.mapsPathNewestPos).t < timestamp\n    ) {\n      const elem = data.at(cache.mapsPathNewestPos);\n      track.push({\n        lat: elem.pos.lat,\n        lng: elem.pos.lng,\n        timestamp: elem.t,\n        elevation: elem.gpsAlt\n      });\n      cache.mapsPathNewestPos += 1;\n    }\n\n    // Delete old data\n    if (limitTrack) {\n      const removeChunkSize = 32;\n      let numRemove = 0;\n      while (\n        numRemove + removeChunkSize - 1 < track.length &&\n        track[numRemove + removeChunkSize - 1].timestamp < oldestTimestamp\n      ) {\n        numRemove += removeChunkSize;\n      }\n      if (numRemove > 0) {\n        track = track.slice(numRemove);\n        cache.mapsPath = track;\n      }\n    }\n\n    return track;\n  };\n\n  updateAnimation = (\n    animationTimeMillis,\n    lowLatencyMode,\n    limitTrack,\n    trackLengthMinutes\n  ) => {\n    const animationTimeSeconds = animationTimeMillis / 1000;\n\n    let animationResult = this.getInterpolatedData(\n      this.liveData,\n      this.liveDataCache,\n      animationTimeSeconds\n    );\n    if (!animationResult) {\n      animationResult = this.getInterpolatedData(\n        this.flightInfoData,\n        this.flightInfoDataCache,\n        animationTimeSeconds\n      );\n    }\n    if (!animationResult) {\n      animationResult = this.getFallbackData();\n    }\n\n    let track = this.computeTrack(\n      this.liveData,\n      this.liveDataCache,\n      animationTimeSeconds,\n      limitTrack,\n      trackLengthMinutes * 60\n    );\n    if (!track) {\n      track = this.computeTrack(\n        this.flightInfoData,\n        this.flightInfoDataCache,\n        animationTimeSeconds,\n        limitTrack,\n        trackLengthMinutes * 60\n      );\n    }\n    if (!track) {\n      track = [];\n    }\n\n    const [blendedData, startOfTrack, endOfTrack] = animationResult;\n\n    const result = {\n      ...blendedData,\n      startOfTrack: startOfTrack,\n      endOfTrack: endOfTrack,\n      landed: this.landed,\n      track: track\n    };\n\n    return result;\n  };\n}\n\nexport default FlightAnimation;\n","class HighPrecisionTimeSync {\n  // Tolerance should be larger than the duration of one animation frame.\n  // Most animations are 60Hz, meaning 16ms, so 20ms is fine.\n  constructor(tolerance = 20) {\n    this.offset = 0.0;\n    this.tolerance = tolerance;\n  }\n\n  get = (currentHighPrecisionTime, currentTime) => {\n    let estimatedTime = currentHighPrecisionTime + this.offset;\n    const offBy = estimatedTime - currentTime;\n\n    if (offBy > this.tolerance || offBy < -this.tolerance) {\n      this.offset -= offBy;\n      estimatedTime = currentHighPrecisionTime + this.offset;\n    }\n\n    return estimatedTime;\n  };\n}\n\nexport default HighPrecisionTimeSync;\n","import {\n  getChosenPilots,\n  getChosenPilotsObject\n} from \"../../common/PersistentState/ChosenPilots\";\nimport { useState, useEffect } from \"react\";\nimport FlightAnimation from \"./FlightAnimation\";\nimport HighPrecisionTimeSync from \"../../util/HighPrecisionTimeSync\";\nimport { Settings, getSetting } from \"../../common/PersistentState/Settings\";\n\nfunction eqSet(as, bs) {\n  if (as.size !== bs.size) return false;\n  for (const a of as) if (!bs.has(a)) return false;\n  return true;\n}\n\nexport default class XContestAnimation {\n  constructor(setSubscribedFlights) {\n    this._currentAnimationData = {};\n    this._callbacks = [];\n    this._subscribedPilots = getChosenPilots();\n    this._subscribedFlights = new Set();\n    this._pilotInfos = {};\n    this._flightAnimations = {};\n    this._highPrecisionTimeSync = new HighPrecisionTimeSync();\n    const settings_timeOffset = getSetting(Settings.ANIMATION_DELAY);\n    const settings_lowLatencyMode = getSetting(Settings.LOW_LATENCY);\n    const settings_limitFps = getSetting(Settings.FPS_LIMIT);\n    const settings_fps = getSetting(Settings.FPS_RATE);\n    const settings_trackLength = getSetting(Settings.PATH_LENGTH);\n    const settings_limitTracks = getSetting(Settings.LIMIT_PATHS);\n\n    // Cached settings values for performance improvements. Not sure if actually worth\n    this._setting_timeOffset = settings_timeOffset.getValue();\n    this._setting_lowLatencyMode = settings_lowLatencyMode.getValue();\n    this._setting_limitFps = settings_limitFps.getValue();\n    this._setting_fps = settings_fps.getValue();\n    this._setting_trackLength = settings_trackLength.getValue();\n    this._setting_limitTracks = settings_limitTracks.getValue();\n    settings_timeOffset.registerCallback(value => {\n      this._setting_timeOffset = value;\n    });\n    settings_lowLatencyMode.registerCallback(value => {\n      this._setting_lowLatencyMode = value;\n    });\n    settings_limitFps.registerCallback(value => {\n      this._setting_limitFps = value;\n    });\n    settings_fps.registerCallback(value => {\n      this._setting_fps = value;\n    });\n    settings_trackLength.registerCallback(value => {\n      this._setting_trackLength = value;\n    });\n    settings_limitTracks.registerCallback(value => {\n      this._setting_limitTracks = value;\n    });\n\n    this._setSubscribedFlightsCallback = flights => {\n      this._subscribedFlights = flights;\n      setSubscribedFlights(Array.from(flights));\n    };\n    getChosenPilotsObject().registerCallback(this.setSubscribedPilots);\n    requestAnimationFrame(this.animationLoop);\n  }\n\n  // Animation loop\n  _nextUpdate = Date.now();\n  animationLoop = () => {\n    // Can't use time of function parameter, because we need absolute time\n    const absTime = Date.now();\n\n    const frameTimeDelta = 1000.0 / this._setting_fps;\n\n    if (!this._setting_limitFps || absTime >= this._nextUpdate) {\n      this._nextUpdate = this._nextUpdate + frameTimeDelta;\n      if (this._nextUpdate < absTime) {\n        this._nextUpdate = absTime;\n      }\n\n      const offsetTime = absTime - 1000 * this._setting_timeOffset;\n      const newAnimationData = {};\n      Object.keys(this._subscribedPilots).forEach(pilot => {\n        if (pilot in this._pilotInfos) {\n          const flightId = this._pilotInfos[pilot].flightId;\n          if (flightId in this._flightAnimations) {\n            const flightAnim = this._flightAnimations[flightId];\n            newAnimationData[pilot] = flightAnim.updateAnimation(\n              offsetTime,\n              this._setting_lowLatencyMode,\n              this._setting_limitTracks,\n              this._setting_trackLength\n            );\n          }\n        }\n      });\n      this._submitAnimationFrame(newAnimationData);\n    }\n    requestAnimationFrame(this.animationLoop);\n  };\n\n  _submitAnimationFrame = data => {\n    this._currentAnimationData = data;\n    for (const cb of this._callbacks) {\n      cb(data);\n    }\n  };\n\n  // External\n  setSubscribedPilots = subscribedPilots => {\n    this._subscribedPilots = subscribedPilots;\n    this._updateImportantFlights();\n  };\n\n  pushNewInfo = pilotInfo => {\n    console.log(\"newInfo: \", pilotInfo);\n    this._pilotInfos = pilotInfo;\n    this._updateImportantFlights();\n\n    // Update flight info in flightAnimations\n    Object.values(pilotInfo).forEach(flightInfo => {\n      const flightId = flightInfo.flightId;\n      if (flightId in this._flightAnimations) {\n        this._flightAnimations[flightId].updateInfos(flightInfo);\n      }\n    });\n  };\n\n  pushNewData = (trackId, trackData) => {\n    console.log(\"newTrackdata: \", trackId, trackData);\n    if (trackId in this._flightAnimations)\n      this._flightAnimations[trackId].updateData(trackData);\n  };\n\n  pushFlightLanded = flightId => {\n    if (flightId in this._flightAnimations)\n      this._flightAnimations[flightId].updateLanded();\n  };\n\n  // callback gets called every frame with new data\n  registerCallback = cb => {\n    if (!this._callbacks.includes(cb)) this._callbacks.push(cb);\n  };\n\n  unregisterCallback = cb => {\n    const index = this._callbacks.indexOf(cb);\n    if (index >= 0) {\n      this._callbacks.splice(index, 1);\n    }\n  };\n\n  useAnimatedData = () => {\n    const [value, setValue] = useState(this._currentAnimationData);\n\n    useEffect(() => {\n      const cb = newValue => {\n        // trigger component update on change\n        setValue(newValue);\n      };\n\n      this.registerCallback(cb);\n      return () => this.unregisterCallback(cb);\n    }, []);\n\n    return value;\n  };\n\n  // Internal\n  _updateImportantFlights = () => {\n    // Filter important flights\n    let importantFlights = {};\n    Object.values(this._pilotInfos)\n      .filter(val => val.info.user.username in this._subscribedPilots)\n      .forEach(val => {\n        importantFlights[val.flightId] = val;\n      });\n\n    let importantFlightSet = new Set(Object.keys(importantFlights));\n\n    // Cleanup old entries of _flightAnimations\n    {\n      const toRemove = [];\n      for (const flightId in this._flightAnimations) {\n        if (!(flightId in importantFlights)) {\n          toRemove.push(flightId);\n        }\n      }\n      for (const flightId of toRemove) {\n        console.log(\"Removing flightAnimation of '\" + flightId + \"' ...\");\n        delete this._flightAnimations[flightId];\n      }\n    }\n\n    // Add new flightAnimations\n    Object.entries(importantFlights).forEach(([flightId, flightInfo]) => {\n      if (!(flightId in this._flightAnimations)) {\n        this._flightAnimations[flightId] = new FlightAnimation(flightInfo);\n      }\n    });\n\n    // Send subscription change to socket\n    if (!eqSet(importantFlightSet, this._subscribedFlights)) {\n      console.log(\n        \"Changing flight subscribtion: \",\n        this._subscribedFlights,\n        importantFlightSet\n      );\n      this._setSubscribedFlightsCallback(importantFlightSet);\n    }\n  };\n}\n","import { useState, useEffect } from \"react\";\n\nclass EventfulState {\n  constructor(initialValue) {\n    this._callbacks = [];\n    this._callbackData = initialValue;\n  }\n\n  set = value => {\n    this._callbackData = value;\n    for (const cb of this._callbacks) {\n      cb(value);\n    }\n  };\n\n  getValue = () => this._callbackData;\n\n  registerCallback = cb => {\n    if (!this._callbacks.includes(cb)) this._callbacks.push(cb);\n  };\n\n  unregisterCallback = cb => {\n    const index = this._callbacks.indexOf(cb);\n    if (index >= 0) {\n      this._callbacks.splice(index, 1);\n    }\n  };\n\n  use = () => {\n    const [value, setValue] = useState(this._callbackData);\n\n    useEffect(() => {\n      // trigger component update on change\n      this.registerCallback(setValue);\n      return () => this.unregisterCallback(setValue);\n    }, []);\n\n    return value;\n  };\n}\n\nexport default EventfulState;\n","import XContestSocket from \"./XContestSocket\";\nimport XContestAnimation from \"./XContestAnimation\";\nimport EventfulState from \"../../util/EventfulState\";\n\nexport const ConnectionState = {\n  CONNECTING: \"connecting\", //orange\n  ERROR: \"error\", //red\n  ESTABLISHED: \"established\", //yellow\n  ACTIVE: \"active\", //green\n  INACTIVE: \"inactive\", //orange\n  NO_CONNECTION: \"no connection\", //red\n  NO_INFORMATION: \"no information\" //gray\n};\n\nclass XContestInterface {\n  constructor() {\n    this.pilots = [];\n    this.connectionState = new EventfulState(ConnectionState.NO_INFORMATION);\n    this.pilotInfos = new EventfulState([]);\n    this.socket = new XContestSocket(\n      this.onConnectionStateChanged,\n      this.onInfoMessageReceived,\n      this.onTracklogMessageReceived,\n      this.onFlightLandedMessageReceived\n    );\n    this.animation = new XContestAnimation(this.setSubscribedFlights);\n  }\n\n  setSubscribedFlights = flights => {\n    this.socket.setSubscribedFlights(flights);\n  };\n\n  getPilotInfos = () => this.pilots;\n\n  onConnectionStateChanged = state => {\n    this.connectionState.set(state);\n  };\n\n  onInfoMessageReceived = msg => {\n    this.pilots = {};\n    for (const [trackId, track] of msg) {\n      // Skip if we have a newer track of the same person\n      if (track.overriden) continue;\n\n      track.flightId = trackId;\n\n      this.pilots[track.info.user.username] = track;\n    }\n    this.animation.pushNewInfo(this.pilots);\n    this.pilotInfos.set(this.pilots);\n  };\n\n  onTracklogMessageReceived = msg => {\n    this.animation.pushNewData(msg.flightUuid, msg.trackChunk);\n  };\n\n  onFlightLandedMessageReceived = flightId => {\n    this.animation.pushFlightLanded(flightId);\n  };\n}\n\n// Singleton stuff\nlet _instance = null;\nexport const getXContestInterface = () => {\n  if (!_instance) {\n    _instance = new XContestInterface();\n  }\n  return _instance;\n};\n\nexport const useXContestPilots = () => getXContestInterface().pilotInfos.use();\nexport const useXContestConnectionState = () =>\n  getXContestInterface().connectionState.use();\n","export default class GoogleMapsTrack {\n  constructor(google, map, pilotInfo, initialData) {\n    this.google = google;\n    this.marker = new this.google.maps.Marker({\n      map: map,\n      position: initialData.pos,\n      title: pilotInfo.info.user.fullname\n    });\n    this.track = new this.google.maps.Polyline({\n      map: map,\n      path: []\n    });\n    this.currentTrackVersion = { startTime: null, endTime: null, length: null };\n  }\n\n  setMap = map => {\n    this.marker.setMap(map);\n    this.track.setMap(map);\n  };\n\n  _updateTrack = track => {\n    if (!track || track.length < 1) return;\n\n    // Compute identifiers to reduce the amount if maps updates\n    const length = track.length;\n    const startTime = track[0].timestamp;\n    const endTime = track[length - 1].timestamp;\n    if (\n      startTime === this.currentTrackVersion.startTime &&\n      endTime === this.currentTrackVersion.endTime &&\n      length === this.currentTrackVersion.length\n    ) {\n      return;\n    }\n\n    // If the start/end time or length changed, update track in map\n    this.currentTrackVersion.startTime = startTime;\n    this.currentTrackVersion.endTime = endTime;\n    this.currentTrackVersion.length = length;\n\n    this.track.setPath(track);\n    console.log(\"Updated track!\");\n  };\n\n  updateData = data => {\n    this.marker.setPosition(data.pos);\n    this._updateTrack(data.track);\n  };\n}\n","import { getXContestInterface } from \"../location_provider/XContest/XContestInterface\";\nimport GoogleMapsTrack from \"./GoogleMapsTrack\";\n\nexport default class MapAnimator {\n  constructor(map, google) {\n    this.map = map;\n    this.google = google;\n    this.tracks = {};\n  }\n\n  cleanupOldTracks = data => {\n    const toRemove = [];\n    for (const pilot in this.tracks) {\n      if (!(pilot in data)) {\n        toRemove.push(pilot);\n      }\n    }\n    for (const pilot of toRemove) {\n      this.tracks[pilot].setMap(null);\n      delete this.tracks[pilot];\n    }\n  };\n\n  update = data => {\n    const pilotInfos = getXContestInterface().getPilotInfos();\n\n    // Remove tracks that we unsubscribed from\n    this.cleanupOldTracks(data);\n\n    // Update all pilots\n    Object.entries(data).forEach(([pilot, pilotData]) => {\n      if (!(pilot in pilotInfos)) return;\n      const info = pilotInfos[pilot];\n\n      // Add track if it doesn't exist\n      if (!(pilot in this.tracks)) {\n        this.tracks[pilot] = new GoogleMapsTrack(\n          this.google,\n          this.map,\n          info,\n          pilotData\n        );\n      }\n\n      // Update all tracks properties\n      const track = this.tracks[pilot];\n      track.updateData(pilotData);\n    });\n  };\n}\n","import React, { useState, useRef, useLayoutEffect, useEffect } from \"react\";\nimport Box from \"@material-ui/core/Box\";\nimport useGoogleMapsApi from \"../common/GoogleMapsApiLoader\";\nimport { LoadingPage, ErrorPage } from \"./StatusPages\";\nimport mapStyle from \"./MapStyle.json\";\nimport { getXContestInterface } from \"../location_provider/XContest/XContestInterface\";\nimport MapAnimator from \"./MapAnimator\";\n\nconst LiveMap = () => {\n  const [mapReady, mapError, google] = useGoogleMapsApi();\n  const mapsRef = useRef();\n  const [map, setMap] = useState(null);\n\n  // Initialize Map\n  useLayoutEffect(() => {\n    if (mapReady && !map) {\n      setMap(\n        new google.maps.Map(mapsRef.current, {\n          center: { lat: 46.509012, lng: 11.827984 },\n          mapTypeId: \"terrain\",\n          zoom: 12,\n          maxZoom: 15,\n          disableDefaultUI: true,\n          scaleControl: true,\n          fullscreenControl: true,\n          styles: mapStyle\n        })\n      );\n    }\n  }, [mapReady, map, google, mapsRef]);\n\n  // Register map for updates\n  useEffect(() => {\n    if (map && google) {\n      const mapAnimator = new MapAnimator(map, google);\n      const mapAnimatorUpdateCallback = mapAnimator.update;\n      getXContestInterface().animation.registerCallback(\n        mapAnimatorUpdateCallback\n      );\n\n      return () => {\n        getXContestInterface().animation.unregisterCallback(\n          mapAnimatorUpdateCallback\n        );\n      };\n    }\n  }, [map, google]);\n\n  return (\n    <React.Fragment>\n      <Box\n        width=\"100%\"\n        height=\"100%\"\n        display={mapReady ? \"block\" : \"none\"}\n        ref={mapsRef}\n      ></Box>\n      <LoadingPage\n        message=\"Loading Maps ...\"\n        hideIf={mapReady || mapError}\n      ></LoadingPage>\n      <ErrorPage message=\"Unable to load map!\" hideIf={!mapError}></ErrorPage>\n    </React.Fragment>\n  );\n};\n\nexport default LiveMap;\n","import React from \"react\";\n\nfunction formatTimeDiff(millis) {\n  let negative = \"\";\n\n  if (millis < 0) {\n    millis = -millis;\n    negative = \"-\";\n  }\n\n  let secs = Math.floor(millis / 1000);\n  if (secs < 60) {\n    return negative + secs + \" sec\";\n  }\n\n  let mins = Math.floor(secs / 60);\n  if (mins < 60) {\n    return negative + mins + \" min\";\n  }\n\n  let hours = Math.floor(mins / 60);\n  mins = mins - hours * 60;\n  if (hours < 24) {\n    return negative + hours + \":\" + mins.toString().padStart(2, \"0\") + \" h\";\n  }\n\n  let days = Math.floor(hours / 24);\n  hours = hours - days * 24;\n  return (\n    negative +\n    days +\n    \"d \" +\n    hours +\n    \":\" +\n    mins.toString().padStart(2, \"0\") +\n    \" h\"\n  );\n}\n\nfunction timestampToTimeString(timestamp) {\n  let time = new Date(timestamp);\n  return time.toLocaleTimeString();\n}\n\nconst LastFixState = props => {\n  const timestamp = props.timestamp;\n  const landed = props.landed;\n  const relative = props.relative;\n\n  if (timestamp == null) {\n    return <span>never</span>;\n  }\n  let time_diff = Date.parse(timestamp) - Date.now();\n\n  let timeStr = \"\";\n  if (relative) timeStr = formatTimeDiff(time_diff);\n  else timeStr = timestampToTimeString(timestamp);\n\n  if (landed) {\n    return <span style={{ color: \"#346B8F\" }}>&#10004; {timeStr}</span>;\n  }\n\n  if (-time_diff < 120000) {\n    if (relative)\n      return (\n        <span style={{ color: \"green\" }}>\n          <span role=\"img\" aria-hidden>\n            &#9899;\n          </span>{\" \"}\n          LIVE\n        </span>\n      );\n    else\n      return (\n        <span style={{ color: \"green\" }}>\n          <span role=\"img\" aria-hidden>\n            &#9899;\n          </span>{\" \"}\n          {timeStr}\n        </span>\n      );\n  }\n\n  if (relative) return <span style={{ color: \"red\" }}>! LIVE ({timeStr})</span>;\n  else return <span style={{ color: \"red\" }}>! {timeStr}</span>;\n};\n\nexport const LastFixArrow = props => {\n  const rotationStyle = {\n    transform: \"rotate(-90deg)\",\n\n    /* Safari */\n    WebkitTransform: \"rotate(-90deg)\",\n\n    /* Firefox */\n    MozTransform: \"rotate(-90deg)\",\n\n    /* IE */\n    msTransform: \"rotate(-90deg)\",\n\n    /* Opera */\n    OTransform: \"rotate(-90deg)\"\n  };\n  return (\n    <span>\n      1.7km <div style={{ display: \"inline-block\", ...rotationStyle }}></div>\n    </span>\n  );\n};\n\nexport default LastFixState;\n","import React from \"react\";\nimport {\n  Box,\n  useMediaQuery,\n  useTheme,\n  Typography,\n  Toolbar\n} from \"@material-ui/core\";\nimport { useState } from \"react\";\n\nimport { lighten } from \"@material-ui/core/styles\";\nimport { Button, Dialog, DialogActions, TextField } from \"@material-ui/core\";\n\nimport {\n  Table,\n  TableBody,\n  TableHead,\n  TableRow,\n  TableCell\n} from \"@material-ui/core\";\n\nimport { useXContestPilots } from \"../location_provider/XContest/XContestInterface\";\nimport LastFixState, { LastFixArrow } from \"../util/LastFixState\";\n\nconst columns = [\n  {\n    id: \"name\",\n    label: \"Name\",\n    render: row => {\n      return (\n        <Box paddingLeft={1} paddingTop={1} paddingBottom={1}>\n          <Typography variant=\"body2\">{row.info.user.fullname}</Typography>\n          <Typography\n            variant=\"caption\"\n            color=\"textSecondary\"\n            style={{ paddingLeft: \".5em\" }}\n          >\n            [{row.info.user.username}]\n          </Typography>\n        </Box>\n      );\n    }\n  },\n  {\n    id: \"state\",\n    label: \"State\",\n    align: \"right\",\n    render: row => {\n      return (\n        <Box>\n          <Box>\n            <Typography variant=\"caption\">\n              <LastFixState\n                timestamp={row.lastFix.timestamp}\n                landed={row.landed}\n                relative\n              />\n            </Typography>\n          </Box>\n          <Box>\n            <Typography variant=\"caption\">\n              <LastFixArrow />\n            </Typography>\n          </Box>\n        </Box>\n      );\n    }\n  },\n  {\n    id: \"country\",\n    label: \"Country\",\n    align: \"right\",\n    render: row => {\n      return (\n        <Box paddingRight={1} paddingLeft={1}>\n          {row.info.user.nationality.iso}\n          <Box\n            fontSize=\"large\"\n            marginLeft=\"4px\"\n            boxShadow={1}\n            style={{ verticalAlign: \"middle\" }}\n            className={\n              \"flag-icon flag-icon-\" +\n              row.info.user.nationality.iso.toLowerCase()\n            }\n          ></Box>\n        </Box>\n      );\n    }\n  }\n];\n\nfunction createPlaceholderPilot(name) {\n  return {\n    info: {\n      user: {\n        login: null,\n        username: name,\n        fullname: \"Offline User\",\n        gender: \"-\",\n        nationality: { iso: \"--\", name: \"--\" }\n      },\n      flightId: null\n    }\n  };\n}\n\nconst PilotSelector = props => {\n  const theme = useTheme();\n  const pilotList = useXContestPilots();\n\n  // State\n  const [selected, setSelected] = useState([]);\n  const [search, setSearch] = useState(\"\");\n  const numSelected = selected.length;\n\n  const closeWindow = () => {\n    // Reset state\n    setSearch(\"\");\n    setSelected([]);\n    props.onClose();\n  };\n\n  const handleClick = (_event, name) => {\n    const selectedIndex = selected.indexOf(name);\n    let newSelected = [];\n\n    if (selectedIndex === -1) {\n      newSelected = newSelected.concat(selected, name);\n    } else if (selectedIndex === 0) {\n      newSelected = newSelected.concat(selected.slice(1));\n    } else if (selectedIndex === selected.length - 1) {\n      newSelected = newSelected.concat(selected.slice(0, -1));\n    } else if (selectedIndex > 0) {\n      newSelected = newSelected.concat(\n        selected.slice(0, selectedIndex),\n        selected.slice(selectedIndex + 1)\n      );\n    }\n\n    setSelected(newSelected);\n  };\n\n  const fullScreen = useMediaQuery(theme.breakpoints.down(\"xs\"));\n\n  const isSelected = name => selected.indexOf(name) !== -1;\n  const wasAlreadyAdded = name => props.alreadyAdded.indexOf(name) !== -1;\n  const matchesSearch = name => {\n    if (search === \"\") {\n      return true;\n    }\n    return name.toLowerCase().includes(search.toLowerCase());\n  };\n\n  // Create virtual pilot if nobody found\n  let filteredPilots = Object.values(pilotList).filter(userData => {\n    return (\n      matchesSearch(userData.info.user.username) ||\n      matchesSearch(userData.info.user.fullname)\n    );\n  });\n\n  // Add dummy pilot if list is empty and search string is valid\n  if (filteredPilots.length === 0 && !/\\s/.test(search) && search.length > 0) {\n    filteredPilots.push(createPlaceholderPilot(search));\n  }\n\n  return (\n    <Dialog open={props.open} onClose={closeWindow} fullScreen={fullScreen}>\n      <Toolbar\n        style={\n          numSelected === 0\n            ? {}\n            : theme.palette.type === \"light\"\n            ? {\n                color: theme.palette.secondary.main,\n                backgroundColor: lighten(theme.palette.secondary.light, 0.85)\n              }\n            : {\n                color: theme.palette.text.primary,\n                backgroundColor: theme.palette.secondary.dark\n              }\n        }\n      >\n        {numSelected > 0 ? (\n          <Typography component=\"div\" color=\"inherit\" variant=\"subtitle1\">\n            {numSelected} selected\n          </Typography>\n        ) : (\n          <Typography component=\"div\" variant=\"h6\" id=\"tableTitle\">\n            Add new pilots:\n          </Typography>\n        )}\n      </Toolbar>\n      <Box paddingLeft=\"1em\" paddingRight=\"1em\" paddingTop=\"4px\">\n        <TextField\n          //autoFocus\n          margin=\"dense\"\n          autoComplete=\"off\"\n          variant=\"outlined\"\n          id=\"search_field\"\n          label=\"Search\"\n          type=\"search\"\n          fullWidth\n          onChange={event => setSearch(event.target.value)}\n        />\n      </Box>\n      <Box flex=\"1 1 auto\" marginY=\"8px\" style={{ overflowY: \"auto\" }}>\n        <Table stickyHeader size=\"small\">\n          <TableHead>\n            <TableRow>\n              {columns.map(column => (\n                <TableCell\n                  key={column.id}\n                  align={column.align}\n                  style={{ width: column.width }}\n                  component=\"th\"\n                >\n                  {column.label}\n                </TableCell>\n              ))}\n            </TableRow>\n          </TableHead>\n          <TableBody>\n            {filteredPilots.map(row => {\n              const username = row.info.user.username;\n\n              const isItemSelected = isSelected(username);\n\n              const itemDisabled = wasAlreadyAdded(username);\n              const style = itemDisabled\n                ? { filter: \"grayscale(100%) opacity(30%)\" }\n                : {};\n\n              const columnContent = columns.map(column => {\n                return (\n                  <TableCell\n                    key={column.id}\n                    align={column.align}\n                    padding=\"none\"\n                  >\n                    <Box style={style}>{column.render(row)}</Box>\n                  </TableCell>\n                );\n              });\n\n              if (itemDisabled) {\n                return <TableRow key={username}>{columnContent}</TableRow>;\n              }\n\n              return (\n                <TableRow\n                  key={username}\n                  selected={isItemSelected}\n                  onClick={event => handleClick(event, username)}\n                >\n                  {columnContent}\n                </TableRow>\n              );\n            })}\n          </TableBody>\n        </Table>\n      </Box>\n      <DialogActions>\n        <Button onClick={closeWindow} color=\"primary\">\n          Cancel\n        </Button>\n        <Button\n          disabled={numSelected === 0}\n          onClick={() => {\n            props.onAddPilots(selected);\n            closeWindow();\n          }}\n          color=\"primary\"\n        >\n          Add\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n};\n\nexport default PilotSelector;\n","import React from \"react\";\nimport { Box } from \"@material-ui/core\";\nimport { getXContestInterface } from \"../location_provider/XContest/XContestInterface\";\n\nconst AnimatedPilotList = props => {\n  const animatedData = getXContestInterface().animation.useAnimatedData();\n\n  const content = Object.entries(props.pilots).map(([pilotId, pilotName]) => {\n    let displayedName = pilotName;\n    if (pilotName === null) {\n      displayedName = pilotId;\n    }\n\n    let pilotDebugOutput = [];\n    if (pilotId in animatedData) {\n      const animatedPilotData = animatedData[pilotId];\n\n      for (const key in animatedPilotData) {\n        pilotDebugOutput.push(\n          <tr key={key}>\n            <td>{key}</td>\n            <td>\n              {(Math.round(100 * animatedPilotData[key]) / 100).toString()}\n            </td>\n          </tr>\n        );\n      }\n    }\n\n    return (\n      <Box\n        margin=\"10px\"\n        key={pilotId}\n        onClick={() => props.removePilots([pilotId])}\n      >\n        {displayedName}\n        <table>\n          <tbody>{pilotDebugOutput}</tbody>\n        </table>\n      </Box>\n    );\n  });\n\n  // console.log(\"Data:\", animatedData);\n  return (\n    <Box height=\"100%\" style={{ overflowY: \"auto\" }}>\n      {content}\n    </Box>\n  );\n};\n\nexport default AnimatedPilotList;\n","import React from \"react\";\nimport { useState } from \"react\";\nimport { Fab } from \"@material-ui/core\";\nimport { useTheme } from \"@material-ui/core/styles\";\nimport AddIcon from \"@material-ui/icons/Add\";\nimport Box from \"@material-ui/core/Box\";\nimport PilotSelector from \"./PilotSelector\";\nimport { useChosenPilots } from \"../common/PersistentState/ChosenPilots\";\nimport AnimatedPilotList from \"./AnimatedPilotList\";\n\nconst Pilots = () => {\n  const theme = useTheme();\n  const [pilotSelectorOpen, setPilotSelectorOpen] = useState(false);\n\n  const [pilots, addPilots, removePilots] = useChosenPilots();\n\n  // TODO sort pilots\n\n  return (\n    <React.Fragment>\n      <AnimatedPilotList\n        pilots={pilots}\n        removePilots={removePilots}\n      ></AnimatedPilotList>\n\n      <Box\n        position=\"absolute\"\n        bottom={theme.spacing(2)}\n        right={theme.spacing(2)}\n      >\n        <Fab\n          size=\"small\"\n          color=\"primary\"\n          onClick={() => setPilotSelectorOpen(true)}\n        >\n          <AddIcon />\n        </Fab>\n      </Box>\n      <PilotSelector\n        open={pilotSelectorOpen}\n        onClose={() => setPilotSelectorOpen(false)}\n        onAddPilots={addPilots}\n        alreadyAdded={Object.keys(pilots)}\n      />\n    </React.Fragment>\n  );\n};\n\nexport default Pilots;\n","import React, { Component } from \"react\";\nimport { TextField, InputAdornment } from \"@material-ui/core\";\n\nexport default class NumberInput extends Component {\n  state = {\n    internalUpdate: false,\n    value: null\n  };\n\n  static getDerivedStateFromProps(props, state) {\n    const resultState = { ...state, internalUpdate: false };\n\n    // Overwrite with external value if we got an update from the parent element\n    if (!state.internalUpdate) {\n      resultState.value = props.value;\n    }\n\n    return resultState;\n  }\n\n  render() {\n    console.log(localStorage);\n    return (\n      <TextField\n        onChange={event => {\n          const value = event.target.value;\n          // If the value is too small, send the smallest possible value to the parent,\n          // but keep the incorrect value in the text field.\n          // If the value is too large, send the largest possible value to the parent,\n          // and also set the text field to the largest possible value.\n          // Otherwise, just update.\n\n          if (value < this.props.min) {\n            // If those two messages get delivered out of order, this entire trick will stop working.\n            // But I think setting states will never be done in an incorrect order, that would really break things.\n            this.props.onChange(this.props.min);\n            this.setState({\n              ...this.state,\n              internalUpdate: true,\n              value: value\n            });\n          } else if (value > this.props.max) {\n            this.props.onChange(this.props.max);\n          } else {\n            this.props.onChange(value);\n          }\n        }}\n        variant=\"outlined\"\n        disabled={this.props.disabled}\n        margin=\"dense\"\n        hiddenLabel\n        type=\"number\"\n        value={this.state.value}\n        InputProps={{\n          endAdornment: (\n            <InputAdornment position=\"end\">{this.props.unit}</InputAdornment>\n          )\n        }}\n        inputProps={{\n          min: this.props.min,\n          max: this.props.max\n        }}\n      />\n    );\n  }\n}\n","import React, { useState } from \"react\";\n\nimport {\n  Dialog,\n  AppBar,\n  Toolbar,\n  Typography,\n  List,\n  ListItem,\n  ListItemText,\n  Divider,\n  IconButton,\n  Box,\n  Switch,\n  ListItemSecondaryAction,\n  DialogTitle,\n  DialogContent,\n  DialogActions,\n  DialogContentText,\n  Button\n} from \"@material-ui/core\";\nimport UndoIcon from \"@material-ui/icons/Undo\";\n\nimport ArrowBackIcon from \"@material-ui/icons/ArrowBack\";\nimport {\n  getSetting,\n  Settings,\n  resetAllSettings\n} from \"../common/PersistentState/Settings\";\nimport NumberInput from \"../util/NumberInput\";\n\nconst SettingsPage = props => {\n  const [resetAllSettingsDialogOpen, setResetAllSettingsDialogOpen] = useState(\n    false\n  );\n\n  // Retreive the settings we want to change\n  const [settingPathLength, setSettingPathLength] = getSetting(\n    Settings.PATH_LENGTH\n  ).use();\n  const [settingLimitPaths, setSettingLimitPaths] = getSetting(\n    Settings.LIMIT_PATHS\n  ).use();\n  const [settingLowLatency, setSettingLowLatency] = getSetting(\n    Settings.LOW_LATENCY\n  ).use();\n  const [settingAnimationDelay, setSettingAnimationDelay] = getSetting(\n    Settings.ANIMATION_DELAY\n  ).use();\n  const [settingFpsLimit, setSettingFpsLimit] = getSetting(\n    Settings.FPS_LIMIT\n  ).use();\n  const [settingFpsRate, setSettingFpsRate] = getSetting(\n    Settings.FPS_RATE\n  ).use();\n\n  const flipLimitPaths = () => setSettingLimitPaths(!settingLimitPaths);\n  const flipLowLatency = () => setSettingLowLatency(!settingLowLatency);\n  const flipFpsLimit = () => setSettingFpsLimit(!settingFpsLimit);\n\n  return (\n    <Dialog fullScreen open={props.open} onClose={props.onClose}>\n      {/* THE TITLE BAR */}\n      <AppBar style={{ position: \"static\" }}>\n        <Toolbar>\n          <IconButton edge=\"start\" color=\"inherit\" onClick={props.onClose}>\n            <ArrowBackIcon />\n          </IconButton>\n\n          <Box marginLeft={2} flexGrow={1}>\n            <Typography variant=\"h6\">Settings</Typography>\n          </Box>\n\n          <IconButton\n            edge=\"end\"\n            color=\"inherit\"\n            onClick={() => setResetAllSettingsDialogOpen(true)}\n          >\n            <UndoIcon />\n          </IconButton>\n        </Toolbar>\n      </AppBar>\n\n      {/* RESET ALL SETTINGS DIALOG */}\n      <Dialog\n        open={resetAllSettingsDialogOpen}\n        onClose={() => setResetAllSettingsDialogOpen(false)}\n      >\n        <DialogTitle>{\"Reset all settings?\"}</DialogTitle>\n        <DialogContent>\n          <DialogContentText>\n            This sets all settings to their default values.\n          </DialogContentText>\n        </DialogContent>\n        <DialogActions>\n          <Button\n            onClick={() => {\n              resetAllSettings();\n              setResetAllSettingsDialogOpen(false);\n            }}\n            color=\"primary\"\n          >\n            Yes\n          </Button>\n          <Button\n            onClick={() => setResetAllSettingsDialogOpen(false)}\n            color=\"primary\"\n            autoFocus\n          >\n            No\n          </Button>\n        </DialogActions>\n      </Dialog>\n\n      {/* THE ACTUAL OPTIONS */}\n      <List>\n        {/* FRAMERATE */}\n        <ListItem button onClick={flipFpsLimit}>\n          <ListItemText\n            primary=\"Limit Framerate\"\n            secondary=\"reduces energy consumption\"\n          />\n          <ListItemSecondaryAction>\n            <Switch\n              edge=\"end\"\n              onChange={flipFpsLimit}\n              checked={settingFpsLimit}\n            />\n          </ListItemSecondaryAction>\n        </ListItem>\n        <ListItem disabled={!settingFpsLimit}>\n          <ListItemText primary=\"Framerate\" secondary=\"Valid: 1-60 fps\" />\n          <ListItemSecondaryAction>\n            <NumberInput\n              value={settingFpsRate}\n              onChange={setSettingFpsRate}\n              disabled={!settingFpsLimit}\n              unit=\"fps\"\n              min={1}\n              max={60}\n            />\n          </ListItemSecondaryAction>\n        </ListItem>\n        <Divider />\n\n        {/* TRACK LENGTH */}\n        <ListItem button onClick={flipLimitPaths}>\n          <ListItemText\n            primary=\"Limit Track Length\"\n            secondary=\"reduces data consumption\"\n          />\n          <ListItemSecondaryAction>\n            <Switch\n              edge=\"end\"\n              onChange={flipLimitPaths}\n              checked={settingLimitPaths}\n            />\n          </ListItemSecondaryAction>\n        </ListItem>\n        <ListItem disabled={!settingLimitPaths}>\n          <ListItemText primary=\"Track Length\" secondary=\"Valid: 1-999 min\" />\n          <ListItemSecondaryAction>\n            <NumberInput\n              disabled={!settingLimitPaths}\n              value={settingPathLength}\n              onChange={setSettingPathLength}\n              unit=\"min\"\n              min={1}\n              max={999}\n            />\n          </ListItemSecondaryAction>\n        </ListItem>\n        <Divider />\n\n        {/* ANIMATION DELAY */}\n        <ListItem button onClick={flipLowLatency}>\n          <ListItemText\n            primary=\"Low Latency Mode\"\n            secondary=\"disables animations\"\n          />\n          <ListItemSecondaryAction>\n            <Switch\n              edge=\"end\"\n              onChange={flipLowLatency}\n              checked={settingLowLatency}\n            />\n          </ListItemSecondaryAction>\n        </ListItem>\n        <ListItem disabled={settingLowLatency}>\n          <ListItemText\n            primary=\"Animation Delay\"\n            secondary=\"70-120 sec (default: 80)\"\n          />\n          <ListItemSecondaryAction>\n            <NumberInput\n              disabled={settingLowLatency}\n              value={settingAnimationDelay}\n              onChange={setSettingAnimationDelay}\n              unit=\"sec\"\n              min={70}\n              max={120}\n            />\n          </ListItemSecondaryAction>\n        </ListItem>\n      </List>\n    </Dialog>\n  );\n};\n\nexport default SettingsPage;\n","import React, { useState } from \"react\";\nimport SwipeableDrawer from \"@material-ui/core/SwipeableDrawer\";\nimport {\n  List,\n  ListItem,\n  ListItemIcon,\n  ListItemText,\n  Box,\n  Typography,\n  Toolbar,\n  useTheme\n} from \"@material-ui/core\";\nimport { IconButton } from \"@material-ui/core\";\n\nimport ChevronLeftIcon from \"@material-ui/icons/ChevronLeft\";\nimport SettingsIcon from \"@material-ui/icons/Settings\";\n\nimport SettingsPage from \"./SettingsPage\";\n\nconst MainMenu = props => {\n  const theme = useTheme();\n  const [settingsOpen, setSettingsOpen] = useState(false);\n\n  return (\n    <React.Fragment>\n      <SwipeableDrawer\n        disableSwipeToOpen\n        open={props.open}\n        onOpen={() => {}}\n        onClose={props.onClose}\n      >\n        <Toolbar\n          style={{\n            backgroundColor: theme.palette.primary.light,\n            minWidth: \"200px\"\n          }}\n          onClick={props.onClose}\n        >\n          <Box flexGrow={1} clone>\n            <Typography variant=\"h6\">Menu</Typography>\n          </Box>\n          <IconButton edge=\"end\" color=\"inherit\">\n            <ChevronLeftIcon />\n          </IconButton>\n        </Toolbar>\n\n        <List>\n          <ListItem\n            button\n            onClick={() => {\n              props.onClose();\n              setSettingsOpen(true);\n            }}\n          >\n            <ListItemIcon>\n              <SettingsIcon />\n            </ListItemIcon>\n            <ListItemText primary=\"Settings\" />\n          </ListItem>\n        </List>\n      </SwipeableDrawer>\n      <SettingsPage\n        open={settingsOpen}\n        onClose={() => setSettingsOpen(false)}\n      ></SettingsPage>\n    </React.Fragment>\n  );\n};\n\nexport default MainMenu;\n","import React from \"react\";\nimport { useState } from \"react\";\n\nimport AppBar from \"@material-ui/core/AppBar\";\nimport Toolbar from \"@material-ui/core/Toolbar\";\nimport Typography from \"@material-ui/core/Typography\";\nimport IconButton from \"@material-ui/core/IconButton\";\nimport Popover from \"@material-ui/core/Popover\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport Box from \"@material-ui/core/Box\";\nimport Badge from \"@material-ui/core/Badge\";\n\nimport MenuIcon from \"@material-ui/icons/Menu\";\nimport ErrorIcon from \"@material-ui/icons/ErrorRounded\";\nimport SignalCellular4BarIcon from \"@material-ui/icons/SignalCellular4Bar\";\nimport SignalCellularConnectedNoInternet4BarIcon from \"@material-ui/icons/SignalCellularConnectedNoInternet4Bar\";\nimport SignalCellularNullIcon from \"@material-ui/icons/SignalCellularNull\";\n\nimport { useXContestConnectionState } from \"../location_provider/XContest/XContestInterface\";\nimport { ConnectionState } from \"../location_provider/XContest/XContestInterface\";\nimport { CircularProgress } from \"@material-ui/core\";\nimport MainMenu from \"./MainMenu\";\n\nconst useStyles = makeStyles(theme => ({\n  popover: {\n    padding: theme.spacing(1),\n    align: \"right\"\n  }\n}));\n\nconst LoadingBadge = props => {\n  return (\n    <Badge\n      //overlap=\"circle\"\n      anchorOrigin={{\n        vertical: \"bottom\",\n        horizontal: \"right\"\n      }}\n      badgeContent={\n        <CircularProgress\n          disableShrink={props.disableShrink}\n          color=\"secondary\"\n          size={15}\n          thickness={10}\n        />\n      }\n    >\n      {props.children}\n    </Badge>\n  );\n};\n\nconst TitleBar = () => {\n  const classes = useStyles();\n  const connectionState = useXContestConnectionState();\n\n  const popoverActions = React.useRef();\n  const [connectionPopAnchor, setConnectionPopAnchor] = useState(null);\n\n  const [mainMenuOpen, setMainMenuOpen] = useState(false);\n\n  React.useLayoutEffect(() => {\n    if (popoverActions.current) {\n      popoverActions.current.updatePosition();\n    }\n  }, [connectionState, connectionPopAnchor]);\n\n  const renderConnectionIcon = () => {\n    switch (connectionState) {\n      case ConnectionState.ACTIVE:\n        return <SignalCellular4BarIcon />;\n      case ConnectionState.CONNECTING:\n        return (\n          <LoadingBadge>\n            <SignalCellularNullIcon />\n          </LoadingBadge>\n        );\n      case ConnectionState.ERROR:\n        return <ErrorIcon color=\"error\" />;\n      case ConnectionState.ESTABLISHED:\n        return (\n          <LoadingBadge disableShrink>\n            <SignalCellularNullIcon />\n          </LoadingBadge>\n        );\n      case ConnectionState.INACTIVE:\n        return <SignalCellularConnectedNoInternet4BarIcon />;\n      case ConnectionState.NO_CONNECTION:\n        return <SignalCellularNullIcon />;\n      default:\n        return <SignalCellularNullIcon />;\n    }\n  };\n\n  return (\n    <div>\n      <AppBar position=\"static\">\n        <Toolbar>\n          <IconButton\n            edge=\"start\"\n            color=\"inherit\"\n            onClick={() => setMainMenuOpen(true)}\n          >\n            <MenuIcon />\n          </IconButton>\n\n          <Box marginLeft={2} flexGrow={1}>\n            <Typography variant=\"h6\">XC Live Viewer</Typography>\n          </Box>\n\n          <IconButton\n            edge=\"end\"\n            color=\"inherit\"\n            onClick={event => setConnectionPopAnchor(event.currentTarget)}\n          >\n            {renderConnectionIcon()}\n          </IconButton>\n        </Toolbar>\n      </AppBar>\n      <Popover\n        open={Boolean(connectionPopAnchor)}\n        anchorEl={connectionPopAnchor}\n        onClose={() => setConnectionPopAnchor(null)}\n        anchorOrigin={{\n          vertical: \"bottom\",\n          horizontal: \"right\"\n        }}\n        transformOrigin={{\n          vertical: \"top\",\n          horizontal: \"right\"\n        }}\n        action={popoverActions}\n      >\n        <Box className={classes.popover}>\n          <Typography>{connectionState}</Typography>\n        </Box>\n      </Popover>\n      <MainMenu\n        open={mainMenuOpen}\n        onClose={() => setMainMenuOpen(false)}\n      ></MainMenu>\n    </div>\n  );\n};\n\nexport default TitleBar;\n","import React from \"react\";\nimport Box from \"@material-ui/core/Box\";\nimport SwipeableViews from \"react-swipeable-views\";\nimport { BottomNavigation, BottomNavigationAction } from \"@material-ui/core\";\n\nimport LocationOnIcon from \"@material-ui/icons/LocationOn\";\nimport PeopleIcon from \"@material-ui/icons/People\";\nimport MapIcon from \"@material-ui/icons/Map\";\n\nimport \"./MainPage.css\";\n\n// TODO import LazyLoading from \"./util/LazyLoading\";\n\nimport LiveMap from \"./pages/LiveMap\";\nimport Pilots from \"./pages/Pilots\";\nimport TitleBar from \"./pages/TitleBar\";\n\nconst MainPage = () => {\n  const [tabId, setTabId] = React.useState(1);\n  const [windowHeight, setWindowHeight] = React.useState(0);\n\n  // Workaround for mobile screens reporting an incorrect window height\n  const updateWindowHeight = () => {\n    setWindowHeight(window.innerHeight);\n  };\n  React.useLayoutEffect(() => {\n    updateWindowHeight();\n    window.addEventListener(\"resize\", updateWindowHeight);\n    return () => window.removeEventListener(\"resize\", updateWindowHeight);\n  }, []);\n\n  // Callbacks for changing the current page\n  const handleNavigationButton = (_event, newValue) => setTabId(newValue);\n\n  return (\n    <Box height={windowHeight} display=\"flex\" flexDirection=\"column\">\n      <Box zIndex={100}>\n        <TitleBar></TitleBar>\n      </Box>\n      <Box flexGrow={1} clone>\n        <SwipeableViews disabled index={tabId}>\n          <Box width=\"100%\" height=\"100%\" position=\"relative\">\n            <LiveMap></LiveMap>\n          </Box>\n          <Box width=\"100%\" height=\"100%\" position=\"relative\">\n            <Pilots></Pilots>\n          </Box>\n          <Box width=\"100%\" height=\"100%\" position=\"relative\">\n            Item Three\n          </Box>\n        </SwipeableViews>\n      </Box>\n      <Box zIndex={100} boxShadow={3}>\n        <BottomNavigation\n          value={tabId}\n          onChange={handleNavigationButton}\n          showLabels\n        >\n          <BottomNavigationAction label=\"Map\" icon={<MapIcon />} />\n          <BottomNavigationAction label=\"Pilots\" icon={<PeopleIcon />} />\n          <BottomNavigationAction label=\"Nearby\" icon={<LocationOnIcon />} />\n        </BottomNavigation>\n      </Box>\n    </Box>\n  );\n};\n\nexport default MainPage;\n","import React from \"react\";\nimport MainPage from \"./MainPage\";\n\nconst App = () => {\n  return (\n    <div className=\"App\">\n      <MainPage />\n    </div>\n  );\n};\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./App\";\nimport \"./index.css\";\n\nimport \"flag-icon-css/css/flag-icon.min.css\";\n\nimport * as serviceWorker from \"./serviceWorker\";\n\n// Read the .env file\nrequire(\"dotenv\").config();\n\n// Render the page\nReactDOM.render(<App />, document.getElementById(\"root\"));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}