{"version":3,"sources":["common/GoogleMapsApiLoader.js","pages/StatusPages.jsx","common/PersistentState/PersistentState.js","common/PersistentState/PageLayout.js","common/PersistentState/Settings.js","location_provider/XContest/XContestSocket.js","util/RunningDerivation.js","util/FindBisect.js","location_provider/XContest/FlightAnimationData.js","common/PersistentState/ChosenPilots.js","util/Interpolation.js","location_provider/XContest/FlightAnimation.js","util/HighPrecisionTimeSync.js","location_provider/XContest/XContestAnimation.js","util/EventfulState.js","location_provider/XContest/XContestInterface.js","util/rng.js","util/string2color.js","common/PilotIcon.js","services/MapViewportControllerService.js","pages/GoogleMapsPage/GoogleMapsTrack.js","pages/GoogleMapsPage/MapPilotInfoWindow.js","pages/GoogleMapsPage/MapAnimator.js","services/GPSProvider.js","pages/GoogleMapsPage/GoogleMapsController.js","pages/GoogleMapsPage/CustomButtons/ButtonIcons.js","pages/GoogleMapsPage/CustomButtons/SatelliteMapButton.js","pages/GoogleMapsPage/CustomButtons/FocusCameraMapButton.js","pages/GoogleMapsPage/CustomButtons/DisplayGpsMapButton.js","util/ContextMenuHandler.js","common/PersistentState/PageState.js","pages/common/ContextMenu.jsx","util/MapLinks.js","pages/GoogleMapsPage/LiveMap.jsx","ext/geolocation-marker.js","common/History.js","util/SubWindow.jsx","util/Rotation.js","util/LastFixState.jsx","pages/PilotSelector/PilotSelectorListRenderer.jsx","pages/PilotSelector/PilotSelectorList.jsx","util/CompareArrays.js","pages/PilotSelector/PilotSelector.jsx","pages/PilotList/ElevationHistogram.jsx","pages/PilotList/AnimatedPilotListEntry.jsx","pages/PilotList/OfflinePilotEntry.jsx","pages/PilotList/AnimatedPilotList.jsx","pages/common/PilotMultipleChoiceList.jsx","pages/VisibilitySelector/VisibilitySelector.jsx","pages/PilotList/Pilots.jsx","util/NumberInput.jsx","pages/SettingsPage/SettingsPageEntries.jsx","pages/SettingsPage/SettingsPageTitleBar.jsx","pages/SettingsPage/SettingsPage.jsx","pages/LinkCreator/LinkPopup.jsx","pages/LinkCreator/LinkCreator.jsx","pages/MainMenu.jsx","pages/TitleBar.jsx","MainPage.jsx","App.jsx","serviceWorker.jsx","UrlParameters.js","index.js","common/PersistentState/BreakingChanges.js","services/NoSleep.js","util/Base64Data.js"],"names":["googleMapsApiPromise","loadGoogleMapsApi","Loader","apiKey","process","load","useStyles","makeStyles","theme","progress","margin","spacing","LoadingPage","message","hideIf","subRef","classes","Box","width","height","display","alignItems","justifyContent","ref","textAlign","CircularProgress","className","Typography","ErrorPage","fontSize","color","PersistentState","constructor","key","initialValue","getValue","jsonValue","localStorage","getItem","this","locallyCachedJson","locallyCachedValue","JSON","parse","value","_notifyAll","callbacks","cb","registerCallback","includes","push","unregisterCallback","index","indexOf","splice","setValue","removeItem","setItem","stringify","updateValue","use","useState","useEffect","newValue","registerPersistentState","name","PageLayout","Settings","createSetting","settingsObjects","PATH_LENGTH","LIMIT_PATHS","LOW_LATENCY","ANIMATION_DELAY","FPS_LIMIT","FPS_RATE","GPS_ENABLED","GPS_SHOWN","PREVENT_SLEEP","SHOW_OFFLINE_PILOTS","PAGE_LAYOUT","getSetting","XContestSocket","onStateChanged","onInfoMessage","onTracklogMessage","onFlightLanded","formatSubscribedFlights","subscribedFlights","map","flightId","startTimestamp","flightUuid","start","Date","toISOString","refreshSubscribedFlights","sock","readyState","WebSocket","OPEN","connected","formattedSubscribedFlights","send","tag","contents","setSubscribedFlights","flights","onOpen","handleReset","console","debug","setConnectionState","ConnectionState","ESTABLISHED","area","lat","lon","onMessage","evt","ACTIVE","msg","data","clearTimeout","watchdog","setTimeout","INACTIVE","processMessage","onClose","NO_CONNECTION","connect","bind","onError","log","dispatchInfoMessage","dispatchTracklogMessage","dispatchFlightLandedMessage","warn","window","CONNECTING","onopen","onmessage","onclose","onerror","ERROR","alert","RunningDerivation","smoothingFactor","derivation_func","a","b","invalid_func","computeDiff","isInvalid","old_val","old_t","running_avg","update","new_val","new_t","dt","deriv","weight","Math","pow","reset","findBisect","targetValue","length","dataFn","minIndex","maxIndex","currentIndex","currentValue","parseTime","isoStr","round","FlightAnimationData","at","timestamp","pos","t","findForwardSwipe","startPos","getNewestTimestamp","counter_gpsVario","counter_baroVarion","counter_velocity","end","getDistance","clear","isAfterLastElement","append","elem","lng","baroAlt","gpsAlt","gpsVario","baroVario","velocity","newElem","elevation","replace","insert","newElements","oldElements","oldPos","newPos","oldEl","newEl","persistentChosenPilots","getChosenPilotsObject","getChosenPilots","setChosenPilots","setChosenPilotsAndUpdateInfos","chosenPilots","chosenPilotsUpdated","pilotList","getXContestInterface","getPilotInfos","pilotId","currentName","info","user","fullname","lastFix","previousLastFix","landed","setPilotShown","shown","newPilotState","pilotState","defaultPilotEntry","pilotName","addPilots","pilotIds","changed","lerp","val1","val2","pct","spline","p0","t0","p1","t1","p2","t2","p3","t3","A1","A2","A3","B1","B2","splineDerivative","A1d","A2d","A3d","B1d","B2d","FlightAnimationDataCache","currentArrayPos","mapsPath","mapsPathNewestPos","DataGens","data1","data2","timeStamp","data0","data3","dT","d0","d1","d2","d3","fallbackData","flightInfos","offlineData","offlinePilotInfos","FlightAnimation","destroy","updateSettings","settings","timeOffsetSeconds","lowLatencyMode","trackLengthMinutes","limitTracks","liveDataCache","flightInfoDataCache","updateInfos","infos","flightInfoData","track","updateData","data_start_time","liveData","updateLanded","getInterpolatedData","cache","blendedData","endOfTrack","startOfTrack","velocityVec","takeData","computeLinearVelocity","blendDataSpline","computeSplineVelocity","getFallbackData","computeTrack","oldestTimestamp","altitude","removeChunkSize","numRemove","slice","updateAnimation","animationTimeMillis","animationTimeSeconds","animationResult","newestDataTimestamp","lastPotentialAirtime","lastPotentialAirTime","offline","HighPrecisionTimeSync","tolerance","get","currentHighPrecisionTime","currentTime","estimatedTime","offset","offBy","XContestAnimation","_nextUpdate","now","animationLoop","absTime","frameTimeDelta","_setting_fps","_setting_limitFps","newAnimationData","newFilteredAnimationData","Object","entries","_subscribedPilots","forEach","pilot","pilotData","_pilotInfos","_flightAnimations","pilotAnimationFrame","_setting_showOfflinePilots","offlinePilotEntry","createOfflineEntry","_submitAnimationFrame","pilotData_filtered","requestAnimationFrame","_currentAnimationData","_callbacks","setSubscribedPilots","subscribedPilots","_updateImportantFlights","pushNewInfo","pilotInfo","values","flightInfo","pushNewData","trackId","trackData","pushFlightLanded","getData","importantFlights","filter","val","username","importantFlightSet","Set","keys","toRemove","eqSet","as","bs","size","has","_subscribedFlights","flightsWithTimestamps","_setSubscribedFlightsCallback","_highPrecisionTimeSync","settings_limitFps","settings_fps","settings_showOfflinePilots","Array","from","EventfulState","set","_callbackData","NO_INFORMATION","XContestInterface","socket","pilots","onConnectionStateChanged","state","connectionState","onInfoMessageReceived","overriden","animation","pilotInfos","onTracklogMessageReceived","trackChunk","onFlightLandedMessageReceived","_instance","createRng","seedString","seed","xmur3","str","i","h","imul","charCodeAt","sfc32","c","d","string2color","lightness","rand","colorHue","min","max","convert","hsl","hex","getPilotIconColor","getPilotIcon","waitingForStart","hasLanded","path","fillColor","fillOpacity","anchor","x","y","strokeWeight","scale","rotation","getRhumbLineBearing","MapViewportControllerService","setState","setFreeMode","enabled","setSinglePilotMode","followSinglePilot","_emitZoomToSinglePilot","setFollowMode","mapControllers","zoomToSinglePilot","onSelfShownChanged","includeSelf","onAnimationFrame","oldState","newState","registerMapController","controller","unregisterMapController","getMapViewportControllerService","GoogleMapsTrack","google","initialData","pilotInfoWindow","onMouseOver","canOpenInfoWindow","computeIconBottomLeftCornerPos","mouseEvent","target","mouseX","pageX","mouseY","pageY","undefined","touches","left","top","isValid","devicePixelRatio","setMap","marker","newestTrackSegment","_updateTrack","startTime","endTime","currentTrackVersion","oldTrack","getPath","oldLength","getLength","newPoint","maps","LatLng","setPath","_updateNewestSegment","trackEndPos","currentPos","newestTrackSegmentData","previousTrackEndPos","previousPos","point","setAt","setPosition","pilotIcon","getIcon","newPilotIcon","pilotColor","oldPilotIcon","p","pilotIconChanged","setIcon","trackColor","Marker","position","title","icon","addListener","open","tb","Polyline","strokeColor","MapPilotInfoWindow","currentPilot","infoWindow","updateContent","close","heightGnd","newContent","vario","varioAbs","abs","floor","getContent","setContent","InfoWindow","content","pixelOffset","Size","disableAutoPan","MapAnimator","canReceiveMouseClicks","cleanupOldTracks","tracks","isOver","pagePos","currentMouseOvers","num","GPSProvider","_updateGPSState","gpssettingEnabled","callbackRegistered","enableGps","_watchId","navigator","geolocation","watchPosition","_onNewGPSData","_onGPSError","enableHighAccuracy","clearWatch","_setGPSData","_gpsData","getGPSProvider","GoogleMapsController","insideMapsApiFunction","getZoom","setZoom","shutdown","onGpsUpdate","gpsData","gpsState","onUserInput","updateViewport","watchedCoords","previousSinglePersonMode","singlePersonMode","panTo","bounds","LatLngBounds","coord","extend","fitBounds","controllerState","viewportInitialized","coords","latitude","longitude","lastUpdate","userInputListeners","createButtonIcon","svgPath","viewBox","xmlns","svgEl","document","createElementNS","setAttribute","pathEl","appendChild","createSatelliteMapButton","controlDiv","createElement","controlUI","classList","add","onclick","getMapTypeId","MapTypeId","HYBRID","setMapTypeId","TERRAIN","createFocusCameraMapButton","updateGpsMapButton","gpsShown","firstChild","childNodes","style","longPressDuration","platform","ContextMenuHandler","callback","onTouchStart","e","contextMenuPossible","touch","currentTouch","longPressCountdown","onTouchMove","dX","dY","onTouchCancel","onTouchEnd","onContextMenu","preventDefault","TabID","switchToMap","ContextMenu","React","PureComponent","generateMenuEntry","text","action","disabled","ListItem","button","onClick","ListItemIcon","ListItemText","props","onDelete","removePilots","onNavigateTo","navigateTo","toString","onShowOnMap","PageState","onHidePilot","onUnhidePilot","render","onMap","Popover","anchorReference","anchorPosition","transformOrigin","vertical","horizontal","List","dense","subheader","ListSubheader","LiveMap","super","initializeGoogleMapsApi","mapsApiLoadingState","canceled","cleanups","then","mapReady","catch","mapError","initializeMapIfNecessary","Map","mapsRef","current","center","mapTypeId","zoom","maxZoom","disableDefaultUI","zoomControl","scaleControl","fullscreenControl","styles","mapStyle","setOptions","controls","ControlPosition","TOP_LEFT","gpsMapButton","createDisplayGpsMapButton","gpsShownSetting","RIGHT_TOP","mapButtonUpdater","mapAnimator","contextMenu","mapAnimatorUpdateCallback","geolocationMarker","createGeolocationMarker","GeolocationMarker","MVCObject","opt_map","opt_outerMarkerOpts","opt_markerOpts","opt_circleOpts","outerMarker_","marker_","circle_","watchId_","outerMarkerOpts","clickable","cursor","draggable","flat","SymbolPath","CIRCLE","zIndex","markerOpts","optimized","copyOptions_","circleOpts","radius","strokeOpacity","Circle","prototype","call","maximumAge","bindTo","invalidPropertiesExpr_","test","Error","getMap","getPositionOptions","setPositionOptions","positionOpts","getPosition","getBounds","getAccuracy","getMinimumAccuracy","setMinimumAccuracy","accuracy","watchPosition_","unbind","setOuterMarkerOptions","setMarkerOptions","setCircleOptions","updatePosition_","newPosition","mapNotSet","equals","geolocationError_","event","trigger","source","opt","DISALLOWED_OPTIONS","geolocationMarkerUpdateState","currentGPSData","mapController","mapInitialized","mouseOvers","hideContextMenu","createRef","contextMenuHandler","componentDidMount","componentDidUpdate","componentWillUnmount","reverse","cleanup","Fragment","onWheel","ourHistory","addEventListener","pop","history","pushState","passive","SubWindow","_setOpen","historyOpen","_setHistoryOpen","histSize","back","Dialog","fullScreen","maxWidth","fullWidth","children","getRotationStyle","bearing","transform","WebkitTransform","MozTransform","msTransform","OTransform","LastFixState","getMessage","relative","showLastFix","time_diff","getTime","timeStr","formatTimeDiff","millis","negative","secs","mins","hours","padStart","days","timestampToTimeString","toLocaleTimeString","shallowRerender","msgRef","msgSpan","assign","innerHTML","LastFixArrow","onNewGPSDataReceived","updateThroughRef","setFix","newFix","arrowRef","arrowStyle","getArrowRotationStyle","distanceRef","newDistance","myPosition","pilotFix","distance","NoWrapTypography","withStyles","root","whiteSpace","TableHeader","TableCell","component","variant","boxSizing","flex","PilotSelectorListRow","iso","overflow","paddingLeft","paddingTop","paddingBottom","paddingRight","marginLeft","boxShadow","verticalAlign","toLowerCase","renderRow","nationality","selected","alreadyAdded","padding","backgroundColor","onPilotClicked","sortPilotList","gps","myPos","distances","sort","el1","el2","el","PilotSelectorList","startRendering","didMount","updatePilotListIfNecessary","newPilotList","arraysEqual","array1","array2","l","sortedPilotList","onNewGpsData","onNewPilotInfos","disableShrink","displayedPilots","search","matchesSearch","filteredPilots","filterPilotList","itemCount","itemSize","itemData","itemKey","fullHeightWindow","pure","useTheme","useMediaQuery","breakpoints","down","setSelected","setSearch","numSelected","closeWindow","paper","Toolbar","palette","type","secondary","main","lighten","light","primary","dark","id","TextField","autoComplete","label","onChange","marginY","flexDirection","selectedIndex","newSelected","concat","DialogActions","Button","onAddPilots","ElevationHistogram","prepareCanvasAndComputeLimits","canvas","dpr","rect","getBoundingClientRect","finalTimestamp","beginningTimestamp","renderCanvas","minValue","maxValue","timeFrame","currentElevation","getCoord","time","lastKnownElevationY","ctx","getContext","alpha","fillStyle","COLOR_GROUND","fillRect","COLOR_SKY","strokeStyle","COLOR_PILOT","beginPath","moveTo","lineTo","currentY","fill","lineWidth","lineJoin","lineCap","stroke","force","canvasRef","trackStartTime","lastRenderedTimestamp","lastRenderedTrackStart","currentHeight","HEIGHT_MARGIN","HEIGHT_STEPS","ceil","maxValueRef","textContent","minValueRef","onNewAnimationData","shallowFetchDataAndRerender","onSizeChanged","removeEventListener","marginTop","marginBottom","canvasParentRef","FirstRowLeft","styled","FirstRowRight","marginRight","SecondRow","PilotExpansionPanelSummary","ExpansionPanelSummary","PilotExpansionPanelDetails","MozUserSelect","WebkitUserSelect","msUserSelect","ExpansionPanelDetails","DetailsStats","DetailsGraph","DetailsRow","DetailTimerIcon","TimerIcon","DetailDistanceIcon","DoubleArrowIcon","DetailLaunchIcon","FlagIcon","AnimatedPilotListEntry","extractImportantProps","velocityLat","velocityLng","propsChanged","newProps","oldProps","pilotProps","onNewDataReceived","newPilotProps","stateChanges","stateChangesFromPilotInfos","allInfos","processInfo","launch","launchPoint","contest","score","toFixed","heightRef","newHeight","renderHeight","lastFixRef","iconRef","getAttribute","liveStateRef","flightDurationRef","newFlightDuration","renderFlightDuration","launchTime","launchSite","scoreDistance","scoreType","onContextMenuHandler","duration","durationMinutes","scoreTypes","pilotIconRotation","ExpansionPanel","TransitionProps","unmountOnExit","expandIcon","renderScore","FlatTriangle","FaiTriangle","FreeFlight","OfflinePilotPaper","Paper","OfflinePilotEntry","OfflinePilotsExpansionPanel","AnimatedPilotList","getSortedPilotList","pilotsAndDistances","landedPilotList","pilotListChanged","onlinePilots","showContextMenu","mousePos","showContextMenuOffline","pilotIsOnline","onlineHiddenPilots","offlinePilots","getPilotName","bgcolor","PilotMultipleChoiceList","getSortedPilotIds","nameA","nameB","Table","TableBody","TableRow","Checkbox","checked","scope","VisibilitySelector","pilotClicked","allPilotsSelected","Divider","onUpdateVisibility","getDerivedStateFromProps","Pilots","Component","openPilotSelector","pilotSelectorOpen","closePilotSelector","openVisibilitySelector","visibilitySelectorOpen","closeVisibilitySelector","chosenPilotsChanged","newChosenPilots","bottom","right","Fab","pilotShouldBeShown","updateShownPilots","NumberInput","internalUpdate","resultState","hiddenLabel","InputProps","endAdornment","InputAdornment","unit","inputProps","BooleanSetting","setting","settingValue","setSettingValue","flipSetting","primaryText","secondaryText","ListItemSecondaryAction","Switch","edge","NumberSetting","MultipleChoiceSetting","NativeSelect","displayEmpty","choices","choice","SettingsPageTitleBar","resetAllSettingsDialogOpen","setResetAllSettingsDialogOpen","AppBar","IconButton","flexGrow","DialogTitle","DialogContent","DialogContentText","settingsObj","autoFocus","SettingsPage","settingLimitPaths","settingFpsLimit","LinkPopup","copyToClipboard","clipboard","writeText","link","err","wordWrap","wordBreak","href","LinkCreator","createLink","payload","encodedData","encodeBase64","url","location","encodeURIComponent","createdLink","MainMenu","settingsOpen","setSettingsOpen","linkCreatorOpen","setLinkCreatorOpen","SwipeableDrawer","disableSwipeToOpen","minWidth","clone","popover","align","LoadingBadge","Badge","anchorOrigin","badgeContent","thickness","popoverActions","useRef","connectionPopAnchor","setConnectionPopAnchor","mainMenuOpen","setMainMenuOpen","useLayoutEffect","updatePosition","currentTarget","renderConnectionIcon","Boolean","anchorEl","MainPage","tabId","setTabId","pageLayout","windowHeight","setWindowHeight","isSmartphone","updateWindowHeight","innerHeight","showSmartphoneLayout","BottomNavigation","_event","showLabels","BottomNavigationAction","App","isLocalhost","hostname","match","registerValidSW","swUrl","config","serviceWorker","register","registration","onupdatefound","installingWorker","installing","onstatechange","onUpdate","onSuccess","error","processGroupData","groupPilots","require","resolveBreakingChanges","fixChosenPilots","chosenPilot","processUrlParameters","urlParams","URLSearchParams","groupParameterJson","groupData","decodeBase64Json","groupParameter","decodeBase64","split","newHref","replaceState","startNoSleepService","noSleep","NoSleep","enableNoSleep","enable","noSleepSetting","initiator","disable","ReactDOM","getElementById","URL","origin","checkValidServiceWorker","fetch","response","contentType","headers","status","ready","unregister","reload","bufferToBase64Url","cbor_value","Buffer","cbor","cbor_compressed","deflate","cbor_data_uncompressed","cbor_data_compressed","data_base64","buffer","data_type","decompressed","inflate","decoded","decodeUtf8","TextDecoder","decode"],"mappings":"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","file":"static/js/main.296a2aef.chunk.js","sourcesContent":["import { useState, useEffect } from \"react\";\nimport { Loader } from \"@googlemaps/loader\";\n\n// Global google maps api singleton\nlet googleMapsApiPromise = null;\nexport function loadGoogleMapsApi() {\n  if (googleMapsApiPromise === null) {\n    googleMapsApiPromise = new Loader({\n      apiKey: process.env.REACT_APP_GAPI_KEY,\n    }).load();\n  }\n  return googleMapsApiPromise;\n}\n\n// Hook\nexport function useGoogleMapsApi() {\n  // Keeping track of script loaded and error state\n  const [state, setState] = useState({\n    ready: false,\n    error: false,\n  });\n\n  useEffect(\n    () => {\n      let promiseParameters = { gotCanceled: false };\n      loadGoogleMapsApi()\n        .then(() => {\n          if (promiseParameters.gotCanceled) return;\n          console.log(\"Google Maps API loaded.\");\n          setState({\n            ready: true,\n            error: false,\n          });\n        })\n        .catch((e) => {\n          if (promiseParameters.gotCanceled) return;\n          console.log(\"Error: Cannot load Google Maps API:\", e);\n          setState({\n            ready: false,\n            error: true,\n          });\n        });\n\n      return () => {\n        promiseParameters.gotCanceled = true;\n      };\n    },\n    [] // Don't re-run\n  );\n\n  return [state.ready, state.error, state.ready ? window.google : null];\n}\n","import React from \"react\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport { Box, Typography } from \"@material-ui/core\";\nimport CircularProgress from \"@material-ui/core/CircularProgress\";\nimport ErrorIcon from \"@material-ui/icons/Error\";\n\nconst useStyles = makeStyles(theme => ({\n  progress: {\n    margin: theme.spacing(2)\n  }\n}));\n\nexport const LoadingPage = ({ message, hideIf, subRef }) => {\n  const classes = useStyles();\n  return (\n    <Box\n      width=\"100%\"\n      height=\"100%\"\n      display={hideIf ? \"none\" : \"flex\"}\n      alignItems=\"center\"\n      justifyContent=\"center\"\n      ref={subRef}\n    >\n      <Box textAlign=\"center\">\n        <CircularProgress className={classes.progress} />\n        <Typography>{message}</Typography>\n      </Box>\n    </Box>\n  );\n};\n\nexport const ErrorPage = ({ message, hideIf }) => {\n  const classes = useStyles();\n  return (\n    <Box\n      width=\"100%\"\n      height=\"100%\"\n      display={hideIf ? \"none\" : \"flex\"}\n      alignItems=\"center\"\n      justifyContent=\"center\"\n    >\n      <Box textAlign=\"center\">\n        <ErrorIcon\n          fontSize=\"large\"\n          color=\"error\"\n          className={classes.progress}\n        />\n        <Typography color=\"error\">{message}</Typography>\n      </Box>\n    </Box>\n  );\n};\n","import { useState, useEffect } from \"react\";\n\nclass PersistentState {\n  constructor(key, initialValue) {\n    this.key = key;\n    this.initialValue = initialValue;\n    this.callbacks = [];\n\n    this.locallyCachedJson = null;\n    this.locallyCachedValue = null;\n  }\n\n  getValue = () => {\n    const jsonValue = localStorage.getItem(this.key);\n\n    // Caching, to reduce the amount of times the value !== itself.\n    // This is a performance optimization for PureComponents.\n    if (this.locallyCachedJson !== jsonValue) {\n      this.locallyCachedJson = jsonValue;\n      this.locallyCachedValue = JSON.parse(jsonValue);\n    }\n\n    const value = this.locallyCachedValue;\n    if (value === null) return this.initialValue;\n    return value;\n  };\n\n  _notifyAll = () => {\n    const value = this.getValue();\n    for (const cb of this.callbacks) {\n      cb(value);\n    }\n  };\n\n  registerCallback = cb => {\n    if (!this.callbacks.includes(cb)) this.callbacks.push(cb);\n  };\n\n  unregisterCallback = cb => {\n    const index = this.callbacks.indexOf(cb);\n    if (index >= 0) {\n      this.callbacks.splice(index, 1);\n    }\n  };\n\n  setValue = value => {\n    if (value == null) {\n      localStorage.removeItem(this.key);\n    } else {\n      localStorage.setItem(this.key, JSON.stringify(value));\n    }\n\n    this._notifyAll();\n  };\n\n  updateValue = cb => {\n    this.setValue(cb(this.getValue()));\n  };\n\n  use = () => {\n    const [value, setValue] = useState(this.getValue);\n\n    useEffect(() => {\n      const cb = newValue => {\n        // trigger component update on change\n        setValue(newValue);\n      };\n\n      this.registerCallback(cb);\n      return () => this.unregisterCallback(cb);\n    }, []);\n\n    return [value, this.setValue];\n  };\n}\n\nexport const registerPersistentState = (name, initialValue) => {\n  return new PersistentState(name, initialValue);\n};\n","// Keys\nexport const PageLayout = {\n  AUTO: \"auto\",\n  PHONE: \"phone\",\n  DESKTOP: \"desktop\",\n  WIDGET: \"widget\",\n};\n","import { registerPersistentState } from \"./PersistentState\";\nimport { PageLayout } from \"./PageLayout\";\n\n// Keys\nexport const Settings = {\n  PATH_LENGTH: \"PATH_LENGTH\",\n  LIMIT_PATHS: \"LIMIT_PATHS\",\n  LOW_LATENCY: \"LOW_LATENCY\",\n  ANIMATION_DELAY: \"ANIMATION_DELAY\",\n  FPS_LIMIT: \"FPS_LIMIT\",\n  FPS_RATE: \"FPS_RATE\",\n  GPS_ENABLED: \"GPS_ENABLED\",\n  GPS_SHOWN: \"GPS_SHOWN\",\n  PREVENT_SLEEP: \"PREVENT_SLEEP\",\n  SHOW_OFFLINE_PILOTS: \"SHOW_OFFLINE_PILOTS\",\n  PAGE_LAYOUT: \"PAGE_LAYOUT\",\n};\n\n// Wrapper for simplification\nconst createSetting = (key, value) =>\n  registerPersistentState(\"SETTINGS_\" + key, value);\n\n// Settings objects\nconst settingsObjects = {\n  PATH_LENGTH: createSetting(Settings.PATH_LENGTH, 15),\n  LIMIT_PATHS: createSetting(Settings.LIMIT_PATHS, false),\n  LOW_LATENCY: createSetting(Settings.LOW_LATENCY, false),\n  ANIMATION_DELAY: createSetting(Settings.ANIMATION_DELAY, 80),\n  FPS_LIMIT: createSetting(Settings.FPS_LIMIT, true),\n  FPS_RATE: createSetting(Settings.FPS_RATE, 10),\n  GPS_ENABLED: createSetting(Settings.GPS_ENABLED, true),\n  GPS_SHOWN: createSetting(Settings.GPS_SHOWN, true),\n  PREVENT_SLEEP: createSetting(Settings.PREVENT_SLEEP, false),\n  SHOW_OFFLINE_PILOTS: createSetting(Settings.SHOW_OFFLINE_PILOTS, false),\n  PAGE_LAYOUT: createSetting(Settings.PAGE_LAYOUT, PageLayout.AUTO),\n};\n\nexport const getSetting = (key) => settingsObjects[key];\n\nexport const resetAllSettings = () => {\n  Object.values(settingsObjects).forEach((settingsObj) =>\n    settingsObj.setValue(null)\n  );\n};\n","import { ConnectionState } from \"./XContestInterface\";\nimport { getSetting, Settings } from \"../../common/PersistentState/Settings\";\n\nexport default class XContestSocket {\n  constructor(\n    onStateChanged,\n    onInfoMessage,\n    onTracklogMessage,\n    onFlightLanded\n  ) {\n    this.setConnectionState = onStateChanged;\n    this.dispatchInfoMessage = onInfoMessage;\n    this.dispatchTracklogMessage = onTracklogMessage;\n    this.dispatchFlightLandedMessage = onFlightLanded;\n    this.subscribedFlights = [];\n    this.connect();\n    this.connected = false;\n\n    // Register hooks, so we get notified when these settings change\n    getSetting(Settings.PATH_LENGTH).registerCallback(\n      this.refreshSubscribedFlights\n    );\n    getSetting(Settings.LIMIT_PATHS).registerCallback(\n      this.refreshSubscribedFlights\n    );\n  }\n\n  connect() {\n    if (\"WebSocket\" in window) {\n      this.connected = false;\n      this.setConnectionState(ConnectionState.CONNECTING);\n      this.sock = new WebSocket(\"wss://live.xcontest.org/websock/webclient\");\n      this.sock.onopen = this.onOpen;\n      this.sock.onmessage = this.onMessage;\n      this.sock.onclose = this.onClose;\n      this.sock.onerror = this.onError;\n    } else {\n      this.setConnectionState(ConnectionState.ERROR);\n      // The browser doesn't support WebSocket\n      alert(\"WebSocket NOT supported by your Browser!\");\n    }\n  }\n\n  formatSubscribedFlights = () => {\n    const formattedFlights = this.subscribedFlights.map(\n      ([flightId, startTimestamp]) => {\n        const startIsoTime =\n          startTimestamp === null\n            ? null\n            : new Date(1000 * startTimestamp).toISOString();\n        return { flightUuid: flightId, start: startIsoTime };\n      }\n    );\n\n    return formattedFlights;\n  };\n\n  refreshSubscribedFlights = () => {\n    if (this.sock.readyState === WebSocket.OPEN && this.connected) {\n      const formattedSubscribedFlights = this.formatSubscribedFlights();\n\n      this.sock.send(\n        JSON.stringify({\n          tag: \"WebFollow\",\n          contents: formattedSubscribedFlights,\n        })\n      );\n    }\n  };\n\n  setSubscribedFlights = (flights) => {\n    this.subscribedFlights = flights;\n    this.refreshSubscribedFlights();\n  };\n\n  onOpen = () => {\n    this.handleReset();\n    console.debug(\"WebSocket: Open!\");\n    this.setConnectionState(ConnectionState.ESTABLISHED);\n    this.connected = true;\n\n    // Set area filter to the entire world\n    this.sock.send(\n      JSON.stringify({\n        tag: \"WebFilterArea\",\n        area: [\n          { lat: -90, lon: -180 },\n          { lat: 90, lon: 180 },\n        ],\n      })\n    );\n\n    // Use current 'fake' contest that is valid for the current alpha phase.\n    // Primarily sent to match the messages from their reverse engineered websocket\n    this.sock.send(\n      JSON.stringify({ tag: \"WebFilterContest\", contents: \"alpha9999\" })\n    );\n\n    // Tell the webserver which flights we want in more detail. TODO.\n    const formattedSubscribedFlights = this.formatSubscribedFlights();\n    this.sock.send(\n      JSON.stringify({\n        tag: \"WebFollow\",\n        contents: formattedSubscribedFlights,\n      })\n    );\n  };\n\n  onMessage = (evt) => {\n    //console.debug(\"WebSocket: Message!\");\n    this.setConnectionState(ConnectionState.ACTIVE);\n\n    let msg = JSON.parse(evt.data);\n\n    // Expect the next message in 60 seconds. If not, change the status message.\n    clearTimeout(this.watchdog);\n    this.watchdog = setTimeout(() => {\n      this.setConnectionState(ConnectionState.INACTIVE);\n    }, 70000);\n\n    // Process the message\n    this.processMessage(msg);\n  };\n\n  onClose = (evt) => {\n    this.connected = false;\n    console.debug(\"WebSocket: Close!\");\n    this.setConnectionState(ConnectionState.NO_CONNECTION);\n    // websocket is closed.\n    setTimeout(this.connect.bind(this), 1000);\n  };\n\n  onError = (evt) => {\n    this.connected = false;\n    console.debug(\"WebSocket: Error!\");\n  };\n\n  // Message Processing\n  handleReset = () => {\n    console.log(\"TODO: handle reset!\");\n  };\n  processMessage = (msg) => {\n    if (!(\"tag\" in msg)) {\n      console.warn(\"Warning: Invalid message format!\", msg);\n      return;\n    }\n    switch (msg.tag) {\n      case \"LiveFlightInfos\":\n        this.dispatchInfoMessage(msg.contents);\n        break;\n      case \"LiveFlightChunk\":\n        this.dispatchTracklogMessage(msg);\n        break;\n      case \"LiveFlightLanded\":\n        this.dispatchFlightLandedMessage(msg.flightUuid);\n        break;\n      default:\n        console.warn(`Warning: Unknown message tag '${msg.tag}'!`, msg);\n    }\n  };\n}\n","export default class RunningDerivation {\n  constructor(\n    smoothingFactor,\n    derivation_func = (a, b) => b - a,\n    invalid_func = a => a === null\n  ) {\n    this.computeDiff = derivation_func;\n    this.isInvalid = invalid_func;\n    this.old_val = null;\n    this.old_t = null;\n    this.running_avg = null;\n    this.smoothingFactor = smoothingFactor;\n  }\n\n  update(new_val, new_t) {\n    if (\n      this.old_val === null ||\n      new_val === null ||\n      this.old_t === null ||\n      new_t === null ||\n      this.isInvalid(this.old_val) ||\n      this.isInvalid(new_val) ||\n      this.old_t === this.new_t\n    ) {\n      this.old_val = new_val;\n      this.old_t = new_t;\n      return null;\n    }\n\n    let dt = new_t - this.old_t;\n    let diff = this.computeDiff(this.old_val, new_val);\n    let deriv = diff / dt;\n\n    let weight = Math.pow(this.smoothingFactor, dt);\n    if (this.running_avg === null) {\n      this.running_avg = deriv;\n    } else {\n      this.running_avg = weight * this.running_avg + (1.0 - weight) * deriv;\n    }\n\n    this.old_val = new_val;\n    this.old_t = new_t;\n    return this.running_avg;\n  }\n\n  reset() {\n    this.old_val = null;\n    this.old_t = null;\n    this.running_avg = null;\n  }\n}\n","const findBisect = (targetValue, length, dataFn) => {\n  if (length < 1) return 0;\n\n  let minIndex = -1;\n  let maxIndex = length;\n  let currentIndex = 0;\n  let currentValue = null;\n\n  while (minIndex < maxIndex - 1) {\n    currentIndex = ((minIndex + maxIndex) / 2) | 0;\n    currentValue = dataFn(currentIndex);\n\n    if (currentValue < targetValue) {\n      minIndex = currentIndex;\n    } else {\n      maxIndex = currentIndex;\n    }\n  }\n\n  return maxIndex;\n};\n\nexport default findBisect;\n","import RunningDerivation from \"../../util/RunningDerivation\";\nimport { getDistance } from \"geolib\";\nimport findBisect from \"../../util/FindBisect\";\n\nexport const parseTime = (isoStr) => {\n  return Math.round(Date.parse(isoStr) / 1000);\n};\n\nexport default class FlightAnimationData {\n  constructor() {\n    this.data = [];\n    this.counter_gpsVario = new RunningDerivation(0.7);\n    this.counter_baroVarion = new RunningDerivation(0.7);\n    this.counter_velocity = new RunningDerivation(\n      0.7,\n      (start, end) => getDistance(start, end, 0.01),\n      () => false\n    );\n  }\n\n  at = (index) => this.data[index];\n\n  clear() {\n    // reset everything\n    this.data = [];\n    this.counter_gpsVario = new RunningDerivation(0.7);\n    this.counter_baroVarion = new RunningDerivation(0.7);\n    this.counter_velocity = new RunningDerivation(\n      0.7,\n      (start, end) => getDistance(start, end, 0.01),\n      () => false\n    );\n  }\n\n  get length() {\n    return this.data.length;\n  }\n\n  isAfterLastElement(timestamp) {\n    if (this.data.length <= 0) return true;\n    return this.data[this.data.length - 1].t < timestamp;\n  }\n\n  append(data) {\n    for (const elem of data) {\n      const timestamp = parseTime(elem.timestamp);\n      const pos = { lat: elem.lat, lng: elem.lon };\n\n      const baroAlt = elem.baroAlt === 0 ? null : elem.baroAlt;\n      const gpsAlt = elem.gpsAlt === 0 ? null : elem.gpsAlt;\n\n      // Compute new running average values\n      const gpsVario = this.counter_gpsVario.update(gpsAlt, timestamp);\n      const baroVario = this.counter_baroVarion.update(baroAlt, timestamp);\n      const velocity = this.counter_velocity.update(pos, timestamp);\n\n      const newElem = {\n        baroAlt: baroAlt,\n        gpsAlt: gpsAlt,\n        elevation: elem.elevation,\n        pos: pos,\n        gpsVario: gpsVario,\n        baroVario: baroVario,\n        velocity: velocity,\n        t: timestamp,\n      };\n      this.data.push(newElem);\n    }\n  }\n\n  replace(data) {\n    this.clear();\n    this.append(data);\n  }\n\n  insert(data) {\n    const newElements = [];\n    for (const elem of data) {\n      const timestamp = parseTime(elem.timestamp);\n      const pos = { lat: elem.lat, lng: elem.lon };\n      const baroAlt = elem.baroAlt === 0 ? null : elem.baroAlt;\n      const gpsAlt = elem.gpsAlt === 0 ? null : elem.gpsAlt;\n\n      const newElem = {\n        baroAlt: baroAlt,\n        gpsAlt: gpsAlt,\n        elevation: elem.elevation,\n        pos: pos,\n        gpsVario: null,\n        baroVario: null,\n        velocity: null,\n        t: timestamp,\n      };\n      newElements.push(newElem);\n    }\n\n    // Merge\n    const oldElements = this.data;\n    this.data = [];\n\n    let oldPos = 0;\n    let newPos = 0;\n\n    while (true) {\n      if (oldPos >= oldElements.length && newPos >= newElements.length) break;\n      else if (oldPos >= oldElements.length) {\n        this.data.push(newElements[newPos]);\n        newPos += 1;\n      } else if (newPos >= newElements.length) {\n        this.data.push(oldElements[oldPos]);\n        oldPos += 1;\n      } else {\n        const oldEl = oldElements[oldPos];\n        const newEl = newElements[newPos];\n\n        if (newEl.t < oldEl.t) {\n          this.data.push(newEl);\n          newPos += 1;\n        } else if (oldEl.t < newEl.t) {\n          this.data.push(oldEl);\n          oldPos += 1;\n        } else {\n          this.data.push(newEl);\n          oldPos += 1;\n          newPos += 1;\n        }\n      }\n    }\n\n    // Re-compute derivatives\n    this.counter_gpsVario.reset();\n    this.counter_baroVarion.reset();\n    this.counter_velocity.reset();\n    for (let elem of this.data) {\n      const gpsVario = this.counter_gpsVario.update(elem.gpsAlt, elem.t);\n      const baroVario = this.counter_baroVarion.update(elem.baroAlt, elem.t);\n      const velocity = this.counter_velocity.update(elem.pos, elem.t);\n\n      elem.gpsVario = gpsVario;\n      elem.baroVario = baroVario;\n      elem.velocity = velocity;\n    }\n  }\n\n  findBisect = (timestamp) => {\n    return findBisect(timestamp, this.data.length, (pos) => this.data[pos].t);\n  };\n\n  findForwardSwipe = (timestamp, startPos) => {\n    let pos = startPos;\n    while (pos < this.data.length && this.data[pos].t < timestamp) {\n      pos += 1;\n    }\n    return pos;\n  };\n\n  getNewestTimestamp = () => {\n    if (this.data.length < 1) return null;\n    return this.data[this.data.length - 1].t;\n  };\n}\n","import { registerPersistentState } from \"./PersistentState\";\nimport { getXContestInterface } from \"../../location_provider/XContest/XContestInterface\";\nimport { parseTime } from \"../../location_provider/XContest/FlightAnimationData\";\n\nconst persistentChosenPilots = registerPersistentState(\"chosen-pilots\", {});\n\nexport const getChosenPilotsObject = () => persistentChosenPilots;\n\nexport function getChosenPilots() {\n  return persistentChosenPilots.getValue();\n}\n\nexport function setChosenPilots(newValue) {\n  console.log(\"Selected pilots updated: \", newValue);\n  persistentChosenPilots.setValue(newValue);\n}\n\n// Sets new chosen pilots and also looks up their names.\n// When used without argument, just updates the names of the existing pilots.\nexport function setChosenPilotsAndUpdateInfos(chosenPilots = null) {\n  let chosenPilotsUpdated = true;\n\n  // if no new chosenPilots list was defined, take over previous one and disable updating unless a name changed\n  if (chosenPilots === null) {\n    chosenPilots = { ...getChosenPilots() };\n    chosenPilotsUpdated = false;\n  }\n\n  const pilotList = getXContestInterface().getPilotInfos();\n\n  for (const pilotId in chosenPilots) {\n    if (pilotId in pilotList) {\n      // Get new name\n      const currentName = pilotList[pilotId].info.user.fullname;\n      // Get stored name\n      const previousName = chosenPilots[pilotId].name;\n\n      // If new name is different, update\n      if (currentName !== previousName) {\n        chosenPilots[pilotId].name = currentName;\n        chosenPilotsUpdated = true;\n      }\n\n      const lastFix = pilotList[pilotId].lastFix;\n      const previousLastFix = chosenPilots[pilotId].lastFix;\n      if (!previousLastFix || previousLastFix.t !== lastFix.timestamp) {\n        chosenPilots[pilotId].lastFix = {\n          t: parseTime(lastFix.timestamp),\n          lat: lastFix.lat,\n          lon: lastFix.lon,\n          landed: pilotList[pilotId].landed,\n        };\n        chosenPilotsUpdated = true;\n      }\n    }\n  }\n\n  // If anything updated, set new list. This will trigger events.\n  if (chosenPilotsUpdated) {\n    setChosenPilots(chosenPilots);\n  }\n}\n\n// Change which pilots are shown\nexport const updateShownPilots = (pilotIds) => {\n  const newPilotState = { ...getChosenPilots() };\n\n  let changed = false;\n  for (const pilotId in newPilotState) {\n    const pilotShouldBeShown = pilotIds.indexOf(pilotId) !== -1;\n    const pilotIsShown = newPilotState[pilotId].shown;\n    if (pilotShouldBeShown !== pilotIsShown) {\n      newPilotState[pilotId].shown = pilotShouldBeShown;\n      changed = true;\n    }\n  }\n\n  if (changed) {\n    setChosenPilots(newPilotState);\n  }\n};\n\nexport const setPilotShown = (pilotId, shown) => {\n  const newPilotState = { ...getChosenPilots() };\n\n  if (pilotId in newPilotState) {\n    const pilotState = newPilotState[pilotId];\n    if (pilotState.shown !== shown) {\n      pilotState.shown = shown;\n      setChosenPilots(newPilotState);\n    }\n  }\n};\n\n// The default pilot entry for new pilots\nexport const defaultPilotEntry = (pilotName) => ({\n  name: pilotName,\n  shown: true,\n  lastFix: null,\n});\n\n// Add new pilots\nexport const addPilots = (pilotIds) => {\n  const newPilotState = { ...getChosenPilots() };\n\n  let changed = false;\n  for (const pilotId of pilotIds) {\n    if (!(pilotId in newPilotState)) {\n      newPilotState[pilotId] = defaultPilotEntry(pilotId);\n      changed = true;\n    }\n  }\n\n  if (changed) {\n    setChosenPilotsAndUpdateInfos(newPilotState);\n  }\n};\n\n// Remove pilots\nexport const removePilots = (pilotIds) => {\n  const newPilotState = { ...getChosenPilots() };\n\n  let changed = false;\n  for (const pilotId of pilotIds) {\n    if (pilotId in newPilotState) {\n      delete newPilotState[pilotId];\n      changed = true;\n    }\n  }\n\n  if (changed) {\n    setChosenPilots(newPilotState);\n  }\n};\n\n/*export function useChosenPilots() {\n  const [chosenPilots] = persistentChosenPilots.use();\n\n  return [chosenPilots, addPilots, removePilots];\n}*/\n","export const lerp = (val1, val2, pct) => {\n  if (val2 === null) {\n    return val1;\n  }\n  if (val1 === null) {\n    return val2;\n  }\n  return (1.0 - pct) * val1 + pct * val2;\n};\n\n// Important:\n// t0<t1<t2<t3 and t1<=t<=t2\nexport const spline = (p0, t0, p1, t1, p2, t2, p3, t3, t) => {\n  // Make timestamps relative.\n  // This enables us to handle unix timestamps (large numbers)\n  t1 -= t0;\n  t2 -= t0;\n  t3 -= t0;\n  t -= t0;\n  t0 = 0;\n\n  const A1 = ((p1 - p0) * t + p0 * t1 - p1 * t0) / (t1 - t0);\n  const A2 = ((p2 - p1) * t + p1 * t2 - p2 * t1) / (t2 - t1);\n  const A3 = ((p3 - p2) * t + p2 * t3 - p3 * t2) / (t3 - t2);\n\n  const B1 = ((A2 - A1) * t + A1 * t2 - A2 * t0) / (t2 - t0);\n  const B2 = ((A3 - A2) * t + A2 * t3 - A3 * t1) / (t3 - t1);\n\n  const C = ((B2 - B1) * t + B1 * t2 - B2 * t1) / (t2 - t1);\n\n  return C;\n};\n\nexport const splineDerivative = (p0, t0, p1, t1, p2, t2, p3, t3, t) => {\n  // Make timestamps relative.\n  // This enables us to handle unix timestamps (large numbers)\n  t1 -= t0;\n  t2 -= t0;\n  t3 -= t0;\n  t -= t0;\n  t0 = 0;\n\n  const A1 = ((p1 - p0) * t + p0 * t1 - p1 * t0) / (t1 - t0);\n  const A2 = ((p2 - p1) * t + p1 * t2 - p2 * t1) / (t2 - t1);\n  const A3 = ((p3 - p2) * t + p2 * t3 - p3 * t2) / (t3 - t2);\n\n  const A1d = (p1 - p0) / (t1 - t0);\n  const A2d = (p2 - p1) / (t2 - t1);\n  const A3d = (p3 - p2) / (t3 - t2);\n\n  const B1 = ((A2 - A1) * t + A1 * t2 - A2 * t0) / (t2 - t0);\n  const B2 = ((A3 - A2) * t + A2 * t3 - A3 * t1) / (t3 - t1);\n\n  const B1d = (A2d * t + A2 - A1d * t - A1 + A1d * t2 - A2d * t0) / (t2 - t0);\n  const B2d = (A3d * t + A3 - A2d * t - A2 + A2d * t3 - A3d * t1) / (t3 - t1);\n\n  const Cd = (B2d * t + B2 - B1d * t - B1 + B1d * t2 - B2d * t1) / (t2 - t1);\n\n  return Cd;\n};\n\n// Interpolates between points p1 and p2\nexport const uniformspline = (p0, p1, p2, p3, pct) => {\n  //return 0.5*pct*pct*pct*(p3-3*p2+3*p1-p0) + 0.5*pct*pct*(2*p0-5*p1+4*p2-p3) + 0.5*pct*(p2-p0) + p1;\n  return (\n    pct *\n      (pct *\n        (pct * (p3 - 3 * p2 + 3 * p1 - p0) + 2 * p0 - 5 * p1 + 4 * p2 - p3) +\n        p2 -\n        p0) *\n      0.5 +\n    p1\n  );\n};\n\nexport const uniformsplineDerivative = (p0, p1, p2, p3, pct) => {\n  //return 1.5*pct*pct*(p3-3*p2+3*p1-p0) + pct*(2*p0-5*p1+4*p2-p3) + 0.5*(p2-p0);\n  return (\n    0.5 *\n    (pct *\n      (3 * pct * (p3 - 3 * p2 + 3 * p1 - p0) +\n        4 * p0 -\n        10 * p1 +\n        8 * p2 -\n        2 * p3) +\n      p2 -\n      p0)\n  );\n};\n","import { lerp, splineDerivative, spline } from \"../../util/Interpolation\";\nimport FlightAnimationData, { parseTime } from \"./FlightAnimationData\";\nimport { getSetting, Settings } from \"../../common/PersistentState/Settings\";\n\nclass FlightAnimationDataCache {\n  // IMPORTANT ASSUMPTION IN THIS ENTIRE FILE:\n  // While the cache exists, new data gets only appended. Whenever existing data changes, the cache\n  // will be invalidated.\n  // I.E., chache invariants:\n  //    - existing data entries don't change, indices always point to the same data\n  //    - data timestamps are monotonic rising, meaning, to get newer data the data array only\n  //      needs to be traversed in forward direction, never backwards.\n  // This enables efficient caching and O(1) lookup times.\n  constructor() {\n    this.currentArrayPos = null;\n    this.mapsPath = [];\n    this.mapsPathNewestPos = 0;\n  }\n\n  reset = () => {\n    this.currentArrayPos = null;\n    this.mapsPath = [];\n    this.mapsPathNewestPos = 0;\n  };\n}\n\nclass DataGens {\n  static fallbackData = (flightInfos) => {\n    return {\n      baroAlt: flightInfos.lastFix.baroAlt,\n      gpsAlt: flightInfos.lastFix.gpsAlt,\n      elevation: flightInfos.lastFix.elevation,\n      pos: {\n        lat: flightInfos.lastFix.lat,\n        lng: flightInfos.lastFix.lon,\n      },\n      gpsVario: null,\n      baroVario: null,\n      velocity: null,\n    };\n  };\n\n  static offlineData = (offlinePilotInfos) => {\n    return {\n      baroAlt: null,\n      gpsAlt: null,\n      elevation: null,\n      pos: {\n        lat: offlinePilotInfos.lastFix.lat,\n        lng: offlinePilotInfos.lastFix.lon,\n      },\n      gpsVario: null,\n      baroVario: null,\n      velocity: null,\n    };\n  };\n\n  static takeData(data) {\n    return {\n      baroAlt: data.baroAlt,\n      gpsAlt: data.gpsAlt,\n      elevation: data.elevation,\n      pos: {\n        lat: data.pos.lat,\n        lng: data.pos.lng,\n      },\n      gpsVario: data.gpsVario,\n      baroVario: data.baroVario,\n      velocity: data.velocity,\n    };\n  }\n\n  static blendData(data1, data2, timeStamp) {\n    const pct = (timeStamp - data1.t) / (data2.t - data1.t);\n    return {\n      baroAlt: lerp(data1.baroAlt, data2.baroAlt, pct),\n      gpsAlt: lerp(data1.gpsAlt, data2.gpsAlt, pct),\n      elevation: lerp(data1.elevation, data2.elevation, pct),\n      pos: {\n        lat: lerp(data1.pos.lat, data2.pos.lat, pct),\n        lng: lerp(data1.pos.lng, data2.pos.lng, pct),\n      },\n      gpsVario: lerp(data1.gpsVario, data2.gpsVario, pct),\n      baroVario: lerp(data1.baroVario, data2.baroVario, pct),\n      velocity: lerp(data1.velocity, data2.velocity, pct),\n    };\n  }\n\n  static blendDataSpline(data0, data1, data2, data3, timeStamp) {\n    const pct = (timeStamp - data1.t) / (data2.t - data1.t);\n    return {\n      baroAlt: lerp(data1.baroAlt, data2.baroAlt, pct),\n      gpsAlt: lerp(data1.gpsAlt, data2.gpsAlt, pct),\n      elevation: lerp(data1.elevation, data2.elevation, pct),\n      pos: {\n        lat: spline(\n          data0.pos.lat,\n          data0.t,\n          data1.pos.lat,\n          data1.t,\n          data2.pos.lat,\n          data2.t,\n          data3.pos.lat,\n          data3.t,\n          timeStamp\n        ),\n        lng: spline(\n          data0.pos.lng,\n          data0.t,\n          data1.pos.lng,\n          data1.t,\n          data2.pos.lng,\n          data2.t,\n          data3.pos.lng,\n          data3.t,\n          timeStamp\n        ),\n      },\n      gpsVario: lerp(data1.gpsVario, data2.gpsVario, pct),\n      baroVario: lerp(data1.baroVario, data2.baroVario, pct),\n      velocity: lerp(data1.velocity, data2.velocity, pct),\n    };\n  }\n\n  static computeLinearVelocity(data1, data2) {\n    const t1 = data1.t;\n    const t2 = data2.t;\n    if (t1 === t2) return null;\n\n    const dT = t2 - t1;\n\n    const p1 = data1.pos;\n    const p2 = data2.pos;\n\n    const vLat = (p2.lat - p1.lat) / dT;\n    const vLng = (p2.lng - p1.lng) / dT;\n    return { lat: vLat, lng: vLng };\n  }\n\n  static computeSplineVelocity(d0, d1, d2, d3, t) {\n    const t0 = d0.t;\n    const t1 = d1.t;\n    const t2 = d2.t;\n    const t3 = d3.t;\n\n    const p0 = d0.pos;\n    const p1 = d1.pos;\n    const p2 = d2.pos;\n    const p3 = d3.pos;\n\n    const vLat = splineDerivative(\n      p0.lat,\n      t0,\n      p1.lat,\n      t1,\n      p2.lat,\n      t2,\n      p3.lat,\n      t3,\n      t\n    );\n\n    const vLng = splineDerivative(\n      p0.lng,\n      t0,\n      p1.lng,\n      t1,\n      p2.lng,\n      t2,\n      p3.lng,\n      t3,\n      t\n    );\n\n    return { lat: vLat, lng: vLng };\n  }\n}\n\nclass FlightAnimation {\n  constructor(flightInfos) {\n    // Live data\n    this.liveData = new FlightAnimationData();\n    this.liveDataCache = new FlightAnimationDataCache();\n\n    // Data from flight infos, used as fallback\n    this.flightInfos = null;\n    this.flightInfoData = new FlightAnimationData();\n    this.flightInfoDataCache = new FlightAnimationDataCache();\n\n    // 'landed' state\n    this.landed = flightInfos.landed;\n\n    // Set flight infos\n    this.updateInfos(flightInfos);\n\n    this.settings = {};\n    this.updateSettings();\n\n    // register settings hooks\n    getSetting(Settings.ANIMATION_DELAY).registerCallback(this.updateSettings);\n    getSetting(Settings.LOW_LATENCY).registerCallback(this.updateSettings);\n    getSetting(Settings.PATH_LENGTH).registerCallback(this.updateSettings);\n    getSetting(Settings.LIMIT_PATHS).registerCallback(this.updateSettings);\n  }\n\n  destroy = () => {\n    getSetting(Settings.ANIMATION_DELAY).unregisterCallback(\n      this.updateSettings\n    );\n    getSetting(Settings.LOW_LATENCY).unregisterCallback(this.updateSettings);\n    getSetting(Settings.PATH_LENGTH).unregisterCallback(this.updateSettings);\n    getSetting(Settings.LIMIT_PATHS).unregisterCallback(this.updateSettings);\n  };\n\n  updateSettings = () => {\n    this.settings = {\n      timeOffsetSeconds: getSetting(Settings.ANIMATION_DELAY).getValue(),\n      lowLatencyMode: getSetting(Settings.LOW_LATENCY).getValue(),\n      trackLengthMinutes: getSetting(Settings.PATH_LENGTH).getValue(),\n      limitTracks: getSetting(Settings.LIMIT_PATHS).getValue(),\n    };\n    this.liveDataCache.reset();\n    this.flightInfoDataCache.reset();\n  };\n\n  updateInfos = (infos) => {\n    this.landed |= infos.landed;\n    this.flightInfos = infos;\n    this.flightInfoData.replace(infos.track);\n    this.flightInfoDataCache.reset();\n  };\n\n  updateData = (data) => {\n    if (data.length < 1) return;\n\n    // Compute start time\n    const data_start_time = parseTime(data[0].timestamp);\n    if (this.liveData.isAfterLastElement(data_start_time)) {\n      // If the new data is newer than everything in the existing data, append\n      this.liveData.append(data);\n    } else {\n      // Otherwise, merge\n      this.liveData.insert(data);\n\n      // Reset animation\n      this.liveDataCache.reset();\n    }\n  };\n\n  updateLanded = () => {\n    console.log(\"Received flight landed message!\");\n    this.landed = true;\n  };\n\n  getInterpolatedData = (data, cache, timeStamp) => {\n    if (data.length < 1) return null;\n\n    if (cache.currentArrayPos === null) {\n      cache.currentArrayPos = data.findBisect(timeStamp);\n    } else {\n      // Optimization because we assume that time runs forward and the next value is after the current value\n      cache.currentArrayPos = data.findForwardSwipe(\n        timeStamp,\n        cache.currentArrayPos\n      );\n    }\n\n    // Compute\n    let blendedData = null;\n    let endOfTrack = false;\n    let startOfTrack = false;\n    let velocityVec = null;\n    if (cache.currentArrayPos <= 0) {\n      // If the timestamp is before our track, return first element\n      blendedData = DataGens.takeData(data.at(0));\n      if (data.length >= 2) {\n        velocityVec = DataGens.computeLinearVelocity(data.at(0), data.at(1));\n      }\n      startOfTrack = true;\n    } else if (cache.currentArrayPos >= data.length) {\n      // If the timestamp is after our track, return last element\n      blendedData = DataGens.takeData(data.at(data.length - 1));\n      if (data.length >= 2) {\n        velocityVec = DataGens.computeLinearVelocity(\n          data.at(data.length - 2),\n          data.at(data.length - 1)\n        );\n      }\n      endOfTrack = true;\n    } else {\n      const data1 = data.at(cache.currentArrayPos - 1);\n      const data2 = data.at(cache.currentArrayPos);\n\n      const data0 =\n        cache.currentArrayPos - 2 >= 0\n          ? data.at(cache.currentArrayPos - 2)\n          : {\n              ...data1,\n              t: data1.t - 1,\n            };\n\n      const data3 =\n        cache.currentArrayPos + 1 < data.length\n          ? data.at(cache.currentArrayPos + 1)\n          : {\n              ...data2,\n              t: data2.t + 1,\n            };\n\n      // Blend via spline\n      blendedData = DataGens.blendDataSpline(\n        data0,\n        data1,\n        data2,\n        data3,\n        timeStamp\n      );\n      velocityVec = DataGens.computeSplineVelocity(\n        data0,\n        data1,\n        data2,\n        data3,\n        timeStamp\n      );\n    }\n\n    const newestDataTimestamp = data.at(data.length - 1).t;\n\n    return [\n      blendedData,\n      startOfTrack,\n      endOfTrack,\n      newestDataTimestamp,\n      velocityVec,\n    ];\n  };\n\n  getFallbackData = () => {\n    return [\n      DataGens.fallbackData(this.flightInfos),\n      false,\n      true,\n      parseTime(this.flightInfos.lastFix.timestamp),\n      null,\n    ];\n  };\n\n  computeTrack = (data, cache, timestamp) => {\n    if (data.length < 1) return null;\n\n    const oldestTimestamp = timestamp - this.settings.trackLengthMinutes * 60;\n\n    let track = cache.mapsPath;\n\n    // Append new data\n    while (\n      cache.mapsPathNewestPos < data.length &&\n      data.at(cache.mapsPathNewestPos).t < timestamp\n    ) {\n      const elem = data.at(cache.mapsPathNewestPos);\n      track.push({\n        lat: elem.pos.lat,\n        lng: elem.pos.lng,\n        timestamp: elem.t,\n        altitude: elem.gpsAlt !== null ? elem.gpsAlt : elem.baroAlt,\n        elevation: elem.elevation,\n      });\n      cache.mapsPathNewestPos += 1;\n    }\n\n    // Delete old data\n    if (this.settings.limitTracks) {\n      const removeChunkSize = 32;\n      let numRemove = 0;\n      while (\n        numRemove + removeChunkSize - 1 < track.length &&\n        track[numRemove + removeChunkSize - 1].timestamp < oldestTimestamp\n      ) {\n        numRemove += removeChunkSize;\n      }\n      if (numRemove > 0) {\n        track = track.slice(numRemove);\n        cache.mapsPath = track;\n      }\n    }\n\n    return track;\n  };\n\n  updateAnimation = (animationTimeMillis) => {\n    const animationTimeSeconds = this.settings.lowLatencyMode\n      ? animationTimeMillis / 1000\n      : animationTimeMillis / 1000 - this.settings.timeOffsetSeconds;\n\n    let animationResult = this.getInterpolatedData(\n      this.liveData,\n      this.liveDataCache,\n      animationTimeSeconds\n    );\n    if (!animationResult) {\n      animationResult = this.getInterpolatedData(\n        this.flightInfoData,\n        this.flightInfoDataCache,\n        animationTimeSeconds\n      );\n    }\n    if (!animationResult) {\n      animationResult = this.getFallbackData();\n    }\n\n    let track = this.computeTrack(\n      this.liveData,\n      this.liveDataCache,\n      animationTimeSeconds\n    );\n    if (!track) {\n      track = this.computeTrack(\n        this.flightInfoData,\n        this.flightInfoDataCache,\n        animationTimeSeconds\n      );\n    }\n    if (!track) {\n      track = [];\n    }\n\n    let [\n      blendedData,\n      startOfTrack,\n      endOfTrack,\n      newestDataTimestamp,\n      velocityVec,\n    ] = animationResult;\n\n    // Special case for endOfTrack for lowLatencyMode\n    if (this.settings.lowLatencyMode) {\n      if (this.landed) {\n        // If 'landed' got signalled, immediately also end the track,\n        // as the 'landed' signal comes simultaneously to the last track message\n        endOfTrack = true;\n      } else {\n        // Otherwise, determine by how long ago we last heard from the pilot whether\n        // the track is broken or not.\n        // Has to be treated different than the default case, because in lowLatencyMode we\n        // are always at the end of the track.\n        endOfTrack = newestDataTimestamp < animationTimeSeconds - 80;\n      }\n    }\n\n    // Compute last potential air time.\n    // Used for computation of flight duration.\n    let lastPotentialAirtime = animationTimeSeconds;\n    if (endOfTrack && this.landed) {\n      lastPotentialAirtime = newestDataTimestamp;\n    }\n\n    const result = {\n      ...blendedData,\n      startOfTrack: startOfTrack,\n      endOfTrack: endOfTrack,\n      landed: this.landed, // Only valid if 'endOfTrack' is also true!\n      name: this.flightInfos.info.user.fullname,\n      newestDataTimestamp: newestDataTimestamp,\n      track: track,\n      velocityVec: velocityVec,\n      lastPotentialAirTime: Math.round(lastPotentialAirtime),\n      offline: false,\n    };\n\n    return result;\n  };\n\n  getNewestTimestamp = () => this.liveData.getNewestTimestamp();\n}\n\nexport const createOfflineEntry = (pilotId, offlinePilotInfos) => {\n  const landed = offlinePilotInfos.lastFix.landed;\n\n  const result = {\n    ...DataGens.offlineData(offlinePilotInfos),\n    startOfTrack: !landed,\n    endOfTrack: landed,\n    landed: landed,\n    name: offlinePilotInfos.name == null ? pilotId : offlinePilotInfos.name,\n    newestDataTimestamp: offlinePilotInfos.lastFix.t,\n    track: [],\n    velocityVec: null,\n    lastPotentialAirTime: offlinePilotInfos.lastFix.t,\n    offline: true,\n  };\n\n  return result;\n};\n\nexport default FlightAnimation;\n","class HighPrecisionTimeSync {\n  // Tolerance should be larger than the duration of one animation frame.\n  // Most animations are 60Hz, meaning 16ms, so 20ms is fine.\n  constructor(tolerance = 20) {\n    this.offset = 0.0;\n    this.tolerance = tolerance;\n  }\n\n  get = (currentHighPrecisionTime, currentTime) => {\n    let estimatedTime = currentHighPrecisionTime + this.offset;\n    const offBy = estimatedTime - currentTime;\n\n    if (offBy > this.tolerance || offBy < -this.tolerance) {\n      this.offset -= offBy;\n      estimatedTime = currentHighPrecisionTime + this.offset;\n    }\n\n    return estimatedTime;\n  };\n}\n\nexport default HighPrecisionTimeSync;\n","import {\n  getChosenPilots,\n  getChosenPilotsObject,\n} from \"../../common/PersistentState/ChosenPilots\";\nimport FlightAnimation, { createOfflineEntry } from \"./FlightAnimation\";\nimport HighPrecisionTimeSync from \"../../util/HighPrecisionTimeSync\";\nimport { Settings, getSetting } from \"../../common/PersistentState/Settings\";\n\nfunction eqSet(as, bs) {\n  if (as.size !== bs.size) return false;\n  for (const a of as) if (!bs.has(a)) return false;\n  return true;\n}\n\nexport default class XContestAnimation {\n  constructor(setSubscribedFlights) {\n    this._currentAnimationData = { pilotData: {}, pilotData_filtered: {} };\n    this._callbacks = [];\n    this._subscribedPilots = getChosenPilots();\n    this._subscribedFlights = new Set();\n    this._pilotInfos = {};\n    this._flightAnimations = {};\n    this._highPrecisionTimeSync = new HighPrecisionTimeSync();\n    const settings_limitFps = getSetting(Settings.FPS_LIMIT);\n    const settings_fps = getSetting(Settings.FPS_RATE);\n    const settings_showOfflinePilots = getSetting(Settings.SHOW_OFFLINE_PILOTS);\n\n    // Cached settings values for performance improvements. Not sure if actually worth\n    this._setting_limitFps = settings_limitFps.getValue();\n    this._setting_fps = settings_fps.getValue();\n    this._setting_showOfflinePilots = settings_showOfflinePilots.getValue();\n    settings_limitFps.registerCallback((value) => {\n      this._setting_limitFps = value;\n    });\n    settings_fps.registerCallback((value) => {\n      this._setting_fps = value;\n    });\n    settings_showOfflinePilots.registerCallback((value) => {\n      this._setting_showOfflinePilots = value;\n    });\n\n    this._setSubscribedFlightsCallback = (flights) => {\n      setSubscribedFlights(Array.from(flights));\n    };\n    getChosenPilotsObject().registerCallback(this.setSubscribedPilots);\n    requestAnimationFrame(this.animationLoop);\n  }\n\n  // Animation loop\n  _nextUpdate = Date.now();\n  animationLoop = () => {\n    // Can't use time of function parameter, because we need absolute time\n    const absTime = Date.now();\n\n    const frameTimeDelta = 1000.0 / this._setting_fps;\n\n    if (!this._setting_limitFps || absTime >= this._nextUpdate) {\n      if (this._setting_limitFps) {\n        this._nextUpdate += frameTimeDelta;\n        if (absTime > this._nextUpdate) {\n          this._nextUpdate = absTime;\n        }\n      }\n\n      const newAnimationData = {};\n      const newFilteredAnimationData = {};\n      Object.entries(this._subscribedPilots).forEach(([pilot, pilotData]) => {\n        if (pilot in this._pilotInfos) {\n          const flightId = this._pilotInfos[pilot].flightId;\n          if (flightId in this._flightAnimations) {\n            const flightAnim = this._flightAnimations[flightId];\n\n            const pilotAnimationFrame = flightAnim.updateAnimation(absTime);\n            newAnimationData[pilot] = pilotAnimationFrame;\n            if (pilotData.shown) {\n              newFilteredAnimationData[pilot] = pilotAnimationFrame;\n            }\n          }\n        } else {\n          // Add offline pilots\n          if (this._setting_showOfflinePilots) {\n            if (pilotData.lastFix != null && pilotData.lastFix.landed) {\n              const offlinePilotEntry = createOfflineEntry(pilot, pilotData);\n\n              newAnimationData[pilot] = offlinePilotEntry;\n              if (pilotData.shown) {\n                newFilteredAnimationData[pilot] = offlinePilotEntry;\n              }\n            }\n          }\n        }\n      });\n\n      this._submitAnimationFrame({\n        pilotData: newAnimationData,\n        pilotData_filtered: newFilteredAnimationData,\n      });\n    }\n    requestAnimationFrame(this.animationLoop);\n  };\n\n  _submitAnimationFrame = (data) => {\n    this._currentAnimationData = data;\n    for (const cb of this._callbacks) {\n      cb(data);\n    }\n  };\n\n  // External\n  setSubscribedPilots = (subscribedPilots) => {\n    this._subscribedPilots = subscribedPilots;\n    this._updateImportantFlights();\n  };\n\n  pushNewInfo = (pilotInfo) => {\n    console.log(\"newInfo: \", pilotInfo);\n    this._pilotInfos = pilotInfo;\n    this._updateImportantFlights();\n\n    // Update flight info in flightAnimations\n    Object.values(pilotInfo).forEach((flightInfo) => {\n      const flightId = flightInfo.flightId;\n      if (flightId in this._flightAnimations) {\n        this._flightAnimations[flightId].updateInfos(flightInfo);\n      }\n    });\n  };\n\n  pushNewData = (trackId, trackData) => {\n    console.log(\"newTrackdata: \", trackId, trackData);\n    if (trackId in this._flightAnimations)\n      this._flightAnimations[trackId].updateData(trackData);\n  };\n\n  pushFlightLanded = (flightId) => {\n    if (flightId in this._flightAnimations)\n      this._flightAnimations[flightId].updateLanded();\n  };\n\n  // callback gets called every frame with new data\n  registerCallback = (cb) => {\n    if (!this._callbacks.includes(cb)) this._callbacks.push(cb);\n    cb(this._currentAnimationData);\n  };\n\n  unregisterCallback = (cb) => {\n    const index = this._callbacks.indexOf(cb);\n    if (index >= 0) {\n      this._callbacks.splice(index, 1);\n    }\n  };\n\n  getData = () => {\n    return this._currentAnimationData;\n  };\n\n  // Internal\n  _updateImportantFlights = () => {\n    // Filter important flights\n    let importantFlights = {};\n    Object.values(this._pilotInfos)\n      .filter((val) => val.info.user.username in this._subscribedPilots)\n      .forEach((val) => {\n        importantFlights[val.flightId] = val;\n      });\n\n    let importantFlightSet = new Set(Object.keys(importantFlights));\n\n    // Cleanup old entries of _flightAnimations\n    {\n      const toRemove = [];\n      for (const flightId in this._flightAnimations) {\n        if (!(flightId in importantFlights)) {\n          toRemove.push(flightId);\n        }\n      }\n      for (const flightId of toRemove) {\n        console.log(\"Removing flightAnimation of '\" + flightId + \"' ...\");\n        this._flightAnimations[flightId].destroy();\n        delete this._flightAnimations[flightId];\n      }\n    }\n\n    // Add new flightAnimations\n    Object.entries(importantFlights).forEach(([flightId, flightInfo]) => {\n      if (!(flightId in this._flightAnimations)) {\n        this._flightAnimations[flightId] = new FlightAnimation(flightInfo);\n      }\n    });\n\n    // Send subscription change to socket\n    if (!eqSet(importantFlightSet, this._subscribedFlights)) {\n      this._subscribedFlights = importantFlightSet;\n\n      // Get the timestamp of the newest track element, to prevent loading the same data multiple times\n      let flightsWithTimestamps = [];\n      console.log(this._flightAnimations);\n      importantFlightSet.forEach((flightId) => {\n        console.log(flightId, this._flightAnimations[flightId]);\n        flightsWithTimestamps.push([\n          flightId,\n          this._flightAnimations[flightId].getNewestTimestamp(),\n        ]);\n      });\n\n      console.log(\n        \"Changing flight subscribtion: \",\n        this._subscribedFlights,\n        importantFlightSet\n      );\n      this._setSubscribedFlightsCallback(flightsWithTimestamps);\n    }\n  };\n}\n","import { useState, useEffect } from \"react\";\n\nclass EventfulState {\n  constructor(initialValue) {\n    this._callbacks = [];\n    this._callbackData = initialValue;\n  }\n\n  set = value => {\n    this._callbackData = value;\n    for (const cb of this._callbacks) {\n      cb(value);\n    }\n  };\n\n  getValue = () => this._callbackData;\n\n  registerCallback = cb => {\n    if (!this._callbacks.includes(cb)) this._callbacks.push(cb);\n  };\n\n  unregisterCallback = cb => {\n    const index = this._callbacks.indexOf(cb);\n    if (index >= 0) {\n      this._callbacks.splice(index, 1);\n    }\n  };\n\n  use = () => {\n    const [value, setValue] = useState(this._callbackData);\n\n    useEffect(() => {\n      // trigger component update on change\n      this.registerCallback(setValue);\n      return () => this.unregisterCallback(setValue);\n    }, []);\n\n    return value;\n  };\n}\n\nexport default EventfulState;\n","import XContestSocket from \"./XContestSocket\";\nimport XContestAnimation from \"./XContestAnimation\";\nimport EventfulState from \"../../util/EventfulState\";\nimport { setChosenPilotsAndUpdateInfos } from \"../../common/PersistentState/ChosenPilots\";\n\nexport const ConnectionState = {\n  CONNECTING: \"connecting\", //orange\n  ERROR: \"error\", //red\n  ESTABLISHED: \"established\", //yellow\n  ACTIVE: \"active\", //green\n  INACTIVE: \"inactive\", //orange\n  NO_CONNECTION: \"no connection\", //red\n  NO_INFORMATION: \"no information\", //gray\n};\n\nclass XContestInterface {\n  constructor() {\n    this.pilots = [];\n    this.connectionState = new EventfulState(ConnectionState.NO_INFORMATION);\n    this.pilotInfos = new EventfulState([]);\n    this.socket = new XContestSocket(\n      this.onConnectionStateChanged,\n      this.onInfoMessageReceived,\n      this.onTracklogMessageReceived,\n      this.onFlightLandedMessageReceived\n    );\n    this.animation = new XContestAnimation(this.setSubscribedFlights);\n  }\n\n  setSubscribedFlights = (flights) => {\n    this.socket.setSubscribedFlights(flights);\n  };\n\n  getPilotInfos = () => this.pilots;\n\n  onConnectionStateChanged = (state) => {\n    this.connectionState.set(state);\n  };\n\n  onInfoMessageReceived = (msg) => {\n    this.pilots = {};\n    for (const [trackId, track] of msg) {\n      // Skip if we have a newer track of the same person\n      if (track.overriden) continue;\n\n      track.flightId = trackId;\n\n      this.pilots[track.info.user.username] = track;\n    }\n    this.animation.pushNewInfo(this.pilots);\n    this.pilotInfos.set(this.pilots);\n\n    // Set pilot names if available\n    setChosenPilotsAndUpdateInfos();\n  };\n\n  onTracklogMessageReceived = (msg) => {\n    this.animation.pushNewData(msg.flightUuid, msg.trackChunk);\n  };\n\n  onFlightLandedMessageReceived = (flightId) => {\n    this.animation.pushFlightLanded(flightId);\n  };\n}\n\n// Singleton stuff\nlet _instance = null;\nexport const getXContestInterface = () => {\n  if (!_instance) {\n    _instance = new XContestInterface();\n  }\n  return _instance;\n};\n\nexport const useXContestPilots = () => getXContestInterface().pilotInfos.use();\nexport const useXContestConnectionState = () =>\n  getXContestInterface().connectionState.use();\n","// seed\nfunction xmur3(str) {\n  for (var i = 0, h = 1779033703 ^ str.length; i < str.length; i++) {\n    h = Math.imul(h ^ str.charCodeAt(i), 3432918353);\n    h = (h << 13) | (h >>> 19);\n  }\n  return function() {\n    h = Math.imul(h ^ (h >>> 16), 2246822507);\n    h = Math.imul(h ^ (h >>> 13), 3266489909);\n    return (h ^= h >>> 16) >>> 0;\n  };\n}\n\n// rng\nfunction sfc32(a, b, c, d) {\n  return function() {\n    a >>>= 0;\n    b >>>= 0;\n    c >>>= 0;\n    d >>>= 0;\n    var t = (a + b) | 0;\n    a = b ^ (b >>> 9);\n    b = (c + (c << 3)) | 0;\n    c = (c << 21) | (c >>> 11);\n    d = (d + 1) | 0;\n    t = (t + d) | 0;\n    c = (c + t) | 0;\n    return (t >>> 0) / 4294967296;\n  };\n}\n\nexport default function createRng(seedString) {\n  // Create xmur3 state:\n  const seed = xmur3(seedString);\n  // Output four 32-bit hashes to provide the seed for sfc32.\n  const rand = sfc32(seed(), seed(), seed(), seed());\n  return rand;\n}\n","import createRng from \"./rng\";\nimport convert from \"color-convert\";\n\nexport default function string2color(str, lightness) {\n  const rand = createRng(str);\n\n  const colorHue = Math.min(Math.max(rand() * 360, 0), 360);\n  const hexColor = \"#\" + convert.hsl.hex(colorHue, 100, lightness);\n  return hexColor;\n}\n","import { getRhumbLineBearing } from \"geolib\";\nimport string2color from \"../util/string2color\";\n\n//const path_questionmark =\n//  \"m 12.747342,2.0001932 c -0.254753,-0.0015 -0.513283,0.0061 -0.773833,0.0228 C 8.104865,2.2564442 6.070752,4.4579604 5.904,8.4266554 h 3.901734 c 0.03335,-1.367366 0.834151,-2.401618 2.234867,-2.56837 1.400716,-0.133402 2.734861,0.200232 3.135066,1.134043 0.433555,1.033862 -0.533606,2.234215 -1.000512,2.734471 -0.86711,0.9338106 -2.267826,1.6342986 -3.001534,2.6348096 -0.700358,1.000512 -0.834151,2.301567 -0.900851,3.902386 h 3.43535 c 0.03335,-1.033862 0.09979,-2.001153 0.566695,-2.63481 0.767059,-1.033862 1.900972,-1.500768 2.834783,-2.334527 0.90046,-0.767059 1.867621,-1.7008696 2.001023,-3.1682856 0.531522,-4.033312 -2.54199,-6.1030962 -6.363279,-6.1261792 z M 12.073821,17.730891 A 2.1677748,2.1344245 0 0 0 9.906046,19.865445 2.1677748,2.1344245 0 0 0 12.073821,22 2.1677748,2.1344245 0 0 0 14.241595,19.865445 2.1677748,2.1344245 0 0 0 12.073821,17.730891 Z\";\nconst path_questionmark_min =\n  \"M 12.747,2 C 12.492,1.998 12.234,2.006 11.973,2.023 8.105,2.256 6.071,4.458 5.904,8.427 H 9.806 C 9.839,7.06 10.64,6.025 12.041,5.859 c 1.401,-0.133 2.735,0.2 3.135,1.134 0.434,1.034 -0.534,2.234 -1.001,2.734 -0.867,0.934 -2.268,1.634 -3.002,2.635 -0.7,1.001 -0.834,2.302 -0.901,3.902 h 3.435 c 0.033,-1.034 0.1,-2.001 0.567,-2.635 0.767,-1.034 1.901,-1.501 2.835,-2.335 0.9,-0.767 1.868,-1.701 2.001,-3.168 C 19.642,4.093 16.568,2.023 12.747,2 Z M 12.074,17.731 A 2.168,2.134 0 0 0 9.906,19.865 2.168,2.134 0 0 0 12.074,22 2.168,2.134 0 0 0 14.242,19.865 2.168,2.134 0 0 0 12.074,17.731 Z\";\nconst path_arrow =\n  \"M12.93 4.26l6.15 14.99c.34.83-.51 1.66-1.33 1.29l-5.34-2.36c-.26-.11-.55-.11-.81 0l-5.34 2.36c-.82.36-1.67-.46-1.33-1.29l6.15-14.99c.33-.83 1.51-.83 1.85 0z\";\nconst path_idle =\n  \"M 12,2 C 8.13,2 5,5.13 5,9 c 0,5.25 7,13 7,13 0,0 7,-7.75 7,-13 0,-3.87 -3.13,-7 -7,-7\";\n//const path_landed =\n//  \"M 12.662857,19.784264 19.12,15.167121 C 19.668572,14.77855 20,14.149978 20,13.475692 20,11.772835 18.08,10.789978 16.697143,11.772835 L 12,15.121407 7.302857,11.772835 C 5.92,10.778549 4,11.772835 4,13.475692 c 0,0.674286 0.331429,1.314286 0.88,1.702858 l 6.457143,4.617142 c 0.4,0.274286 0.925714,0.274286 1.325714,-0.01143 z m 0,-8 L 19.12,7.1785496 C 19.668572,6.7785496 20,6.1499781 20,5.4756924 20,3.7728353 18.08,2.7785495 16.697143,3.7728353 L 12,7.1214067 7.302857,3.7728353 C 5.92,2.7785495 4,3.7728353 4,5.4756924 4,6.1499781 4.331429,6.7899782 4.88,7.1785496 l 6.457143,4.6171424 c 0.4,0.274286 0.925714,0.274286 1.325714,-0.01143 z\";\nconst path_landed_min =\n  \"m 12.66,19.78 6.46,-4.61 C 19.67,14.78 20,14.15 20,13.48 20,11.77 18.08,10.79 16.7,11.77 L 12,15.12 7.3,11.77 c -1.38,-0.99 -3.3,0 -3.3,1.71 0,0.67 0.33,1.31 0.88,1.7 l 6.46,4.62 c 0.4,0.27 0.93,0.27 1.33,-0.01 z m 0,-8 6.46,-4.6 C 19.67,6.78 20,6.15 20,5.48 20,3.77 18.08,2.78 16.7,3.77 L 12,7.12 7.3,3.77 C 5.92,2.78 4,3.77 4,5.48 4,6.15 4.33,6.79 4.88,7.18 l 6.46,4.62 c 0.4,0.27 0.93,0.27 1.33,-0.01 z\";\n\nexport const getPilotIconColor = name => string2color(name, 70);\nexport const getPilotTrackColor = name => string2color(name, 40);\n\nexport const pilotIconChanged = (oldPilotIcon, newPilotIcon) => {\n  for (let p in oldPilotIcon) {\n    if (!(p in newPilotIcon)) return true;\n  }\n  for (let p in newPilotIcon) {\n    if (!(p in oldPilotIcon)) return true;\n    // Special cases\n    if (p === \"anchor\") {\n      if (\n        oldPilotIcon[p].x !== newPilotIcon[p].x ||\n        oldPilotIcon[p].y !== newPilotIcon[p].y\n      )\n        return true;\n    } else if (oldPilotIcon[p] !== newPilotIcon[p]) {\n      return true;\n    }\n  }\n  return false;\n};\n\nexport const getPilotIcon = (\n  waitingForStart,\n  endOfTrack,\n  hasLanded,\n  pos,\n  velocityVec,\n  color\n) => {\n  /*\n    Four different symbols:\n      - Flying\n      - Signal lost\n      - Landed\n      - Not yet started (idle)\n  */\n\n  if (endOfTrack) {\n    if (hasLanded) {\n      // LANDED\n      return {\n        path: path_landed_min,\n        fillColor: color,\n        fillOpacity: 1,\n        anchor: { x: 12, y: 20 },\n        strokeWeight: 1,\n        scale: 1.2\n      };\n    } else {\n      // SIGNAL LOST\n      return {\n        path: path_questionmark_min,\n        fillColor: color,\n        fillOpacity: 1,\n        anchor: { x: 12, y: 12 },\n        strokeWeight: 1,\n        scale: 1.2\n      };\n    }\n  }\n\n  if (waitingForStart) {\n    // NOT YET STARTED\n    return {\n      path: path_idle,\n      fillColor: color,\n      fillOpacity: 1,\n      anchor: { x: 12, y: 22 },\n      strokeWeight: 1,\n      scale: 1.2\n    };\n  }\n\n  // Compute direction\n  const bearing =\n    velocityVec === null\n      ? 0\n      : getRhumbLineBearing(pos, {\n          lat: pos.lat + velocityVec.lat,\n          lng: pos.lng + velocityVec.lng\n        });\n\n  // FLYING\n  return {\n    path: path_arrow,\n    fillColor: color,\n    fillOpacity: 1,\n    anchor: { x: 12, y: 12 },\n    strokeWeight: 1,\n    scale: 1.2,\n    rotation: bearing\n  };\n};\n","import { getXContestInterface } from \"../location_provider/XContest/XContestInterface\";\nimport { getSetting, Settings } from \"../common/PersistentState/Settings\";\n\nclass MapViewportControllerService {\n  constructor() {\n    this.mapControllers = [];\n\n    // The state of the viewport controller service\n    this.state = {\n      includeSelf: getSetting(Settings.GPS_SHOWN).getValue(),\n      enabled: true,\n      followSinglePilot: null,\n      pilots: {},\n    };\n\n    // Register for animation frame updates\n    getXContestInterface().animation.registerCallback(this.onAnimationFrame);\n\n    // Register for changes in GPS_SHOWN setting\n    getSetting(Settings.GPS_SHOWN).registerCallback(this.onSelfShownChanged);\n  }\n\n  setState = (val) => {\n    this.state = { ...this.state, ...val };\n  };\n\n  // Disables the controllers, enables manual mode\n  setFreeMode = () => {\n    this.setState({ enabled: false });\n  };\n\n  // Follows a single pilot\n  setSinglePilotMode = (pilotId) => {\n    this.setState({\n      enabled: true,\n      followSinglePilot: pilotId,\n    });\n    this._emitZoomToSinglePilot();\n  };\n\n  setFollowMode = () => {\n    this.setState({\n      enabled: true,\n      followSinglePilot: null,\n    });\n  };\n\n  // Sends single pilot mode signal to controllers\n  _emitZoomToSinglePilot = () => {\n    for (const mapController of this.mapControllers) {\n      mapController.zoomToSinglePilot();\n    }\n  };\n\n  // When GPS_SHOWN setting changed\n  onSelfShownChanged = (value) => {\n    this.setState({\n      includeSelf: value,\n    });\n  };\n\n  // Update this and every registered map controller.\n  onAnimationFrame = ({ pilotData_filtered }) => {\n    // Add new pilots, remove old pilots\n    const oldState = this.state;\n    const newState = { ...oldState };\n    newState.pilots = { ...newState.pilots };\n\n    // Remove old pilots\n    for (const pilotName in oldState.pilots) {\n      if (!(pilotName in pilotData_filtered)) {\n        delete newState.pilots[pilotName];\n      }\n    }\n\n    // Add new pilots\n    for (const pilotName in pilotData_filtered) {\n      if (!(pilotName in newState.pilots)) {\n        newState.pilots[pilotName] = true;\n      }\n    }\n\n    this.state = newState;\n\n    for (const mapController of this.mapControllers) {\n      mapController.onAnimationFrame(pilotData_filtered, this.state);\n    }\n  };\n\n  // All other map controllers register here.\n  registerMapController = (controller) => {\n    if (!this.mapControllers.includes(controller))\n      this.mapControllers.push(controller);\n  };\n\n  // All other map controllers unregister here.\n  unregisterMapController = (controller) => {\n    const index = this.mapControllers.indexOf(controller);\n    if (index >= 0) {\n      this.mapControllers.splice(index, 1);\n    }\n  };\n}\n\n// Singleton\nlet _instance = null;\nexport const getMapViewportControllerService = () => {\n  if (!_instance) {\n    _instance = new MapViewportControllerService();\n  }\n  return _instance;\n};\n","import {\n  getPilotIcon,\n  getPilotIconColor,\n  getPilotTrackColor,\n  pilotIconChanged,\n} from \"../../common/PilotIcon\";\nimport { getMapViewportControllerService } from \"../../services/MapViewportControllerService\";\n\nexport default class GoogleMapsTrack {\n  constructor(\n    google,\n    map,\n    pilotId,\n    initialData,\n    pilotInfoWindow,\n    onMouseOver,\n    canOpenInfoWindow\n  ) {\n    this.google = google;\n    this.pilotInfoWindow = pilotInfoWindow;\n    this.pilotColor = getPilotIconColor(pilotId);\n    this.trackColor = getPilotTrackColor(pilotId);\n\n    this.pilotIcon = getPilotIcon(\n      initialData.startOfTrack,\n      initialData.endOfTrack,\n      initialData.landed,\n      initialData.pos,\n      initialData.velocityVec,\n      this.pilotColor\n    );\n\n    this.marker = new this.google.maps.Marker({\n      map: map,\n      position: initialData.pos,\n      title: initialData.name,\n      icon: this.pilotIcon,\n    });\n\n    this.marker.addListener(\"click\", () => {\n      if (canOpenInfoWindow()) {\n        this.pilotInfoWindow.open(this.map, this.marker, pilotId);\n      }\n    });\n\n    this.marker.addListener(\"dblclick\", () => {\n      getMapViewportControllerService().setSinglePilotMode(pilotId);\n    });\n\n    this.marker.addListener(\"mousedown\", ({ tb }) => {\n      onMouseOver(true, this.computeIconBottomLeftCornerPos(tb));\n    });\n    this.marker.addListener(\"mouseup\", () => {\n      onMouseOver(false, null);\n    });\n    this.marker.addListener(\"mouseover\", ({ tb }) => {\n      onMouseOver(true, this.computeIconBottomLeftCornerPos(tb));\n    });\n    this.marker.addListener(\"mouseout\", () => {\n      onMouseOver(false, null);\n    });\n\n    this.track = new this.google.maps.Polyline({\n      map: map,\n      path: [],\n      strokeColor: this.trackColor,\n    });\n    this.currentTrackVersion = { startTime: null, endTime: null, length: null };\n    this.newestTrackSegment = new this.google.maps.Polyline({\n      map: map,\n      path: [],\n      strokeColor: this.trackColor,\n    });\n    this.newestTrackSegmentData = null;\n  }\n\n  computeIconBottomLeftCornerPos = (mouseEvent) => {\n    // Hacky. Gets the bottom left corner of the pilot marker icon.\n    // Uses the event target absolute screen positions and width\n    // to compute the middle of the icon, then moves 13 to the bottom left,\n    // as all pilot icons are 24 in size.\n    const target = mouseEvent.target;\n\n    // Get mouse position\n    let mouseX = mouseEvent.pageX;\n    let mouseY = mouseEvent.pageY;\n    if (\n      \"touches\" in mouseEvent &&\n      (mouseX === undefined || mouseY === undefined)\n    ) {\n      mouseX = mouseEvent.touches[0].pageX;\n      mouseY = mouseEvent.touches[0].pageY;\n    }\n\n    // Initialization\n    let left = target.x;\n    let top = target.y;\n    let width = target.width;\n    let height = target.height;\n    let isValid = () => {\n      return (\n        mouseX >= left &&\n        mouseX <= left + width &&\n        mouseY >= top &&\n        mouseY <= top + height\n      );\n    };\n\n    // First attempt: Most devices.\n    left = target.x;\n    top = target.y;\n    width = target.width;\n    height = target.height;\n\n    // Second attempt: chrome on android\n    if (!isValid()) {\n      console.log(\"First result invalid! Trying android version...\");\n      left = target.x / window.devicePixelRatio;\n      top = target.y / window.devicePixelRatio;\n      width = target.width;\n      height = target.height;\n    }\n\n    if (!isValid()) {\n      console.log(\"Second result invalid! Returning raw mouse coords.\");\n      return { left: mouseX, top: mouseY };\n    }\n\n    const popupRight = left + width / 2 - 13;\n    const popupTop = top + height / 2 + 13;\n    return { left: popupRight, top: popupTop };\n  };\n\n  setMap = (map) => {\n    this.marker.setMap(map);\n    this.track.setMap(map);\n    this.newestTrackSegment.setMap(map);\n  };\n\n  _updateTrack = (track) => {\n    if (!track || track.length < 1) return;\n\n    // Compute identifiers to reduce the amount if maps updates\n    const length = track.length;\n    const startTime = track[0].timestamp;\n    const endTime = track[length - 1].timestamp;\n    if (\n      startTime === this.currentTrackVersion.startTime &&\n      endTime === this.currentTrackVersion.endTime &&\n      length === this.currentTrackVersion.length\n    ) {\n      return;\n    }\n\n    if (\n      startTime === this.currentTrackVersion.startTime &&\n      length > this.currentTrackVersion.length &&\n      endTime > this.currentTrackVersion.endTime\n    ) {\n      let oldTrack = this.track.getPath();\n      let oldLength = oldTrack.getLength();\n      while (oldLength < length) {\n        const newPoint = track[oldLength];\n        oldLength = oldTrack.push(\n          new this.google.maps.LatLng(newPoint.lat, newPoint.lng)\n        );\n      }\n\n      this.currentTrackVersion.endTime = endTime;\n      this.currentTrackVersion.length = length;\n      return;\n    }\n\n    //console.log(\"Full path update!\");\n\n    // If the start/end time or length changed, update track in map\n    this.currentTrackVersion.startTime = startTime;\n    this.currentTrackVersion.endTime = endTime;\n    this.currentTrackVersion.length = length;\n\n    this.track.setPath(track);\n  };\n\n  _updateNewestSegment = (trackEndPos, currentPos) => {\n    // Initialize if unset\n    if (this.newestTrackSegmentData === null) {\n      this.newestTrackSegment.setPath([trackEndPos, currentPos]);\n      this.newestTrackSegmentData = [trackEndPos, currentPos];\n      //console.log(\"Set newest track segment new\");\n    }\n\n    // Query previous and update previous\n    const [previousTrackEndPos, previousPos] = this.newestTrackSegmentData;\n    this.newestTrackSegmentData = [trackEndPos, currentPos];\n\n    // Get maps polyline\n    const path = this.newestTrackSegment.getPath();\n\n    // Update first piont if necessary\n    if (\n      trackEndPos.lat !== previousTrackEndPos.lat ||\n      trackEndPos.lng !== previousTrackEndPos.lng\n    ) {\n      const point = new this.google.maps.LatLng(\n        trackEndPos.lat,\n        trackEndPos.lng\n      );\n      path.setAt(0, point);\n      //console.log(\"Set trackEndPos\");\n    }\n\n    if (\n      previousPos.lat !== currentPos.lat ||\n      previousPos.lng !== currentPos.lng\n    ) {\n      const point = new this.google.maps.LatLng(currentPos.lat, currentPos.lng);\n      path.setAt(1, point);\n      //console.log(\"Set currentPos\");\n    }\n  };\n\n  updateData = (data) => {\n    this.marker.setPosition(data.pos);\n\n    // Update Pilot Icon if necessary\n    let pilotIcon = this.marker.getIcon();\n    const newPilotIcon = getPilotIcon(\n      data.startOfTrack,\n      data.endOfTrack,\n      data.landed,\n      data.pos,\n      data.velocityVec,\n      this.pilotColor\n    );\n    if (pilotIconChanged(pilotIcon, newPilotIcon))\n      this.marker.setIcon(newPilotIcon);\n\n    if (data.track.length > 0) {\n      const currentPos = data.track[data.track.length - 1];\n      const trackEndPos = data.pos;\n      this._updateNewestSegment(trackEndPos, currentPos);\n    }\n    this._updateTrack(data.track);\n  };\n}\n","export default class MapPilotInfoWindow {\n  constructor(google) {\n    this.google = google;\n    this.infoWindow = new google.maps.InfoWindow({\n      content: \"- ERROR -\",\n      pixelOffset: new google.maps.Size(0, -5),\n      disableAutoPan: true,\n    });\n    this.data = {};\n    this.currentPilot = null;\n  }\n\n  open = (map, anchor, pilotId) => {\n    this.currentPilot = pilotId;\n    this.infoWindow.open(map, anchor);\n    this.updateContent();\n  };\n\n  close = () => {\n    this.infoWindow.close();\n    this.currentPilot = null;\n    this.updateContent();\n  };\n\n  update = (data) => {\n    this.data = data;\n    this.updateContent();\n  };\n\n  updateContent = () => {\n    // Some sanity checks\n    if (this.infoWindow.anchor == null) {\n      this.currentPilot = null;\n      return;\n    }\n\n    if (this.currentPilot === null) return;\n\n    if (!(this.currentPilot in this.data)) {\n      this.currentPilot = null;\n      this.infoWindow.close();\n      return;\n    }\n\n    const pilotInfo = this.data[this.currentPilot];\n\n    const height =\n      pilotInfo.gpsAlt === null ? pilotInfo.baroAlt : pilotInfo.gpsAlt;\n    const heightGnd = Math.max(height - pilotInfo.elevation, 0);\n\n    // Update content\n    let newContent = \"\";\n    newContent += \"<b>\" + pilotInfo.name + \"</b>\";\n    if (height !== null && heightGnd !== null) {\n      newContent += \"<br>\";\n      newContent += Math.round(height) + \"m (\";\n      newContent += Math.round(heightGnd) + \"m)<br>\";\n    }\n\n    if (\n      pilotInfo.baroVario !== null &&\n      !(pilotInfo.endOfTrack && pilotInfo.landed)\n    ) {\n      const vario = Math.round(pilotInfo.baroVario * 10);\n      let varioAbs = Math.abs(vario);\n      if (varioAbs > 99) varioAbs = 99;\n      const varioStr =\n        (vario >= 0 ? \"&plus;\" : \"&minus;\") +\n        Math.floor(varioAbs / 10) +\n        \".\" +\n        (varioAbs % 10) +\n        \"m/s\";\n      newContent += \"<span>\" + varioStr + \"</span>&nbsp;&nbsp;\";\n    }\n\n    if (\n      pilotInfo.velocity !== null &&\n      !(pilotInfo.endOfTrack && pilotInfo.landed)\n    ) {\n      newContent += Math.round(pilotInfo.velocity * 3.6) + \"km/h\";\n    }\n\n    if (this.infoWindow.getContent() !== newContent) {\n      this.infoWindow.setContent(newContent);\n    }\n  };\n}\n","import GoogleMapsTrack from \"./GoogleMapsTrack\";\nimport MapPilotInfoWindow from \"./MapPilotInfoWindow\";\n\nexport default class MapAnimator {\n  constructor(map, google, canReceiveMouseClicks) {\n    this.map = map;\n    this.google = google;\n    this.tracks = {};\n    this.infoWindow = new MapPilotInfoWindow(google);\n    this.currentMouseOvers = {};\n    this.canReceiveMouseClicks = canReceiveMouseClicks;\n  }\n\n  cleanupOldTracks = (data) => {\n    const toRemove = [];\n    for (const pilot in this.tracks) {\n      if (!(pilot in data)) {\n        toRemove.push(pilot);\n      }\n    }\n    for (const pilot of toRemove) {\n      this.tracks[pilot].setMap(null);\n      delete this.tracks[pilot];\n    }\n  };\n\n  onMouseOver = (pilotId, isOver, pagePos) => {\n    if (isOver) {\n      if (!(pilotId in this.currentMouseOvers))\n        this.currentMouseOvers[pilotId] = { num: 0, pos: { left: 0, top: 0 } };\n      this.currentMouseOvers[pilotId].num += 1;\n      if (pagePos != null) {\n        this.currentMouseOvers[pilotId].pos = pagePos;\n      }\n    } else {\n      if (pilotId in this.currentMouseOvers) {\n        this.currentMouseOvers[pilotId].num -= 1;\n        if (this.currentMouseOvers[pilotId].num <= 0) {\n          delete this.currentMouseOvers[pilotId];\n        }\n      }\n    }\n  };\n\n  update = ({ pilotData_filtered }) => {\n    // Remove tracks that we unsubscribed from\n    this.cleanupOldTracks(pilotData_filtered);\n\n    // Update all pilots\n    Object.entries(pilotData_filtered).forEach(([pilot, pilotData]) => {\n      // Add track if it doesn't exist\n      if (!(pilot in this.tracks)) {\n        this.tracks[pilot] = new GoogleMapsTrack(\n          this.google,\n          this.map,\n          pilot,\n          pilotData,\n          this.infoWindow,\n          (isOver, pagePos) => this.onMouseOver(pilot, isOver, pagePos),\n          this.canReceiveMouseClicks\n        );\n      }\n\n      // Update all tracks properties\n      const track = this.tracks[pilot];\n      track.updateData(pilotData);\n    });\n\n    this.infoWindow.update(pilotData_filtered);\n  };\n}\n","import { getSetting, Settings } from \"../common/PersistentState/Settings\";\n\nclass GPSProvider {\n  constructor() {\n    this._callbacks = [];\n    this._watchId = null;\n    this._gpsData = null;\n\n    let gpsEnabledSetting = getSetting(Settings.GPS_ENABLED);\n    gpsEnabledSetting.registerCallback(this._updateGPSState);\n    this._updateGPSState();\n  }\n\n  _updateGPSState = () => {\n    let gpssettingEnabled = getSetting(Settings.GPS_ENABLED).getValue();\n    let callbackRegistered = this._callbacks.length > 0;\n\n    let enableGps = gpssettingEnabled && callbackRegistered;\n\n    if (this._watchId === null && enableGps && navigator.geolocation) {\n      this._watchId = navigator.geolocation.watchPosition(\n        this._onNewGPSData,\n        this._onGPSError,\n        { enableHighAccuracy: true }\n      );\n      console.log(\"GPS: On\");\n    }\n\n    if (this._watchId !== null && !enableGps) {\n      navigator.geolocation.clearWatch(this._watchId);\n      this._watchId = null;\n      this._setGPSData(null);\n      console.log(\"GPS: Off\");\n    }\n\n    //console.log(\"UPDATE_GPS_STATE\", enableGps, this._callbacks.length);\n  };\n\n  _setGPSData = (data) => {\n    //console.debug(\"GPS DATA:\", data);\n    this._gpsData = data;\n    for (const cb of this._callbacks) {\n      cb(data);\n    }\n  };\n\n  _onNewGPSData = (data) => {\n    this._setGPSData(data);\n  };\n  _onGPSError = () => {\n    this._setGPSData(null);\n  };\n\n  registerCallback = (cb) => {\n    if (!this._callbacks.includes(cb)) this._callbacks.push(cb);\n    this._updateGPSState();\n    cb(this._gpsData);\n  };\n\n  unregisterCallback = (cb) => {\n    const index = this._callbacks.indexOf(cb);\n    if (index >= 0) {\n      this._callbacks.splice(index, 1);\n    }\n    this._updateGPSState();\n  };\n\n  getData = () => {\n    return this._gpsData;\n  };\n}\n\n// Singleton stuff\nlet _instance = null;\nexport const getGPSProvider = () => {\n  if (!_instance) {\n    _instance = new GPSProvider();\n  }\n  return _instance;\n};\n","import { getMapViewportControllerService } from \"../../services/MapViewportControllerService\";\nimport { getGPSProvider } from \"../../services/GPSProvider\";\n\nexport default class GoogleMapsController {\n  constructor(google, map) {\n    this.google = google;\n    this.map = map;\n    this.lastUpdate = Date.now();\n\n    this.gpsState = getGPSProvider().getData();\n    getGPSProvider().registerCallback(this.onGpsUpdate);\n\n    this.viewportInitialized = false;\n    this.singlePersonMode = false;\n\n    this.userInputListeners = [map.addListener(\"dragstart\", this.onUserInput)];\n\n    this.insideMapsApiFunction = false;\n  }\n\n  zoomToSinglePilot = () => {\n    this.insideMapsApiFunction = true;\n    if (this.map.getZoom() < 12) this.map.setZoom(12);\n    this.insideMapsApiFunction = false;\n  };\n\n  shutdown = () => {\n    // Do nothing -- seems broken atm\n    //  for (let userInputListener in this.userInputListeners) {\n    //    userInputListener.remove();\n    //}\n    getGPSProvider().unregisterCallback(this.onGpsUpdate);\n  };\n\n  onGpsUpdate = (gpsData) => {\n    this.gpsState = gpsData;\n  };\n\n  onUserInput = () => {\n    if (!this.insideMapsApiFunction)\n      getMapViewportControllerService().setFreeMode();\n  };\n\n  updateViewport = (watchedCoords) => {\n    const previousSinglePersonMode = this.singlePersonMode;\n    this.singlePersonMode = false;\n\n    if (watchedCoords.length === 0) {\n      return;\n    }\n\n    if (watchedCoords.length === 1) {\n      this.insideMapsApiFunction = true;\n      this.map.panTo(watchedCoords[0]);\n      this.insideMapsApiFunction = false;\n\n      if (!previousSinglePersonMode) {\n        this.zoomToSinglePilot();\n      }\n      this.singlePersonMode = true;\n      return;\n    }\n\n    let bounds = new this.google.maps.LatLngBounds(\n      watchedCoords[0],\n      watchedCoords[0]\n    );\n\n    watchedCoords.forEach((coord) => bounds.extend(coord));\n\n    this.insideMapsApiFunction = true;\n    this.map.fitBounds(bounds);\n    this.insideMapsApiFunction = false;\n  };\n\n  onAnimationFrame = (pilotInfos, controllerState) => {\n    // Set initial map position after map creations\n    if (!this.viewportInitialized) {\n      let watchedCoords = [];\n\n      for (const [, pilotInfo] of Object.entries(pilotInfos)) {\n        watchedCoords.push(pilotInfo.pos);\n      }\n\n      if (this.gpsState) {\n        watchedCoords.push({\n          lat: this.gpsState.coords.latitude,\n          lng: this.gpsState.coords.longitude,\n        });\n      }\n\n      if (watchedCoords.length !== 0) {\n        this.updateViewport(watchedCoords);\n        this.viewportInitialized = true;\n      }\n    }\n\n    // Don't do anything if the controller is disabled\n    if (!controllerState.enabled) {\n      // Run a viewport update anyway, to register that we currently\n      // don't view anyone. Important for registering when we have to\n      // zoom in.\n      this.updateViewport([]);\n      return;\n    }\n\n    // If followSinglePilot is set,\n    if (controllerState.followSinglePilot !== null) {\n      const pilotName = controllerState.followSinglePilot;\n      if (pilotName in pilotInfos) {\n        this.updateViewport([pilotInfos[pilotName].pos]);\n        return;\n      }\n    }\n\n    let watchedCoords = [];\n    if (controllerState.includeSelf) {\n      if (this.gpsState) {\n        watchedCoords.push({\n          lat: this.gpsState.coords.latitude,\n          lng: this.gpsState.coords.longitude,\n        });\n      }\n    }\n    for (const [pilotName, enabled] of Object.entries(controllerState.pilots)) {\n      if (enabled && pilotName in pilotInfos) {\n        watchedCoords.push(pilotInfos[pilotName].pos);\n      }\n    }\n    this.updateViewport(watchedCoords);\n  };\n}\n","export const createButtonIcon = (svgPath, viewBox) => {\n  const xmlns = \"http://www.w3.org/2000/svg\";\n\n  let svgEl = document.createElementNS(xmlns, \"svg\");\n  svgEl.setAttribute(\"width\", \"24\");\n  svgEl.setAttribute(\"height\", \"24\");\n  svgEl.setAttribute(\"viewBox\", viewBox);\n\n  let pathEl = document.createElementNS(xmlns, \"path\");\n  pathEl.setAttribute(\"d\", svgPath);\n\n  svgEl.appendChild(pathEl);\n  return svgEl;\n};\n\nexport const createSatelliteIcon = () =>\n  createButtonIcon(\n    \"M8.57 6H6v2.58c1.42 0 2.57-1.16 2.57-2.58zM12 6h-1.71c0 2.36-1.92 4.29-4.29 4.29V12c3.32 0 6-2.69 6-6zm2.14 5.86l-3 3.87L9 13.15 6 17h12z\",\n    \"0 0 24 24\"\n  );\n\nexport const createFocusCameraIcon = () =>\n  createButtonIcon(\n    \"M10 30h-4v8c0 2.21 1.79 4 4 4h8v-4h-8v-8zm0-20h8v-4h-8c-2.21 0-4 1.79-4 4v8h4v-8zm28-4h-8v4h8v8h4v-8c0-2.21-1.79-4-4-4zm0 32h-8v4h8c2.21 0 4-1.79 4-4v-8h-4v8zm-14-22c-4.42 0-8 3.58-8 8s3.58 8 8 8 8-3.58 8-8-3.58-8-8-8zm0 12c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4z\",\n    \"-10 -10 68 68\"\n  );\n\nexport const createGpsDisabledIcon = () =>\n  createButtonIcon(\n    \"M20.94 11c-.46-4.17-3.77-7.48-7.94-7.94V1h-2v2.06c-1.13.12-2.19.46-3.16.97l1.5 1.5C10.16 5.19 11.06 5 12 5c3.87 0 7 3.13 7 7 0 .94-.19 1.84-.52 2.65l1.5 1.5c.5-.96.84-2.02.97-3.15H23v-2h-2.06zM3 4.27l2.04 2.04C3.97 7.62 3.25 9.23 3.06 11H1v2h2.06c.46 4.17 3.77 7.48 7.94 7.94V23h2v-2.06c1.77-.2 3.38-.91 4.69-1.98L19.73 21 21 19.73 4.27 3 3 4.27zm13.27 13.27C15.09 18.45 13.61 19 12 19c-3.87 0-7-3.13-7-7 0-1.61.55-3.09 1.46-4.27l9.81 9.81z\",\n    \"-6 -6 36 36\"\n  );\n\nexport const createGpsActiveIcon = () =>\n  createButtonIcon(\n    \"M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3c-.46-4.17-3.77-7.48-7.94-7.94V1h-2v2.06C6.83 3.52 3.52 6.83 3.06 11H1v2h2.06c.46 4.17 3.77 7.48 7.94 7.94V23h2v-2.06c4.17-.46 7.48-3.77 7.94-7.94H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z\",\n    \"-6 -6 36 36\"\n  );\n\nexport const createGpsInactiveIcon = () =>\n  createButtonIcon(\n    \"M20.94 11c-.46-4.17-3.77-7.48-7.94-7.94V1h-2v2.06C6.83 3.52 3.52 6.83 3.06 11H1v2h2.06c.46 4.17 3.77 7.48 7.94 7.94V23h2v-2.06c4.17-.46 7.48-3.77 7.94-7.94H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z\",\n    \"-6 -6 36 36\"\n  );\n","import { createSatelliteIcon } from \"./ButtonIcons\";\n\nexport function createSatelliteMapButton(google, map) {\n  // Create a div to hold the control.\n  var controlDiv = document.createElement(\"div\");\n\n  // Set CSS for the control border\n  var controlUI = document.createElement(\"div\");\n  controlUI.classList.add(\"custom-google-maps-button\");\n  controlUI.title = \"Toggle satellite view\";\n  controlUI.appendChild(createSatelliteIcon());\n  controlDiv.appendChild(controlUI);\n\n  controlDiv.onclick = () => {\n    if (map.getMapTypeId() === google.maps.MapTypeId.HYBRID) {\n      map.setMapTypeId(google.maps.MapTypeId.TERRAIN);\n    } else {\n      map.setMapTypeId(google.maps.MapTypeId.HYBRID);\n    }\n  };\n\n  return controlDiv;\n}\n","import { createFocusCameraIcon } from \"./ButtonIcons\";\nimport { getMapViewportControllerService } from \"../../../services/MapViewportControllerService\";\n\nexport function createFocusCameraMapButton(google, map) {\n  // Create a div to hold the control.\n  var controlDiv = document.createElement(\"div\");\n\n  // Set CSS for the control border\n  var controlUI = document.createElement(\"div\");\n  controlUI.classList.add(\"custom-google-maps-button\");\n  controlUI.title = \"Focus camera\";\n  controlUI.appendChild(createFocusCameraIcon());\n  controlDiv.appendChild(controlUI);\n\n  controlDiv.onclick = () => {\n    getMapViewportControllerService().setFollowMode();\n  };\n\n  return controlDiv;\n}\n","import { createGpsActiveIcon, createGpsDisabledIcon } from \"./ButtonIcons\";\nimport { getSetting, Settings } from \"../../../common/PersistentState/Settings\";\n\nexport function createDisplayGpsMapButton(google, map) {\n  // Create a div to hold the control.\n  var controlDiv = document.createElement(\"div\");\n  controlDiv.onclick = () => {\n    const gpsShownSetting = getSetting(Settings.GPS_SHOWN);\n    gpsShownSetting.setValue(!gpsShownSetting.getValue());\n  };\n\n  updateGpsMapButton(controlDiv, getSetting(Settings.GPS_SHOWN).getValue());\n\n  return controlDiv;\n}\n\nexport function updateGpsMapButton(controlDiv, gpsShown) {\n  let controlUI = controlDiv.firstChild;\n  if (controlUI === null) {\n    // Set CSS for the control border\n    controlUI = document.createElement(\"div\");\n    controlUI.classList.add(\"custom-google-maps-button\");\n    controlUI.title = \"Toggle GPS\";\n    controlUI.appendChild(createGpsActiveIcon());\n    controlUI.appendChild(createGpsDisabledIcon());\n    controlDiv.appendChild(controlUI);\n  }\n\n  if (gpsShown) {\n    controlUI.childNodes[0].style.display = null;\n    controlUI.childNodes[1].style.display = \"none\";\n  } else {\n    controlUI.childNodes[0].style.display = \"none\";\n    controlUI.childNodes[1].style.display = null;\n  }\n}\n","const longPressDuration =\n  navigator.platform.indexOf(\"iPhone\") !== -1 ||\n  navigator.platform.indexOf(\"iPad\") !== -1 ||\n  navigator.platform.indexOf(\"iPod\") !== -1\n    ? 400\n    : 400;\n\nexport default class ContextMenuHandler {\n  constructor(callback) {\n    this.callback = callback;\n    this.longPressCountdown = null;\n    this.contextMenuPossible = false;\n    this.currentTouch = null;\n  }\n\n  onTouchStart = (e) => {\n    //console.log(this.toString(), \"onTouchStart\");\n    this.contextMenuPossible = true;\n\n    const touch = e.touches[0];\n    this.currentTouch = touch;\n\n    this.longPressCountdown = setTimeout(() => {\n      this.contextMenuPossible = false;\n      this.callback(touch);\n      //console.log(this.toString(), \"CONTEXT_MENU\");\n    }, longPressDuration);\n  };\n\n  onTouchMove = (e) => {\n    //console.log(this.toString(), \"onTouchMove\");\n    const touch = e.touches[0];\n    if (this.currentTouch !== null) {\n      const dX = this.currentTouch.pageX - touch.pageX;\n      const dY = this.currentTouch.pageY - touch.pageY;\n\n      // Don't register if touch moved less than 10 pixels.\n      // Important as on google maps, raises onTouchMove events even\n      // for sub-pixel jitter\n      if (dX * dX + dY * dY < 100) {\n        return;\n      }\n    }\n\n    clearTimeout(this.longPressCountdown);\n  };\n\n  onTouchCancel = (e) => {\n    //console.log(this.toString(), \"onTouchCancel\");\n    this.currentTouch = null;\n    this.contextMenuPossible = false;\n    clearTimeout(this.longPressCountdown);\n  };\n\n  onTouchEnd = (e) => {\n    //console.log(this.toString(), \"onTouchEnd\");\n    this.currentTouch = null;\n    this.contextMenuPossible = false;\n    clearTimeout(this.longPressCountdown);\n  };\n\n  onContextMenu = (e) => {\n    //console.log(this.toString(), \"onContextMenu\");\n    this.contextMenuPossible = false;\n\n    clearTimeout(this.longPressCountdown);\n\n    this.callback(e);\n    e.preventDefault();\n  };\n}\n","import { registerPersistentState } from \"./PersistentState\";\n\nconst TabID = registerPersistentState(\"global.tab_id\", 1);\nconst switchToMap = () => {\n  TabID.setValue(0);\n};\n\nexport default {\n  TabID,\n  switchToMap\n};\n","import React from \"react\";\n\nimport {\n  Popover,\n  List,\n  ListItem,\n  ListItemText,\n  ListItemIcon,\n  ListSubheader,\n} from \"@material-ui/core\";\n\nimport PlayArrowIcon from \"@material-ui/icons/PlayArrow\";\nimport DeleteIcon from \"@material-ui/icons/Delete\";\n//import DirectionsIcon from \"@material-ui/icons/Directions\";\nimport StarRateIcon from \"@material-ui/icons/StarRate\";\nimport RoomIcon from \"@material-ui/icons/Room\";\nimport { navigateTo } from \"../../util/MapLinks\";\nimport PageState from \"../../common/PersistentState/PageState\";\nimport {\n  setPilotShown,\n  removePilots,\n} from \"../../common/PersistentState/ChosenPilots\";\nimport { getMapViewportControllerService } from \"../../services/MapViewportControllerService\";\n\nexport default class ContextMenu extends React.PureComponent {\n  generateMenuEntry = (icon, text, action, disabled = false) => (\n    <ListItem\n      button\n      onClick={disabled ? undefined : action}\n      disabled={disabled}\n    >\n      <ListItemIcon>{icon}</ListItemIcon>\n      <ListItemText>{text}</ListItemText>\n    </ListItem>\n  );\n\n  close = () => {\n    this.props.onClose();\n  };\n\n  onDelete = () => {\n    const pilotId = this.props.data.pilotId;\n    removePilots([pilotId]);\n\n    this.close();\n  };\n\n  onNavigateTo = () => {\n    const lastFix = this.props.data.pilotInfo.lastFix;\n    navigateTo({ lat: lastFix.lat, lng: lastFix.lon });\n\n    this.close();\n  };\n\n  onShowOnMap = () => {\n    const pilotId = this.props.data.pilotId;\n    PageState.switchToMap();\n    getMapViewportControllerService().setSinglePilotMode(pilotId);\n\n    this.close();\n  };\n\n  onHidePilot = () => {\n    const pilotId = this.props.data.pilotId;\n    setPilotShown(pilotId, false);\n\n    this.close();\n  };\n\n  onUnhidePilot = () => {\n    const pilotId = this.props.data.pilotId;\n    setPilotShown(pilotId, true);\n\n    this.close();\n  };\n\n  render() {\n    const { data } = this.props;\n\n    const onMap = \"onMap\" in this.props;\n    const offline = data !== null ? data.offline : null;\n    const lastFix = data !== null ? data.pilotInfo.lastFix : null;\n\n    return (\n      <Popover\n        open={data !== null && data.open}\n        anchorReference=\"anchorPosition\"\n        anchorPosition={data === null ? null : data.pos}\n        transformOrigin={{\n          vertical: \"top\",\n          horizontal: \"right\",\n        }}\n        onClose={this.close}\n      >\n        <List\n          dense\n          subheader={\n            onMap && data !== null ? (\n              <ListSubheader>\n                {data === null ? null : data.pilotInfo.name}\n              </ListSubheader>\n            ) : null\n          }\n        >\n          {!onMap && !offline\n            ? this.generateMenuEntry(\n                <PlayArrowIcon />,\n                \"Show Pilot on Map\",\n                this.onShowOnMap\n              )\n            : null}\n          {/*this.generateMenuEntry(\n            <DirectionsIcon />,\n            \"Live Navigation\",\n            () => {},\n            true\n          )*/}\n          {offline\n            ? null\n            : data !== null && data.pilotInfo.shown\n            ? this.generateMenuEntry(\n                <StarRateIcon />,\n                \"Hide Pilot\",\n                this.onHidePilot\n              )\n            : this.generateMenuEntry(\n                <StarRateIcon />,\n                \"Unhide Pilot\",\n                this.onUnhidePilot\n              )}\n          {this.generateMenuEntry(\n            <RoomIcon />,\n            offline ? \"Last Observed Position\" : \"Open in Maps\",\n            this.onNavigateTo,\n            lastFix === null\n          )}\n          {this.generateMenuEntry(\n            <DeleteIcon />,\n            \"Remove Pilot\",\n            this.onDelete\n          )}\n        </List>\n      </Popover>\n    );\n  }\n}\n","export function navigateTo(pos) {\n  if (\n    /* if we're on iOS, open in Apple Maps */\n    navigator.platform.indexOf(\"iPhone\") !== -1 ||\n    navigator.platform.indexOf(\"iPad\") !== -1 ||\n    navigator.platform.indexOf(\"iPod\") !== -1\n  )\n    window.open(\n      \"https://maps.apple.com/maps?q=\" +\n        pos.lat.toString() +\n        \",\" +\n        pos.lng.toString()\n    );\n  /* else use Google */ else\n    window.open(\n      \"https://maps.google.com/maps?q=\" +\n        pos.lat.toString() +\n        \",\" +\n        pos.lng.toString()\n    );\n}\n","import React from \"react\";\nimport Box from \"@material-ui/core/Box\";\nimport { loadGoogleMapsApi } from \"../../common/GoogleMapsApiLoader\";\nimport { LoadingPage, ErrorPage } from \"../StatusPages\";\nimport mapStyle from \"./MapStyle.json\";\nimport { getXContestInterface } from \"../../location_provider/XContest/XContestInterface\";\nimport MapAnimator from \"./MapAnimator\";\nimport \"./gm-style-overrides.css\";\nimport { createGeolocationMarker } from \"../../ext/geolocation-marker\";\nimport { getSetting, Settings } from \"../../common/PersistentState/Settings\";\nimport { getMapViewportControllerService } from \"../../services/MapViewportControllerService\";\nimport GoogleMapsController from \"./GoogleMapsController\";\n\nimport \"./CustomButtons/CustomButtons.css\";\nimport { createSatelliteMapButton } from \"./CustomButtons/SatelliteMapButton\";\nimport { createFocusCameraMapButton } from \"./CustomButtons/FocusCameraMapButton\";\nimport {\n  createDisplayGpsMapButton,\n  updateGpsMapButton,\n} from \"./CustomButtons/DisplayGpsMapButton\";\nimport { getGPSProvider } from \"../../services/GPSProvider\";\nimport ContextMenuHandler from \"../../util/ContextMenuHandler\";\nimport ContextMenu from \"../common/ContextMenu\";\nimport { getChosenPilots } from \"../../common/PersistentState/ChosenPilots\";\n\nexport default class LiveMap extends React.PureComponent {\n  constructor() {\n    super();\n\n    this.map = null;\n    this.google = null;\n    this.mapAnimator = null;\n\n    this.mapsRef = React.createRef();\n    this.cleanups = [];\n\n    this.state = {\n      mapReady: false,\n      mapError: false,\n      contextMenu: null,\n    };\n\n    this.contextMenuHandler = new ContextMenuHandler(this.onContextMenu);\n\n    this.initializeGoogleMapsApi();\n  }\n\n  initializeGoogleMapsApi = () => {\n    const mapsApiLoadingState = { canceled: false };\n\n    this.cleanups.push(() => {\n      mapsApiLoadingState.canceled = true;\n    });\n\n    loadGoogleMapsApi()\n      .then(() => {\n        if (mapsApiLoadingState.canceled) return;\n        this.google = window.google;\n        this.setState({ mapReady: true });\n      })\n      .catch((e) => {\n        if (mapsApiLoadingState.canceled) return;\n        console.log(\"Map error:\", e);\n        this.setState({ mapError: true });\n      });\n  };\n\n  initializeMapIfNecessary = () => {\n    if (!this.state.mapReady || this.state.mapError) return;\n\n    if (this.map !== null) return;\n\n    this.map = new this.google.maps.Map(this.mapsRef.current, {\n      center: { lat: 46.509012, lng: 11.827984 },\n      mapTypeId: \"terrain\",\n      zoom: 5,\n      maxZoom: 15,\n      disableDefaultUI: true,\n      zoomControl: true,\n      scaleControl: true,\n      fullscreenControl: true,\n      styles: mapStyle,\n    });\n\n    const map = this.map;\n    const google = this.google;\n\n    // Register map type callback\n    map.addListener(\"maptypeid_changed\", () => {\n      if (map.getMapTypeId() === google.maps.MapTypeId.TERRAIN) {\n        map.setOptions({ maxZoom: 15 });\n      } else {\n        map.setOptions({ maxZoom: 50 });\n      }\n    });\n\n    // Add custom map controls\n    map.controls[google.maps.ControlPosition.TOP_LEFT].push(\n      createSatelliteMapButton(google, map)\n    );\n    const gpsMapButton = createDisplayGpsMapButton(google, map);\n    map.controls[google.maps.ControlPosition.TOP_LEFT].push(gpsMapButton);\n    map.controls[google.maps.ControlPosition.RIGHT_TOP].push(\n      createFocusCameraMapButton(google, map)\n    );\n\n    // Update gps button on change\n    let mapButtonUpdater = (value) => {\n      updateGpsMapButton(gpsMapButton, value);\n    };\n    getSetting(Settings.GPS_SHOWN).registerCallback(mapButtonUpdater);\n    this.cleanups.push(() => {\n      getSetting(Settings.GPS_SHOWN).unregisterCallback(mapButtonUpdater);\n    });\n\n    // Map animator\n    this.mapAnimator = new MapAnimator(\n      map,\n      google,\n      () => this.state.contextMenu === null || !this.state.contextMenu.open\n    );\n    const mapAnimatorUpdateCallback = this.mapAnimator.update;\n    getXContestInterface().animation.registerCallback(\n      mapAnimatorUpdateCallback\n    );\n    this.cleanups.push(() => {\n      getXContestInterface().animation.unregisterCallback(\n        mapAnimatorUpdateCallback\n      );\n    });\n\n    const geolocationMarker = createGeolocationMarker(google, null);\n    geolocationMarker.setPositionOptions({ enableHighAccuracy: true });\n\n    // enable/disable geolocation marker on change\n    const geolocationMarkerUpdateState = () => {\n      let enabled = getSetting(Settings.GPS_ENABLED).getValue();\n      let shown = getSetting(Settings.GPS_SHOWN).getValue();\n      if (enabled && shown) {\n        geolocationMarker.setMap(map);\n        // Manually update the position to trigger a redrawing.\n        // Kinda hacky, workaround to bug in geolocationMarker\n        const currentGPSData = getGPSProvider().getData();\n        if (currentGPSData !== null)\n          geolocationMarker.updatePosition_(currentGPSData);\n      } else {\n        geolocationMarker.setMap(null);\n      }\n    };\n    geolocationMarkerUpdateState();\n    getSetting(Settings.GPS_ENABLED).registerCallback(\n      geolocationMarkerUpdateState\n    );\n    getSetting(Settings.GPS_SHOWN).registerCallback(\n      geolocationMarkerUpdateState\n    );\n    this.cleanups.push(() => {\n      // Unregister connection between GPS_ENABLED setting and geolocationMarker\n      getSetting(Settings.GPS_ENABLED).unregisterCallback(\n        geolocationMarkerUpdateState\n      );\n      getSetting(Settings.GPS_SHOWN).unregisterCallback(\n        geolocationMarkerUpdateState\n      );\n\n      // Disable geolocationMarker\n      geolocationMarker.setMap(null);\n    });\n\n    // Register Map Controller\n    let mapController = new GoogleMapsController(google, map);\n    getMapViewportControllerService().registerMapController(mapController);\n    this.cleanups.push(() => {\n      // Unregister Map Controller\n      getMapViewportControllerService().unregisterMapController(mapController);\n\n      // Shutdown mapController\n      mapController.shutdown();\n    });\n\n    this.mapInitialized = true;\n  };\n\n  componentDidMount() {\n    this.initializeMapIfNecessary();\n  }\n\n  componentDidUpdate() {\n    this.initializeMapIfNecessary();\n  }\n\n  componentWillUnmount() {\n    [...this.cleanups].reverse().forEach((cleanup) => cleanup());\n  }\n\n  onContextMenu = (e) => {\n    if (this.mapAnimator == null) return;\n\n    // Get pilot, if any selected\n    const mouseOvers = Object.keys(this.mapAnimator.currentMouseOvers);\n    if (mouseOvers.length < 1) return;\n    const pilotId = mouseOvers[0];\n    const pos = this.mapAnimator.currentMouseOvers[pilotId].pos;\n\n    // Get whether or not the pilot is currently shown\n    const chosenPilots = getChosenPilots();\n    if (!(pilotId in chosenPilots)) return;\n    const pilotInfo = chosenPilots[pilotId];\n\n    this.setState({\n      contextMenu: {\n        pilotId,\n        pos,\n        pilotInfo,\n        open: true,\n      },\n    });\n  };\n\n  hideContextMenu = () => {\n    this.setState({ contextMenu: { ...this.state.contextMenu, open: false } });\n  };\n\n  render() {\n    return (\n      <React.Fragment>\n        <Box // Shown if ready,!error\n          width=\"100%\"\n          height=\"100%\"\n          display={\n            this.state.mapReady && !this.state.mapError ? \"block\" : \"none\"\n          }\n          ref={this.mapsRef}\n          onWheel={() => {\n            // Free camera on mouse wheel\n            getMapViewportControllerService().setFreeMode();\n          }}\n          onTouchStart={this.contextMenuHandler.onTouchStart}\n          onTouchMove={this.contextMenuHandler.onTouchMove}\n          onTouchCancel={this.contextMenuHandler.onTouchCancel}\n          onTouchEnd={this.contextMenuHandler.onTouchEnd}\n          onContextMenu={(e) => {\n            this.contextMenuHandler.onContextMenu(e);\n            e.preventDefault();\n          }}\n        ></Box>\n        <LoadingPage // Shown if !ready,!error\n          message=\"Loading Maps ...\"\n          hideIf={this.state.mapReady || this.state.mapError}\n        ></LoadingPage>\n        <ErrorPage // Shown if !ready,error and ready,error\n          message=\"Unable to load map!\"\n          hideIf={!this.state.mapError}\n        ></ErrorPage>\n        <ContextMenu\n          onMap\n          data={this.state.contextMenu}\n          onClose={this.hideContextMenu}\n        />\n      </React.Fragment>\n    );\n  }\n}\n","/**\n * @license geolocation-marker\n * @copyright 2012, 2015 Chad Killingsworth\n * @see https://github.com/ChadKillingsworth/geolocation-marker/blob/master/LICENSE.txt\n */\n\n/**\n * @name GeolocationMarker for Google Maps v3\n * @version version 1.1\n * @author Chad Killingsworth [chadkillingsworth at gmail.com]\n * Copyright 2012\n * @fileoverview\n * This library uses geolocation to add a marker and accuracy circle to a map.\n * The marker position is automatically updated as the user position changes.\n */\n\nexport function createGeolocationMarker(google, map) {\n  class GeolocationMarker extends google.maps.MVCObject {\n    /**\n     * @param {google.maps.Map=} opt_map\n     * @param {(google.maps.MarkerOptions|Object.<string>)=} opt_outerMarkerOpts\n     * @param {(google.maps.MarkerOptions|Object.<string>)=} opt_markerOpts\n     * @param {(google.maps.CircleOptions|Object.<string>)=} opt_circleOpts\n     */\n    constructor(opt_map, opt_outerMarkerOpts, opt_markerOpts, opt_circleOpts) {\n      super();\n\n      /**\n       * @private\n       * @type {google.maps.Marker}\n       */\n      this.outerMarker_ = null;\n\n      /**\n       * @private\n       * @type {google.maps.Marker}\n       */\n      this.marker_ = null;\n\n      /**\n       * @private\n       * @type {google.maps.Circle}\n       */\n      this.circle_ = null;\n\n      /**\n       * @private\n       * @type {number}\n       */\n      this.watchId_ = -1;\n\n      var outerMarkerOpts = {\n        clickable: false,\n        cursor: \"pointer\",\n        draggable: false,\n        flat: true,\n        icon: {\n          path: google.maps.SymbolPath.CIRCLE,\n          fillColor: \"#C8D6EC\",\n          fillOpacity: 0.7,\n          scale: 12,\n          strokeWeight: 0\n        },\n        position: new google.maps.LatLng(0, 0),\n        title: \"Current location\",\n        zIndex: 2\n      };\n\n      var markerOpts = {\n        clickable: false,\n        cursor: \"pointer\",\n        draggable: false,\n        flat: true,\n        icon: {\n          path: google.maps.SymbolPath.CIRCLE,\n          fillColor: \"#4285F4\",\n          fillOpacity: 1,\n          scale: 6,\n          strokeColor: \"white\",\n          strokeWeight: 2\n        },\n        // This marker may move frequently - don't force canvas tile redraw\n        optimized: false,\n        position: new google.maps.LatLng(0, 0),\n        title: \"Current location\",\n        zIndex: 3\n      };\n\n      if (opt_outerMarkerOpts) {\n        outerMarkerOpts = this.copyOptions_(\n          outerMarkerOpts,\n          opt_outerMarkerOpts\n        );\n      }\n\n      if (opt_markerOpts) {\n        markerOpts = this.copyOptions_(markerOpts, opt_markerOpts);\n      }\n\n      var circleOpts = {\n        clickable: false,\n        radius: 0,\n        strokeColor: \"1bb6ff\",\n        strokeOpacity: 0.4,\n        fillColor: \"61a0bf\",\n        fillOpacity: 0.4,\n        strokeWeight: 1,\n        zIndex: 1\n      };\n\n      if (opt_circleOpts) {\n        circleOpts = this.copyOptions_(circleOpts, opt_circleOpts);\n      }\n\n      this.outerMarker_ = new google.maps.Marker(outerMarkerOpts);\n      this.marker_ = new google.maps.Marker(markerOpts);\n      this.circle_ = new google.maps.Circle(circleOpts);\n\n      google.maps.MVCObject.prototype.set.call(this, \"accuracy\", null);\n      google.maps.MVCObject.prototype.set.call(this, \"position\", null);\n      google.maps.MVCObject.prototype.set.call(this, \"map\", null);\n\n      this.set(\"minimum_accuracy\", null);\n\n      this.set(\"position_options\" /** GeolocationPositionOptions */, {\n        enableHighAccuracy: true,\n        maximumAge: 1000\n      });\n\n      this.circle_.bindTo(\"map\", this.outerMarker_);\n      this.circle_.bindTo(\"map\", this.marker_);\n\n      if (opt_map) {\n        this.setMap(opt_map);\n      }\n    }\n\n    /**\n     * @override\n     * @param {string} key\n     * @param {*} value\n     */\n    set(key, value) {\n      if (GeolocationMarker.invalidPropertiesExpr_.test(key)) {\n        throw new Error(\"'\" + key + \"' is a read-only property.\");\n      } else if (key === \"map\") {\n        this.setMap(/** @type {google.maps.Map} */ (value));\n      } else {\n        google.maps.MVCObject.prototype.set.call(this, key, value);\n      }\n    }\n\n    /** @return {google.maps.Map} */\n    getMap() {\n      return /** @type {google.maps.Map|null} */ (this.get(\"map\"));\n    }\n\n    /** @return {GeolocationPositionOptions} */\n    getPositionOptions() {\n      return /** @type {GeolocationPositionOptions} */ (this.get(\n        \"position_options\"\n      ));\n    }\n\n    /** @param {!GeolocationPositionOptions|!Object.<string, *>} positionOpts */\n    setPositionOptions(positionOpts) {\n      this.set(\"position_options\", positionOpts);\n    }\n\n    /** @return {google.maps.LatLng|null} */\n    getPosition() {\n      return /** @type {google.maps.LatLng|null} */ (this.get(\"position\"));\n    }\n\n    /** @return {google.maps.LatLngBounds?} */\n    getBounds() {\n      if (this.get(\"position\")) {\n        return this.circle_.getBounds();\n      } else {\n        return null;\n      }\n    }\n\n    /** @return {number|null} */\n    getAccuracy() {\n      return /** @type {number|null} */ (this.get(\"accuracy\"));\n    }\n\n    /** @return {number|null} */\n    getMinimumAccuracy() {\n      return /** @type {number|null} */ (this.get(\"minimum_accuracy\"));\n    }\n\n    /** @param {number|null} accuracy */\n    setMinimumAccuracy(accuracy) {\n      this.set(\"minimum_accuracy\", accuracy);\n    }\n\n    /** @param {google.maps.Map|null} map */\n    setMap(map) {\n      google.maps.MVCObject.prototype.set.call(this, \"map\", map);\n      if (map) {\n        this.watchPosition_();\n      } else {\n        this.outerMarker_.unbind(\"position\");\n        this.marker_.unbind(\"position\");\n        this.circle_.unbind(\"center\");\n        this.circle_.unbind(\"radius\");\n        google.maps.MVCObject.prototype.set.call(this, \"accuracy\", null);\n        google.maps.MVCObject.prototype.set.call(this, \"position\", null);\n        navigator.geolocation.clearWatch(this.watchId_);\n        this.watchId_ = -1;\n        this.outerMarker_.setMap(map);\n        this.marker_.setMap(map);\n      }\n    }\n\n    /** @param {google.maps.MarkerOptions|Object.<string>} outerMarkerOpts */\n    setOuterMarkerOptions(outerMarkerOpts) {\n      this.outerMarker_.setOptions(this.copyOptions_({}, outerMarkerOpts));\n    }\n\n    /** @param {google.maps.MarkerOptions|Object.<string>} markerOpts */\n    setMarkerOptions(markerOpts) {\n      this.marker_.setOptions(this.copyOptions_({}, markerOpts));\n    }\n\n    /** @param {google.maps.CircleOptions|Object.<string>} circleOpts */\n    setCircleOptions(circleOpts) {\n      this.circle_.setOptions(this.copyOptions_({}, circleOpts));\n    }\n\n    /**\n     * @private\n     * @param {GeolocationPosition} position\n     */\n    updatePosition_(position) {\n      var newPosition = new google.maps.LatLng(\n          position.coords.latitude,\n          position.coords.longitude\n        ),\n        mapNotSet = this.marker_.getMap() == null;\n\n      if (mapNotSet) {\n        if (\n          this.getMinimumAccuracy() != null &&\n          position.coords.accuracy > this.getMinimumAccuracy()\n        ) {\n          return;\n        }\n        this.outerMarker_.setMap(this.getMap());\n        this.marker_.setMap(this.getMap());\n        this.outerMarker_.bindTo(\"position\", this);\n        this.marker_.bindTo(\"position\", this);\n        this.circle_.bindTo(\"center\", this, \"position\");\n        this.circle_.bindTo(\"radius\", this, \"accuracy\");\n      }\n\n      if (this.getAccuracy() !== position.coords.accuracy) {\n        // The local set method does not allow accuracy to be updated\n        google.maps.MVCObject.prototype.set.call(\n          this,\n          \"accuracy\",\n          position.coords.accuracy\n        );\n      }\n\n      if (\n        mapNotSet ||\n        this.getPosition() == null ||\n        !this.getPosition().equals(newPosition)\n      ) {\n        // The local set method does not allow position to be updated\n        google.maps.MVCObject.prototype.set.call(this, \"position\", newPosition);\n      }\n    }\n\n    /**\n     * @private\n     */\n    watchPosition_() {\n      if (navigator.geolocation) {\n        this.watchId_ = navigator.geolocation.watchPosition(\n          this.updatePosition_.bind(this),\n          this.geolocationError_.bind(this),\n          this.getPositionOptions()\n        );\n      }\n    }\n\n    /**\n     * @private\n     * @param {GeolocationPositionError} data\n     */\n    geolocationError_(data) {\n      google.maps.event.trigger(this, \"geolocation_error\", data);\n    }\n\n    /**\n     * @private\n     * @param {Object.<string,*>} target\n     * @param {Object.<string,*>} source\n     * @return {Object.<string,*>}\n     */\n    copyOptions_(target, source) {\n      for (var opt in source) {\n        if (GeolocationMarker.DISALLOWED_OPTIONS[opt] !== true) {\n          target[opt] = source[opt];\n        }\n      }\n      return target;\n    }\n  }\n\n  /**\n   * @const\n   * @type {Object.<string, boolean>}\n   */\n  GeolocationMarker.DISALLOWED_OPTIONS = {\n    map: true,\n    position: true,\n    radius: true\n  };\n\n  /**\n   * @private\n   * @const\n   */\n  GeolocationMarker.invalidPropertiesExpr_ = /^(?:position|accuracy)$/i;\n\n  //export default GeolocationMarker;\n  return new GeolocationMarker(map);\n}\n","const ourHistory = [];\n\nwindow.addEventListener(\n  \"popstate\",\n  () => {\n    if (ourHistory.length === 0) {\n      console.warn(\"History was already 0!\");\n    }\n    const callback = ourHistory.pop();\n    //console.debug(\"- History size:\", ourHistory.length);\n    if (ourHistory.length > 0) window.history.pushState({}, \"\");\n    if (callback) callback();\n  },\n  { passive: true }\n);\n\nexport const useHistory = () => {\n  const pushFunction = (cb) => {\n    const histSize = ourHistory.length;\n    ourHistory.push(cb);\n    //console.debug(\"+ History size:\", ourHistory.length);\n    if (histSize === 0) {\n      window.history.pushState({}, \"\");\n    }\n  };\n\n  const popFunction = () => {\n    //console.log(\"window.history.back()\", window.history.length);\n    window.history.back();\n  };\n\n  return { push: pushFunction, pop: popFunction };\n};\n","import React from \"react\";\nimport { useState } from \"react\";\nimport { Dialog } from \"@material-ui/core\";\nimport { useHistory } from \"../common/History\";\n\n// The difficult here is to fire exactly one history.back() for any case.\n// Cases:\n// - \"open\" changes to 'false'\n// - \"Dialog.onClose()\" => same as previous, as can be forwarded\n// - History gets reverted\n\nconst SubWindow = (props) => {\n  const [open, _setOpen] = useState(false);\n  const [historyOpen, _setHistoryOpen] = useState(false);\n  const history = useHistory();\n\n  const openWindow = () => {\n    // TODO create history entry\n    history.push(() => {\n      _setOpen(false);\n      props.onClose();\n    });\n    _setOpen(true);\n    _setHistoryOpen(true);\n  };\n\n  // If we should be open, initiate a window opening.\n  // Special case: if we just closed the window, don't immediately re-open it,\n  // but signal the parent class to close instead.\n  React.useEffect(() => {\n    if (props.open && !open) {\n      if (historyOpen) {\n        // This creates an endless feedback loop if props.onClose doesn't set\n        // props.open to false. Therefore we require props.onClose to do so.\n        props.onClose();\n\n        // To further prevent the feedback loop, we now set the history open state.\n        // Now, if props.onClose failed to set props.open to false, the window\n        // will immediately re-open.\n        // Currently commented out, because it proved unstable and caused state\n        // fluctuations.\n        //_setHistoryOpen(false);\n      } else {\n        openWindow();\n      }\n    }\n  });\n\n  // If both the external and internal state agree that the window is now close,\n  // reset the history state. The history state prevents the window\n  // from immediately re-opening if the external and internal states disagree.\n  if (historyOpen && !open && !props.open) {\n    _setHistoryOpen(false);\n  }\n\n  // If we are open, the history entry still exists.\n  // Therefore, go back in history if we get signalled to close.\n  if (open && !props.open) {\n    history.pop();\n  }\n\n  return (\n    <Dialog\n      open={open}\n      onClose={() => {\n        props.onClose();\n      }}\n      fullScreen={props.fullScreen}\n      maxWidth={props.maxWidth}\n      fullWidth={props.fullWidth}\n      classes={props.classes}\n    >\n      {props.children}\n    </Dialog>\n  );\n};\n\nexport default SubWindow;\n","export const getRotationStyle = bearing => {\n  const transform = \"rotate(\" + bearing.toString() + \"deg)\";\n\n  const rotationStyle = {\n    transform: transform,\n\n    /* Safari */\n    WebkitTransform: transform,\n\n    /* Firefox */\n    MozTransform: transform,\n\n    /* IE */\n    msTransform: transform,\n\n    /* Opera */\n    OTransform: transform\n  };\n  return rotationStyle;\n};\n","import React from \"react\";\nimport { getGPSProvider } from \"../services/GPSProvider\";\nimport { getDistance, getRhumbLineBearing } from \"geolib\";\nimport { getRotationStyle } from \"./Rotation\";\n\nfunction formatTimeDiff(millis) {\n  let negative = \"\";\n\n  if (millis < 0) {\n    millis = -millis;\n    negative = \"-\";\n  }\n\n  let secs = Math.floor(millis / 1000);\n  if (secs < 90) {\n    return negative + secs + \" sec\";\n  }\n\n  let mins = Math.floor(secs / 60);\n  if (mins < 60) {\n    return negative + mins + \" min\";\n  }\n\n  let hours = Math.floor(mins / 60);\n  mins = mins - hours * 60;\n  if (hours < 24) {\n    return negative + hours + \":\" + mins.toString().padStart(2, \"0\") + \" h\";\n  }\n\n  let days = Math.floor(hours / 24);\n  hours = hours - days * 24;\n  return (\n    negative +\n    days +\n    \"d \" +\n    hours +\n    \":\" +\n    mins.toString().padStart(2, \"0\") +\n    \" h\"\n  );\n}\n\nfunction timestampToTimeString(timestamp) {\n  let time = new Date(timestamp);\n  return time.toLocaleTimeString();\n}\n\nexport class LastFixState extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.msgRef = React.createRef();\n  }\n\n  getMessage = ({ timestamp, endOfTrack, landed, relative, showLastFix }) => {\n    if (timestamp == null) {\n      return [\"\", \"never\"];\n    }\n    let time_diff = new Date(timestamp).getTime() - Date.now();\n\n    let timeStr = \"\";\n    if (relative) timeStr = formatTimeDiff(time_diff);\n    else timeStr = timestampToTimeString(timestamp);\n\n    if (endOfTrack && landed) {\n      return [\"#346B8F\", \"\\u2714 \" + timeStr];\n    }\n\n    if (-time_diff < 120000 && !endOfTrack) {\n      if (relative)\n        if (showLastFix) return [\"green\", \"\\u26ab LIVE (\" + timeStr + \")\"];\n        else return [\"green\", \"\\u26ab LIVE\"];\n      else return [\"green\", \"\\u26ab \" + timeStr];\n    }\n\n    if (relative) return [\"red\", \"! LIVE (\" + timeStr + \")\"];\n    else return [\"red\", \"! \" + timeStr];\n  };\n\n  shallowRerender = props => {\n    if (this.msgRef.current !== null) {\n      const msgSpan = this.msgRef.current;\n      const [color, message] = this.getMessage(props);\n      Object.assign(msgSpan.style, { color: color });\n\n      if (msgSpan.innerHTML !== message) {\n        msgSpan.innerHTML = message;\n      }\n    }\n  };\n\n  render() {\n    const [color, message] = this.getMessage(this.props);\n    return (\n      <span style={{ color: color }} ref={this.msgRef}>\n        {message}\n      </span>\n    );\n  }\n}\n\nexport class LastFixArrow extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.gpsData = getGPSProvider().getData();\n\n    this.distanceRef = React.createRef();\n    this.arrowRef = React.createRef();\n    this.lastFix = this.props.lastFix;\n  }\n\n  onNewGPSDataReceived = gpsData => {\n    this.gpsData = gpsData;\n\n    // Directly update through the refs\n    this.updateThroughRef();\n  };\n\n  componentDidMount() {\n    getGPSProvider().registerCallback(this.onNewGPSDataReceived);\n  }\n  componentWillUnmount() {\n    getGPSProvider().unregisterCallback(this.onNewGPSDataReceived);\n  }\n\n  setFix = newFix => {\n    this.lastFix = newFix;\n\n    // Directly update through the refs\n    this.updateThroughRef();\n  };\n\n  updateThroughRef = () => {\n    if (this.arrowRef.current) {\n      const arrowStyle = LastFixArrow.getArrowRotationStyle(\n        this.gpsData,\n        this.lastFix\n      );\n      Object.assign(this.arrowRef.current.style, arrowStyle);\n    }\n    if (this.distanceRef.current) {\n      const newDistance = LastFixArrow.getDistance(this.gpsData, this.lastFix);\n      if (newDistance !== this.distanceRef.current.innerHTML)\n        this.distanceRef.current.innerHTML = newDistance;\n    }\n  };\n\n  static getDistance(myPosition, pilotFix) {\n    if (myPosition === null || pilotFix === null) return \"--km\";\n\n    const distance = getDistance(\n      { lat: myPosition.coords.latitude, lng: myPosition.coords.longitude },\n      pilotFix\n    );\n    return (Math.round(distance / 100) / 10).toString() + \"km\";\n  }\n\n  static getArrowRotationStyle(myPosition, pilotFix) {\n    if (myPosition === null || pilotFix === null) return getRotationStyle(0);\n    const bearing = getRhumbLineBearing(\n      { lat: myPosition.coords.latitude, lng: myPosition.coords.longitude },\n      pilotFix\n    );\n    return getRotationStyle(bearing);\n  }\n\n  render() {\n    this.lastFix = this.props.lastFix;\n    return (\n      <React.Fragment>\n        <span ref={this.distanceRef}>\n          {LastFixArrow.getDistance(this.gpsData, this.lastFix)}\n        </span>{\" \"}\n        <div\n          ref={this.arrowRef}\n          style={{\n            display: \"inline-block\",\n            ...LastFixArrow.getArrowRotationStyle(this.gpsData, this.lastFix)\n          }}\n        >\n          \n        </div>\n      </React.Fragment>\n    );\n  }\n}\n","import React from \"react\";\nimport { TableCell, Typography, Box, withStyles } from \"@material-ui/core\";\nimport { LastFixState, LastFixArrow } from \"../../util/LastFixState\";\n\nexport const headerHeight = 37;\nexport const rowHeight = 57;\n\nconst NoWrapTypography = withStyles({\n  root: {\n    whiteSpace: \"nowrap\",\n    width: 0,\n  },\n})(Typography);\n\nexport const TableHeader = () => {\n  return (\n    <TableCell\n      component=\"div\"\n      variant=\"head\"\n      className=\"MuiTableCell-stickyHeader\"\n      style={{\n        height: headerHeight,\n        display: \"flex\",\n        alignItems: \"center\",\n        boxSizing: \"border-box\",\n      }}\n    >\n      <div style={{ flex: \"1\" }}>Name</div>\n      <div style={{ width: \"25%\", textAlign: \"right\" }}>State</div>\n      <div style={{ width: \"27%\", textAlign: \"right\" }}>Country</div>\n    </TableCell>\n  );\n};\n\nclass PilotSelectorListRow extends React.PureComponent {\n  render() {\n    const {\n      fullname,\n      username,\n      lastFix,\n      timestamp,\n      landed,\n      iso,\n      disabled,\n    } = this.props;\n\n    return (\n      <div\n        style={{\n          width: \"100%\",\n          height: \"100%\",\n          display: \"flex\",\n          alignItems: \"center\",\n          boxSizing: \"border-box\",\n          filter: disabled ? \"grayscale(100%) opacity(30%)\" : undefined,\n        }}\n      >\n        <Box\n          flex=\"1\"\n          overflow=\"hidden\"\n          paddingLeft={1}\n          paddingTop={1}\n          paddingBottom={1}\n        >\n          <NoWrapTypography variant=\"body2\">{fullname}</NoWrapTypography>\n          <NoWrapTypography\n            variant=\"caption\"\n            color=\"textSecondary\"\n            style={{ paddingLeft: \".5em\" }}\n          >\n            [{username}]\n          </NoWrapTypography>\n        </Box>\n        <div style={{ width: \"25%\", textAlign: \"right\" }}>\n          <div>\n            <Typography variant=\"caption\">\n              <LastFixState\n                timestamp={timestamp}\n                landed={landed}\n                endOfTrack={landed}\n                relative\n              />\n            </Typography>\n          </div>\n          <div>\n            <Typography variant=\"caption\">\n              <LastFixArrow lastFix={lastFix} />\n            </Typography>\n          </div>\n        </div>\n        <div style={{ width: \"27%\", textAlign: \"right\" }}>\n          <Box paddingRight={1} paddingLeft={1}>\n            {iso}\n            <Box\n              fontSize=\"large\"\n              marginLeft=\"4px\"\n              boxShadow={1}\n              style={{ verticalAlign: \"middle\" }}\n              className={\"flag-icon flag-icon-\" + iso.toLowerCase()}\n            ></Box>\n          </Box>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport const renderRow = ({ data, index, style }) => {\n  const pilotId = data.keys[index];\n  const pilotData = data.data[pilotId];\n\n  const fullname = pilotData ? pilotData.info.user.fullname : \"Offline User\";\n  const username = pilotData ? pilotData.info.user.username : pilotId;\n  const lastFix = pilotData ? pilotData.lastFix : null;\n  const timestamp = pilotData ? pilotData.lastFix.timestamp : null;\n  const landed = pilotData ? pilotData.landed : null;\n  const iso = pilotData ? pilotData.info.user.nationality.iso : \"--\";\n  const selected = data.selected.indexOf(pilotId) !== -1;\n  const disabled = data.alreadyAdded.indexOf(pilotId) !== -1;\n\n  return (\n    <TableCell\n      component=\"div\"\n      variant=\"body\"\n      padding=\"none\"\n      style={{\n        ...style,\n        backgroundColor:\n          selected && !disabled ? \"rgba(0, 0, 0, 0.04)\" : undefined,\n      }}\n      onClick={() => {\n        if (!disabled) data.onPilotClicked(pilotId);\n      }}\n    >\n      <PilotSelectorListRow\n        fullname={fullname}\n        username={username}\n        lastFix={lastFix}\n        timestamp={timestamp}\n        landed={landed}\n        iso={iso}\n        disabled={disabled}\n      />\n    </TableCell>\n  );\n};\n","import React from \"react\";\n\nimport { CircularProgress } from \"@material-ui/core\";\n\nimport { getXContestInterface } from \"../../location_provider/XContest/XContestInterface\";\n\nimport { arraysEqual } from \"../../util/CompareArrays\";\nimport { getGPSProvider } from \"../../services/GPSProvider\";\nimport { getDistance } from \"geolib\";\nimport { renderRow, TableHeader, rowHeight } from \"./PilotSelectorListRenderer\";\nimport { FixedSizeList } from \"react-window\";\nimport AutoSizer from \"react-virtualized-auto-sizer\";\n\nconst filterPilotList = (pilotList, pilotInfos, search) => {\n  const matchesSearch = (name) => {\n    if (search === \"\") {\n      return true;\n    }\n    return name.toLowerCase().includes(search.toLowerCase());\n  };\n\n  // Create virtual pilot if nobody found\n  let filteredPilots = pilotList.filter((pilotId) => {\n    return (\n      matchesSearch(pilotInfos[pilotId].info.user.username) ||\n      matchesSearch(pilotInfos[pilotId].info.user.fullname)\n    );\n  });\n\n  // Add dummy pilot if list is empty and search string is valid\n  if (filteredPilots.length === 0 && !/\\s/.test(search) && search.length > 0) {\n    filteredPilots.push(search);\n  }\n\n  return filteredPilots;\n};\n\nconst sortPilotList = (pilotInfos, gps) => {\n  if (gps) {\n    // If gps, sort by distance\n    const myPos = { lat: gps.coords.latitude, lng: gps.coords.longitude };\n    let distances = Object.entries(pilotInfos).map(([pilotId, data]) => {\n      const distance = getDistance(myPos, data.lastFix);\n      return [pilotId, distance];\n    });\n    distances.sort((el1, el2) => el1[1] - el2[1]);\n    const pilotIds = distances.map((el) => el[0]);\n    return pilotIds;\n  } else {\n    // Else, sort by name\n    let pilotIds = Object.keys(pilotInfos);\n    pilotIds.sort();\n    return pilotIds;\n  }\n};\n\n// The list content\nexport default class PilotSelectorList extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.gpsData = getGPSProvider().getData();\n    const pilotInfos = getXContestInterface().pilotInfos.getValue();\n    this.state = {\n      didMount: false,\n      pilotInfos: pilotInfos,\n      sortedPilotList: sortPilotList(pilotInfos, this.gpsData),\n    };\n  }\n\n  startRendering = () => {\n    this.setState((state) => ({ ...state, didMount: true }));\n  };\n\n  componentDidMount() {\n    getXContestInterface().pilotInfos.registerCallback(this.onNewPilotInfos);\n    getGPSProvider().registerCallback(this.onNewGpsData);\n\n    // This starts the actual rendering, as it can take quite a while.\n    // setTimeout forces the browser to present before loading the table.\n    // without setTimeout, the waiting symbol would never be shown.\n    setTimeout(this.startRendering);\n  }\n\n  componentWillUnmount() {\n    getXContestInterface().pilotInfos.unregisterCallback(this.onNewPilotInfos);\n    getGPSProvider().unregisterCallback(this.onNewGpsData);\n  }\n\n  updatePilotListIfNecessary = () => {\n    const newPilotList = sortPilotList(this.state.pilotInfos, this.gpsData);\n\n    if (!arraysEqual(this.state.sortedPilotList, newPilotList))\n      this.setState((state) => ({ ...state, sortedPilotList: newPilotList }));\n  };\n\n  onNewGpsData = (gpsData) => {\n    // update only if gps position changed pilot list\n    this.gpsData = gpsData;\n    this.updatePilotListIfNecessary();\n  };\n\n  onNewPilotInfos = (pilotInfos) => {\n    // Always update on new pilot infos\n    this.setState((state) => ({\n      ...state,\n      pilotInfos: pilotInfos,\n      sortedPilotList: sortPilotList(pilotInfos, this.gpsData),\n    }));\n  };\n\n  onPilotClicked = (pilotId) => {\n    if (this.props.onPilotClicked) this.props.onPilotClicked(pilotId);\n  };\n\n  render() {\n    if (!this.state.didMount) {\n      return (\n        <div\n          style={{\n            width: \"100%\",\n            display: \"flex\",\n            justifyContent: \"center\",\n            overflow: \"hidden\",\n          }}\n        >\n          <CircularProgress disableShrink style={{ margin: \"2em\" }} />\n        </div>\n      );\n    }\n\n    const displayedPilots = filterPilotList(\n      this.state.sortedPilotList,\n      this.state.pilotInfos,\n      this.props.search\n    );\n\n    return (\n      <React.Fragment>\n        <TableHeader />\n        <div style={{ flex: \"1\" }}>\n          <AutoSizer>\n            {({ height, width }) => (\n              <FixedSizeList\n                width={width}\n                height={height}\n                itemCount={displayedPilots.length}\n                itemSize={rowHeight}\n                itemData={{\n                  keys: displayedPilots,\n                  data: this.state.pilotInfos,\n                  selected: this.props.selected,\n                  alreadyAdded: this.props.alreadyAdded,\n                  onPilotClicked: this.onPilotClicked,\n                }}\n                itemKey={(index, { keys }) => keys[index]}\n              >\n                {renderRow}\n              </FixedSizeList>\n            )}\n          </AutoSizer>\n        </div>\n      </React.Fragment>\n    );\n  }\n}\n","// attach the .equals method to Array's prototype to call it on any array\nexport function arraysEqual(array1, array2) {\n  // if the other array is a falsy value, return\n  if (!array1 || !array2) return false;\n\n  // compare lengths - can save a lot of time\n  if (array1.length !== array2.length) return false;\n\n  for (var i = 0, l = array1.length; i < l; i++) {\n    /*// Check if we have nested arrays\n    if (array1[i] instanceof Array && array2[i] instanceof Array) {\n      // recurse into the nested arrays\n      if (!array1[i].equals(array2[i])) return false;\n    } else */\n    if (array1[i] !== array2[i]) {\n      return false;\n    }\n  }\n  return true;\n}\n","import React from \"react\";\nimport {\n  Box,\n  useMediaQuery,\n  useTheme,\n  Typography,\n  Toolbar\n} from \"@material-ui/core\";\nimport { useState } from \"react\";\n\nimport { lighten, makeStyles } from \"@material-ui/core/styles\";\nimport { Button, DialogActions, TextField } from \"@material-ui/core\";\n\nimport SubWindow from \"../../util/SubWindow\";\nimport PilotSelectorList from \"./PilotSelectorList\";\nimport { pure } from \"recompose\";\n\nconst useStyles = makeStyles({\n  fullHeightWindow: {\n    height: \"100%\"\n  }\n});\n\n// Base window, without the table\nconst PilotSelector = props => {\n  const classes = useStyles();\n  const theme = useTheme();\n  const fullScreen = useMediaQuery(theme.breakpoints.down(\"xs\"));\n\n  // State\n  const [selected, setSelected] = useState([]);\n  const [search, setSearch] = useState(\"\");\n  const numSelected = selected.length;\n\n  const closeWindow = () => {\n    // Reset state\n    setSearch(\"\");\n    setSelected([]);\n    props.onClose();\n  };\n\n  const pilotClicked = name => {\n    const selectedIndex = selected.indexOf(name);\n    let newSelected = [];\n\n    if (selectedIndex === -1) {\n      newSelected = newSelected.concat(selected, name);\n    } else if (selectedIndex === 0) {\n      newSelected = newSelected.concat(selected.slice(1));\n    } else if (selectedIndex === selected.length - 1) {\n      newSelected = newSelected.concat(selected.slice(0, -1));\n    } else if (selectedIndex > 0) {\n      newSelected = newSelected.concat(\n        selected.slice(0, selectedIndex),\n        selected.slice(selectedIndex + 1)\n      );\n    }\n\n    setSelected(newSelected);\n  };\n\n  return (\n    <SubWindow\n      open={props.open}\n      onClose={closeWindow}\n      fullScreen={fullScreen}\n      maxWidth=\"xs\"\n      fullWidth={true}\n      classes={{ paper: classes.fullHeightWindow }}\n    >\n      <Toolbar\n        style={\n          numSelected === 0\n            ? {}\n            : theme.palette.type === \"light\"\n            ? {\n                color: theme.palette.secondary.main,\n                backgroundColor: lighten(theme.palette.secondary.light, 0.85)\n              }\n            : {\n                color: theme.palette.text.primary,\n                backgroundColor: theme.palette.secondary.dark\n              }\n        }\n      >\n        {numSelected > 0 ? (\n          <Typography component=\"div\" color=\"inherit\" variant=\"subtitle1\">\n            {numSelected} selected\n          </Typography>\n        ) : (\n          <Typography component=\"div\" variant=\"h6\" id=\"tableTitle\">\n            Add new pilots:\n          </Typography>\n        )}\n      </Toolbar>\n      <Box paddingLeft=\"1em\" paddingRight=\"1em\" paddingTop=\"4px\">\n        <TextField\n          //autoFocus\n          margin=\"dense\"\n          autoComplete=\"off\"\n          variant=\"outlined\"\n          id=\"search_field\"\n          label=\"Search\"\n          type=\"search\"\n          fullWidth\n          onChange={event => setSearch(event.target.value)}\n        />\n      </Box>\n      <Box\n        flex=\"1 1 auto\"\n        marginY=\"8px\"\n        display=\"flex\"\n        flexDirection=\"column\"\n        alignItems=\"stretch\"\n      >\n        <PilotSelectorList\n          alreadyAdded={props.alreadyAdded}\n          selected={selected}\n          onPilotClicked={pilotClicked}\n          search={search}\n        />\n      </Box>\n      <DialogActions>\n        <Button onClick={closeWindow} color=\"primary\">\n          Cancel\n        </Button>\n        <Button\n          disabled={numSelected === 0}\n          onClick={() => {\n            props.onAddPilots(selected);\n            closeWindow();\n          }}\n          color=\"primary\"\n        >\n          Add\n        </Button>\n      </DialogActions>\n    </SubWindow>\n  );\n};\n\nexport default pure(PilotSelector);\n","import React from \"react\";\nimport { getXContestInterface } from \"../../location_provider/XContest/XContestInterface\";\n\nexport class ElevationHistogram extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.canvasRef = React.createRef();\n    this.maxValueRef = React.createRef();\n    this.minValueRef = React.createRef();\n\n    this.HEIGHT_MARGIN = 50;\n    this.HEIGHT_STEPS = 100;\n    this.COLOR_SKY = \"#aac7ff\";\n    //this.COLOR_GROUND = \"#f2b485\";\n    this.COLOR_GROUND = \"#92b465\";\n    this.COLOR_PILOT = \"#e11\";\n\n    this.lastRenderedTimestamp = 0;\n    this.lastRenderedTrackStart = null;\n  }\n\n  prepareCanvasAndComputeLimits = (canvas, pilotData) => {\n    const dpr = window.devicePixelRatio || 1;\n    const rect = canvas.getBoundingClientRect();\n    canvas.width = rect.width * dpr;\n    canvas.height = rect.height * dpr;\n\n    // If landed, display the elevation histogram of the entire flight\n    if (\n      pilotData.endOfTrack &&\n      pilotData.landed &&\n      pilotData.track.length > 0\n    ) {\n      const finalTimestamp = pilotData.lastPotentialAirTime;\n      const beginningTimestamp = pilotData.track[0].timestamp;\n      return Math.max(1, finalTimestamp - beginningTimestamp);\n    }\n\n    // Return number of minutes to be included in the histogram\n    return 15 * 60;\n  };\n\n  renderCanvas = (\n    canvas,\n    track,\n    minValue,\n    maxValue,\n    timeFrame,\n    currentTime,\n    currentElevation\n  ) => {\n    const dpr = window.devicePixelRatio || 1;\n    const width = canvas.width;\n    const height = canvas.height;\n\n    const getCoord = (time, elevation) => {\n      const x = width * (1 - (currentTime - time) / timeFrame);\n      const y = height * (1 - (elevation - minValue) / (maxValue - minValue));\n      return [x, y];\n    };\n\n    const [, lastKnownElevationY] = getCoord(0, currentElevation);\n\n    let ctx = canvas.getContext(\"2d\", {\n      alpha: false,\n    });\n\n    // paint ground\n    ctx.fillStyle = this.COLOR_GROUND;\n    ctx.fillRect(0, 0, width, height);\n\n    // paint sky\n    ctx.fillStyle = this.COLOR_SKY;\n    ctx.strokeStyle = this.COLOR_PILOT;\n    ctx.beginPath();\n    ctx.moveTo(0, 0);\n    ctx.lineTo(width, 0);\n    ctx.lineTo(width, lastKnownElevationY);\n    let currentY = lastKnownElevationY;\n    for (let i = track.length - 1; i >= 0; i--) {\n      const data = track[i];\n      if (data.timestamp < currentTime - timeFrame) break;\n\n      const [x, y] = getCoord(data.timestamp, data.elevation);\n      ctx.lineTo(x, y);\n\n      currentY = y;\n    }\n    ctx.lineTo(0, currentY);\n    ctx.fill();\n\n    // paint path\n    ctx.lineWidth = 1.5 * dpr;\n    ctx.lineJoin = \"round\";\n    ctx.lineCap = \"round\";\n    ctx.beginPath();\n    for (let i = track.length - 1; i >= 0; i--) {\n      const data = track[i];\n      if (data.timestamp < currentTime - timeFrame) break;\n\n      const [x, y] = getCoord(data.timestamp, data.altitude);\n      if (i === track.length - 1) {\n        ctx.moveTo(x, y);\n      } else {\n        ctx.lineTo(x, y);\n      }\n    }\n    ctx.stroke();\n  };\n\n  shallowRerender = (data, force = false) => {\n    if (!(this.props.pilot in data)) return;\n    if (this.canvasRef.current === null) return;\n    const canvas = this.canvasRef.current;\n\n    // Perpare data\n    const pilotData = data[this.props.pilot];\n    const track = pilotData.track;\n    const currentElevation = pilotData.elevation;\n    const currentTime = pilotData.lastPotentialAirTime;\n    const trackStartTime = track.length > 0 ? track[0].timestamp : null;\n\n    // Only update once per second\n    if (\n      !force &&\n      this.lastRenderedTimestamp === currentTime &&\n      this.lastRenderedTrackStart === trackStartTime\n    )\n      return;\n    this.lastRenderedTimestamp = currentTime;\n    this.lastRenderedTrackStart = trackStartTime;\n\n    // Get current height, as a starting point\n    const currentHeight =\n      pilotData.gpsAlt !== null ? pilotData.gpsAlt : pilotData.baroAlt;\n    if (currentHeight === null) return;\n\n    // Prepare canvas and compute timeframe\n    const timeFrame = this.prepareCanvasAndComputeLimits(canvas, pilotData);\n\n    // Compute max/min value\n    let minValue = currentElevation;\n    let maxValue = currentHeight;\n    for (let i = track.length - 1; i >= 0; i--) {\n      const data = track[i];\n      if (data.timestamp < currentTime - timeFrame) break;\n\n      minValue = Math.min(minValue, data.elevation);\n      maxValue = Math.max(maxValue, data.altitude);\n    }\n    maxValue += this.HEIGHT_MARGIN;\n    minValue -= this.HEIGHT_MARGIN;\n    maxValue = this.HEIGHT_STEPS * Math.ceil(maxValue / this.HEIGHT_STEPS);\n    minValue = this.HEIGHT_STEPS * Math.floor(minValue / this.HEIGHT_STEPS);\n\n    // Render canvas\n    this.renderCanvas(\n      canvas,\n      track,\n      minValue,\n      maxValue,\n      timeFrame,\n      currentTime,\n      currentElevation\n    );\n\n    // Update numbers\n    if (this.maxValueRef.current !== null) {\n      this.maxValueRef.current.textContent = maxValue.toString();\n    }\n    if (this.minValueRef.current !== null) {\n      this.minValueRef.current.textContent = minValue.toString();\n    }\n  };\n\n  onNewAnimationData = ({ pilotData }) => {\n    this.shallowRerender(pilotData);\n  };\n\n  shallowFetchDataAndRerender = (force = false) => {\n    this.shallowRerender(\n      getXContestInterface().animation.getData().pilotData,\n      force\n    );\n  };\n\n  componentDidMount = () => {\n    this.shallowFetchDataAndRerender();\n    getXContestInterface().animation.registerCallback(this.onNewAnimationData);\n    window.addEventListener(\"resize\", this.onSizeChanged);\n  };\n  componentDidUpdate = () => {\n    this.shallowFetchDataAndRerender();\n  };\n  componentWillUnmount() {\n    window.removeEventListener(\"resize\", this.onSizeChanged);\n    getXContestInterface().animation.unregisterCallback(\n      this.onNewAnimationData\n    );\n  }\n\n  onSizeChanged = () => {\n    this.shallowFetchDataAndRerender(true);\n  };\n\n  render() {\n    return (\n      <div\n        style={{\n          width: \"100%\",\n          height: \"100%\",\n          display: \"flex\",\n          alignItems: \"stretch\",\n        }}\n      >\n        <div\n          style={{\n            flex: \"0 0 auto\",\n            width: \"4em\",\n            paddingRight: \".2em\",\n            display: \"flex\",\n            flexDirection: \"column\",\n            justifyContent: \"space-between\",\n            alignItems: \"flex-end\",\n          }}\n        >\n          <div\n            ref={this.maxValueRef}\n            style={{ fontSize: \".8em\", marginTop: \"-.7em\" }}\n          />\n          <div\n            ref={this.minValueRef}\n            style={{ fontSize: \".8em\", marginBottom: \"-.75em\" }}\n          />\n        </div>\n        <div\n          style={{\n            flex: \"1 1 0\",\n            overflow: \"hidden\",\n            position: \"relative\",\n          }}\n          ref={this.canvasParentRef}\n        >\n          <canvas\n            ref={this.canvasRef}\n            style={{\n              position: \"absolute\",\n              width: \"100%\",\n              height: \"100%\",\n            }}\n          ></canvas>\n        </div>\n      </div>\n    );\n  }\n}\n","import React from \"react\";\nimport {\n  ExpansionPanel,\n  ExpansionPanelSummary,\n  Typography,\n  ExpansionPanelDetails,\n} from \"@material-ui/core\";\nimport ExpandMoreIcon from \"@material-ui/icons/ExpandMore\";\nimport { getXContestInterface } from \"../../location_provider/XContest/XContestInterface\";\nimport { getGPSProvider } from \"../../services/GPSProvider\";\nimport { LastFixState, LastFixArrow } from \"../../util/LastFixState\";\nimport { getPilotIcon, getPilotIconColor } from \"../../common/PilotIcon\";\nimport { styled, withStyles } from \"@material-ui/styles\";\nimport TimerIcon from \"@material-ui/icons/Timer\";\nimport DoubleArrowIcon from \"@material-ui/icons/DoubleArrow\";\nimport FlagIcon from \"@material-ui/icons/Flag\";\nimport { getRotationStyle } from \"../../util/Rotation\";\nimport { getSetting, Settings } from \"../../common/PersistentState/Settings\";\nimport ContextMenuHandler from \"../../util/ContextMenuHandler\";\nimport { parseTime } from \"../../location_provider/XContest/FlightAnimationData\";\nimport { ElevationHistogram } from \"./ElevationHistogram\";\n\nconst FirstRowLeft = styled(Typography)({\n  overflow: \"hidden\",\n  flex: \"1\",\n  width: 0,\n});\n\nconst FirstRowRight = styled(Typography)({\n  marginRight: \".2em\",\n  marginLeft: \".5em\",\n});\n\nconst SecondRow = styled(Typography)({\n  display: \"flex\",\n  justifyContent: \"space-between\",\n  paddingLeft: \".5em\",\n});\n\nconst PilotExpansionPanelSummary = withStyles({\n  root: {\n    paddingLeft: \"12px\",\n  },\n  content: {\n    overflow: \"hidden\",\n    alignItems: \"center\",\n    whiteSpace: \"nowrap\",\n  },\n})(ExpansionPanelSummary);\n\nconst PilotExpansionPanelDetails = withStyles({\n  root: {\n    display: \"flex\",\n    alignItems: \"stretch\",\n    justifyContent: \"space-between\",\n    MozUserSelect: \"none\",\n    WebkitUserSelect: \"none\",\n    msUserSelect: \"none\",\n  },\n})(ExpansionPanelDetails);\n\nconst DetailsStats = styled(Typography)({\n  flex: \"1 0 0\",\n  display: \"flex\",\n  justifyContent: \"flex-start\",\n  flexDirection: \"column\",\n  alignItems: \"flex-start\",\n  paddingRight: \"1em\",\n});\n\nconst DetailsGraph = styled(Typography)({\n  flex: \"2 1 0\",\n  display: \"flex\",\n});\n\nconst DetailsRow = styled(Typography)({\n  display: \"flex\",\n  justifyContent: \"flex-start\",\n  alignItems: \"center\",\n  whiteSpace: \"nowrap\",\n});\n\nconst DetailTimerIcon = withStyles({\n  root: {\n    paddingRight: \".2em\",\n    width: \".6em\",\n    height: \".6em\",\n  },\n})(TimerIcon);\nconst DetailDistanceIcon = withStyles({\n  root: {\n    paddingRight: \".2em\",\n    width: \".6em\",\n    height: \".6em\",\n  },\n})(DoubleArrowIcon);\nconst DetailLaunchIcon = withStyles({\n  root: {\n    paddingRight: \".2em\",\n    width: \".6em\",\n    height: \".6em\",\n  },\n})(FlagIcon);\n\nclass AnimatedPilotListEntry extends React.PureComponent {\n  constructor(props) {\n    super(props);\n\n    // Get initial data\n    this.gpsData = getGPSProvider().getData();\n    this.pilotColor = getPilotIconColor(this.props.pilotId);\n\n    // Get initial pilotinfo\n    this.state = {\n      launchSite: null,\n      launchTime: null,\n      scoreDistance: null,\n      scoreType: null,\n      offline: true,\n    };\n    Object.assign(\n      this.state,\n      this.stateChangesFromPilotInfos(\n        this.state,\n        getXContestInterface().getPilotInfos()\n      )\n    );\n\n    // References\n    this.lastFixRef = React.createRef();\n    this.heightRef = React.createRef();\n    this.liveStateRef = React.createRef();\n    this.iconRef = React.createRef();\n    this.flightDurationRef = React.createRef();\n\n    this.contextMenuHandler = new ContextMenuHandler((e) => {\n      this.props.onContextMenuHandler(this.props.pilotId, {\n        left: e.pageX,\n        top: e.pageY,\n      });\n    });\n  }\n\n  //////////////////////////////////////////////////////////////\n  /// BOILERPLATE CODE FOR UPDATING THE COMPONENT\n  ///\n  extractImportantProps = (pilotInfo) => {\n    return {\n      height: pilotInfo.gpsAlt !== null ? pilotInfo.gpsAlt : pilotInfo.baroAlt,\n      elevation: pilotInfo.elevation,\n      vario: pilotInfo.baroVario,\n      startOfTrack: pilotInfo.startOfTrack,\n      endOfTrack: pilotInfo.endOfTrack,\n      landed: pilotInfo.landed,\n      newestDataTimestamp: pilotInfo.newestDataTimestamp,\n      lat: pilotInfo.pos.lat,\n      lng: pilotInfo.pos.lng,\n      velocityLat:\n        pilotInfo.velocityVec === null ? null : pilotInfo.velocityVec.lat,\n      velocityLng:\n        pilotInfo.velocityVec === null ? null : pilotInfo.velocityVec.lng,\n      velocity: pilotInfo.velocity,\n      lastPotentialAirTime: pilotInfo.lastPotentialAirTime,\n      offline: pilotInfo.offline,\n    };\n  };\n\n  propsChanged = (newProps) => {\n    const oldProps = this.pilotProps;\n    for (let p in oldProps) {\n      if (!(p in newProps)) return true;\n    }\n    for (let p in newProps) {\n      if (!(p in oldProps)) return true;\n      if (oldProps[p] !== newProps[p]) return true;\n    }\n    return false;\n  };\n\n  onNewGPSDataReceived = (gpsData) => {\n    this.gpsData = gpsData;\n  };\n\n  onNewDataReceived = ({ pilotData }) => {\n    if (!(this.props.pilotId in pilotData)) return;\n\n    const pilotInfo = pilotData[this.props.pilotId];\n    const newPilotProps = this.extractImportantProps(pilotInfo);\n\n    // If offline state changed, rerender\n    if (this.state.offline !== newPilotProps.offline) {\n      this.setState({ offline: newPilotProps.offline });\n      return;\n    }\n\n    // Run shallow update without touching React\n    if (this.propsChanged(newPilotProps)) {\n      this.pilotProps = newPilotProps;\n      this.shallowRerender(true);\n    } else {\n      // If props didn't change, rerender anyways to update time stamps and time-dependent data\n      this.shallowRerender(false);\n    }\n  };\n\n  onNewPilotInfos = (infos) => {\n    const stateChanges = this.stateChangesFromPilotInfos(this.state, infos);\n    if (Object.keys(stateChanges).length !== 0) {\n      this.setState(stateChanges);\n    }\n  };\n\n  stateChangesFromPilotInfos = (oldState, allInfos) => {\n    const stateChanges = {};\n\n    const processInfo = (name, value) => {\n      if (name in oldState && oldState[name] === value) {\n        return;\n      }\n      stateChanges[name] = value;\n    };\n\n    if (this.props.pilotId in allInfos) {\n      const infos = allInfos[this.props.pilotId];\n\n      processInfo(\"launchSite\", infos.info.launch);\n      processInfo(\"launchTime\", parseTime(infos.info.launchPoint.timestamp));\n\n      if (\"contest\" in infos && \"score\" in infos.contest) {\n        const score = infos.contest.score;\n        if (score.distance != null)\n          processInfo(\"scoreDistance\", score.distance.toFixed(1));\n        if (\"type\" in score) {\n          processInfo(\"scoreType\", score.type.tag);\n        }\n      }\n    }\n    return stateChanges;\n  };\n\n  shallowRerender = (propsChanged) => {\n    // Update height\n    if (this.heightRef.current !== null && propsChanged) {\n      const newHeight = AnimatedPilotListEntry.renderHeight(this.pilotProps);\n      if (newHeight !== this.heightRef.current.innerHTML)\n        this.heightRef.current.innerHTML = newHeight;\n    }\n\n    // Update distance and direction\n    if (this.lastFixRef.current !== null && propsChanged) {\n      this.lastFixRef.current.setFix({\n        lat: this.pilotProps.lat,\n        lng: this.pilotProps.lng,\n      });\n    }\n\n    // Update Pilot Icon\n    if (this.iconRef.current !== null && propsChanged) {\n      let icon = this.iconRef.current;\n\n      const newPilotIcon = getPilotIcon(\n        this.pilotProps.startOfTrack,\n        this.pilotProps.endOfTrack,\n        this.pilotProps.landed,\n        { lat: this.pilotProps.lat, lng: this.pilotProps.lng },\n        { lat: this.pilotProps.velocityLat, lng: this.pilotProps.velocityLng }\n      );\n\n      // Update svg path if necessary\n      if (icon.childNodes.length > 0) {\n        const path = icon.childNodes[0];\n        const oldPath = path.getAttribute(\"d\");\n        if (oldPath !== newPilotIcon.path) {\n          path.setAttribute(\"d\", newPilotIcon.path);\n        }\n      }\n\n      // Update rotation if necessary\n      const rotation =\n        newPilotIcon.rotation === undefined ? 0 : newPilotIcon.rotation;\n      Object.assign(icon.style, getRotationStyle(rotation));\n    }\n\n    // Update Live State\n    if (this.liveStateRef.current !== null) {\n      this.liveStateRef.current.shallowRerender({\n        timestamp: this.pilotProps.newestDataTimestamp * 1000,\n        landed: this.pilotProps.landed,\n        endOfTrack: this.pilotProps.endOfTrack,\n        relative: true,\n        showLastFix: getSetting(Settings.LOW_LATENCY).getValue(),\n      });\n    }\n\n    // Update Flight Duration\n    if (this.flightDurationRef.current !== null && propsChanged) {\n      const newFlightDuration = AnimatedPilotListEntry.renderFlightDuration(\n        this.state.launchTime,\n        this.pilotProps.lastPotentialAirTime\n      );\n      if (newFlightDuration !== this.flightDurationRef.current.innerHTML)\n        this.flightDurationRef.current.innerHTML = newFlightDuration;\n    }\n  };\n\n  componentDidMount() {\n    getXContestInterface().animation.registerCallback(this.onNewDataReceived);\n    getXContestInterface().pilotInfos.registerCallback(this.onNewPilotInfos);\n    getGPSProvider().registerCallback(this.onNewGPSDataReceived);\n  }\n\n  componentWillUnmount() {\n    getXContestInterface().animation.unregisterCallback(this.onNewDataReceived);\n    getXContestInterface().pilotInfos.unregisterCallback(this.onNewPilotInfos);\n    getGPSProvider().unregisterCallback(this.onNewGPSDataReceived);\n  }\n  ///\n  /////////////////////////////////////////////////////////////////\n\n  /////////////////////////////////////////////////////////////////\n  /// LAYOUT\n  ///\n\n  static renderHeight(pilotProps) {\n    const height = pilotProps.height;\n\n    if (height == null) {\n      return \"--m (--m)\";\n    }\n\n    return (\n      Math.round(height) +\n      \"m (\" +\n      Math.round(Math.max(0, height - pilotProps.elevation)) +\n      \"m)\"\n    );\n  }\n\n  static renderFlightDuration(launchTime, currentTime) {\n    if (launchTime == null || currentTime == null) return \"-:-- h\";\n\n    const duration = Math.round((currentTime - launchTime) / 60);\n    const durationMinutes = (duration % 60).toString().padStart(2, \"0\");\n    const durationHours = Math.floor(duration / 60);\n    return durationHours + \":\" + durationMinutes + \" h\";\n  }\n\n  static scoreTypes = {\n    FlatTriangle: \" (flat)\",\n    FaiTriangle: \" (fai)\",\n    FreeFlight: \" (free)\",\n  };\n\n  static renderScore(scoreDistance, scoreType) {\n    const scoreTypeStr =\n      scoreType in AnimatedPilotListEntry.scoreTypes\n        ? AnimatedPilotListEntry.scoreTypes[scoreType]\n        : scoreType;\n    return scoreDistance + \" km \" + scoreTypeStr;\n  }\n\n  render() {\n    {\n      const pilotData = getXContestInterface().animation.getData().pilotData;\n      const pilotInfo =\n        this.props.pilotId in pilotData ? pilotData[this.props.pilotId] : null;\n      this.pilotProps = this.extractImportantProps(pilotInfo);\n    }\n\n    /*console.debug(\n      \"RENDER \",\n      this.props.pilotId,\n      this.state,\n      this.props,\n      this.pilotProps\n    );*/\n\n    const pilotIcon = getPilotIcon(\n      this.pilotProps.startOfTrack,\n      this.pilotProps.endOfTrack,\n      this.pilotProps.landed,\n      { lat: this.pilotProps.lat, lng: this.pilotProps.lng },\n      { lat: this.pilotProps.velocityLat, lng: this.pilotProps.velocityLng }\n    );\n    const pilotIconRotation =\n      pilotIcon.rotation === undefined ? 0 : pilotIcon.rotation;\n\n    return (\n      <ExpansionPanel\n        TransitionProps={{ unmountOnExit: true }}\n        onContextMenu={this.contextMenuHandler.onContextMenu}\n        onTouchStart={this.contextMenuHandler.onTouchStart}\n        onTouchCancel={this.contextMenuHandler.onTouchCancel}\n        onTouchEnd={this.contextMenuHandler.onTouchEnd}\n        onTouchMove={this.contextMenuHandler.onTouchMove}\n        style={{\n          filter: this.props.shown ? undefined : \"grayscale(100%) opacity(70%)\",\n        }}\n      >\n        <PilotExpansionPanelSummary expandIcon={<ExpandMoreIcon />}>\n          <svg\n            width=\"30px\"\n            height=\"30px\"\n            viewBox=\"0 0 24 24\"\n            display=\"block\"\n            style={{\n              flex: \"0 0 auto\",\n              ...getRotationStyle(pilotIconRotation),\n            }}\n            ref={this.iconRef}\n          >\n            <path d={pilotIcon.path} fill={this.pilotColor} stroke=\"black\" />\n          </svg>\n          <div\n            style={{\n              flex: \"1 1 auto\",\n              overflow: \"hidden\",\n              marginLeft: \"10px\",\n            }}\n          >\n            <div\n              style={{\n                width: \"100%\",\n                display: \"flex\",\n                overflow: \"hidden\",\n              }}\n            >\n              <FirstRowLeft variant=\"body2\">\n                {this.props.pilotName}\n              </FirstRowLeft>\n              <FirstRowRight variant=\"caption\">\n                <LastFixArrow\n                  ref={this.lastFixRef}\n                  lastFix={{\n                    lat: this.pilotProps.lat,\n                    lng: this.pilotProps.lng,\n                  }}\n                />\n              </FirstRowRight>\n            </div>\n            <SecondRow variant=\"caption\">\n              <LastFixState\n                timestamp={this.pilotProps.newestDataTimestamp * 1000}\n                landed={this.pilotProps.landed}\n                endOfTrack={this.pilotProps.endOfTrack}\n                relative\n                ref={this.liveStateRef}\n                showLastFix={getSetting(Settings.LOW_LATENCY).getValue()}\n              />\n              <span ref={this.heightRef}>\n                {AnimatedPilotListEntry.renderHeight(this.pilotProps)}\n              </span>\n            </SecondRow>\n          </div>\n        </PilotExpansionPanelSummary>\n        {this.state.offline ? null : (\n          <PilotExpansionPanelDetails>\n            <DetailsStats>\n              <DetailsRow variant=\"caption\">\n                <DetailTimerIcon />\n                <span ref={this.flightDurationRef}>\n                  {AnimatedPilotListEntry.renderFlightDuration(\n                    this.state.launchTime,\n                    this.pilotProps.lastPotentialAirTime\n                  )}\n                </span>\n              </DetailsRow>\n              <DetailsRow variant=\"caption\">\n                <DetailDistanceIcon />\n                {AnimatedPilotListEntry.renderScore(\n                  this.state.scoreDistance,\n                  this.state.scoreType\n                )}\n              </DetailsRow>\n              <DetailsRow variant=\"caption\">\n                <DetailLaunchIcon /> {this.state.launchSite}\n              </DetailsRow>\n            </DetailsStats>\n            <DetailsGraph variant=\"caption\">\n              <ElevationHistogram pilot={this.props.pilotId} />\n            </DetailsGraph>\n          </PilotExpansionPanelDetails>\n        )}\n      </ExpansionPanel>\n    );\n  }\n}\n\nexport default AnimatedPilotListEntry;\n","import React from \"react\";\nimport { Typography, withStyles, Paper } from \"@material-ui/core\";\nimport ContextMenuHandler from \"../../util/ContextMenuHandler\";\n\nconst OfflinePilotPaper = withStyles({\n  root: {\n    display: \"flex\",\n    backgroundColor: \"#ccc\",\n    padding: \".8em\",\n  },\n})(Paper);\n\nexport default class OfflinePilotEntry extends React.PureComponent {\n  constructor(props) {\n    super(props);\n\n    this.contextMenuHandler = new ContextMenuHandler((e) => {\n      this.props.onContextMenuHandler(this.props.pilotId, {\n        left: e.pageX,\n        top: e.pageY,\n      });\n    });\n  }\n\n  render() {\n    return (\n      <OfflinePilotPaper\n        className=\"MuiExpansionPanel-rounded MuiExpansionPanel-root\"\n        onContextMenu={this.contextMenuHandler.onContextMenu}\n        onTouchStart={this.contextMenuHandler.onTouchStart}\n        onTouchCancel={this.contextMenuHandler.onTouchCancel}\n        onTouchEnd={this.contextMenuHandler.onTouchEnd}\n        onTouchMove={this.contextMenuHandler.onTouchMove}\n      >\n        <Typography variant=\"body2\">{this.props.pilotName}</Typography>\n        <Typography\n          variant=\"caption\"\n          color=\"textSecondary\"\n          style={{ paddingLeft: \".5em\" }}\n        >\n          [{this.props.pilotId}]\n        </Typography>\n      </OfflinePilotPaper>\n    );\n  }\n}\n","import React from \"react\";\nimport {\n  Box,\n  Typography,\n  ExpansionPanel,\n  ExpansionPanelSummary,\n  ExpansionPanelDetails,\n  withStyles,\n} from \"@material-ui/core\";\nimport ExpandMoreIcon from \"@material-ui/icons/ExpandMore\";\nimport { getXContestInterface } from \"../../location_provider/XContest/XContestInterface\";\nimport AnimatedPilotListEntry from \"./AnimatedPilotListEntry\";\nimport { getGPSProvider } from \"../../services/GPSProvider\";\nimport { getDistance } from \"geolib\";\n\nimport ContextMenu from \"../common/ContextMenu\";\nimport { getChosenPilots } from \"../../common/PersistentState/ChosenPilots\";\nimport OfflinePilotEntry from \"./OfflinePilotEntry\";\n\nconst OfflinePilotsExpansionPanel = withStyles({\n  root: {\n    backgroundColor: \"#ddd\",\n  },\n})(ExpansionPanel);\n\nclass AnimatedPilotList extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      onlinePilots: [],\n      contextMenu: null,\n    };\n    this.gpsData = getGPSProvider().getData();\n  }\n\n  getSortedPilotList = (pilotData) => {\n    // If we have GPS, return pilot list in whatever order\n    if (this.gpsData === null) return Object.keys(pilotData);\n\n    // Get own position\n    const myPos = {\n      lat: this.gpsData.coords.latitude,\n      lng: this.gpsData.coords.longitude,\n    };\n\n    // Get distances to pilots\n    let pilotsAndDistances = Object.entries(pilotData).map(([name, data]) => [\n      name,\n      getDistance(myPos, data.pos),\n    ]);\n\n    // Sort\n    pilotsAndDistances.sort((el1, el2) => el1[1] - el2[1]);\n\n    // Return the sorted pilot names\n    return pilotsAndDistances.map((el) => el[0]);\n  };\n\n  onAnimationFrame = ({ pilotData }) => {\n    // Sort\n    const sortedPilotList = this.getSortedPilotList(pilotData);\n\n    // Split pilots by landed and not landed\n    const landedPilotList = sortedPilotList.filter(\n      (name) => pilotData[name].endOfTrack && pilotData[name].landed\n    );\n    const notLandedPilotList = sortedPilotList.filter(\n      (name) => !(pilotData[name].endOfTrack && pilotData[name].landed)\n    );\n\n    // Show landed pilots at the end of the list\n    const pilotList = notLandedPilotList.concat(landedPilotList);\n\n    // Check if the pilot list changed\n    let pilotListChanged = false;\n    if (pilotList.length === this.state.onlinePilots.length) {\n      for (let i = 0; i < pilotList.length; i++) {\n        if (pilotList[i] !== this.state.onlinePilots[i]) {\n          pilotListChanged = true;\n          break;\n        }\n      }\n    } else {\n      pilotListChanged = true;\n    }\n\n    // If it changed, run a component update\n    if (pilotListChanged) {\n      this.setState((state) => ({ ...state, onlinePilots: pilotList }));\n    }\n  };\n\n  onNewGPSDataReceived = (gpsData) => {\n    this.gpsData = gpsData;\n  };\n\n  componentDidMount() {\n    getXContestInterface().animation.registerCallback(this.onAnimationFrame);\n    getGPSProvider().registerCallback(this.onNewGPSDataReceived);\n  }\n  componentWillUnmount() {\n    getXContestInterface().animation.unregisterCallback(this.onAnimationFrame);\n    getGPSProvider().unregisterCallback(this.onNewGPSDataReceived);\n  }\n\n  showContextMenu = (pilotId, mousePos) => {\n    const chosenPilots = getChosenPilots();\n    if (!(pilotId in chosenPilots)) return;\n    const pilotInfo = chosenPilots[pilotId];\n\n    this.setState({\n      contextMenu: {\n        open: true,\n        pilotId,\n        pos: mousePos,\n        pilotInfo,\n      },\n    });\n  };\n\n  showContextMenuOffline = (pilotId, mousePos) => {\n    const chosenPilots = getChosenPilots();\n    if (!(pilotId in chosenPilots)) return;\n    const pilotInfo = chosenPilots[pilotId];\n\n    this.setState({\n      contextMenu: {\n        open: true,\n        pilotId,\n        pos: mousePos,\n        pilotInfo,\n        offline: true,\n      },\n    });\n  };\n\n  hideContextMenu = () => {\n    this.setState({ contextMenu: { ...this.state.contextMenu, open: false } });\n  };\n\n  render() {\n    let pilotIsOnline = new Set(this.state.onlinePilots);\n\n    // Show online pilots first\n    const onlinePilots = this.state.onlinePilots.filter(\n      (pilotId) =>\n        pilotId in this.props.pilots && this.props.pilots[pilotId].shown\n    );\n    const onlineHiddenPilots = this.state.onlinePilots.filter(\n      (pilotId) =>\n        pilotId in this.props.pilots && !this.props.pilots[pilotId].shown\n    );\n\n    const offlinePilots = Object.keys(this.props.pilots).filter(\n      (pilotId) => !pilotIsOnline.has(pilotId)\n    );\n\n    const getPilotName = (pilotId) => {\n      const pilotData = this.props.pilots[pilotId];\n      if (pilotData === undefined || pilotData === null) return pilotId;\n      return pilotData.name;\n    };\n\n    return (\n      <Box\n        height=\"100%\"\n        bgcolor=\"#eeeef5\"\n        overflow=\"auto\"\n        onContextMenu={(event) => event.preventDefault()}\n      >\n        {onlinePilots.length > 0 ? (\n          <Box margin={1} marginBottom={2}>\n            {onlinePilots.map((pilotId) => (\n              <AnimatedPilotListEntry\n                shown={true}\n                key={pilotId}\n                pilotId={pilotId}\n                pilotName={getPilotName(pilotId)}\n                onContextMenuHandler={this.showContextMenu}\n              />\n            ))}\n          </Box>\n        ) : null}\n        {onlineHiddenPilots.length > 0 ? (\n          <Box margin={1} marginBottom={2}>\n            {onlineHiddenPilots.map((pilotId) => (\n              <AnimatedPilotListEntry\n                shown={false}\n                key={pilotId}\n                pilotId={pilotId}\n                pilotName={getPilotName(pilotId)}\n                onContextMenuHandler={this.showContextMenu}\n              />\n            ))}\n          </Box>\n        ) : null}\n        {offlinePilots.length > 0 ? (\n          <Box margin={1} onContextMenu={() => false}>\n            <OfflinePilotsExpansionPanel>\n              <ExpansionPanelSummary expandIcon={<ExpandMoreIcon />}>\n                <Typography>Offline Pilots</Typography>\n              </ExpansionPanelSummary>\n              <ExpansionPanelDetails style={{ flexDirection: \"column\" }}>\n                {offlinePilots.map((pilotId) => (\n                  <OfflinePilotEntry\n                    key={pilotId}\n                    pilotId={pilotId}\n                    pilotName={getPilotName(pilotId)}\n                    onContextMenuHandler={this.showContextMenuOffline}\n                  />\n                ))}\n              </ExpansionPanelDetails>\n            </OfflinePilotsExpansionPanel>\n          </Box>\n        ) : null}\n        <ContextMenu\n          data={this.state.contextMenu}\n          onClose={this.hideContextMenu}\n        />\n      </Box>\n    );\n  }\n}\n\nexport default AnimatedPilotList;\n","import React from \"react\";\n\nimport {\n  CircularProgress,\n  Table,\n  TableBody,\n  TableRow,\n  TableCell,\n  Box,\n  Checkbox,\n  Typography,\n} from \"@material-ui/core\";\n\n// The list content\nexport default class PilotMultipleChoiceList extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = { didMount: false };\n  }\n\n  startRendering = () => {\n    this.setState({ didMount: true });\n  };\n\n  componentDidMount() {\n    // This starts the actual rendering, as it can take quite a while.\n    // setTimeout forces the browser to present before loading the table.\n    // without setTimeout, the waiting symbol would never be shown.\n    setTimeout(this.startRendering);\n  }\n\n  onPilotClicked = (pilotId) => {\n    if (this.props.onPilotClicked) this.props.onPilotClicked(pilotId);\n  };\n\n  getSortedPilotIds = () => {\n    const pilots = Object.keys(this.props.pilots);\n\n    pilots.sort((a, b) => {\n      const nameA = this.props.pilots[a].name;\n      const nameB = this.props.pilots[b].name;\n      if (nameA < nameB) {\n        return -1;\n      }\n      if (nameA > nameB) {\n        return 1;\n      }\n      return 0;\n    });\n\n    return pilots;\n  };\n\n  render() {\n    if (!this.state.didMount) {\n      return (\n        <div\n          style={{\n            width: \"100%\",\n            display: \"flex\",\n            justifyContent: \"center\",\n            overflow: \"hidden\",\n          }}\n        >\n          <CircularProgress disableShrink style={{ margin: \"2em\" }} />\n        </div>\n      );\n    }\n\n    const pilots = this.getSortedPilotIds();\n\n    return (\n      <Box overflow=\"auto\">\n        <Table /*size=\"small\"*/ style={{ width: \"100%\" }}>\n          <TableBody>\n            {pilots.map((pilotId) => (\n              <TableRow\n                key={pilotId}\n                onClick={() => this.onPilotClicked(pilotId)}\n                selected={pilotId in this.props.selected}\n              >\n                <TableCell padding=\"checkbox\">\n                  <Checkbox checked={pilotId in this.props.selected} />\n                </TableCell>\n                <TableCell component=\"th\" scope=\"row\" padding=\"none\">\n                  <Typography variant=\"body2\" component=\"span\">\n                    {this.props.pilots[pilotId].name}\n                  </Typography>\n                  <Typography\n                    variant=\"caption\"\n                    color=\"textSecondary\"\n                    style={{ paddingLeft: \".5em\" }}\n                    component=\"span\"\n                  >\n                    [{pilotId}]\n                  </Typography>\n                </TableCell>\n              </TableRow>\n            ))}\n          </TableBody>\n        </Table>\n      </Box>\n    );\n  }\n}\n","import React from \"react\";\nimport { Typography, Toolbar, Divider } from \"@material-ui/core\";\n\nimport { Button, DialogActions } from \"@material-ui/core\";\n\nimport SubWindow from \"../../util/SubWindow\";\n\nimport PilotMultipleChoiceList from \"../common/PilotMultipleChoiceList\";\n\n// Base window, without the table\nclass VisibilitySelector extends React.PureComponent {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      selected: {},\n      open: false,\n    };\n  }\n\n  static getDerivedStateFromProps = (props, state) => {\n    // Whenever the window is opened, set the selected pilots from\n    // the shown pilots\n    if (props.open !== state.open) {\n      if (props.open === false) return { open: props.open };\n\n      let selected = {};\n      Object.entries(props.pilots).forEach(([pilotId, pilotData]) => {\n        if (pilotData.shown) {\n          selected[pilotId] = true;\n        }\n      });\n\n      return { open: props.open, selected };\n    }\n\n    return null;\n  };\n\n  pilotClicked = (name) => {\n    const selected = { ...this.state.selected };\n\n    if (name in selected) {\n      delete selected[name];\n    } else {\n      selected[name] = true;\n    }\n\n    this.setState({ selected });\n  };\n\n  closeWindow = () => {\n    this.props.onClose();\n  };\n\n  reset = () => {\n    let selected = {};\n    Object.keys(this.props.pilots).forEach((pilotId) => {\n      selected[pilotId] = true;\n    });\n    this.setState({ selected });\n  };\n\n  clear = () => {\n    this.setState({ selected: {} });\n  };\n\n  render() {\n    const fullScreen = false;\n\n    const allPilotsSelected =\n      Object.keys(this.props.pilots).length ===\n      Object.keys(this.state.selected).length;\n\n    return (\n      <SubWindow\n        open={this.props.open}\n        onClose={this.closeWindow}\n        fullScreen={fullScreen}\n        maxWidth=\"xs\"\n        fullWidth={true}\n      >\n        <Toolbar>\n          <Typography component=\"div\" variant=\"h6\" id=\"tableTitle\">\n            Select shown pilots:\n          </Typography>\n        </Toolbar>\n        <Divider />\n        <PilotMultipleChoiceList\n          pilots={this.props.pilots}\n          selected={this.state.selected}\n          onPilotClicked={this.pilotClicked}\n        />\n        <DialogActions>\n          <Button\n            onClick={allPilotsSelected ? this.clear : this.reset}\n            color=\"primary\"\n          >\n            {allPilotsSelected ? \"Clear\" : \"Reset\"}\n          </Button>\n          <Button onClick={this.closeWindow} color=\"primary\">\n            Cancel\n          </Button>\n          <Button\n            disabled={false}\n            onClick={() => {\n              this.props.onUpdateVisibility(Object.keys(this.state.selected));\n              this.closeWindow();\n            }}\n            color=\"primary\"\n          >\n            Save\n          </Button>\n        </DialogActions>\n      </SubWindow>\n    );\n  }\n}\n\nexport default VisibilitySelector;\n","import React from \"react\";\nimport { Fab } from \"@material-ui/core\";\nimport AddIcon from \"@material-ui/icons/Add\";\nimport StarRateIcon from \"@material-ui/icons/StarRate\";\nimport Box from \"@material-ui/core/Box\";\nimport PilotSelector from \"../PilotSelector/PilotSelector\";\nimport {\n  getChosenPilots,\n  addPilots,\n  getChosenPilotsObject,\n  updateShownPilots,\n} from \"../../common/PersistentState/ChosenPilots\";\nimport AnimatedPilotList from \"./AnimatedPilotList\";\nimport VisibilitySelector from \"../VisibilitySelector/VisibilitySelector\";\n\nclass Pilots extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      pilotSelectorOpen: false,\n      visibilitySelectorOpen: false,\n      chosenPilots: getChosenPilots(),\n    };\n  }\n\n  openPilotSelector = () => {\n    if (this.state.pilotSelectorOpen === false)\n      this.setState({ pilotSelectorOpen: true });\n  };\n\n  closePilotSelector = () => {\n    if (this.state.pilotSelectorOpen === true)\n      this.setState({ pilotSelectorOpen: false });\n  };\n\n  openVisibilitySelector = () => {\n    if (this.state.visibilitySelectorOpen === false)\n      this.setState({ visibilitySelectorOpen: true });\n  };\n\n  closeVisibilitySelector = () => {\n    if (this.state.visibilitySelectorOpen === true)\n      this.setState({ visibilitySelectorOpen: false });\n  };\n\n  chosenPilotsChanged = (newChosenPilots) => {\n    this.setState({\n      chosenPilots: newChosenPilots,\n    });\n  };\n\n  componentDidMount() {\n    getChosenPilotsObject().registerCallback(this.chosenPilotsChanged);\n  }\n  componentWillUnmount() {\n    getChosenPilotsObject().unregisterCallback(this.chosenPilotsChanged);\n  }\n\n  render() {\n    return (\n      <React.Fragment>\n        <AnimatedPilotList pilots={this.state.chosenPilots}></AnimatedPilotList>\n\n        <Box position=\"absolute\" bottom=\"68px\" right=\"16px\">\n          <Fab\n            size=\"small\"\n            color=\"primary\"\n            onClick={this.openVisibilitySelector}\n          >\n            <StarRateIcon />\n          </Fab>\n        </Box>\n        <Box position=\"absolute\" bottom=\"16px\" right=\"16px\">\n          <Fab size=\"small\" color=\"primary\" onClick={this.openPilotSelector}>\n            <AddIcon />\n          </Fab>\n        </Box>\n        <PilotSelector\n          open={this.state.pilotSelectorOpen}\n          onClose={this.closePilotSelector}\n          onAddPilots={addPilots}\n          alreadyAdded={Object.keys(this.state.chosenPilots)}\n        />\n        <VisibilitySelector\n          open={this.state.visibilitySelectorOpen}\n          onClose={this.closeVisibilitySelector}\n          onUpdateVisibility={(selected) => {\n            updateShownPilots(selected);\n          }}\n          pilots={this.state.chosenPilots}\n        />\n      </React.Fragment>\n    );\n  }\n}\n\nexport default Pilots;\n","import React from \"react\";\nimport { TextField, InputAdornment } from \"@material-ui/core\";\n\nexport default class NumberInput extends React.PureComponent {\n  state = {\n    internalUpdate: false,\n    value: null\n  };\n\n  static getDerivedStateFromProps(props, state) {\n    const resultState = { ...state, internalUpdate: false };\n\n    // Overwrite with external value if we got an update from the parent element\n    if (!state.internalUpdate) {\n      resultState.value = props.value;\n    }\n\n    return resultState;\n  }\n\n  render() {\n    return (\n      <TextField\n        onChange={event => {\n          const value = event.target.value;\n          // If the value is too small, send the smallest possible value to the parent,\n          // but keep the incorrect value in the text field.\n          // If the value is too large, send the largest possible value to the parent,\n          // and also set the text field to the largest possible value.\n          // Otherwise, just update.\n\n          if (value < this.props.min) {\n            // If those two messages get delivered out of order, this entire trick will stop working.\n            // But I think setting states will never be done in an incorrect order, that would really break things.\n            this.props.onChange(this.props.min);\n            this.setState(state => ({\n              ...state,\n              internalUpdate: true,\n              value: value\n            }));\n          } else if (value > this.props.max) {\n            this.props.onChange(this.props.max);\n          } else {\n            this.props.onChange(value);\n          }\n        }}\n        variant=\"outlined\"\n        disabled={this.props.disabled}\n        margin=\"dense\"\n        hiddenLabel\n        type=\"number\"\n        value={this.state.value}\n        InputProps={{\n          endAdornment: (\n            <InputAdornment position=\"end\">{this.props.unit}</InputAdornment>\n          )\n        }}\n        inputProps={{\n          min: this.props.min,\n          max: this.props.max\n        }}\n      />\n    );\n  }\n}\n","import React from \"react\";\nimport { getSetting } from \"../../common/PersistentState/Settings\";\nimport {\n  ListItem,\n  ListItemText,\n  ListItemSecondaryAction,\n  Switch,\n  NativeSelect,\n} from \"@material-ui/core\";\nimport NumberInput from \"../../util/NumberInput\";\nimport { pure } from \"recompose\";\n\nexport const BooleanSetting = pure((props) => {\n  const [settingValue, setSettingValue] = getSetting(props.setting).use();\n  const flipSetting = () => setSettingValue(!settingValue);\n\n  return (\n    <ListItem button onClick={flipSetting}>\n      <ListItemText\n        primary={props.primaryText}\n        secondary={props.secondaryText}\n      />\n      <ListItemSecondaryAction>\n        <Switch edge=\"end\" onChange={flipSetting} checked={settingValue} />\n      </ListItemSecondaryAction>\n    </ListItem>\n  );\n});\n\nexport const NumberSetting = pure((props) => {\n  const [settingValue, setSettingValue] = getSetting(props.setting).use();\n\n  return (\n    <ListItem disabled={props.disabled}>\n      <ListItemText\n        primary={props.primaryText}\n        secondary={props.secondaryText}\n      />\n      <ListItemSecondaryAction>\n        <NumberInput\n          value={settingValue}\n          onChange={setSettingValue}\n          disabled={props.disabled}\n          unit={props.unit}\n          min={props.min}\n          max={props.max}\n        />\n      </ListItemSecondaryAction>\n    </ListItem>\n  );\n});\n\nexport const MultipleChoiceSetting = pure((props) => {\n  const [settingValue, setSettingValue] = getSetting(props.setting).use();\n\n  return (\n    <ListItem disabled={props.disabled}>\n      <ListItemText\n        primary={props.primaryText}\n        secondary={props.secondaryText}\n      />\n      <ListItemSecondaryAction>\n        <NativeSelect\n          value={settingValue}\n          onChange={(event) => {\n            setSettingValue(event.target.value);\n          }}\n          disabled={props.disabled}\n          displayEmpty\n        >\n          {props.choices.map((choice) => (\n            <option value={choice.value} disabled={choice.disabled}>\n              {choice.name}\n            </option>\n          ))}\n        </NativeSelect>\n      </ListItemSecondaryAction>\n    </ListItem>\n  );\n});\n","import React, { useState } from \"react\";\nimport {\n  AppBar,\n  Toolbar,\n  IconButton,\n  Box,\n  Typography,\n  DialogTitle,\n  DialogContent,\n  DialogContentText,\n  DialogActions,\n  Button\n} from \"@material-ui/core\";\nimport ArrowBackIcon from \"@material-ui/icons/ArrowBack\";\nimport UndoIcon from \"@material-ui/icons/Undo\";\n\nimport SubWindow from \"../../util/SubWindow\";\nimport { resetAllSettings } from \"../../common/PersistentState/Settings\";\nimport { pure } from \"recompose\";\n\nconst SettingsPageTitleBar = pure(props => {\n  const [resetAllSettingsDialogOpen, setResetAllSettingsDialogOpen] = useState(\n    false\n  );\n\n  return (\n    <React.Fragment>\n      <AppBar style={{ position: \"static\" }}>\n        <Toolbar>\n          <IconButton edge=\"start\" color=\"inherit\" onClick={props.onClose}>\n            <ArrowBackIcon />\n          </IconButton>\n\n          <Box marginLeft={2} flexGrow={1}>\n            <Typography variant=\"h6\">Settings</Typography>\n          </Box>\n\n          <IconButton\n            edge=\"end\"\n            color=\"inherit\"\n            onClick={() => setResetAllSettingsDialogOpen(true)}\n          >\n            <UndoIcon />\n          </IconButton>\n        </Toolbar>\n      </AppBar>\n\n      {/* RESET ALL SETTINGS DIALOG */}\n      <SubWindow\n        open={resetAllSettingsDialogOpen}\n        onClose={() => setResetAllSettingsDialogOpen(false)}\n      >\n        <DialogTitle>{\"Reset all settings?\"}</DialogTitle>\n        <DialogContent>\n          <DialogContentText>\n            This sets all settings to their default values.\n          </DialogContentText>\n        </DialogContent>\n        <DialogActions>\n          <Button\n            onClick={() => {\n              resetAllSettings();\n              setResetAllSettingsDialogOpen(false);\n            }}\n            color=\"primary\"\n          >\n            Yes\n          </Button>\n          <Button\n            onClick={() => setResetAllSettingsDialogOpen(false)}\n            color=\"primary\"\n            autoFocus\n          >\n            No\n          </Button>\n        </DialogActions>\n      </SubWindow>\n    </React.Fragment>\n  );\n});\n\nexport default SettingsPageTitleBar;\n","import React from \"react\";\n\nimport { List, Divider } from \"@material-ui/core\";\nimport { getSetting, Settings } from \"../../common/PersistentState/Settings\";\nimport { PageLayout } from \"../../common/PersistentState/PageLayout\";\nimport SubWindow from \"../../util/SubWindow\";\nimport {\n  BooleanSetting,\n  NumberSetting,\n  MultipleChoiceSetting,\n} from \"./SettingsPageEntries\";\nimport SettingsPageTitleBar from \"./SettingsPageTitleBar\";\n\nconst SettingsPage = (props) => {\n  // Retreive the settings that enable/disable other settings\n  const [settingLimitPaths] = getSetting(Settings.LIMIT_PATHS).use();\n  const [settingFpsLimit] = getSetting(Settings.FPS_LIMIT).use();\n  //const [settingLowLatency] = getSetting(Settings.LOW_LATENCY).use();\n\n  return (\n    <SubWindow fullScreen open={props.open} onClose={props.onClose}>\n      <SettingsPageTitleBar onClose={props.onClose} />\n\n      <List style={{ overflow: \"auto\" }}>\n        {/* ANIMATION DELAY */}\n        <BooleanSetting\n          setting={Settings.LOW_LATENCY}\n          primaryText=\"Low Latency Mode\"\n          secondaryText=\"disables animations\"\n        />\n        {/*<NumberSetting\n          primaryText=\"Animation Delay\"\n          secondaryText=\"70-120 sec (default: 80)\"\n          setting={Settings.ANIMATION_DELAY}\n          disabled={settingLowLatency}\n          unit=\"sec\"\n          min={70}\n          max={120}\n        />*/}\n\n        {/* TRACK LENGTH */}\n        <Divider />\n        <BooleanSetting\n          setting={Settings.LIMIT_PATHS}\n          primaryText=\"Limit Track Length\"\n          secondaryText=\"prevents map clutter\"\n        />\n        <NumberSetting\n          primaryText=\"Track Length\"\n          secondaryText=\"Valid: 1-999 min\"\n          setting={Settings.PATH_LENGTH}\n          disabled={!settingLimitPaths}\n          unit=\"min\"\n          min={1}\n          max={999}\n        />\n\n        {/* FRAMERATE */}\n        <Divider />\n        <BooleanSetting\n          setting={Settings.FPS_LIMIT}\n          primaryText=\"Limit Framerate\"\n          secondaryText=\"reduces energy consumption\"\n        />\n        <NumberSetting\n          primaryText=\"Framerate\"\n          secondaryText=\"Valid: 1-60 fps\"\n          setting={Settings.FPS_RATE}\n          disabled={!settingFpsLimit}\n          unit=\"fps\"\n          min={1}\n          max={60}\n        />\n\n        {/* GPS */}\n        <Divider />\n        <BooleanSetting\n          setting={Settings.GPS_ENABLED}\n          primaryText=\"Enable GPS\"\n          secondaryText=\"required for advanced features\"\n        />\n\n        {/* Prevent sleep */}\n        <Divider />\n        <BooleanSetting\n          setting={Settings.PREVENT_SLEEP}\n          primaryText=\"Prevent Sleep\"\n          secondaryText=\"keeps display on, useful for driving\"\n        />\n\n        {/* Show offline pilots */}\n        <Divider />\n        <BooleanSetting\n          setting={Settings.SHOW_OFFLINE_PILOTS}\n          primaryText=\"Show Offline Pilots\"\n          secondaryText=\"displays last observed landing spot\"\n        />\n\n        {/* Page Layout */}\n        <Divider />\n        <MultipleChoiceSetting\n          setting={Settings.PAGE_LAYOUT}\n          primaryText=\"Page Layout\"\n          secondaryText=\"explicitely sets the layout mode\"\n          choices={[\n            { name: \"Auto\", value: PageLayout.AUTO },\n            { name: \"Phone\", value: PageLayout.PHONE },\n            { name: \"Desktop\", value: PageLayout.DESKTOP },\n            { name: \"Widget\", value: PageLayout.WIDGET, disabled: true },\n          ]}\n        />\n      </List>\n    </SubWindow>\n  );\n};\n\nexport default SettingsPage;\n","import React from \"react\";\nimport {\n  Dialog,\n  DialogTitle,\n  DialogContent,\n  DialogContentText,\n  DialogActions,\n  Button,\n} from \"@material-ui/core\";\n\nexport default function LinkPopup(props) {\n  const copyToClipboard = () => {\n    navigator.clipboard.writeText(props.link).then(\n      function () {\n        alert(\"Copied link to clipboard!\");\n      },\n      function (err) {\n        alert(\"Can't copy to clipboard:\", err);\n      }\n    );\n  };\n\n  return (\n    <Dialog open={props.link !== null} onClose={props.onClose}>\n      <DialogTitle>{\"Shareable Link:\"}</DialogTitle>\n      <DialogContent>\n        <DialogContentText>\n          <a\n            style={{ wordWrap: \"break-word\", wordBreak: \"break-all\" }}\n            onClick={() => {\n              copyToClipboard();\n              window.event.preventDefault();\n              return false;\n            }}\n            href={props.link}\n          >\n            {props.link}\n          </a>\n        </DialogContentText>\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={copyToClipboard} color=\"primary\" autoFocus>\n          Copy\n        </Button>\n        <Button onClick={props.onClose} color=\"primary\" autoFocus>\n          Close\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n}\n","import React from \"react\";\n\nimport { Typography, Toolbar, Divider } from \"@material-ui/core\";\n\nimport { Button, DialogActions } from \"@material-ui/core\";\n\nimport SubWindow from \"../../util/SubWindow\";\n\nimport { getChosenPilots } from \"../../common/PersistentState/ChosenPilots\";\nimport LinkPopup from \"./LinkPopup\";\nimport { encodeBase64 } from \"../../util/Base64Data\";\nimport PilotMultipleChoiceList from \"../common/PilotMultipleChoiceList\";\n\n// Base window, without the table\nclass LinkCreator extends React.PureComponent {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      selected: {},\n      createdLink: null,\n      open: props.open,\n    };\n  }\n\n  pilotClicked = (name) => {\n    const selected = { ...this.state.selected };\n\n    if (name in selected) {\n      delete selected[name];\n    } else {\n      selected[name] = true;\n    }\n\n    this.setState({ selected });\n  };\n\n  closeWindow = () => {\n    this.props.onClose();\n  };\n\n  static getDerivedStateFromProps = (props, state) => {\n    // Whenever the window is opened, set the selected pilots from\n    // the shown pilots\n    if (props.open !== state.open) {\n      if (props.open === false) {\n        return { open: props.open };\n      } else {\n        return { open: props.open, selected: {} };\n      }\n    }\n\n    return null;\n  };\n\n  createLink = (pilots) => {\n    const payload = {};\n\n    const chosenPilots = getChosenPilots();\n\n    // Sort pilots\n    pilots = [...pilots];\n    pilots.sort();\n\n    pilots.forEach((pilotId) => {\n      if (pilotId in chosenPilots && chosenPilots[pilotId].name != null) {\n        payload[pilotId] = chosenPilots[pilotId].name;\n      } else {\n        payload[pilotId] = null;\n      }\n    });\n\n    const encodedData = encodeBase64(payload);\n\n    const url = window.location.href + \"?g=\" + encodeURIComponent(encodedData);\n\n    this.setState({ createdLink: url });\n  };\n\n  render() {\n    const fullScreen = false;\n\n    return (\n      <React.Fragment>\n        <SubWindow\n          open={this.props.open}\n          onClose={this.closeWindow}\n          fullScreen={fullScreen}\n          maxWidth=\"xs\"\n          fullWidth={true}\n        >\n          <Toolbar>\n            <Typography component=\"div\" variant=\"h6\" id=\"tableTitle\">\n              Choose Pilots to share:\n            </Typography>\n          </Toolbar>\n          <Divider />\n          <PilotMultipleChoiceList\n            pilots={getChosenPilots()}\n            selected={this.state.selected}\n            onPilotClicked={this.pilotClicked}\n          />\n          <DialogActions>\n            <Button onClick={this.closeWindow} color=\"primary\">\n              Cancel\n            </Button>\n            <Button\n              disabled={false}\n              onClick={() => {\n                this.closeWindow();\n                this.createLink(Object.keys(this.state.selected));\n              }}\n              color=\"primary\"\n            >\n              Create Link\n            </Button>\n          </DialogActions>\n        </SubWindow>\n        <LinkPopup\n          link={this.state.createdLink}\n          onClose={() => {\n            this.setState({ createdLink: null });\n          }}\n        />\n      </React.Fragment>\n    );\n  }\n}\n\nexport default LinkCreator;\n","import React, { useState } from \"react\";\nimport SwipeableDrawer from \"@material-ui/core/SwipeableDrawer\";\nimport {\n  List,\n  ListItem,\n  ListItemIcon,\n  ListItemText,\n  Box,\n  Typography,\n  Toolbar,\n  useTheme,\n} from \"@material-ui/core\";\nimport { IconButton } from \"@material-ui/core\";\n\nimport ChevronLeftIcon from \"@material-ui/icons/ChevronLeft\";\nimport SettingsIcon from \"@material-ui/icons/Settings\";\nimport ShareIcon from \"@material-ui/icons/Share\";\n\nimport SettingsPage from \"./SettingsPage/SettingsPage\";\nimport LinkCreator from \"./LinkCreator/LinkCreator\";\n\nconst MainMenu = (props) => {\n  const theme = useTheme();\n  const [settingsOpen, setSettingsOpen] = useState(false);\n  const [linkCreatorOpen, setLinkCreatorOpen] = useState(false);\n\n  return (\n    <React.Fragment>\n      <SwipeableDrawer\n        disableSwipeToOpen\n        open={props.open}\n        onOpen={() => {}}\n        onClose={props.onClose}\n      >\n        <Toolbar\n          style={{\n            backgroundColor: theme.palette.primary.light,\n            minWidth: \"200px\",\n          }}\n          onClick={props.onClose}\n        >\n          <Box flexGrow={1} clone>\n            <Typography variant=\"h6\">Menu</Typography>\n          </Box>\n          <IconButton edge=\"end\" color=\"inherit\">\n            <ChevronLeftIcon />\n          </IconButton>\n        </Toolbar>\n\n        <List>\n          <ListItem\n            button\n            onClick={() => {\n              props.onClose();\n              setSettingsOpen(true);\n            }}\n          >\n            <ListItemIcon>\n              <SettingsIcon />\n            </ListItemIcon>\n            <ListItemText primary=\"Settings\" />\n          </ListItem>\n          <ListItem\n            button\n            onClick={() => {\n              props.onClose();\n              setLinkCreatorOpen(true);\n            }}\n          >\n            <ListItemIcon>\n              <ShareIcon />\n            </ListItemIcon>\n            <ListItemText primary=\"Create Pilot Link\" />\n          </ListItem>\n        </List>\n        <Typography\n          variant=\"caption\"\n          style={{\n            fontSize: \"0.6rem\",\n            textAlign: \"center\",\n            position: \"absolute\",\n            bottom: \"0px\",\n            width: \"100%\",\n          }}\n        >\n          {\"Icon made by \"}\n          <a href=\"https://www.flaticon.com/authors/freepik\">{\"Freepik\"}</a>\n          {\" from \"}\n          <a href=\"https://www.flaticon.com/\">{\"www.flaticon.com\"}</a>\n        </Typography>\n      </SwipeableDrawer>\n      <SettingsPage\n        open={settingsOpen}\n        onClose={() => setSettingsOpen(false)}\n      ></SettingsPage>\n      <LinkCreator\n        open={linkCreatorOpen}\n        onClose={() => setLinkCreatorOpen(false)}\n      ></LinkCreator>\n    </React.Fragment>\n  );\n};\n\nexport default MainMenu;\n","import React from \"react\";\nimport { useState } from \"react\";\n\nimport AppBar from \"@material-ui/core/AppBar\";\nimport Toolbar from \"@material-ui/core/Toolbar\";\nimport Typography from \"@material-ui/core/Typography\";\nimport IconButton from \"@material-ui/core/IconButton\";\nimport Popover from \"@material-ui/core/Popover\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport Box from \"@material-ui/core/Box\";\nimport Badge from \"@material-ui/core/Badge\";\n\nimport MenuIcon from \"@material-ui/icons/Menu\";\nimport ErrorIcon from \"@material-ui/icons/ErrorRounded\";\nimport SignalCellular4BarIcon from \"@material-ui/icons/SignalCellular4Bar\";\nimport SignalCellularConnectedNoInternet4BarIcon from \"@material-ui/icons/SignalCellularConnectedNoInternet4Bar\";\nimport SignalCellularNullIcon from \"@material-ui/icons/SignalCellularNull\";\n\nimport { useXContestConnectionState } from \"../location_provider/XContest/XContestInterface\";\nimport { ConnectionState } from \"../location_provider/XContest/XContestInterface\";\nimport { CircularProgress } from \"@material-ui/core\";\nimport MainMenu from \"./MainMenu\";\nimport { pure } from \"recompose\";\n\nconst useStyles = makeStyles(theme => ({\n  popover: {\n    padding: theme.spacing(1),\n    align: \"right\"\n  }\n}));\n\nconst LoadingBadge = props => {\n  return (\n    <Badge\n      //overlap=\"circle\"\n      anchorOrigin={{\n        vertical: \"bottom\",\n        horizontal: \"right\"\n      }}\n      badgeContent={\n        <CircularProgress\n          disableShrink={props.disableShrink}\n          color=\"secondary\"\n          size={15}\n          thickness={10}\n        />\n      }\n    >\n      {props.children}\n    </Badge>\n  );\n};\n\nconst TitleBar = () => {\n  const classes = useStyles();\n  const connectionState = useXContestConnectionState();\n\n  const popoverActions = React.useRef();\n  const [connectionPopAnchor, setConnectionPopAnchor] = useState(null);\n\n  const [mainMenuOpen, setMainMenuOpen] = useState(false);\n\n  React.useLayoutEffect(() => {\n    if (popoverActions.current) {\n      popoverActions.current.updatePosition();\n    }\n  }, [connectionState, connectionPopAnchor]);\n\n  const renderConnectionIcon = () => {\n    switch (connectionState) {\n      case ConnectionState.ACTIVE:\n        return <SignalCellular4BarIcon />;\n      case ConnectionState.CONNECTING:\n        return (\n          <LoadingBadge>\n            <SignalCellularNullIcon />\n          </LoadingBadge>\n        );\n      case ConnectionState.ERROR:\n        return <ErrorIcon color=\"error\" />;\n      case ConnectionState.ESTABLISHED:\n        return (\n          <LoadingBadge disableShrink>\n            <SignalCellularNullIcon />\n          </LoadingBadge>\n        );\n      case ConnectionState.INACTIVE:\n        return <SignalCellularConnectedNoInternet4BarIcon />;\n      case ConnectionState.NO_CONNECTION:\n        return <SignalCellularNullIcon />;\n      default:\n        return <SignalCellularNullIcon />;\n    }\n  };\n\n  return (\n    <div>\n      <AppBar position=\"static\">\n        <Toolbar>\n          <IconButton\n            edge=\"start\"\n            color=\"inherit\"\n            onClick={() => setMainMenuOpen(true)}\n          >\n            <MenuIcon />\n          </IconButton>\n\n          <Box marginLeft={2} flexGrow={1}>\n            <Typography variant=\"h6\">XC Live Viewer</Typography>\n          </Box>\n\n          <IconButton\n            edge=\"end\"\n            color=\"inherit\"\n            onClick={event => setConnectionPopAnchor(event.currentTarget)}\n          >\n            {renderConnectionIcon()}\n          </IconButton>\n        </Toolbar>\n      </AppBar>\n      <Popover\n        open={Boolean(connectionPopAnchor)}\n        anchorEl={connectionPopAnchor}\n        onClose={() => setConnectionPopAnchor(null)}\n        anchorOrigin={{\n          vertical: \"bottom\",\n          horizontal: \"right\"\n        }}\n        transformOrigin={{\n          vertical: \"top\",\n          horizontal: \"right\"\n        }}\n        action={popoverActions}\n      >\n        <Box className={classes.popover}>\n          <Typography>{connectionState}</Typography>\n        </Box>\n      </Popover>\n      <MainMenu\n        open={mainMenuOpen}\n        onClose={() => setMainMenuOpen(false)}\n      ></MainMenu>\n    </div>\n  );\n};\n\nexport default pure(TitleBar);\n","import React from \"react\";\nimport Box from \"@material-ui/core/Box\";\nimport SwipeableViews from \"react-swipeable-views\";\nimport {\n  BottomNavigation,\n  BottomNavigationAction,\n  useMediaQuery,\n  useTheme,\n} from \"@material-ui/core\";\n\nimport PeopleIcon from \"@material-ui/icons/People\";\nimport MapIcon from \"@material-ui/icons/Map\";\n\nimport \"./MainPage.css\";\n\n// TODO import LazyLoading from \"./util/LazyLoading\";\n\nimport LiveMap from \"./pages/GoogleMapsPage/LiveMap\";\nimport Pilots from \"./pages/PilotList/Pilots\";\nimport TitleBar from \"./pages/TitleBar\";\n\nimport PageState from \"./common/PersistentState/PageState\";\nimport { getSetting, Settings } from \"./common/PersistentState/Settings\";\nimport { PageLayout } from \"./common/PersistentState/PageLayout\";\n\nconst MainPage = () => {\n  const [tabId, setTabId] = PageState.TabID.use();\n  const [pageLayout] = getSetting(Settings.PAGE_LAYOUT).use();\n  const [windowHeight, setWindowHeight] = React.useState(0);\n  const theme = useTheme();\n  const isSmartphone = useMediaQuery(theme.breakpoints.down(\"sm\"));\n\n  // Workaround for mobile screens reporting an incorrect window height\n  const updateWindowHeight = () => {\n    setWindowHeight(window.innerHeight);\n  };\n  React.useLayoutEffect(() => {\n    updateWindowHeight();\n    window.addEventListener(\"resize\", updateWindowHeight);\n    return () => {\n      window.removeEventListener(\"resize\", updateWindowHeight);\n    };\n  }, []);\n\n  // Callbacks for changing the current page\n  const handleNavigationButton = (_event, newValue) => {\n    setTabId(newValue);\n  };\n\n  // Apply layout overrides from PAGE_LAYOUT setting\n  let showSmartphoneLayout = isSmartphone;\n  switch (pageLayout) {\n    case PageLayout.DESKTOP:\n      showSmartphoneLayout = false;\n      break;\n    case PageLayout.PHONE:\n      showSmartphoneLayout = true;\n      break;\n    default:\n      break;\n  }\n\n  const content = showSmartphoneLayout ? (\n    <React.Fragment>\n      <Box flexGrow={1} clone display=\"flex\">\n        <SwipeableViews disabled index={tabId}>\n          <Box width=\"100%\" height=\"100%\" position=\"relative\">\n            <LiveMap></LiveMap>\n          </Box>\n          <Box width=\"100%\" height=\"100%\" position=\"relative\">\n            <Pilots></Pilots>\n          </Box>\n        </SwipeableViews>\n      </Box>\n      <Box zIndex={100} boxShadow={3}>\n        <BottomNavigation\n          value={tabId}\n          onChange={handleNavigationButton}\n          showLabels\n        >\n          <BottomNavigationAction label=\"Map\" icon={<MapIcon />} />\n          <BottomNavigationAction label=\"Pilots\" icon={<PeopleIcon />} />\n        </BottomNavigation>\n      </Box>\n    </React.Fragment>\n  ) : (\n    <Box width=\"100%\" flexGrow={1} display=\"flex\" overflow=\"hidden\">\n      <Box flexGrow={1} height=\"100%\">\n        <LiveMap></LiveMap>\n      </Box>\n      <Box width=\"400px\" height=\"100%\" zIndex={50} boxShadow={3}>\n        <Pilots></Pilots>\n      </Box>\n    </Box>\n  );\n\n  return (\n    <Box\n      height={windowHeight}\n      display=\"flex\"\n      flexDirection=\"column\"\n      overflow=\"hidden\"\n    >\n      <Box zIndex={100}>\n        <TitleBar></TitleBar>\n      </Box>\n\n      {content}\n    </Box>\n  );\n};\n\nexport default MainPage;\n","import React from \"react\";\nimport MainPage from \"./MainPage\";\n\nconst App = () => {\n  return (\n    <div className=\"App\">\n      <MainPage />\n    </div>\n  );\n};\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import { decodeBase64, decodeBase64Json } from \"./util/Base64Data\";\nimport {\n  getChosenPilots,\n  defaultPilotEntry,\n  setChosenPilots,\n} from \"./common/PersistentState/ChosenPilots\";\n\nexport function processUrlParameters() {\n  const urlParams = new URLSearchParams(window.location.search);\n\n  if (urlParams.has(\"group\")) {\n    groupParameterJson(urlParams.get(\"group\"));\n  }\n\n  if (urlParams.has(\"g\")) {\n    groupParameter(urlParams.get(\"g\"));\n  }\n\n  // If there were params,\n  if (window.location.href !== window.location.href.split(\"?\")[0]) {\n    const newHref = window.location.href.split(\"?\")[0];\n    window.history.replaceState({}, \"\", newHref);\n  }\n}\n\nfunction groupParameterJson(groupData) {\n  let groupPilots = decodeBase64Json(groupData);\n  processGroupData(groupPilots);\n}\n\nfunction groupParameter(groupData) {\n  let groupPilots = decodeBase64(groupData);\n  processGroupData(groupPilots);\n}\n\nfunction processGroupData(groupPilots) {\n  console.log(\"Applying group information from url data:\", groupPilots);\n  let chosenPilots = { ...getChosenPilots() };\n\n  // Create pilots and update names\n  Object.entries(groupPilots).forEach(([pilotId, pilotName]) => {\n    if (pilotId in chosenPilots) {\n      if (pilotName != null)\n        chosenPilots[pilotId] = { ...chosenPilots[pilotId], name: pilotName };\n    } else {\n      if (pilotName != null) {\n        chosenPilots[pilotId] = defaultPilotEntry(pilotName);\n      } else {\n        chosenPilots[pilotId] = defaultPilotEntry(pilotId);\n      }\n    }\n  });\n\n  // Set visibility\n  Object.keys(chosenPilots).forEach((pilotId) => {\n    chosenPilots[pilotId] = {\n      ...chosenPilots[pilotId],\n      shown: pilotId in groupPilots,\n    };\n  });\n\n  setChosenPilots(chosenPilots);\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./App\";\nimport \"./index.css\";\nimport resolveBreakingChanges from \"./common/PersistentState/BreakingChanges\";\n\nimport \"flag-icon-css/css/flag-icon.min.css\";\n\nimport * as serviceWorker from \"./serviceWorker\";\nimport { processUrlParameters } from \"./UrlParameters\";\nimport { startNoSleepService } from \"./services/NoSleep\";\n\n// Read the .env file\nrequire(\"dotenv\").config();\n\n// Update breaking changes\nresolveBreakingChanges();\n\n// Process url parameters\nprocessUrlParameters();\n\n// Nosleep\nstartNoSleepService();\n\n// Render the page\nReactDOM.render(<App />, document.getElementById(\"root\"));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.register();\n","import {\n  getChosenPilots,\n  setChosenPilots,\n  defaultPilotEntry,\n} from \"./ChosenPilots\";\n\nfunction fixChosenPilots() {\n  let chosenPilots = { ...getChosenPilots() };\n\n  let changed = false;\n  for (let pilotId of [...Object.keys(chosenPilots)]) {\n    let chosenPilot = chosenPilots[pilotId];\n    // if chosenPilot is not an object\n    if (chosenPilot !== Object(chosenPilot)) {\n      if (typeof chosenPilot == \"string\") {\n        chosenPilots[pilotId] = defaultPilotEntry(chosenPilot);\n        changed = true;\n      } else {\n        chosenPilots[pilotId] = defaultPilotEntry(pilotId);\n        changed = true;\n      }\n    }\n  }\n\n  if (changed) {\n    setChosenPilots(chosenPilots);\n  }\n}\n\nexport default function resolveBreakingChanges() {\n  fixChosenPilots();\n}\n","import { Settings, getSetting } from \"../common/PersistentState/Settings\";\n\nimport NoSleep from \"nosleep.js\";\n\nexport function startNoSleepService() {\n  const noSleep = new NoSleep();\n\n  const enableNoSleep = () => {\n    console.debug(\"Enable nosleep!\");\n    noSleep.enable();\n  };\n\n  const disableNoSleep = () => {\n    console.debug(\"Disable nosleep!\");\n    noSleep.disable();\n  };\n\n  // Fetch setting\n  const noSleepSetting = getSetting(Settings.PREVENT_SLEEP);\n\n  // Enable wake lock.\n  // (must be wrapped in a user input event handler e.g. a mouse or touch handler)\n  const initiator = () => {\n    document.removeEventListener(\"mousedown\", initiator, false);\n    document.removeEventListener(\"touchstart\", initiator, false);\n    if (noSleepSetting.getValue()) enableNoSleep();\n  };\n\n  document.addEventListener(\"mousedown\", initiator, false);\n  document.addEventListener(\"touchstart\", initiator, false);\n\n  noSleepSetting.registerCallback((value) => {\n    if (value) {\n      enableNoSleep();\n    } else {\n      disableNoSleep();\n    }\n  });\n}\n","import { deflate, inflate } from \"pako\";\n\nimport * as cbor from \"cbor\";\n\nfunction bufferToBase64Url(data) {\n  const base64Encoded = data.toString(\"base64\");\n  const urlEscaped = base64Encoded\n    .replace(/\\+/g, \"-\") // Replace + with -\n    .replace(/\\//g, \"_\") // Replace / with _\n    .replace(/=+$/, \"\"); // Remove padding =\n  return urlEscaped;\n}\n\nfunction encodeUtf8(data) {\n  // Needs to be imported explicitely for tests\n  if (typeof TextEncoder === \"undefined\") {\n    const { TextEncoder } = require(\"util\");\n    return new TextEncoder(\"utf-8\").encode(data);\n  } else {\n    return new TextEncoder(\"utf-8\").encode(data);\n  }\n}\n\nfunction decodeUtf8(data) {\n  // Needs to be imported explicitely for tests\n  if (typeof TextDecoder === \"undefined\") {\n    const { TextDecoder } = require(\"util\");\n    return new TextDecoder(\"utf-8\").decode(data);\n  } else {\n    return new TextDecoder(\"utf-8\").decode(data);\n  }\n}\n\nexport const encodeBase64 = (value) => {\n  const cbor_value = Buffer.from(cbor.encode(value));\n  const cbor_compressed = Buffer.from(deflate(cbor_value));\n\n  const cbor_data_uncompressed = Buffer.concat([\n    Buffer.from([0x1]),\n    cbor_value,\n  ]);\n  const cbor_data_compressed = Buffer.concat([\n    Buffer.from([0x2]),\n    cbor_compressed,\n  ]);\n\n  if (cbor_data_compressed.length < cbor_data_uncompressed.length) {\n    return bufferToBase64Url(cbor_data_compressed);\n  } else {\n    return bufferToBase64Url(cbor_data_uncompressed);\n  }\n};\n\nexport const decodeBase64 = (data_base64) => {\n  const buffer = Buffer.from(data_base64, \"base64\");\n  const data_type = buffer.slice(0, 1)[0];\n  const data = buffer.slice(1);\n\n  switch (data_type) {\n    case 1:\n      return cbor.decodeFirstSync(data);\n    case 2:\n      const decompressed = Buffer.from(inflate(data));\n      return cbor.decodeFirstSync(decompressed);\n    default:\n      return null;\n  }\n};\n\n// Compatibility with previous version\nexport const decodeBase64Json = (data) => {\n  const buffer = Buffer.from(data, \"base64\");\n  const decompressed = inflate(buffer);\n  const decoded = decodeUtf8(decompressed);\n  return JSON.parse(decoded);\n};\nexport const encodeBase64Json = (value) => {\n  const json = JSON.stringify(value);\n  const encoded = encodeUtf8(json);\n  const compressed_brotli = deflate(encoded);\n  return bufferToBase64Url(Buffer.from(compressed_brotli));\n};\n"],"sourceRoot":""}