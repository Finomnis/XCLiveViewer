/*! For license information please see main.05234392.chunk.js.LICENSE.txt */
(this["webpackJsonpxc-live-viewer"]=this["webpackJsonpxc-live-viewer"]||[]).push([[0],{121:function(t){t.exports=JSON.parse('[{"featureType":"all","stylers":[{"visibility":"simplified"},{"saturation":-40}]},{"featureType":"administrative.land_parcel","stylers":[{"visibility":"off"}]},{"featureType":"administrative.neighborhood","stylers":[{"visibility":"off"}]},{"featureType":"poi","elementType":"labels.text","stylers":[{"visibility":"off"}]},{"featureType":"road","elementType":"labels","stylers":[{"visibility":"off"}]},{"featureType":"water","elementType":"labels.text","stylers":[{"visibility":"off"}]}]')},159:function(t,e,i){t.exports=i(238)},185:function(t,e,i){},216:function(t,e,i){},217:function(t,e,i){},233:function(t,e,i){},238:function(t,e,i){"use strict";i.r(e);var n=i(0),a=i.n(n),s=i(12),o=i.n(s),l=i(7),r=i(303),c=i(118),h=i.n(c),p=i(21),u=i(281),d=i(300),m=i(301),g=i(143),f=i.n(g),b=i(142),C=i.n(b),v=(i(185),i(8)),y=i(119);let E=null;function loadGoogleMapsApi(){return null===E&&(E=new y.a({apiKey:"AIzaSyBCrP5uoEJXfEvz8f_y1HgzQnqUGHz0Aak"}).load()),E}var k=i(269),w=i(46),P=i(272),S=i(120),O=i.n(S);const M=Object(k.a)(t=>({progress:{margin:t.spacing(2)}})),LoadingPage=({message:t,hideIf:e,subRef:i})=>{const n=M();return a.a.createElement(r.a,{width:"100%",height:"100%",display:e?"none":"flex",alignItems:"center",justifyContent:"center",ref:i},a.a.createElement(r.a,{textAlign:"center"},a.a.createElement(P.a,{className:n.progress}),a.a.createElement(w.a,null,t)))},ErrorPage=({message:t,hideIf:e})=>{const i=M();return a.a.createElement(r.a,{width:"100%",height:"100%",display:e?"none":"flex",alignItems:"center",justifyContent:"center"},a.a.createElement(r.a,{textAlign:"center"},a.a.createElement(O.a,{fontSize:"large",color:"error",className:i.progress}),a.a.createElement(w.a,{color:"error"},t)))};var x=i(121),_=i(17);class PersistentState_PersistentState{constructor(t,e){this.getValue=()=>{const t=localStorage.getItem(this.key);this.locallyCachedJson!==t&&(this.locallyCachedJson=t,this.locallyCachedValue=JSON.parse(t));const e=this.locallyCachedValue;return null===e?this.initialValue:e},this._notifyAll=()=>{const t=this.getValue();var e,i=Object(_.a)(this.callbacks);try{for(i.s();!(e=i.n()).done;){(0,e.value)(t)}}catch(n){i.e(n)}finally{i.f()}},this.registerCallback=t=>{this.callbacks.includes(t)||this.callbacks.push(t)},this.unregisterCallback=t=>{const e=this.callbacks.indexOf(t);e>=0&&this.callbacks.splice(e,1)},this.setValue=t=>{null==t?localStorage.removeItem(this.key):localStorage.setItem(this.key,JSON.stringify(t)),this._notifyAll()},this.updateValue=t=>{this.setValue(t(this.getValue()))},this.use=()=>{const t=Object(n.useState)(this.getValue),e=Object(l.a)(t,2),i=e[0],a=e[1];return Object(n.useEffect)(()=>{const cb=t=>{a(t)};return this.registerCallback(cb),()=>this.unregisterCallback(cb)},[]),[i,this.setValue]},this.key=t,this.initialValue=e,this.callbacks=[],this.locallyCachedJson=null,this.locallyCachedValue=null}}const registerPersistentState=(t,e)=>new PersistentState_PersistentState(t,e),T="PATH_LENGTH",A="LIMIT_PATHS",I="LOW_LATENCY",L="ANIMATION_DELAY",D="FPS_LIMIT",R="FPS_RATE",F="GPS_ENABLED",j="GPS_SHOWN",createSetting=(t,e)=>registerPersistentState("SETTINGS_"+t,e),V={PATH_LENGTH:createSetting(T,15),LIMIT_PATHS:createSetting(A,!1),LOW_LATENCY:createSetting(I,!1),ANIMATION_DELAY:createSetting(L,80),FPS_LIMIT:createSetting(D,!0),FPS_RATE:createSetting(R,10),GPS_ENABLED:createSetting(F,!0),GPS_SHOWN:createSetting(j,!0)},getSetting=t=>V[t];class XContestSocket_XContestSocket{constructor(t,e,i,n){this.formatSubscribedFlights=()=>this.subscribedFlights.map(([t,e])=>({flightUuid:t,start:null===e?null:new Date(1e3*e).toISOString()})),this.refreshSubscribedFlights=()=>{if(this.sock.readyState===WebSocket.OPEN&&this.connected){const t=this.formatSubscribedFlights();this.sock.send(JSON.stringify({tag:"WebFollow",contents:t}))}},this.setSubscribedFlights=t=>{this.subscribedFlights=t,this.refreshSubscribedFlights()},this.onOpen=()=>{this.handleReset(),console.debug("WebSocket: Open!"),this.setConnectionState(U.ESTABLISHED),this.connected=!0,this.sock.send(JSON.stringify({tag:"WebFilterArea",area:[{lat:-90,lon:-180},{lat:90,lon:180}]})),this.sock.send(JSON.stringify({tag:"WebFilterContest",contents:"alpha9999"}));const t=this.formatSubscribedFlights();this.sock.send(JSON.stringify({tag:"WebFollow",contents:t}))},this.onMessage=t=>{console.debug("WebSocket: Message!"),this.setConnectionState(U.ACTIVE);let e=JSON.parse(t.data);clearTimeout(this.watchdog),this.watchdog=setTimeout(()=>{this.setConnectionState(U.INACTIVE)},7e4),this.processMessage(e)},this.onClose=t=>{this.connected=!1,console.debug("WebSocket: Close!"),this.setConnectionState(U.NO_CONNECTION),setTimeout(this.connect.bind(this),1e3)},this.onError=t=>{this.connected=!1,console.debug("WebSocket: Error!")},this.handleReset=()=>{console.log("TODO: handle reset!")},this.processMessage=t=>{if("tag"in t)switch(t.tag){case"LiveFlightInfos":this.dispatchInfoMessage(t.contents);break;case"LiveFlightChunk":this.dispatchTracklogMessage(t);break;case"LiveFlightLanded":this.dispatchFlightLandedMessage(t.flightUuid);break;default:console.warn("Warning: Unknown message tag '".concat(t.tag,"'!"),t)}else console.warn("Warning: Invalid message format!",t)},this.setConnectionState=t,this.dispatchInfoMessage=e,this.dispatchTracklogMessage=i,this.dispatchFlightLandedMessage=n,this.subscribedFlights=[],this.connect(),this.connected=!1,getSetting(T).registerCallback(this.refreshSubscribedFlights),getSetting(A).registerCallback(this.refreshSubscribedFlights)}connect(){"WebSocket"in window?(this.connected=!1,this.setConnectionState(U.CONNECTING),this.sock=new WebSocket("wss://live.xcontest.org/websock/webclient"),this.sock.onopen=this.onOpen,this.sock.onmessage=this.onMessage,this.sock.onclose=this.onClose,this.sock.onerror=this.onError):(this.setConnectionState(U.ERROR),alert("WebSocket NOT supported by your Browser!"))}}const N=registerPersistentState("chosen-pilots",{}),getChosenPilotsObject=()=>N;function getChosenPilots(){return N.getValue()}function setChosenPilots(t){console.log("Selected pilots updated: ",t),N.setValue(t)}function setChosenPilotsAndUpdateInfos(t=null){let e=!0;null===t&&(t=Object(v.a)({},getChosenPilots()),e=!1);const i=getXContestInterface().getPilotInfos();for(const n in t)if(n in i){const a=i[n].info.user.fullname;a!==t[n].name&&(t[n].name=a,e=!0);const s=i[n].lastFix,o=t[n].lastFix;o&&o.t===s.timestamp||(t[n].lastFix={t:s.timestamp,lat:s.lat,lon:s.lon},e=!0)}e&&setChosenPilots(t)}const setPilotShown=(t,e)=>{const i=Object(v.a)({},getChosenPilots());if(t in i){const n=i[t];n.shown!==e&&(n.shown=e,setChosenPilots(i))}},defaultPilotEntry=t=>({name:t,shown:!0,lastFix:null}),addPilots=t=>{const e=Object(v.a)({},getChosenPilots());let i=!1;var n,a=Object(_.a)(t);try{for(a.s();!(n=a.n()).done;){const t=n.value;t in e||(e[t]=defaultPilotEntry(t),i=!0)}}catch(s){a.e(s)}finally{a.f()}i&&setChosenPilotsAndUpdateInfos(e)},lerp=(t,e,i)=>null===e?t:null===t?e:(1-i)*t+i*e,spline=(t,e,i,n,a,s,o,l,r)=>{s-=e,l-=e;const c=((i-t)*(r-=e)+t*(n-=e)-i*(e=0))/(n-e),h=((a-i)*r+i*s-a*n)/(s-n),p=((o-a)*r+a*l-o*s)/(l-s),u=((h-c)*r+c*s-h*e)/(s-e),d=((p-h)*r+h*l-p*n)/(l-n);return((d-u)*r+u*s-d*n)/(s-n)},splineDerivative=(t,e,i,n,a,s,o,l,r)=>{s-=e,l-=e;const c=((i-t)*(r-=e)+t*(n-=e)-i*(e=0))/(n-e),h=((a-i)*r+i*s-a*n)/(s-n),p=((o-a)*r+a*l-o*s)/(l-s),u=(i-t)/(n-e),d=(a-i)/(s-n),m=(o-a)/(l-s),g=(d*r+h-u*r-c+u*s-d*e)/(s-e),f=(m*r+p-d*r-h+d*l-m*n)/(l-n);return(f*r+((p-h)*r+h*l-p*n)/(l-n)-g*r-((h-c)*r+c*s-h*e)/(s-e)+g*s-f*n)/(s-n)};class RunningDerivation{constructor(t,e=((t,e)=>e-t),i=(t=>null===t)){this.computeDiff=e,this.isInvalid=i,this.old_val=null,this.old_t=null,this.running_avg=null,this.smoothingFactor=t}update(t,e){if(null===this.old_val||null===t||null===this.old_t||null===e||this.isInvalid(this.old_val)||this.isInvalid(t)||this.old_t===this.new_t)return this.old_val=t,this.old_t=e,null;let i=e-this.old_t,n=this.computeDiff(this.old_val,t)/i,a=Math.pow(this.smoothingFactor,i);return null===this.running_avg?this.running_avg=n:this.running_avg=a*this.running_avg+(1-a)*n,this.old_val=t,this.old_t=e,this.running_avg}reset(){this.old_val=null,this.old_t=null,this.running_avg=null}}var G=i(28);var FindBisect=(t,e,i)=>{if(e<1)return 0;let n=-1,a=e,s=0,o=null;for(;n<a-1;)s=(n+a)/2|0,o=i(s),o<t?n=s:a=s;return a};const parseTime=t=>Math.round(Date.parse(t)/1e3);class FlightAnimationData_FlightAnimationData{constructor(){this.at=t=>this.data[t],this.findBisect=t=>FindBisect(t,this.data.length,t=>this.data[t].t),this.findForwardSwipe=(t,e)=>{let i=e;for(;i<this.data.length&&this.data[i].t<t;)i+=1;return i},this.getNewestTimestamp=()=>this.data.length<1?null:this.data[this.data.length-1].t,this.data=[],this.counter_gpsVario=new RunningDerivation(.7),this.counter_baroVarion=new RunningDerivation(.7),this.counter_velocity=new RunningDerivation(.7,(t,e)=>Object(G.getDistance)(t,e,.01),()=>!1)}clear(){this.data=[],this.counter_gpsVario=new RunningDerivation(.7),this.counter_baroVarion=new RunningDerivation(.7),this.counter_velocity=new RunningDerivation(.7,(t,e)=>Object(G.getDistance)(t,e,.01),()=>!1)}get length(){return this.data.length}isAfterLastElement(t){return this.data.length<=0||this.data[this.data.length-1].t<t}append(t){var e,i=Object(_.a)(t);try{for(i.s();!(e=i.n()).done;){const t=e.value,i=parseTime(t.timestamp),n={lat:t.lat,lng:t.lon},a=0===t.baroAlt?null:t.baroAlt,s=0===t.gpsAlt?null:t.gpsAlt,o=this.counter_gpsVario.update(s,i),l=this.counter_baroVarion.update(a,i),r=this.counter_velocity.update(n,i),c={baroAlt:a,gpsAlt:s,elevation:t.elevation,pos:n,gpsVario:o,baroVario:l,velocity:r,t:i};this.data.push(c)}}catch(n){i.e(n)}finally{i.f()}}replace(t){this.clear(),this.append(t)}insert(t){const e=[];var i,n=Object(_.a)(t);try{for(n.s();!(i=n.n()).done;){const t=i.value,n=parseTime(t.timestamp),a={lat:t.lat,lng:t.lon},s={baroAlt:0===t.baroAlt?null:t.baroAlt,gpsAlt:0===t.gpsAlt?null:t.gpsAlt,elevation:t.elevation,pos:a,gpsVario:null,baroVario:null,velocity:null,t:n};e.push(s)}}catch(c){n.e(c)}finally{n.f()}const a=this.data;this.data=[];let s=0,o=0;for(;!(s>=a.length&&o>=e.length);)if(s>=a.length)this.data.push(e[o]),o+=1;else if(o>=e.length)this.data.push(a[s]),s+=1;else{const t=a[s],i=e[o];i.t<t.t?(this.data.push(i),o+=1):t.t<i.t?(this.data.push(t),s+=1):(this.data.push(i),s+=1,o+=1)}this.counter_gpsVario.reset(),this.counter_baroVarion.reset(),this.counter_velocity.reset();var l,r=Object(_.a)(this.data);try{for(r.s();!(l=r.n()).done;){let t=l.value;const e=this.counter_gpsVario.update(t.gpsAlt,t.t),i=this.counter_baroVarion.update(t.baroAlt,t.t),n=this.counter_velocity.update(t.pos,t.t);t.gpsVario=e,t.baroVario=i,t.velocity=n}}catch(c){r.e(c)}finally{r.f()}}}class FlightAnimationDataCache{constructor(){this.reset=()=>{this.currentArrayPos=null,this.mapsPath=[],this.mapsPathNewestPos=0},this.currentArrayPos=null,this.mapsPath=[],this.mapsPathNewestPos=0}}class FlightAnimation_DataGens{static takeData(t){return{baroAlt:t.baroAlt,gpsAlt:t.gpsAlt,elevation:t.elevation,pos:{lat:t.pos.lat,lng:t.pos.lng},gpsVario:t.gpsVario,baroVario:t.baroVario,velocity:t.velocity}}static blendData(t,e,i){const n=(i-t.t)/(e.t-t.t);return{baroAlt:lerp(t.baroAlt,e.baroAlt,n),gpsAlt:lerp(t.gpsAlt,e.gpsAlt,n),elevation:lerp(t.elevation,e.elevation,n),pos:{lat:lerp(t.pos.lat,e.pos.lat,n),lng:lerp(t.pos.lng,e.pos.lng,n)},gpsVario:lerp(t.gpsVario,e.gpsVario,n),baroVario:lerp(t.baroVario,e.baroVario,n),velocity:lerp(t.velocity,e.velocity,n)}}static blendDataSpline(t,e,i,n,a){const s=(a-e.t)/(i.t-e.t);return{baroAlt:lerp(e.baroAlt,i.baroAlt,s),gpsAlt:lerp(e.gpsAlt,i.gpsAlt,s),elevation:lerp(e.elevation,i.elevation,s),pos:{lat:spline(t.pos.lat,t.t,e.pos.lat,e.t,i.pos.lat,i.t,n.pos.lat,n.t,a),lng:spline(t.pos.lng,t.t,e.pos.lng,e.t,i.pos.lng,i.t,n.pos.lng,n.t,a)},gpsVario:lerp(e.gpsVario,i.gpsVario,s),baroVario:lerp(e.baroVario,i.baroVario,s),velocity:lerp(e.velocity,i.velocity,s)}}static computeLinearVelocity(t,e){const i=t.t,n=e.t;if(i===n)return null;const a=n-i,s=t.pos,o=e.pos;return{lat:(o.lat-s.lat)/a,lng:(o.lng-s.lng)/a}}static computeSplineVelocity(t,e,i,n,a){const s=t.t,o=e.t,l=i.t,r=n.t,c=t.pos,h=e.pos,p=i.pos,u=n.pos;return{lat:splineDerivative(c.lat,s,h.lat,o,p.lat,l,u.lat,r,a),lng:splineDerivative(c.lng,s,h.lng,o,p.lng,l,u.lng,r,a)}}}FlightAnimation_DataGens.fallbackData=t=>({baroAlt:t.lastFix.baroAlt,gpsAlt:t.lastFix.gpsAlt,elevation:t.lastFix.elevation,pos:{lat:t.lastFix.lat,lng:t.lastFix.lon},gpsVario:null,baroVario:null,velocity:null});var H=class FlightAnimation_FlightAnimation{constructor(t){this.destroy=()=>{getSetting(L).unregisterCallback(this.updateSettings),getSetting(I).unregisterCallback(this.updateSettings),getSetting(T).unregisterCallback(this.updateSettings),getSetting(A).unregisterCallback(this.updateSettings)},this.updateSettings=()=>{this.settings={timeOffsetSeconds:getSetting(L).getValue(),lowLatencyMode:getSetting(I).getValue(),trackLengthMinutes:getSetting(T).getValue(),limitTracks:getSetting(A).getValue()},this.liveDataCache.reset(),this.flightInfoDataCache.reset()},this.updateInfos=t=>{this.landed|=t.landed,this.flightInfos=t,this.flightInfoData.replace(t.track),this.flightInfoDataCache.reset()},this.updateData=t=>{if(t.length<1)return;const e=parseTime(t[0].timestamp);this.liveData.isAfterLastElement(e)?this.liveData.append(t):(this.liveData.insert(t),this.liveDataCache.reset())},this.updateLanded=()=>{console.log("Received flight landed message!"),this.landed=!0},this.getInterpolatedData=(t,e,i)=>{if(t.length<1)return null;null===e.currentArrayPos?e.currentArrayPos=t.findBisect(i):e.currentArrayPos=t.findForwardSwipe(i,e.currentArrayPos);let n=null,a=!1,s=!1,o=null;if(e.currentArrayPos<=0)n=FlightAnimation_DataGens.takeData(t.at(0)),t.length>=2&&(o=FlightAnimation_DataGens.computeLinearVelocity(t.at(0),t.at(1))),s=!0;else if(e.currentArrayPos>=t.length)n=FlightAnimation_DataGens.takeData(t.at(t.length-1)),t.length>=2&&(o=FlightAnimation_DataGens.computeLinearVelocity(t.at(t.length-2),t.at(t.length-1))),a=!0;else{const a=t.at(e.currentArrayPos-1),s=t.at(e.currentArrayPos),l=e.currentArrayPos-2>=0?t.at(e.currentArrayPos-2):Object(v.a)({},a,{t:a.t-1}),r=e.currentArrayPos+1<t.length?t.at(e.currentArrayPos+1):Object(v.a)({},s,{t:s.t+1});n=FlightAnimation_DataGens.blendDataSpline(l,a,s,r,i),o=FlightAnimation_DataGens.computeSplineVelocity(l,a,s,r,i)}return[n,s,a,t.at(t.length-1).t,o]},this.getFallbackData=()=>[FlightAnimation_DataGens.fallbackData(this.flightInfos),!1,!0,parseTime(this.flightInfos.lastFix.timestamp),null],this.computeTrack=(t,e,i)=>{if(t.length<1)return null;const n=i-60*this.settings.trackLengthMinutes;let a=e.mapsPath;for(;e.mapsPathNewestPos<t.length&&t.at(e.mapsPathNewestPos).t<i;){const i=t.at(e.mapsPathNewestPos);a.push({lat:i.pos.lat,lng:i.pos.lng,timestamp:i.t,altitude:null!==i.gpsAlt?i.gpsAlt:i.baroAlt,elevation:i.elevation}),e.mapsPathNewestPos+=1}if(this.settings.limitTracks){const t=32;let i=0;for(;i+t-1<a.length&&a[i+t-1].timestamp<n;)i+=t;i>0&&(a=a.slice(i),e.mapsPath=a)}return a},this.updateAnimation=t=>{const e=this.settings.lowLatencyMode?t/1e3:t/1e3-this.settings.timeOffsetSeconds;let i=this.getInterpolatedData(this.liveData,this.liveDataCache,e);i||(i=this.getInterpolatedData(this.flightInfoData,this.flightInfoDataCache,e)),i||(i=this.getFallbackData());let n=this.computeTrack(this.liveData,this.liveDataCache,e);n||(n=this.computeTrack(this.flightInfoData,this.flightInfoDataCache,e)),n||(n=[]);let a=i,s=Object(l.a)(a,5),o=s[0],r=s[1],c=s[2],h=s[3],p=s[4];this.settings.lowLatencyMode&&(c=!!this.landed||h<e-80);let u=e;return this.landed&&(u=Math.min(h,e)),Object(v.a)({},o,{startOfTrack:r,endOfTrack:c,landed:this.landed,name:this.flightInfos.info.user.fullname,newestDataTimestamp:h,track:n,velocityVec:p,lastPotentialAirTime:Math.round(u)})},this.getNewestTimestamp=()=>this.liveData.getNewestTimestamp(),this.liveData=new FlightAnimationData_FlightAnimationData,this.liveDataCache=new FlightAnimationDataCache,this.flightInfos=null,this.flightInfoData=new FlightAnimationData_FlightAnimationData,this.flightInfoDataCache=new FlightAnimationDataCache,this.landed=t.landed,this.updateInfos(t),this.settings={},this.updateSettings(),getSetting(L).registerCallback(this.updateSettings),getSetting(I).registerCallback(this.updateSettings),getSetting(T).registerCallback(this.updateSettings),getSetting(A).registerCallback(this.updateSettings)}};var W=class HighPrecisionTimeSync{constructor(t=20){this.get=(t,e)=>{let i=t+this.offset;const n=i-e;return(n>this.tolerance||n<-this.tolerance)&&(this.offset-=n,i=t+this.offset),i},this.offset=0,this.tolerance=t}};class XContestAnimation_XContestAnimation{constructor(t){this._nextUpdate=Date.now(),this.animationLoop=()=>{const t=Date.now(),e=1e3/this._setting_fps;if(!this._setting_limitFps||t>=this._nextUpdate){this._setting_limitFps&&(this._nextUpdate+=e,t>this._nextUpdate&&(this._nextUpdate=t));const i={},n={};Object.entries(this._subscribedPilots).forEach(([e,a])=>{if(e in this._pilotInfos){const s=this._pilotInfos[e].flightId;if(s in this._flightAnimations){const o=this._flightAnimations[s].updateAnimation(t);i[e]=o,a.shown&&(n[e]=o)}}}),this._submitAnimationFrame({pilotData:i,pilotData_filtered:n})}requestAnimationFrame(this.animationLoop)},this._submitAnimationFrame=t=>{this._currentAnimationData=t;var e,i=Object(_.a)(this._callbacks);try{for(i.s();!(e=i.n()).done;){(0,e.value)(t)}}catch(n){i.e(n)}finally{i.f()}},this.setSubscribedPilots=t=>{this._subscribedPilots=t,this._updateImportantFlights()},this.pushNewInfo=t=>{console.log("newInfo: ",t),this._pilotInfos=t,this._updateImportantFlights(),Object.values(t).forEach(t=>{const e=t.flightId;e in this._flightAnimations&&this._flightAnimations[e].updateInfos(t)})},this.pushNewData=(t,e)=>{console.log("newTrackdata: ",t,e),t in this._flightAnimations&&this._flightAnimations[t].updateData(e)},this.pushFlightLanded=t=>{t in this._flightAnimations&&this._flightAnimations[t].updateLanded()},this.registerCallback=t=>{this._callbacks.includes(t)||this._callbacks.push(t),t(this._currentAnimationData)},this.unregisterCallback=t=>{const e=this._callbacks.indexOf(t);e>=0&&this._callbacks.splice(e,1)},this.getData=()=>this._currentAnimationData,this._updateImportantFlights=()=>{let t={};Object.values(this._pilotInfos).filter(t=>t.info.user.username in this._subscribedPilots).forEach(e=>{t[e.flightId]=e});let e=new Set(Object.keys(t));{const e=[];for(const i in this._flightAnimations)i in t||e.push(i);for(var i=0,n=e;i<n.length;i++){const t=n[i];console.log("Removing flightAnimation of '"+t+"' ..."),this._flightAnimations[t].destroy(),delete this._flightAnimations[t]}}if(Object.entries(t).forEach(([t,e])=>{t in this._flightAnimations||(this._flightAnimations[t]=new H(e))}),!function eqSet(t,e){if(t.size!==e.size)return!1;var i,n=Object(_.a)(t);try{for(n.s();!(i=n.n()).done;){const t=i.value;if(!e.has(t))return!1}}catch(a){n.e(a)}finally{n.f()}return!0}(e,this._subscribedFlights)){this._subscribedFlights=e;let t=[];console.log(this._flightAnimations),e.forEach(e=>{console.log(e,this._flightAnimations[e]),t.push([e,this._flightAnimations[e].getNewestTimestamp()])}),console.log("Changing flight subscribtion: ",this._subscribedFlights,e),this._setSubscribedFlightsCallback(t)}},this._currentAnimationData={pilotData:{},pilotData_filtered:{}},this._callbacks=[],this._subscribedPilots=getChosenPilots(),this._subscribedFlights=new Set,this._pilotInfos={},this._flightAnimations={},this._highPrecisionTimeSync=new W;const e=getSetting(D),i=getSetting(R);this._setting_limitFps=e.getValue(),this._setting_fps=i.getValue(),e.registerCallback(t=>{this._setting_limitFps=t}),i.registerCallback(t=>{this._setting_fps=t}),this._setSubscribedFlightsCallback=e=>{t(Array.from(e))},getChosenPilotsObject().registerCallback(this.setSubscribedPilots),requestAnimationFrame(this.animationLoop)}}var z=class EventfulState_EventfulState{constructor(t){this.set=t=>{this._callbackData=t;var e,i=Object(_.a)(this._callbacks);try{for(i.s();!(e=i.n()).done;){(0,e.value)(t)}}catch(n){i.e(n)}finally{i.f()}},this.getValue=()=>this._callbackData,this.registerCallback=t=>{this._callbacks.includes(t)||this._callbacks.push(t)},this.unregisterCallback=t=>{const e=this._callbacks.indexOf(t);e>=0&&this._callbacks.splice(e,1)},this.use=()=>{const t=Object(n.useState)(this._callbackData),e=Object(l.a)(t,2),i=e[0],a=e[1];return Object(n.useEffect)(()=>(this.registerCallback(a),()=>this.unregisterCallback(a)),[]),i},this._callbacks=[],this._callbackData=t}};const U={CONNECTING:"connecting",ERROR:"error",ESTABLISHED:"established",ACTIVE:"active",INACTIVE:"inactive",NO_CONNECTION:"no connection",NO_INFORMATION:"no information"};class XContestInterface_XContestInterface{constructor(){this.setSubscribedFlights=t=>{this.socket.setSubscribedFlights(t)},this.getPilotInfos=()=>this.pilots,this.onConnectionStateChanged=t=>{this.connectionState.set(t)},this.onInfoMessageReceived=t=>{this.pilots={};var e,i=Object(_.a)(t);try{for(i.s();!(e=i.n()).done;){const t=Object(l.a)(e.value,2),i=t[0],n=t[1];n.overriden||(n.flightId=i,this.pilots[n.info.user.username]=n)}}catch(n){i.e(n)}finally{i.f()}this.animation.pushNewInfo(this.pilots),this.pilotInfos.set(this.pilots),setChosenPilotsAndUpdateInfos()},this.onTracklogMessageReceived=t=>{this.animation.pushNewData(t.flightUuid,t.trackChunk)},this.onFlightLandedMessageReceived=t=>{this.animation.pushFlightLanded(t)},this.pilots=[],this.connectionState=new z(U.NO_INFORMATION),this.pilotInfos=new z([]),this.socket=new XContestSocket_XContestSocket(this.onConnectionStateChanged,this.onInfoMessageReceived,this.onTracklogMessageReceived,this.onFlightLandedMessageReceived),this.animation=new XContestAnimation_XContestAnimation(this.setSubscribedFlights)}}let B=null;const getXContestInterface=()=>(B||(B=new XContestInterface_XContestInterface),B);function createRng(t){const e=function xmur3(t){for(var e=0,i=1779033703^t.length;e<t.length;e++)i=(i=Math.imul(i^t.charCodeAt(e),3432918353))<<13|i>>>19;return function(){return i=Math.imul(i^i>>>16,2246822507),i=Math.imul(i^i>>>13,3266489909),(i^=i>>>16)>>>0}}(t);return function sfc32(t,e,i,n){return function(){var a=(t>>>=0)+(e>>>=0)|0;return t=e^e>>>9,e=(i>>>=0)+(i<<3)|0,i=(i=i<<21|i>>>11)+(a=a+(n=(n>>>=0)+1|0)|0)|0,(a>>>0)/4294967296}}(e(),e(),e(),e())}var X=i(122),J=i.n(X);function string2color(t,e){const i=createRng(t),n=Math.min(Math.max(360*i(),0),360);return"#"+J.a.hsl.hex(n,100,e)}const getPilotIconColor=t=>string2color(t,70),getPilotIcon=(t,e,i,n,a,s)=>{if(e)return i?{path:"m 12.66,19.78 6.46,-4.61 C 19.67,14.78 20,14.15 20,13.48 20,11.77 18.08,10.79 16.7,11.77 L 12,15.12 7.3,11.77 c -1.38,-0.99 -3.3,0 -3.3,1.71 0,0.67 0.33,1.31 0.88,1.7 l 6.46,4.62 c 0.4,0.27 0.93,0.27 1.33,-0.01 z m 0,-8 6.46,-4.6 C 19.67,6.78 20,6.15 20,5.48 20,3.77 18.08,2.78 16.7,3.77 L 12,7.12 7.3,3.77 C 5.92,2.78 4,3.77 4,5.48 4,6.15 4.33,6.79 4.88,7.18 l 6.46,4.62 c 0.4,0.27 0.93,0.27 1.33,-0.01 z",fillColor:s,fillOpacity:1,anchor:{x:12,y:20},strokeWeight:1,scale:1.2}:{path:"M 12.747,2 C 12.492,1.998 12.234,2.006 11.973,2.023 8.105,2.256 6.071,4.458 5.904,8.427 H 9.806 C 9.839,7.06 10.64,6.025 12.041,5.859 c 1.401,-0.133 2.735,0.2 3.135,1.134 0.434,1.034 -0.534,2.234 -1.001,2.734 -0.867,0.934 -2.268,1.634 -3.002,2.635 -0.7,1.001 -0.834,2.302 -0.901,3.902 h 3.435 c 0.033,-1.034 0.1,-2.001 0.567,-2.635 0.767,-1.034 1.901,-1.501 2.835,-2.335 0.9,-0.767 1.868,-1.701 2.001,-3.168 C 19.642,4.093 16.568,2.023 12.747,2 Z M 12.074,17.731 A 2.168,2.134 0 0 0 9.906,19.865 2.168,2.134 0 0 0 12.074,22 2.168,2.134 0 0 0 14.242,19.865 2.168,2.134 0 0 0 12.074,17.731 Z",fillColor:s,fillOpacity:1,anchor:{x:12,y:12},strokeWeight:1,scale:1.2};if(t)return{path:"M 12,2 C 8.13,2 5,5.13 5,9 c 0,5.25 7,13 7,13 0,0 7,-7.75 7,-13 0,-3.87 -3.13,-7 -7,-7",fillColor:s,fillOpacity:1,anchor:{x:12,y:22},strokeWeight:1,scale:1.2};return{path:"M12.93 4.26l6.15 14.99c.34.83-.51 1.66-1.33 1.29l-5.34-2.36c-.26-.11-.55-.11-.81 0l-5.34 2.36c-.82.36-1.67-.46-1.33-1.29l6.15-14.99c.33-.83 1.51-.83 1.85 0z",fillColor:s,fillOpacity:1,anchor:{x:12,y:12},strokeWeight:1,scale:1.2,rotation:null===a?0:Object(G.getRhumbLineBearing)(n,{lat:n.lat+a.lat,lng:n.lng+a.lng})}};class MapViewportControllerService_MapViewportControllerService{constructor(){this.setFreeMode=()=>{this.state.updateValue(t=>Object(v.a)({},t,{enabled:!1}))},this.setSinglePilotMode=t=>{this.state.updateValue(e=>Object(v.a)({},e,{enabled:!0,followSinglePilot:t})),this._emitZoomToSinglePilot()},this.setFollowMode=()=>{this.state.updateValue(t=>Object(v.a)({},t,{enabled:!0,followSinglePilot:null}))},this._emitZoomToSinglePilot=()=>{var t,e=Object(_.a)(this.mapControllers);try{for(e.s();!(t=e.n()).done;){t.value.zoomToSinglePilot()}}catch(i){e.e(i)}finally{e.f()}},this.onSelfShownChanged=t=>{this.state.updateValue(e=>Object(v.a)({},e,{includeSelf:t}))},this.onAnimationFrame=({pilotData_filtered:t})=>{this.state.updateValue(e=>{const i=Object(v.a)({},e);i.pilots=Object(v.a)({},i.pilots);for(const n in e.pilots)n in t||delete i.pilots[n];for(const n in t)n in i.pilots||(i.pilots[n]=!0);return i});var e,i=Object(_.a)(this.mapControllers);try{for(i.s();!(e=i.n()).done;){e.value.onAnimationFrame(t,this.state.getValue())}}catch(n){i.e(n)}finally{i.f()}},this.registerMapController=t=>{this.mapControllers.includes(t)||this.mapControllers.push(t)},this.unregisterMapController=t=>{const e=this.mapControllers.indexOf(t);e>=0&&this.mapControllers.splice(e,1)},this.mapControllers=[],this.state=registerPersistentState("viewport-state",{includeSelf:getSetting(j).getValue(),enabled:!0,followSinglePilot:null,pilots:{}}),this.state.setValue(null),getXContestInterface().animation.registerCallback(this.onAnimationFrame),getSetting(j).registerCallback(this.onSelfShownChanged)}}let Y=null;const getMapViewportControllerService=()=>(Y||(Y=new MapViewportControllerService_MapViewportControllerService),Y);class GoogleMapsTrack_GoogleMapsTrack{constructor(t,e,i,n,a,s,o){this.computeIconBottomLeftCornerPos=t=>{const e=t.target;return null==e?null:{left:e.x/window.devicePixelRatio+e.width/2-13,top:e.y/window.devicePixelRatio+e.height/2+13}},this.setMap=t=>{this.marker.setMap(t),this.track.setMap(t),this.newestTrackSegment.setMap(t)},this._updateTrack=t=>{if(!t||t.length<1)return;const e=t.length,i=t[0].timestamp,n=t[e-1].timestamp;if(i!==this.currentTrackVersion.startTime||n!==this.currentTrackVersion.endTime||e!==this.currentTrackVersion.length){if(i===this.currentTrackVersion.startTime&&e>this.currentTrackVersion.length&&n>this.currentTrackVersion.endTime){let i=this.track.getPath(),a=i.getLength();for(;a<e;){const e=t[a];a=i.push(new this.google.maps.LatLng(e.lat,e.lng))}return this.currentTrackVersion.endTime=n,void(this.currentTrackVersion.length=e)}this.currentTrackVersion.startTime=i,this.currentTrackVersion.endTime=n,this.currentTrackVersion.length=e,this.track.setPath(t)}},this._updateNewestSegment=(t,e)=>{null===this.newestTrackSegmentData&&(this.newestTrackSegment.setPath([t,e]),this.newestTrackSegmentData=[t,e]);const i=Object(l.a)(this.newestTrackSegmentData,2),n=i[0],a=i[1];this.newestTrackSegmentData=[t,e];const s=this.newestTrackSegment.getPath();if(t.lat!==n.lat||t.lng!==n.lng){const e=new this.google.maps.LatLng(t.lat,t.lng);s.setAt(0,e)}if(a.lat!==e.lat||a.lng!==e.lng){const t=new this.google.maps.LatLng(e.lat,e.lng);s.setAt(1,t)}},this.updateData=t=>{this.marker.setPosition(t.pos);let e=this.marker.getIcon();const i=getPilotIcon(t.startOfTrack,t.endOfTrack,t.landed,t.pos,t.velocityVec,this.pilotColor);if(((t,e)=>{for(let i in t)if(!(i in e))return!0;for(let i in e){if(!(i in t))return!0;if("anchor"===i){if(t[i].x!==e[i].x||t[i].y!==e[i].y)return!0}else if(t[i]!==e[i])return!0}return!1})(e,i)&&this.marker.setIcon(i),t.track.length>0){const e=t.track[t.track.length-1],i=t.pos;this._updateNewestSegment(i,e)}this._updateTrack(t.track)},this.google=t,this.pilotInfoWindow=a,this.pilotColor=getPilotIconColor(i.info.user.username),this.trackColor=string2color(i.info.user.username,40),this.pilotIcon=getPilotIcon(n.startOfTrack,n.endOfTrack,n.landed,n.pos,n.velocityVec,this.pilotColor),this.marker=new this.google.maps.Marker({map:e,position:n.pos,title:i.info.user.fullname,icon:this.pilotIcon}),this.marker.addListener("click",()=>{o()&&this.pilotInfoWindow.open(this.map,this.marker,i.info.user.username)}),this.marker.addListener("dblclick",()=>{getMapViewportControllerService().setSinglePilotMode(i.info.user.username)}),this.marker.addListener("mousedown",({tb:t})=>{s(!0,this.computeIconBottomLeftCornerPos(t))}),this.marker.addListener("mouseup",()=>{s(!1,null)}),this.marker.addListener("mouseover",({tb:t})=>{s(!0,this.computeIconBottomLeftCornerPos(t))}),this.marker.addListener("mouseout",()=>{s(!1,null)}),this.track=new this.google.maps.Polyline({map:e,path:[],strokeColor:this.trackColor}),this.currentTrackVersion={startTime:null,endTime:null,length:null},this.newestTrackSegment=new this.google.maps.Polyline({map:e,path:[],strokeColor:this.trackColor}),this.newestTrackSegmentData=null}}class MapPilotInfoWindow{constructor(t){this.open=(t,e,i)=>{this.currentPilot=i,this.infoWindow.open(t,e),this.updateContent()},this.close=()=>{this.infoWindow.close(),this.currentPilot=null,this.updateContent()},this.update=t=>{this.data=t,this.updateContent()},this.updateContent=()=>{if(null==this.infoWindow.anchor)return void(this.currentPilot=null);if(null===this.currentPilot)return;if(!(this.currentPilot in this.data))return this.currentPilot=null,void this.infoWindow.close();const t=this.data[this.currentPilot],e=null===t.gpsAlt?t.baroAlt:t.gpsAlt,i=Math.max(e-t.elevation,0);let n="";if(n+="<b>"+t.name+"</b><br>",n+=Math.round(e)+"m (",n+=Math.round(i)+"m)<br>",null!==t.baroVario&&!t.landed){const e=Math.round(10*t.baroVario);let i=Math.abs(e);i>99&&(i=99),n+="<span>"+((e>=0?"&plus;":"&minus;")+Math.floor(i/10)+"."+i%10+"m/s")+"</span>&nbsp;&nbsp;"}null===t.velocity||t.landed||(n+=Math.round(3.6*t.velocity)+"km/h"),this.infoWindow.getContent()!==n&&this.infoWindow.setContent(n)},this.google=t,this.infoWindow=new t.maps.InfoWindow({content:"- ERROR -",pixelOffset:new t.maps.Size(0,-5),disableAutoPan:!0}),this.data={},this.currentPilot=null}}class MapAnimator_MapAnimator{constructor(t,e,i){this.cleanupOldTracks=t=>{const e=[];for(const a in this.tracks)a in t||e.push(a);for(var i=0,n=e;i<n.length;i++){const t=n[i];this.tracks[t].setMap(null),delete this.tracks[t]}},this.onMouseOver=(t,e,i)=>{e?(t in this.currentMouseOvers||(this.currentMouseOvers[t]={num:0,pos:{left:0,top:0}}),this.currentMouseOvers[t].num+=1,null!=i&&(this.currentMouseOvers[t].pos=i)):t in this.currentMouseOvers&&(this.currentMouseOvers[t].num-=1,this.currentMouseOvers[t].num<=0&&delete this.currentMouseOvers[t])},this.update=({pilotData_filtered:t})=>{const e=getXContestInterface().getPilotInfos();this.cleanupOldTracks(t),Object.entries(t).forEach(([t,i])=>{if(!(t in e))return;const n=e[t];t in this.tracks||(this.tracks[t]=new GoogleMapsTrack_GoogleMapsTrack(this.google,this.map,n,i,this.infoWindow,(e,i)=>this.onMouseOver(t,e,i),this.canReceiveMouseClicks)),this.tracks[t].updateData(i)}),this.infoWindow.update(t)},this.map=t,this.google=e,this.tracks={},this.infoWindow=new MapPilotInfoWindow(e),this.currentMouseOvers={},this.canReceiveMouseClicks=i}}i(216);class GPSProvider_GPSProvider{constructor(){this._updateGPSState=()=>{let t=getSetting(F).getValue(),e=this._callbacks.length>0,i=t&&e;null===this._watchId&&i&&navigator.geolocation&&(this._watchId=navigator.geolocation.watchPosition(this._onNewGPSData,this._onGPSError,{enableHighAccuracy:!0}),console.log("GPS: On")),null===this._watchId||i||(navigator.geolocation.clearWatch(this._watchId),this._watchId=null,this._setGPSData(null),console.log("GPS: Off"))},this._setGPSData=t=>{console.log("GPS DATA:",t),this._gpsData=t;var e,i=Object(_.a)(this._callbacks);try{for(i.s();!(e=i.n()).done;){(0,e.value)(t)}}catch(n){i.e(n)}finally{i.f()}},this._onNewGPSData=t=>{this._setGPSData(t)},this._onGPSError=()=>{this._setGPSData(null)},this.registerCallback=t=>{this._callbacks.includes(t)||this._callbacks.push(t),this._updateGPSState(),t(this._gpsData)},this.unregisterCallback=t=>{const e=this._callbacks.indexOf(t);e>=0&&this._callbacks.splice(e,1),this._updateGPSState()},this.getData=()=>this._gpsData,this._callbacks=[],this._watchId=null,this._gpsData=null,getSetting(F).registerCallback(this._updateGPSState),this._updateGPSState()}}let q=null;const getGPSProvider=()=>(q||(q=new GPSProvider_GPSProvider),q);class GoogleMapsController_GoogleMapsController{constructor(t,e){this.zoomToSinglePilot=()=>{this.insideMapsApiFunction=!0,this.map.getZoom()<12&&this.map.setZoom(12),this.insideMapsApiFunction=!1},this.shutdown=()=>{getGPSProvider().unregisterCallback(this.onGpsUpdate)},this.onGpsUpdate=t=>{this.gpsState=t},this.onUserInput=()=>{this.insideMapsApiFunction||getMapViewportControllerService().setFreeMode()},this.updateViewport=t=>{const e=this.singlePersonMode;if(this.singlePersonMode=!1,0===t.length)return;if(1===t.length)return this.insideMapsApiFunction=!0,this.map.panTo(t[0]),this.insideMapsApiFunction=!1,e||this.zoomToSinglePilot(),void(this.singlePersonMode=!0);let i=new this.google.maps.LatLngBounds(t[0],t[0]);t.forEach(t=>i.extend(t)),this.insideMapsApiFunction=!0,this.map.fitBounds(i),this.insideMapsApiFunction=!1},this.onAnimationFrame=(t,e)=>{if(!this.viewportInitialized){let e=[];for(var i=0,n=Object.entries(t);i<n.length;i++){const t=Object(l.a)(n[i],2)[1];e.push(t.pos)}this.gpsState&&e.push({lat:this.gpsState.coords.latitude,lng:this.gpsState.coords.longitude}),0!==e.length&&(this.updateViewport(e),this.viewportInitialized=!0)}if(!e.enabled)return void this.updateViewport([]);if(null!==e.followSinglePilot){const i=e.followSinglePilot;if(i in t)return void this.updateViewport([t[i].pos])}let a=[];e.includeSelf&&this.gpsState&&a.push({lat:this.gpsState.coords.latitude,lng:this.gpsState.coords.longitude});for(var s=0,o=Object.entries(e.pilots);s<o.length;s++){const e=Object(l.a)(o[s],2),i=e[0];e[1]&&i in t&&a.push(t[i].pos)}this.updateViewport(a)},this.google=t,this.map=e,this.lastUpdate=Date.now(),this.gpsState=getGPSProvider().getData(),getGPSProvider().registerCallback(this.onGpsUpdate),this.viewportInitialized=!1,this.singlePersonMode=!1,this.userInputListeners=[e.addListener("dragstart",this.onUserInput)],this.insideMapsApiFunction=!1}}i(217);const createButtonIcon=(t,e)=>{const i="http://www.w3.org/2000/svg";let n=document.createElementNS(i,"svg");n.setAttribute("width","24"),n.setAttribute("height","24"),n.setAttribute("viewBox",e);let a=document.createElementNS(i,"path");return a.setAttribute("d",t),n.appendChild(a),n};function createSatelliteMapButton(t,e){var i=document.createElement("div"),n=document.createElement("div");return n.classList.add("custom-google-maps-button"),n.title="Toggle satellite view",n.appendChild(createButtonIcon("M8.57 6H6v2.58c1.42 0 2.57-1.16 2.57-2.58zM12 6h-1.71c0 2.36-1.92 4.29-4.29 4.29V12c3.32 0 6-2.69 6-6zm2.14 5.86l-3 3.87L9 13.15 6 17h12z","0 0 24 24")),i.appendChild(n),i.onclick=()=>{e.getMapTypeId()===t.maps.MapTypeId.HYBRID?e.setMapTypeId(t.maps.MapTypeId.TERRAIN):e.setMapTypeId(t.maps.MapTypeId.HYBRID)},i}function createFocusCameraMapButton(t,e){var i=document.createElement("div"),n=document.createElement("div");return n.classList.add("custom-google-maps-button"),n.title="Focus camera",n.appendChild(createButtonIcon("M10 30h-4v8c0 2.21 1.79 4 4 4h8v-4h-8v-8zm0-20h8v-4h-8c-2.21 0-4 1.79-4 4v8h4v-8zm28-4h-8v4h8v8h4v-8c0-2.21-1.79-4-4-4zm0 32h-8v4h8c2.21 0 4-1.79 4-4v-8h-4v8zm-14-22c-4.42 0-8 3.58-8 8s3.58 8 8 8 8-3.58 8-8-3.58-8-8-8zm0 12c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4z","-10 -10 68 68")),i.appendChild(n),i.onclick=()=>{getMapViewportControllerService().setFollowMode()},i}function updateGpsMapButton(t,e){let i=t.firstChild;null===i&&(i=document.createElement("div"),i.classList.add("custom-google-maps-button"),i.title="Toggle GPS",i.appendChild(createButtonIcon("M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3c-.46-4.17-3.77-7.48-7.94-7.94V1h-2v2.06C6.83 3.52 3.52 6.83 3.06 11H1v2h2.06c.46 4.17 3.77 7.48 7.94 7.94V23h2v-2.06c4.17-.46 7.48-3.77 7.94-7.94H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z","-6 -6 36 36")),i.appendChild(createButtonIcon("M20.94 11c-.46-4.17-3.77-7.48-7.94-7.94V1h-2v2.06c-1.13.12-2.19.46-3.16.97l1.5 1.5C10.16 5.19 11.06 5 12 5c3.87 0 7 3.13 7 7 0 .94-.19 1.84-.52 2.65l1.5 1.5c.5-.96.84-2.02.97-3.15H23v-2h-2.06zM3 4.27l2.04 2.04C3.97 7.62 3.25 9.23 3.06 11H1v2h2.06c.46 4.17 3.77 7.48 7.94 7.94V23h2v-2.06c1.77-.2 3.38-.91 4.69-1.98L19.73 21 21 19.73 4.27 3 3 4.27zm13.27 13.27C15.09 18.45 13.61 19 12 19c-3.87 0-7-3.13-7-7 0-1.61.55-3.09 1.46-4.27l9.81 9.81z","-6 -6 36 36")),t.appendChild(i)),e?(i.childNodes[0].style.display=null,i.childNodes[1].style.display="none"):(i.childNodes[0].style.display="none",i.childNodes[1].style.display=null)}const Z=(-1!==navigator.platform.indexOf("iPhone")||-1!==navigator.platform.indexOf("iPad")||navigator.platform.indexOf("iPod"),400);class ContextMenuHandler{constructor(t){this.onTouchStart=t=>{this.contextMenuPossible=!0;const e=t.touches[0];this.currentTouch=e,this.longPressCountdown=setTimeout(()=>{this.contextMenuPossible=!1,this.callback(e)},Z)},this.onTouchMove=t=>{const e=t.touches[0];if(null!==this.currentTouch){const t=this.currentTouch.pageX-e.pageX,i=this.currentTouch.pageY-e.pageY;if(t*t+i*i<100)return}clearTimeout(this.longPressCountdown)},this.onTouchCancel=t=>{this.currentTouch=null,this.contextMenuPossible=!1,clearTimeout(this.longPressCountdown)},this.onTouchEnd=t=>{this.currentTouch=null,this.contextMenuPossible=!1,clearTimeout(this.longPressCountdown)},this.onContextMenu=t=>{this.contextMenuPossible=!1,clearTimeout(this.longPressCountdown),this.callback(t),t.preventDefault()},this.callback=t,this.longPressCountdown=null,this.contextMenuPossible=!1,this.currentTouch=null}}var K=i(273),$=i(275),Q=i(276),tt=i(307),et=i(277),it=i(278),nt=i(123),at=i.n(nt),st=i(125),ot=i.n(st),lt=i(58),rt=i.n(lt),ct=i(124),ht=i.n(ct);const pt=registerPersistentState("global.tab_id",1);var ut={TabID:pt,switchToMap:()=>{pt.setValue(0)}};class ContextMenu_ContextMenu extends a.a.PureComponent{constructor(...t){super(...t),this.generateMenuEntry=(t,e,i,n=!1)=>a.a.createElement(K.a,{button:!0,onClick:n?void 0:i,disabled:n},a.a.createElement($.a,null,t),a.a.createElement(Q.a,null,e)),this.close=()=>{this.props.onClose()},this.onDelete=()=>{(t=>{const e=Object(v.a)({},getChosenPilots());let i=!1;var n,a=Object(_.a)(t);try{for(a.s();!(n=a.n()).done;){const t=n.value;t in e&&(delete e[t],i=!0)}}catch(s){a.e(s)}finally{a.f()}i&&setChosenPilots(e)})([this.props.data.pilotId]),this.close()},this.onNavigateTo=()=>{const t=this.props.data.pilotInfo.lastFix;!function navigateTo(t){-1!==navigator.platform.indexOf("iPhone")||-1!==navigator.platform.indexOf("iPad")||-1!==navigator.platform.indexOf("iPod")?window.open("https://maps.apple.com/maps?q="+t.lat.toString()+","+t.lng.toString()):window.open("https://maps.google.com/maps?q="+t.lat.toString()+","+t.lng.toString())}({lat:t.lat,lng:t.lon}),this.close()},this.onShowOnMap=()=>{const t=this.props.data.pilotId;ut.switchToMap(),getMapViewportControllerService().setSinglePilotMode(t),this.close()},this.onHidePilot=()=>{const t=this.props.data.pilotId;setPilotShown(t,!1),this.close()},this.onUnhidePilot=()=>{const t=this.props.data.pilotId;setPilotShown(t,!0),this.close()}}render(){const t=this.props.data,e="onMap"in this.props,i=null!==t?t.offline:null,n=null!==t?t.pilotInfo.lastFix:null;return a.a.createElement(tt.a,{open:null!==t&&t.open,anchorReference:"anchorPosition",anchorPosition:null===t?null:t.pos,transformOrigin:{vertical:"top",horizontal:"right"},onClose:this.close},a.a.createElement(et.a,{dense:!0,subheader:e&&null!==t?a.a.createElement(it.a,null,null===t?null:t.pilotInfo.name):null},e||i?null:this.generateMenuEntry(a.a.createElement(at.a,null),"Show Pilot on Map",this.onShowOnMap),i?null:null!==t&&t.pilotInfo.shown?this.generateMenuEntry(a.a.createElement(rt.a,null),"Hide Pilot",this.onHidePilot):this.generateMenuEntry(a.a.createElement(rt.a,null),"Unhide Pilot",this.onUnhidePilot),this.generateMenuEntry(a.a.createElement(ht.a,null),i?"Last Observed Position":"Open in Maps",this.onNavigateTo,null===n),this.generateMenuEntry(a.a.createElement(ot.a,null),"Remove Pilot",this.onDelete)))}}class LiveMap_LiveMap extends a.a.PureComponent{constructor(){super(),this.initializeGoogleMapsApi=()=>{const t={canceled:!1};this.cleanups.push(()=>{t.canceled=!0}),loadGoogleMapsApi().then(()=>{t.canceled||(this.google=window.google,this.setState({mapReady:!0}))}).catch(e=>{t.canceled||(console.log("Map error:",e),this.setState({mapError:!0}))})},this.initializeMapIfNecessary=()=>{if(!this.state.mapReady||this.state.mapError)return;if(null!==this.map)return;this.map=new this.google.maps.Map(this.mapsRef.current,{center:{lat:46.509012,lng:11.827984},mapTypeId:"terrain",zoom:5,maxZoom:15,disableDefaultUI:!0,zoomControl:!0,scaleControl:!0,fullscreenControl:!0,styles:x});const t=this.map,e=this.google;t.addListener("maptypeid_changed",()=>{t.getMapTypeId()===e.maps.MapTypeId.TERRAIN?t.setOptions({maxZoom:15}):t.setOptions({maxZoom:50})}),t.controls[e.maps.ControlPosition.TOP_LEFT].push(createSatelliteMapButton(e,t));const i=function createDisplayGpsMapButton(t,e){var i=document.createElement("div");return i.onclick=()=>{const t=getSetting(j);t.setValue(!t.getValue())},updateGpsMapButton(i,getSetting(j).getValue()),i}();t.controls[e.maps.ControlPosition.TOP_LEFT].push(i),t.controls[e.maps.ControlPosition.RIGHT_TOP].push(createFocusCameraMapButton());let mapButtonUpdater=t=>{updateGpsMapButton(i,t)};getSetting(j).registerCallback(mapButtonUpdater),this.cleanups.push(()=>{getSetting(j).unregisterCallback(mapButtonUpdater)}),this.mapAnimator=new MapAnimator_MapAnimator(t,e,()=>null===this.state.contextMenu||!this.state.contextMenu.open);const n=this.mapAnimator.update;getXContestInterface().animation.registerCallback(n),this.cleanups.push(()=>{getXContestInterface().animation.unregisterCallback(n)});const a=function createGeolocationMarker(t,e){class GeolocationMarker extends t.maps.MVCObject{constructor(e,i,n,a){super(),this.outerMarker_=null,this.marker_=null,this.circle_=null,this.watchId_=-1;var s={clickable:!1,cursor:"pointer",draggable:!1,flat:!0,icon:{path:t.maps.SymbolPath.CIRCLE,fillColor:"#C8D6EC",fillOpacity:.7,scale:12,strokeWeight:0},position:new t.maps.LatLng(0,0),title:"Current location",zIndex:2},o={clickable:!1,cursor:"pointer",draggable:!1,flat:!0,icon:{path:t.maps.SymbolPath.CIRCLE,fillColor:"#4285F4",fillOpacity:1,scale:6,strokeColor:"white",strokeWeight:2},optimized:!1,position:new t.maps.LatLng(0,0),title:"Current location",zIndex:3};i&&(s=this.copyOptions_(s,i)),n&&(o=this.copyOptions_(o,n));var l={clickable:!1,radius:0,strokeColor:"1bb6ff",strokeOpacity:.4,fillColor:"61a0bf",fillOpacity:.4,strokeWeight:1,zIndex:1};a&&(l=this.copyOptions_(l,a)),this.outerMarker_=new t.maps.Marker(s),this.marker_=new t.maps.Marker(o),this.circle_=new t.maps.Circle(l),t.maps.MVCObject.prototype.set.call(this,"accuracy",null),t.maps.MVCObject.prototype.set.call(this,"position",null),t.maps.MVCObject.prototype.set.call(this,"map",null),this.set("minimum_accuracy",null),this.set("position_options",{enableHighAccuracy:!0,maximumAge:1e3}),this.circle_.bindTo("map",this.outerMarker_),this.circle_.bindTo("map",this.marker_),e&&this.setMap(e)}set(e,i){if(GeolocationMarker.invalidPropertiesExpr_.test(e))throw new Error("'"+e+"' is a read-only property.");"map"===e?this.setMap(i):t.maps.MVCObject.prototype.set.call(this,e,i)}getMap(){return this.get("map")}getPositionOptions(){return this.get("position_options")}setPositionOptions(t){this.set("position_options",t)}getPosition(){return this.get("position")}getBounds(){return this.get("position")?this.circle_.getBounds():null}getAccuracy(){return this.get("accuracy")}getMinimumAccuracy(){return this.get("minimum_accuracy")}setMinimumAccuracy(t){this.set("minimum_accuracy",t)}setMap(e){t.maps.MVCObject.prototype.set.call(this,"map",e),e?this.watchPosition_():(this.outerMarker_.unbind("position"),this.marker_.unbind("position"),this.circle_.unbind("center"),this.circle_.unbind("radius"),t.maps.MVCObject.prototype.set.call(this,"accuracy",null),t.maps.MVCObject.prototype.set.call(this,"position",null),navigator.geolocation.clearWatch(this.watchId_),this.watchId_=-1,this.outerMarker_.setMap(e),this.marker_.setMap(e))}setOuterMarkerOptions(t){this.outerMarker_.setOptions(this.copyOptions_({},t))}setMarkerOptions(t){this.marker_.setOptions(this.copyOptions_({},t))}setCircleOptions(t){this.circle_.setOptions(this.copyOptions_({},t))}updatePosition_(e){var i=new t.maps.LatLng(e.coords.latitude,e.coords.longitude),n=null==this.marker_.getMap();if(n){if(null!=this.getMinimumAccuracy()&&e.coords.accuracy>this.getMinimumAccuracy())return;this.outerMarker_.setMap(this.getMap()),this.marker_.setMap(this.getMap()),this.outerMarker_.bindTo("position",this),this.marker_.bindTo("position",this),this.circle_.bindTo("center",this,"position"),this.circle_.bindTo("radius",this,"accuracy")}this.getAccuracy()!==e.coords.accuracy&&t.maps.MVCObject.prototype.set.call(this,"accuracy",e.coords.accuracy),!n&&null!=this.getPosition()&&this.getPosition().equals(i)||t.maps.MVCObject.prototype.set.call(this,"position",i)}watchPosition_(){navigator.geolocation&&(this.watchId_=navigator.geolocation.watchPosition(this.updatePosition_.bind(this),this.geolocationError_.bind(this),this.getPositionOptions()))}geolocationError_(e){t.maps.event.trigger(this,"geolocation_error",e)}copyOptions_(t,e){for(var i in e)!0!==GeolocationMarker.DISALLOWED_OPTIONS[i]&&(t[i]=e[i]);return t}}return GeolocationMarker.DISALLOWED_OPTIONS={map:!0,position:!0,radius:!0},GeolocationMarker.invalidPropertiesExpr_=/^(?:position|accuracy)$/i,new GeolocationMarker(e)}(e,null);a.setPositionOptions({enableHighAccuracy:!0});const geolocationMarkerUpdateState=()=>{let e=getSetting(F).getValue(),i=getSetting(j).getValue();if(e&&i){a.setMap(t);const e=getGPSProvider().getData();null!==e&&a.updatePosition_(e)}else a.setMap(null)};geolocationMarkerUpdateState(),getSetting(F).registerCallback(geolocationMarkerUpdateState),getSetting(j).registerCallback(geolocationMarkerUpdateState),this.cleanups.push(()=>{getSetting(F).unregisterCallback(geolocationMarkerUpdateState),getSetting(j).unregisterCallback(geolocationMarkerUpdateState),a.setMap(null)});let s=new GoogleMapsController_GoogleMapsController(e,t);getMapViewportControllerService().registerMapController(s),this.cleanups.push(()=>{getMapViewportControllerService().unregisterMapController(s),s.shutdown()}),this.mapInitialized=!0},this.onContextMenu=t=>{if(null==this.mapAnimator)return;const e=Object.keys(this.mapAnimator.currentMouseOvers);if(e.length<1)return;const i=e[0],n=this.mapAnimator.currentMouseOvers[i].pos,a=getChosenPilots();if(!(i in a))return;const s=a[i];this.setState({contextMenu:{pilotId:i,pos:n,pilotInfo:s,open:!0}})},this.hideContextMenu=()=>{this.setState({contextMenu:Object(v.a)({},this.state.contextMenu,{open:!1})})},this.map=null,this.google=null,this.mapAnimator=null,this.mapsRef=a.a.createRef(),this.cleanups=[],this.state={mapReady:!1,mapError:!1,contextMenu:null},this.contextMenuHandler=new ContextMenuHandler(this.onContextMenu),this.initializeGoogleMapsApi()}componentDidMount(){this.initializeMapIfNecessary()}componentDidUpdate(){this.initializeMapIfNecessary()}componentWillUnmount(){[...this.cleanups].reverse().forEach(t=>t())}render(){return a.a.createElement(a.a.Fragment,null,a.a.createElement(r.a,{width:"100%",height:"100%",display:this.state.mapReady&&!this.state.mapError?"block":"none",ref:this.mapsRef,onWheel:()=>{getMapViewportControllerService().setFreeMode()},onTouchStart:this.contextMenuHandler.onTouchStart,onTouchMove:this.contextMenuHandler.onTouchMove,onTouchCancel:this.contextMenuHandler.onTouchCancel,onTouchEnd:this.contextMenuHandler.onTouchEnd,onContextMenu:t=>{this.contextMenuHandler.onContextMenu(t),t.preventDefault()}}),a.a.createElement(LoadingPage,{message:"Loading Maps ...",hideIf:this.state.mapReady||this.state.mapError}),a.a.createElement(ErrorPage,{message:"Unable to load map!",hideIf:!this.state.mapError}),a.a.createElement(ContextMenu_ContextMenu,{onMap:!0,data:this.state.contextMenu,onClose:this.hideContextMenu}))}}var dt=i(291),mt=i(132),gt=i.n(mt),ft=i(282),bt=i(9),Ct=i(302),vt=i(283),yt=i(284),Et=i(279);const kt=[];window.addEventListener("popstate",()=>{0===kt.length&&console.warn("History was already 0!");const t=kt.pop();console.debug("- History size:",kt.length),kt.length>0&&window.history.pushState({},""),t&&t()},{passive:!0});var util_SubWindow=t=>{const e=Object(n.useState)(!1),i=Object(l.a)(e,2),s=i[0],o=i[1],r=Object(n.useState)(!1),c=Object(l.a)(r,2),h=c[0],p=c[1],u={push:t=>{const e=kt.length;kt.push(t),console.debug("+ History size:",kt.length),0===e&&window.history.pushState({},"")},pop:()=>{window.history.back()}};return t.open&&!s&&(h?t.onClose():(u.push(()=>{o(!1),t.onClose()}),o(!0),p(!0))),!h||s||t.open||p(!1),s&&!t.open&&u.pop(),a.a.createElement(Et.a,{open:s,onClose:()=>{t.onClose()},fullScreen:t.fullScreen,maxWidth:t.maxWidth,fullWidth:t.fullWidth,classes:t.classes},t.children)};var wt=i(280);const getRotationStyle=t=>{const e="rotate("+t.toString()+"deg)";return{transform:e,WebkitTransform:e,MozTransform:e,msTransform:e,OTransform:e}};class LastFixState_LastFixState extends a.a.PureComponent{constructor(t){super(t),this.getMessage=({timestamp:t,endOfTrack:e,landed:i,relative:n,showLastFix:a})=>{if(null==t)return["","never"];let s=new Date(t).getTime()-Date.now(),o="";return o=n?function formatTimeDiff(t){let e="";t<0&&(t=-t,e="-");let i=Math.floor(t/1e3);if(i<90)return e+i+" sec";let n=Math.floor(i/60);if(n<60)return e+n+" min";let a=Math.floor(n/60);if(n-=60*a,a<24)return e+a+":"+n.toString().padStart(2,"0")+" h";let s=Math.floor(a/24);return a-=24*s,e+s+"d "+a+":"+n.toString().padStart(2,"0")+" h"}(s):function timestampToTimeString(t){return new Date(t).toLocaleTimeString()}(t),e&&i?["#346B8F","\u2714 "+o]:-s<12e4&&!e?n?a?["green","\u26ab LIVE ("+o+")"]:["green","\u26ab LIVE"]:["green","\u26ab "+o]:n?["red","! LIVE ("+o+")"]:["red","! "+o]},this.shallowRerender=t=>{if(null!==this.msgRef.current){const e=this.msgRef.current,i=this.getMessage(t),n=Object(l.a)(i,2),a=n[0],s=n[1];Object.assign(e.style,{color:a}),e.innerHTML!==s&&(e.innerHTML=s)}},this.msgRef=a.a.createRef()}render(){const t=this.getMessage(this.props),e=Object(l.a)(t,2),i=e[0],n=e[1];return a.a.createElement("span",{style:{color:i},ref:this.msgRef},n)}}class LastFixState_LastFixArrow extends a.a.PureComponent{constructor(t){super(t),this.onNewGPSDataReceived=t=>{this.gpsData=t,this.updateThroughRef()},this.setFix=t=>{this.lastFix=t,this.updateThroughRef()},this.updateThroughRef=()=>{if(this.arrowRef.current){const t=LastFixState_LastFixArrow.getArrowRotationStyle(this.gpsData,this.lastFix);Object.assign(this.arrowRef.current.style,t)}if(this.distanceRef.current){const t=LastFixState_LastFixArrow.getDistance(this.gpsData,this.lastFix);t!==this.distanceRef.current.innerHTML&&(this.distanceRef.current.innerHTML=t)}},this.gpsData=getGPSProvider().getData(),this.distanceRef=a.a.createRef(),this.arrowRef=a.a.createRef(),this.lastFix=this.props.lastFix}componentDidMount(){getGPSProvider().registerCallback(this.onNewGPSDataReceived)}componentWillUnmount(){getGPSProvider().unregisterCallback(this.onNewGPSDataReceived)}static getDistance(t,e){if(null===t||null===e)return"--km";const i=Object(G.getDistance)({lat:t.coords.latitude,lng:t.coords.longitude},e);return(Math.round(i/100)/10).toString()+"km"}static getArrowRotationStyle(t,e){if(null===t||null===e)return getRotationStyle(0);const i=Object(G.getRhumbLineBearing)({lat:t.coords.latitude,lng:t.coords.longitude},e);return getRotationStyle(i)}render(){return this.lastFix=this.props.lastFix,a.a.createElement(a.a.Fragment,null,a.a.createElement("span",{ref:this.distanceRef},LastFixState_LastFixArrow.getDistance(this.gpsData,this.lastFix))," ",a.a.createElement("div",{ref:this.arrowRef,style:Object(v.a)({display:"inline-block"},LastFixState_LastFixArrow.getArrowRotationStyle(this.gpsData,this.lastFix))},"\u2191"))}}const TableHeader=()=>a.a.createElement(wt.a,{component:"div",variant:"head",className:"MuiTableCell-stickyHeader",style:{height:37,display:"flex",alignItems:"center",boxSizing:"border-box"}},a.a.createElement("div",{style:{flex:"1"}},"Name"),a.a.createElement("div",{style:{width:"25%",textAlign:"right"}},"State"),a.a.createElement("div",{style:{width:"27%",textAlign:"right"}},"Country"));class PilotSelectorListRenderer_PilotSelectorListRow extends a.a.PureComponent{render(){const t=this.props,e=t.fullname,i=t.username,n=t.lastFix,s=t.timestamp,o=t.landed,l=t.iso,c=t.disabled;return a.a.createElement("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",boxSizing:"border-box",filter:c?"grayscale(100%) opacity(30%)":void 0}},a.a.createElement(r.a,{flex:"1",paddingLeft:1,paddingTop:1,paddingBottom:1},a.a.createElement(w.a,{variant:"body2"},e),a.a.createElement(w.a,{variant:"caption",color:"textSecondary",style:{paddingLeft:".5em"}},"[",i,"]")),a.a.createElement("div",{style:{width:"25%",textAlign:"right"}},a.a.createElement("div",null,a.a.createElement(w.a,{variant:"caption"},a.a.createElement(LastFixState_LastFixState,{timestamp:s,landed:o,endOfTrack:o,relative:!0}))),a.a.createElement("div",null,a.a.createElement(w.a,{variant:"caption"},a.a.createElement(LastFixState_LastFixArrow,{lastFix:n})))),a.a.createElement("div",{style:{width:"27%",textAlign:"right"}},a.a.createElement(r.a,{paddingRight:1,paddingLeft:1},l,a.a.createElement(r.a,{fontSize:"large",marginLeft:"4px",boxShadow:1,style:{verticalAlign:"middle"},className:"flag-icon flag-icon-"+l.toLowerCase()}))))}}const renderRow=({data:t,index:e,style:i})=>{const n=t.keys[e],s=t.data[n],o=s?s.info.user.fullname:"Offline User",l=s?s.info.user.username:n,r=s?s.lastFix:null,c=s?s.lastFix.timestamp:null,h=s?s.landed:null,p=s?s.info.user.nationality.iso:"--",u=-1!==t.selected.indexOf(n),d=-1!==t.alreadyAdded.indexOf(n);return a.a.createElement(wt.a,{component:"div",variant:"body",padding:"none",style:Object(v.a)({},i,{backgroundColor:u&&!d?"rgba(0, 0, 0, 0.04)":void 0}),onClick:()=>{d||t.onPilotClicked(n)}},a.a.createElement(PilotSelectorListRenderer_PilotSelectorListRow,{fullname:o,username:l,lastFix:r,timestamp:c,landed:h,iso:p,disabled:d}))};var Pt=i(144),St=i(126);const sortPilotList=(t,e)=>{if(e){const i={lat:e.coords.latitude,lng:e.coords.longitude};let n=Object.entries(t).map(([t,e])=>[t,Object(G.getDistance)(i,e.lastFix)]);return n.sort((t,e)=>t[1]-e[1]),n.map(t=>t[0])}{let e=Object.keys(t);return e.sort(),e}};class PilotSelectorList_PilotSelectorList extends a.a.PureComponent{constructor(t){super(t),this.startRendering=()=>{this.setState(t=>Object(v.a)({},t,{didMount:!0}))},this.updatePilotListIfNecessary=()=>{const t=sortPilotList(this.state.pilotInfos,this.gpsData);(function arraysEqual(t,e){if(!t||!e)return!1;if(t.length!==e.length)return!1;for(var i=0,n=t.length;i<n;i++)if(t[i]!==e[i])return!1;return!0})(this.state.sortedPilotList,t)||this.setState(e=>Object(v.a)({},e,{sortedPilotList:t}))},this.onNewGpsData=t=>{this.gpsData=t,this.updatePilotListIfNecessary()},this.onNewPilotInfos=t=>{this.setState(e=>Object(v.a)({},e,{pilotInfos:t,sortedPilotList:sortPilotList(t,this.gpsData)}))},this.onPilotClicked=t=>{this.props.onPilotClicked&&this.props.onPilotClicked(t)},this.gpsData=getGPSProvider().getData();const e=getXContestInterface().pilotInfos.getValue();this.state={didMount:!1,pilotInfos:e,sortedPilotList:sortPilotList(e,this.gpsData)}}componentDidMount(){getXContestInterface().pilotInfos.registerCallback(this.onNewPilotInfos),getGPSProvider().registerCallback(this.onNewGpsData),setTimeout(this.startRendering)}componentWillUnmount(){getXContestInterface().pilotInfos.unregisterCallback(this.onNewPilotInfos),getGPSProvider().unregisterCallback(this.onNewGpsData)}render(){if(!this.state.didMount)return a.a.createElement("div",{style:{width:"100%",display:"flex",justifyContent:"center",overflow:"hidden"}},a.a.createElement(P.a,{disableShrink:!0,style:{margin:"2em"}}));const t=((t,e,i)=>{const matchesSearch=t=>""===i||t.toLowerCase().includes(i.toLowerCase());let n=t.filter(t=>matchesSearch(e[t].info.user.username)||matchesSearch(e[t].info.user.fullname));return 0===n.length&&!/\s/.test(i)&&i.length>0&&n.push(i),n})(this.state.sortedPilotList,this.state.pilotInfos,this.props.search);return a.a.createElement(a.a.Fragment,null,a.a.createElement(TableHeader,null),a.a.createElement("div",{style:{flex:"1"}},a.a.createElement(St.a,null,({height:e,width:i})=>a.a.createElement(Pt.a,{width:i,height:e,itemCount:t.length,itemSize:57,itemData:{keys:t,data:this.state.pilotInfos,selected:this.props.selected,alreadyAdded:this.props.alreadyAdded,onPilotClicked:this.onPilotClicked},itemKey:(t,{keys:e})=>e[t]},renderRow))))}}var Ot=i(35);const Mt=Object(k.a)({fullHeightWindow:{height:"100%"}});var xt=Object(Ot.a)(t=>{const e=Mt(),i=Object(p.a)(),s=Object(u.a)(i.breakpoints.down("xs")),o=Object(n.useState)([]),c=Object(l.a)(o,2),h=c[0],d=c[1],m=Object(n.useState)(""),g=Object(l.a)(m,2),f=g[0],b=g[1],C=h.length,closeWindow=()=>{b(""),d([]),t.onClose()};return a.a.createElement(util_SubWindow,{open:t.open,onClose:closeWindow,fullScreen:s,maxWidth:"xs",fullWidth:!0,classes:{paper:e.fullHeightWindow}},a.a.createElement(ft.a,{style:0===C?{}:"light"===i.palette.type?{color:i.palette.secondary.main,backgroundColor:Object(bt.d)(i.palette.secondary.light,.85)}:{color:i.palette.text.primary,backgroundColor:i.palette.secondary.dark}},C>0?a.a.createElement(w.a,{component:"div",color:"inherit",variant:"subtitle1"},C," selected"):a.a.createElement(w.a,{component:"div",variant:"h6",id:"tableTitle"},"Add new pilots:")),a.a.createElement(r.a,{paddingLeft:"1em",paddingRight:"1em",paddingTop:"4px"},a.a.createElement(Ct.a,{margin:"dense",autoComplete:"off",variant:"outlined",id:"search_field",label:"Search",type:"search",fullWidth:!0,onChange:t=>b(t.target.value)})),a.a.createElement(r.a,{flex:"1 1 auto",marginY:"8px",display:"flex",flexDirection:"column",alignItems:"stretch"},a.a.createElement(PilotSelectorList_PilotSelectorList,{alreadyAdded:t.alreadyAdded,selected:h,onPilotClicked:t=>{const e=h.indexOf(t);let i=[];-1===e?i=i.concat(h,t):0===e?i=i.concat(h.slice(1)):e===h.length-1?i=i.concat(h.slice(0,-1)):e>0&&(i=i.concat(h.slice(0,e),h.slice(e+1))),d(i)},search:f})),a.a.createElement(vt.a,null,a.a.createElement(yt.a,{onClick:closeWindow,color:"primary"},"Cancel"),a.a.createElement(yt.a,{disabled:0===C,onClick:()=>{t.onAddPilots(h),closeWindow()},color:"primary"},"Add")))}),_t=i(4),Tt=i(306),At=i(285),It=i(286),Lt=i(79),Dt=i.n(Lt),Rt=i(271),Ft=i(240),jt=i(129),Vt=i.n(jt),Nt=i(130),Gt=i.n(Nt),Ht=i(131),Wt=i.n(Ht);class ElevationHistogram_ElevationHistogram extends a.a.PureComponent{constructor(t){super(t),this.prepareCanvasAndComputeLimits=(t,e)=>{const i=window.devicePixelRatio||1,n=t.getBoundingClientRect();if(t.width=n.width*i,t.height=n.height*i,e.landed&&e.track.length>0){const t=e.lastPotentialAirTime,i=e.track[0].timestamp;return Math.max(1,t-i)}return 900},this.renderCanvas=(t,e,i,n,a,s,o)=>{const r=window.devicePixelRatio||1,c=t.width,h=t.height,getCoord=(t,e)=>[c*(1-(s-t)/a),h*(1-(e-i)/(n-i))],p=getCoord(0,o),u=Object(l.a)(p,2)[1];let d=t.getContext("2d",{alpha:!1});d.fillStyle=this.COLOR_GROUND,d.fillRect(0,0,c,h),d.fillStyle=this.COLOR_SKY,d.strokeStyle=this.COLOR_PILOT,d.beginPath(),d.moveTo(0,0),d.lineTo(c,0),d.lineTo(c,u);let m=u;for(let g=e.length-1;g>=0;g--){const t=e[g];if(t.timestamp<s-a)break;const i=getCoord(t.timestamp,t.elevation),n=Object(l.a)(i,2),o=n[0],r=n[1];d.lineTo(o,r),m=r}d.lineTo(0,m),d.fill(),d.lineWidth=2*r,d.lineJoin="round",d.lineCap="round",d.beginPath();for(let g=e.length-1;g>=0;g--){const t=e[g];if(t.timestamp<s-a)break;const i=getCoord(t.timestamp,t.altitude),n=Object(l.a)(i,2),o=n[0],r=n[1];g===e.length-1?d.moveTo(o,r):d.lineTo(o,r)}d.stroke()},this.shallowRerender=t=>{if(!(this.props.pilot in t))return;if(null===this.canvasRef.current)return;const e=this.canvasRef.current,i=t[this.props.pilot],n=i.track,a=i.elevation,s=i.lastPotentialAirTime;if(this.lastRenderedTimestamp===s)return;this.lastRenderedTimestamp=s;const o=null!==i.gpsAlt?i.gpsAlt:i.baroAlt;if(null===o)return;const l=this.prepareCanvasAndComputeLimits(e,i);let r=a,c=o;for(let h=n.length-1;h>=0;h--){const t=n[h];if(t.timestamp<s-l)break;r=Math.min(r,t.elevation),c=Math.max(c,t.altitude)}c+=this.HEIGHT_MARGIN,r-=this.HEIGHT_MARGIN,c=this.HEIGHT_STEPS*Math.ceil(c/this.HEIGHT_STEPS),r=this.HEIGHT_STEPS*Math.floor(r/this.HEIGHT_STEPS),this.renderCanvas(e,n,r,c,l,s,a),null!==this.maxValueRef.current&&(this.maxValueRef.current.textContent=c.toString()),null!==this.minValueRef.current&&(this.minValueRef.current.textContent=r.toString())},this.onNewAnimationData=({pilotData:t})=>{this.shallowRerender(t)},this.componentDidMount=()=>{this.shallowRerender(getXContestInterface().animation.getData().pilotData),getXContestInterface().animation.registerCallback(this.onNewAnimationData)},this.componentDidUpdate=()=>{this.shallowRerender(getXContestInterface().animation.getData())},this.canvasRef=a.a.createRef(),this.maxValueRef=a.a.createRef(),this.minValueRef=a.a.createRef(),this.HEIGHT_MARGIN=50,this.HEIGHT_STEPS=100,this.COLOR_SKY="#aac7ff",this.COLOR_GROUND="#92b465",this.COLOR_PILOT="#e11",this.lastRenderedTimestamp=0}componentWillUnmount(){getXContestInterface().animation.unregisterCallback(this.onNewAnimationData)}render(){return a.a.createElement("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"stretch"}},a.a.createElement("div",{style:{flex:"0 0 auto",width:"4em",paddingRight:".2em",display:"flex",flexDirection:"column",justifyContent:"space-between",alignItems:"flex-end"}},a.a.createElement("div",{ref:this.maxValueRef,style:{fontSize:".8em",marginTop:"-.7em"}}),a.a.createElement("div",{ref:this.minValueRef,style:{fontSize:".8em",marginBottom:"-.75em"}})),a.a.createElement("div",{style:{flex:"1 1 0",overflow:"hidden",position:"relative"},ref:this.canvasParentRef},a.a.createElement("canvas",{ref:this.canvasRef,style:{position:"absolute",width:"100%",height:"100%"}})))}}const zt=Object(Rt.a)(w.a)({overflow:"hidden",flex:"1"}),Ut=Object(Rt.a)(w.a)({marginRight:".2em",marginLeft:".5em"}),Bt=Object(Rt.a)(w.a)({display:"flex",justifyContent:"space-between",paddingLeft:".5em"}),Xt=Object(Ft.a)({root:{paddingLeft:"12px"},content:{overflow:"hidden",alignItems:"center",whiteSpace:"nowrap"}})(At.a),Jt=Object(Ft.a)({root:{display:"flex",alignItems:"stretch",justifyContent:"space-between",MozUserSelect:"none",WebkitUserSelect:"none",msUserSelect:"none"}})(It.a),Yt=Object(Rt.a)(w.a)({flex:"1 0 0",display:"flex",justifyContent:"flex-start",flexDirection:"column",alignItems:"flex-start",paddingRight:"1em"}),qt=Object(Rt.a)(w.a)({flex:"2 1 0",display:"flex"}),Zt=Object(Rt.a)(w.a)({display:"flex",justifyContent:"flex-start",alignItems:"center",whiteSpace:"nowrap"}),Kt=Object(Ft.a)({root:{paddingRight:".2em",width:".6em",height:".6em"}})(Vt.a),$t=Object(Ft.a)({root:{paddingRight:".2em",width:".6em",height:".6em"}})(Gt.a),Qt=Object(Ft.a)({root:{paddingRight:".2em",width:".6em",height:".6em"}})(Wt.a);class AnimatedPilotListEntry_AnimatedPilotListEntry extends a.a.PureComponent{constructor(t){super(t),this.extractImportantProps=t=>({height:null!==t.gpsAlt?t.gpsAlt:t.baroAlt,elevation:t.elevation,vario:t.baroVario,startOfTrack:t.startOfTrack,endOfTrack:t.endOfTrack,landed:t.landed,newestDataTimestamp:t.newestDataTimestamp,lat:t.pos.lat,lng:t.pos.lng,velocityLat:null===t.velocityVec?null:t.velocityVec.lat,velocityLng:null===t.velocityVec?null:t.velocityVec.lng,velocity:t.velocity,lastPotentialAirTime:t.lastPotentialAirTime}),this.propsChanged=t=>{const e=this.pilotProps;for(let i in e)if(!(i in t))return!0;for(let i in t){if(!(i in e))return!0;if(e[i]!==t[i])return!0}return!1},this.onNewGPSDataReceived=t=>{this.gpsData=t},this.onNewDataReceived=({pilotData:t})=>{if(!(this.props.pilotId in t))return;const e=t[this.props.pilotId],i=this.extractImportantProps(e);this.propsChanged(i)?(this.pilotProps=i,this.shallowRerender(!0)):this.shallowRerender(!1)},this.onNewPilotInfos=t=>{const e=this.stateChangesFromPilotInfos(this.state,t);0!==Object.keys(e).length&&this.setState(e)},this.stateChangesFromPilotInfos=(t,e)=>{const i={},processInfo=(e,n)=>{e in t&&t[e]===n||(i[e]=n)};if(this.props.pilotId in e){const t=e[this.props.pilotId];if(processInfo("launchSite",t.info.launch),processInfo("launchTime",parseTime(t.info.launchPoint.timestamp)),"contest"in t&&"score"in t.contest){const e=t.contest.score;null!=e.distance&&processInfo("scoreDistance",e.distance.toFixed(1)),"type"in e&&processInfo("scoreType",e.type.tag)}}return i},this.shallowRerender=t=>{if(null!==this.heightRef.current&&t){const t=AnimatedPilotListEntry_AnimatedPilotListEntry.renderHeight(this.pilotProps);t!==this.heightRef.current.innerHTML&&(this.heightRef.current.innerHTML=t)}if(null!==this.lastFixRef.current&&t&&this.lastFixRef.current.setFix({lat:this.pilotProps.lat,lng:this.pilotProps.lng}),null!==this.iconRef.current&&t){let t=this.iconRef.current;const e=getPilotIcon(this.pilotProps.startOfTrack,this.pilotProps.endOfTrack,this.pilotProps.landed,{lat:this.pilotProps.lat,lng:this.pilotProps.lng},{lat:this.pilotProps.velocityLat,lng:this.pilotProps.velocityLng});if(t.childNodes.length>0){const i=t.childNodes[0];i.getAttribute("d")!==e.path&&i.setAttribute("d",e.path)}const i=void 0===e.rotation?0:e.rotation;Object.assign(t.style,getRotationStyle(i))}if(null!==this.liveStateRef.current&&this.liveStateRef.current.shallowRerender({timestamp:1e3*this.pilotProps.newestDataTimestamp,landed:this.pilotProps.landed,endOfTrack:this.pilotProps.endOfTrack,relative:!0,showLastFix:getSetting(I).getValue()}),null!==this.flightDurationRef.current&&t){const t=AnimatedPilotListEntry_AnimatedPilotListEntry.renderFlightDuration(this.state.launchTime,this.pilotProps.lastPotentialAirTime);t!==this.flightDurationRef.current.innerHTML&&(this.flightDurationRef.current.innerHTML=t)}},this.gpsData=getGPSProvider().getData(),this.pilotColor=getPilotIconColor(this.props.pilotId),this.state={launchSite:null,launchTime:null,scoreDistance:null,scoreType:null},Object.assign(this.state,this.stateChangesFromPilotInfos(this.state,getXContestInterface().getPilotInfos())),this.lastFixRef=a.a.createRef(),this.heightRef=a.a.createRef(),this.liveStateRef=a.a.createRef(),this.iconRef=a.a.createRef(),this.flightDurationRef=a.a.createRef(),this.contextMenuHandler=new ContextMenuHandler(t=>{this.props.onContextMenuHandler(this.props.pilotId,{left:t.pageX,top:t.pageY})})}componentDidMount(){getXContestInterface().animation.registerCallback(this.onNewDataReceived),getXContestInterface().pilotInfos.registerCallback(this.onNewPilotInfos),getGPSProvider().registerCallback(this.onNewGPSDataReceived)}componentWillUnmount(){getXContestInterface().animation.unregisterCallback(this.onNewDataReceived),getXContestInterface().pilotInfos.unregisterCallback(this.onNewPilotInfos),getGPSProvider().unregisterCallback(this.onNewGPSDataReceived)}static renderHeight(t){const e=t.height;return Math.round(e)+"m ("+Math.round(Math.max(0,e-t.elevation))+"m)"}static renderFlightDuration(t,e){if(null==t||null==e)return"-:-- h";const i=Math.round((e-t)/60),n=(i%60).toString().padStart(2,"0");return Math.floor(i/60)+":"+n+" h"}static renderScore(t,e){return t+" km "+(e in AnimatedPilotListEntry_AnimatedPilotListEntry.scoreTypes?AnimatedPilotListEntry_AnimatedPilotListEntry.scoreTypes[e]:e)}render(){{const t=getXContestInterface().animation.getData().pilotData,e=this.props.pilotId in t?t[this.props.pilotId]:null;this.pilotProps=this.extractImportantProps(e)}console.log("RENDER ",this.props.pilotId,this.state,this.props,this.pilotProps);const t=getPilotIcon(this.pilotProps.startOfTrack,this.pilotProps.endOfTrack,this.pilotProps.landed,{lat:this.pilotProps.lat,lng:this.pilotProps.lng},{lat:this.pilotProps.velocityLat,lng:this.pilotProps.velocityLng}),e=void 0===t.rotation?0:t.rotation;return a.a.createElement(Tt.a,{TransitionProps:{unmountOnExit:!0},onContextMenu:this.contextMenuHandler.onContextMenu,onTouchStart:this.contextMenuHandler.onTouchStart,onTouchCancel:this.contextMenuHandler.onTouchCancel,onTouchEnd:this.contextMenuHandler.onTouchEnd,onTouchMove:this.contextMenuHandler.onTouchMove,style:{filter:this.props.shown?void 0:"grayscale(100%) opacity(70%)"}},a.a.createElement(Xt,{expandIcon:a.a.createElement(Dt.a,null)},a.a.createElement("svg",{width:"30px",height:"30px",viewBox:"0 0 24 24",display:"block",style:Object(v.a)({flex:"0 0 auto"},getRotationStyle(e)),ref:this.iconRef},a.a.createElement("path",{d:t.path,fill:this.pilotColor,stroke:"black"})),a.a.createElement("div",{style:{flex:"1 1 auto",overflow:"hidden",marginLeft:"10px"}},a.a.createElement("div",{style:{width:"100%",display:"flex",overflow:"hidden"}},a.a.createElement(zt,{variant:"body2"},this.props.pilotName),a.a.createElement(Ut,{variant:"caption"},a.a.createElement(LastFixState_LastFixArrow,{ref:this.lastFixRef,lastFix:{lat:this.pilotProps.lat,lng:this.pilotProps.lng}}))),a.a.createElement(Bt,{variant:"caption"},a.a.createElement(LastFixState_LastFixState,{timestamp:1e3*this.pilotProps.newestDataTimestamp,landed:this.pilotProps.landed,endOfTrack:this.pilotProps.endOfTrack,relative:!0,ref:this.liveStateRef,showLastFix:getSetting(I).getValue()}),a.a.createElement("span",{ref:this.heightRef},AnimatedPilotListEntry_AnimatedPilotListEntry.renderHeight(this.pilotProps))))),a.a.createElement(Jt,null,a.a.createElement(Yt,null,a.a.createElement(Zt,{variant:"caption"},a.a.createElement(Kt,null),a.a.createElement("span",{ref:this.flightDurationRef},AnimatedPilotListEntry_AnimatedPilotListEntry.renderFlightDuration(this.state.launchTime,this.pilotProps.lastPotentialAirTime))),a.a.createElement(Zt,{variant:"caption"},a.a.createElement($t,null),AnimatedPilotListEntry_AnimatedPilotListEntry.renderScore(this.state.scoreDistance,this.state.scoreType)),a.a.createElement(Zt,{variant:"caption"},a.a.createElement(Qt,null)," ",this.state.launchSite)),a.a.createElement(qt,{variant:"caption"},a.a.createElement(ElevationHistogram_ElevationHistogram,{pilot:this.props.pilotId}))))}}AnimatedPilotListEntry_AnimatedPilotListEntry.scoreTypes={FlatTriangle:" (flat)",FaiTriangle:" (fai)",FreeFlight:" (free)"};var te=AnimatedPilotListEntry_AnimatedPilotListEntry,ee=i(146);const ie=Object(_t.a)({root:{display:"flex",backgroundColor:"#ccc",padding:".8em"}})(ee.a);class OfflinePilotEntry_OfflinePilotEntry extends a.a.PureComponent{constructor(t){super(t),this.contextMenuHandler=new ContextMenuHandler(t=>{this.props.onContextMenuHandler(this.props.pilotId,{left:t.pageX,top:t.pageY})})}render(){return a.a.createElement(ie,{className:"MuiExpansionPanel-rounded MuiExpansionPanel-root",onContextMenu:this.contextMenuHandler.onContextMenu,onTouchStart:this.contextMenuHandler.onTouchStart,onTouchCancel:this.contextMenuHandler.onTouchCancel,onTouchEnd:this.contextMenuHandler.onTouchEnd,onTouchMove:this.contextMenuHandler.onTouchMove},a.a.createElement(w.a,{variant:"body2"},this.props.pilotName),a.a.createElement(w.a,{variant:"caption",color:"textSecondary",style:{paddingLeft:".5em"}},"[",this.props.pilotId,"]"))}}const ne=Object(_t.a)({root:{backgroundColor:"#ddd"}})(Tt.a);class AnimatedPilotList_AnimatedPilotList extends a.a.PureComponent{constructor(t){super(t),this.getSortedPilotList=t=>{if(null===this.gpsData)return Object.keys(t);const e={lat:this.gpsData.coords.latitude,lng:this.gpsData.coords.longitude};let i=Object.entries(t).map(([t,i])=>[t,Object(G.getDistance)(e,i.pos)]);return i.sort((t,e)=>t[1]-e[1]),i.map(t=>t[0])},this.onAnimationFrame=({pilotData:t})=>{const e=this.getSortedPilotList(t),i=e.filter(e=>t[e].endOfTrack&&t[e].landed),n=e.filter(e=>!(t[e].endOfTrack&&t[e].landed)).concat(i);let a=!1;if(n.length===this.state.onlinePilots.length){for(let s=0;s<n.length;s++)if(n[s]!==this.state.onlinePilots[s]){a=!0;break}}else a=!0;a&&this.setState(t=>Object(v.a)({},t,{onlinePilots:n}))},this.onNewGPSDataReceived=t=>{this.gpsData=t},this.showContextMenu=(t,e)=>{const i=getChosenPilots();if(!(t in i))return;const n=i[t];this.setState({contextMenu:{open:!0,pilotId:t,pos:e,pilotInfo:n}})},this.showContextMenuOffline=(t,e)=>{const i=getChosenPilots();if(!(t in i))return;const n=i[t];this.setState({contextMenu:{open:!0,pilotId:t,pos:e,pilotInfo:n,offline:!0}})},this.hideContextMenu=()=>{this.setState({contextMenu:Object(v.a)({},this.state.contextMenu,{open:!1})})},this.state={onlinePilots:[],contextMenu:null},this.gpsData=getGPSProvider().getData()}componentDidMount(){getXContestInterface().animation.registerCallback(this.onAnimationFrame),getGPSProvider().registerCallback(this.onNewGPSDataReceived)}componentWillUnmount(){getXContestInterface().animation.unregisterCallback(this.onAnimationFrame),getGPSProvider().unregisterCallback(this.onNewGPSDataReceived)}render(){let t=new Set(this.state.onlinePilots);const e=this.state.onlinePilots.filter(t=>t in this.props.pilots&&this.props.pilots[t].shown),i=this.state.onlinePilots.filter(t=>t in this.props.pilots&&!this.props.pilots[t].shown),n=Object.keys(this.props.pilots).filter(e=>!t.has(e)),getPilotName=t=>{const e=this.props.pilots[t];return void 0===e||null===e?t:e.name};return a.a.createElement(r.a,{height:"100%",bgcolor:"#eeeef5",overflow:"auto",onContextMenu:t=>t.preventDefault()},e.length>0?a.a.createElement(r.a,{margin:1,marginBottom:2},e.map(t=>a.a.createElement(te,{shown:!0,key:t,pilotId:t,pilotName:getPilotName(t),onContextMenuHandler:this.showContextMenu}))):null,i.length>0?a.a.createElement(r.a,{margin:1,marginBottom:2},i.map(t=>a.a.createElement(te,{shown:!1,key:t,pilotId:t,pilotName:getPilotName(t),onContextMenuHandler:this.showContextMenu}))):null,n.length>0?a.a.createElement(r.a,{margin:1,onContextMenu:()=>!1},a.a.createElement(ne,null,a.a.createElement(At.a,{expandIcon:a.a.createElement(Dt.a,null)},a.a.createElement(w.a,null,"Offline Pilots")),a.a.createElement(It.a,{style:{flexDirection:"column"}},n.map(t=>a.a.createElement(OfflinePilotEntry_OfflinePilotEntry,{key:t,pilotId:t,pilotName:getPilotName(t),onContextMenuHandler:this.showContextMenuOffline}))))):null,a.a.createElement(ContextMenu_ContextMenu,{data:this.state.contextMenu,onClose:this.hideContextMenu}))}}var ae=AnimatedPilotList_AnimatedPilotList,se=i(290),oe=i(287),le=i(288),re=i(289),ce=i(304);class PilotMultipleChoiceList_PilotMultipleChoiceList extends a.a.PureComponent{constructor(t){super(t),this.startRendering=()=>{this.setState({didMount:!0})},this.onPilotClicked=t=>{this.props.onPilotClicked&&this.props.onPilotClicked(t)},this.getSortedPilotIds=()=>{const t=Object.keys(this.props.pilots);return t.sort((t,e)=>{const i=this.props.pilots[t].name,n=this.props.pilots[e].name;return i<n?-1:i>n?1:0}),t},this.state={didMount:!1}}componentDidMount(){setTimeout(this.startRendering)}render(){if(!this.state.didMount)return a.a.createElement("div",{style:{width:"100%",display:"flex",justifyContent:"center",overflow:"hidden"}},a.a.createElement(P.a,{disableShrink:!0,style:{margin:"2em"}}));const t=this.getSortedPilotIds();return a.a.createElement(r.a,{overflow:"scroll"},a.a.createElement(oe.a,{style:{overflow:"scroll"}},a.a.createElement(le.a,null,t.map(t=>a.a.createElement(re.a,{key:t,onClick:()=>this.onPilotClicked(t),selected:t in this.props.selected},a.a.createElement(wt.a,{padding:"checkbox"},a.a.createElement(ce.a,{checked:t in this.props.selected})),a.a.createElement(wt.a,{component:"th",scope:"row",padding:"none"},a.a.createElement(w.a,{variant:"body2",component:"span"},this.props.pilots[t].name),a.a.createElement(w.a,{variant:"caption",color:"textSecondary",style:{paddingLeft:".5em"},component:"span"},"[",t,"]")))))))}}class VisibilitySelector_VisibilitySelector extends a.a.PureComponent{constructor(t){super(t),this.pilotClicked=t=>{const e=Object(v.a)({},this.state.selected);t in e?delete e[t]:e[t]=!0,this.setState({selected:e})},this.closeWindow=()=>{this.props.onClose()},this.reset=()=>{let t={};Object.keys(this.props.pilots).forEach(e=>{t[e]=!0}),this.setState({selected:t})},this.clear=()=>{this.setState({selected:{}})},this.state={selected:{},open:!1}}render(){const t=Object.keys(this.props.pilots).length===Object.keys(this.state.selected).length;return a.a.createElement(util_SubWindow,{open:this.props.open,onClose:this.closeWindow,fullScreen:!1,maxWidth:"xs",fullWidth:!0},a.a.createElement(ft.a,null,a.a.createElement(w.a,{component:"div",variant:"h6",id:"tableTitle"},"Select shown pilots:")),a.a.createElement(se.a,null),a.a.createElement(PilotMultipleChoiceList_PilotMultipleChoiceList,{pilots:this.props.pilots,selected:this.state.selected,onPilotClicked:this.pilotClicked}),a.a.createElement(vt.a,null,a.a.createElement(yt.a,{onClick:t?this.clear:this.reset,color:"primary"},t?"Clear":"Reset"),a.a.createElement(yt.a,{onClick:this.closeWindow,color:"primary"},"Cancel"),a.a.createElement(yt.a,{disabled:!1,onClick:()=>{this.props.onUpdateVisibility(Object.keys(this.state.selected)),this.closeWindow()},color:"primary"},"Save")))}}VisibilitySelector_VisibilitySelector.getDerivedStateFromProps=(t,e)=>{if(t.open!==e.open){if(!1===t.open)return{open:t.open};let e={};return Object.entries(t.pilots).forEach(([t,i])=>{i.shown&&(e[t]=!0)}),{open:t.open,selected:e}}return null};var he=VisibilitySelector_VisibilitySelector;class Pilots_Pilots extends a.a.Component{constructor(t){super(t),this.openPilotSelector=()=>{!1===this.state.pilotSelectorOpen&&this.setState({pilotSelectorOpen:!0})},this.closePilotSelector=()=>{!0===this.state.pilotSelectorOpen&&this.setState({pilotSelectorOpen:!1})},this.openVisibilitySelector=()=>{!1===this.state.visibilitySelectorOpen&&this.setState({visibilitySelectorOpen:!0})},this.closeVisibilitySelector=()=>{!0===this.state.visibilitySelectorOpen&&this.setState({visibilitySelectorOpen:!1})},this.chosenPilotsChanged=t=>{this.setState({chosenPilots:t})},this.state={pilotSelectorOpen:!1,visibilitySelectorOpen:!1,chosenPilots:getChosenPilots()}}componentDidMount(){getChosenPilotsObject().registerCallback(this.chosenPilotsChanged)}componentWillUnmount(){getChosenPilotsObject().unregisterCallback(this.chosenPilotsChanged)}render(){return a.a.createElement(a.a.Fragment,null,a.a.createElement(ae,{pilots:this.state.chosenPilots}),a.a.createElement(r.a,{position:"absolute",bottom:"68px",right:"16px"},a.a.createElement(dt.a,{size:"small",color:"primary",onClick:this.openVisibilitySelector},a.a.createElement(rt.a,null))),a.a.createElement(r.a,{position:"absolute",bottom:"16px",right:"16px"},a.a.createElement(dt.a,{size:"small",color:"primary",onClick:this.openPilotSelector},a.a.createElement(gt.a,null))),a.a.createElement(xt,{open:this.state.pilotSelectorOpen,onClose:this.closePilotSelector,onAddPilots:addPilots,alreadyAdded:Object.keys(this.state.chosenPilots)}),a.a.createElement(he,{open:this.state.visibilitySelectorOpen,onClose:this.closeVisibilitySelector,onUpdateVisibility:t=>{(t=>{const e=Object(v.a)({},getChosenPilots());let i=!1;for(const n in e){const a=-1!==t.indexOf(n);a!==e[n].shown&&(e[n].shown=a,i=!0)}i&&setChosenPilots(e)})(t)},pilots:this.state.chosenPilots}))}}var pe=Pilots_Pilots,ue=i(295),de=i(148),me=i(299),ge=i(141),fe=i.n(ge),be=i(139),Ce=i.n(be),ve=i(138),ye=i.n(ve),Ee=i(140),ke=i.n(Ee),we=i(60),Pe=i.n(we),Se=i(305),Oe=i(135),Me=i.n(Oe),xe=i(136),_e=i.n(xe),Te=i(137),Ae=i.n(Te),Ie=i(293),Le=i(294),De=i(292);class NumberInput_NumberInput extends a.a.PureComponent{constructor(...t){super(...t),this.state={internalUpdate:!1,value:null}}static getDerivedStateFromProps(t,e){const i=Object(v.a)({},e,{internalUpdate:!1});return e.internalUpdate||(i.value=t.value),i}render(){return a.a.createElement(Ct.a,{onChange:t=>{const e=t.target.value;e<this.props.min?(this.props.onChange(this.props.min),this.setState(t=>Object(v.a)({},t,{internalUpdate:!0,value:e}))):e>this.props.max?this.props.onChange(this.props.max):this.props.onChange(e)},variant:"outlined",disabled:this.props.disabled,margin:"dense",hiddenLabel:!0,type:"number",value:this.state.value,InputProps:{endAdornment:a.a.createElement(De.a,{position:"end"},this.props.unit)},inputProps:{min:this.props.min,max:this.props.max}})}}const Re=Object(Ot.a)(t=>{const e=getSetting(t.setting).use(),i=Object(l.a)(e,2),n=i[0],s=i[1],flipSetting=()=>s(!n);return a.a.createElement(K.a,{button:!0,onClick:flipSetting},a.a.createElement(Q.a,{primary:t.primaryText,secondary:t.secondaryText}),a.a.createElement(Ie.a,null,a.a.createElement(Le.a,{edge:"end",onChange:flipSetting,checked:n})))}),Fe=Object(Ot.a)(t=>{const e=getSetting(t.setting).use(),i=Object(l.a)(e,2),n=i[0],s=i[1];return a.a.createElement(K.a,{disabled:t.disabled},a.a.createElement(Q.a,{primary:t.primaryText,secondary:t.secondaryText}),a.a.createElement(Ie.a,null,a.a.createElement(NumberInput_NumberInput,{value:n,onChange:s,disabled:t.disabled,unit:t.unit,min:t.min,max:t.max})))});var je=i(296),Ve=i(297),Ne=i(298),Ge=i(133),He=i.n(Ge),We=i(134),ze=i.n(We);var Ue=Object(Ot.a)(t=>{const e=Object(n.useState)(!1),i=Object(l.a)(e,2),s=i[0],o=i[1];return a.a.createElement(a.a.Fragment,null,a.a.createElement(ue.a,{style:{position:"static"}},a.a.createElement(ft.a,null,a.a.createElement(de.a,{edge:"start",color:"inherit",onClick:t.onClose},a.a.createElement(He.a,null)),a.a.createElement(r.a,{marginLeft:2,flexGrow:1},a.a.createElement(w.a,{variant:"h6"},"Settings")),a.a.createElement(de.a,{edge:"end",color:"inherit",onClick:()=>o(!0)},a.a.createElement(ze.a,null)))),a.a.createElement(util_SubWindow,{open:s,onClose:()=>o(!1)},a.a.createElement(je.a,null,"Reset all settings?"),a.a.createElement(Ve.a,null,a.a.createElement(Ne.a,null,"This sets all settings to their default values.")),a.a.createElement(vt.a,null,a.a.createElement(yt.a,{onClick:()=>{Object.values(V).forEach(t=>t.setValue(null)),o(!1)},color:"primary"},"Yes"),a.a.createElement(yt.a,{onClick:()=>o(!1),color:"primary",autoFocus:!0},"No"))))});var SettingsPage_SettingsPage=t=>{const e=getSetting(A).use(),i=Object(l.a)(e,1)[0],n=getSetting(D).use(),s=Object(l.a)(n,1)[0];return a.a.createElement(util_SubWindow,{fullScreen:!0,open:t.open,onClose:t.onClose},a.a.createElement(Ue,{onClose:t.onClose}),a.a.createElement(et.a,null,a.a.createElement(Re,{setting:I,primaryText:"Low Latency Mode",secondaryText:"disables animations"}),a.a.createElement(se.a,null),a.a.createElement(Re,{setting:A,primaryText:"Limit Track Length",secondaryText:"prevents map clutter"}),a.a.createElement(Fe,{primaryText:"Track Length",secondaryText:"Valid: 1-999 min",setting:T,disabled:!i,unit:"min",min:1,max:999}),a.a.createElement(se.a,null),a.a.createElement(Re,{setting:D,primaryText:"Limit Framerate",secondaryText:"reduces energy consumption"}),a.a.createElement(Fe,{primaryText:"Framerate",secondaryText:"Valid: 1-60 fps",setting:R,disabled:!s,unit:"fps",min:1,max:60}),a.a.createElement(se.a,null),a.a.createElement(Re,{setting:F,primaryText:"Enable GPS",secondaryText:"required for advanced features"})))};function LinkPopup(t){const copyToClipboard=()=>{navigator.clipboard.writeText(t.link).then((function(){alert("Copied link to clipboard!")}),(function(t){alert("Can't copy to clipboard:",t)}))};return a.a.createElement(Et.a,{open:null!==t.link,onClose:t.onClose},a.a.createElement(je.a,null,"Shareable Link:"),a.a.createElement(Ve.a,null,a.a.createElement(Ne.a,null,a.a.createElement("a",{style:{wordWrap:"break-word",wordBreak:"break-all"},onClick:()=>(copyToClipboard(),window.event.preventDefault(),!1),href:t.link},t.link))),a.a.createElement(vt.a,null,a.a.createElement(yt.a,{onClick:copyToClipboard,color:"primary",autoFocus:!0},"Copy"),a.a.createElement(yt.a,{onClick:t.onClose,color:"primary",autoFocus:!0},"Close")))}var Be=i(81);class LinkCreator_LinkCreator extends a.a.PureComponent{constructor(t){super(t),this.pilotClicked=t=>{const e=Object(v.a)({},this.state.selected);t in e?delete e[t]:e[t]=!0,this.setState({selected:e})},this.closeWindow=()=>{this.props.onClose()},this.createLink=t=>{const e={},i=getChosenPilots();t.forEach(t=>{t in i&&null!=i[t].name?e[t]=i[t].name:e[t]=null});const n=Object(Be.b)(e),a=window.location.href+"?group="+n;this.setState({createdLink:a})},this.state={selected:{},createdLink:null,open:t.open}}render(){return a.a.createElement(a.a.Fragment,null,a.a.createElement(util_SubWindow,{open:this.props.open,onClose:this.closeWindow,fullScreen:!1,maxWidth:"xs",fullWidth:!0},a.a.createElement(ft.a,null,a.a.createElement(w.a,{component:"div",variant:"h6",id:"tableTitle"},"Choose Pilots to share:")),a.a.createElement(se.a,null),a.a.createElement(PilotMultipleChoiceList_PilotMultipleChoiceList,{pilots:getChosenPilots(),selected:this.state.selected,onPilotClicked:this.pilotClicked}),a.a.createElement(vt.a,null,a.a.createElement(yt.a,{onClick:this.closeWindow,color:"primary"},"Cancel"),a.a.createElement(yt.a,{disabled:!1,onClick:()=>{this.createLink(Object.keys(this.state.selected)),this.closeWindow()},color:"primary"},"Create Link"))),a.a.createElement(LinkPopup,{link:this.state.createdLink,onClose:()=>{this.setState({createdLink:null})}}))}}LinkCreator_LinkCreator.getDerivedStateFromProps=(t,e)=>t.open!==e.open?!1===t.open?{open:t.open}:{open:t.open,selected:{}}:null;var Xe=LinkCreator_LinkCreator;var pages_MainMenu=t=>{const e=Object(p.a)(),i=Object(n.useState)(!1),s=Object(l.a)(i,2),o=s[0],c=s[1],h=Object(n.useState)(!1),u=Object(l.a)(h,2),d=u[0],m=u[1];return a.a.createElement(a.a.Fragment,null,a.a.createElement(Se.a,{disableSwipeToOpen:!0,open:t.open,onOpen:()=>{},onClose:t.onClose},a.a.createElement(ft.a,{style:{backgroundColor:e.palette.primary.light,minWidth:"200px"},onClick:t.onClose},a.a.createElement(r.a,{flexGrow:1,clone:!0},a.a.createElement(w.a,{variant:"h6"},"Menu")),a.a.createElement(de.a,{edge:"end",color:"inherit"},a.a.createElement(Me.a,null))),a.a.createElement(et.a,null,a.a.createElement(K.a,{button:!0,onClick:()=>{t.onClose(),c(!0)}},a.a.createElement($.a,null,a.a.createElement(_e.a,null)),a.a.createElement(Q.a,{primary:"Settings"})),a.a.createElement(K.a,{button:!0,onClick:()=>{t.onClose(),m(!0)}},a.a.createElement($.a,null,a.a.createElement(Ae.a,null)),a.a.createElement(Q.a,{primary:"Create Pilot Link"})))),a.a.createElement(SettingsPage_SettingsPage,{open:o,onClose:()=>c(!1)}),a.a.createElement(Xe,{open:d,onClose:()=>m(!1)}))};const Je=Object(k.a)(t=>({popover:{padding:t.spacing(1),align:"right"}})),LoadingBadge=t=>a.a.createElement(me.a,{anchorOrigin:{vertical:"bottom",horizontal:"right"},badgeContent:a.a.createElement(P.a,{disableShrink:t.disableShrink,color:"secondary",size:15,thickness:10})},t.children);var Ye=Object(Ot.a)(()=>{const t=Je(),e=getXContestInterface().connectionState.use(),i=a.a.useRef(),s=Object(n.useState)(null),o=Object(l.a)(s,2),c=o[0],h=o[1],p=Object(n.useState)(!1),u=Object(l.a)(p,2),d=u[0],m=u[1];a.a.useLayoutEffect(()=>{i.current&&i.current.updatePosition()},[e,c]);return a.a.createElement("div",null,a.a.createElement(ue.a,{position:"static"},a.a.createElement(ft.a,null,a.a.createElement(de.a,{edge:"start",color:"inherit",onClick:()=>m(!0)},a.a.createElement(fe.a,null)),a.a.createElement(r.a,{marginLeft:2,flexGrow:1},a.a.createElement(w.a,{variant:"h6"},"XC Live Viewer")),a.a.createElement(de.a,{edge:"end",color:"inherit",onClick:t=>h(t.currentTarget)},(()=>{switch(e){case U.ACTIVE:return a.a.createElement(ye.a,null);case U.CONNECTING:return a.a.createElement(LoadingBadge,null,a.a.createElement(Pe.a,null));case U.ERROR:return a.a.createElement(Ce.a,{color:"error"});case U.ESTABLISHED:return a.a.createElement(LoadingBadge,{disableShrink:!0},a.a.createElement(Pe.a,null));case U.INACTIVE:return a.a.createElement(ke.a,null);case U.NO_CONNECTION:default:return a.a.createElement(Pe.a,null)}})()))),a.a.createElement(tt.a,{open:Boolean(c),anchorEl:c,onClose:()=>h(null),anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},action:i},a.a.createElement(r.a,{className:t.popover},a.a.createElement(w.a,null,e))),a.a.createElement(pages_MainMenu,{open:d,onClose:()=>m(!1)}))});var src_MainPage=()=>{const t=ut.TabID.use(),e=Object(l.a)(t,2),i=e[0],n=e[1],s=a.a.useState(0),o=Object(l.a)(s,2),c=o[0],g=o[1],b=Object(p.a)(),v=Object(u.a)(b.breakpoints.down("sm")),updateWindowHeight=()=>{g(window.innerHeight)};a.a.useLayoutEffect(()=>(updateWindowHeight(),window.addEventListener("resize",updateWindowHeight),()=>{window.removeEventListener("resize",updateWindowHeight)}),[]);const y=v?a.a.createElement(a.a.Fragment,null,a.a.createElement(r.a,{flexGrow:1,clone:!0,display:"flex"},a.a.createElement(h.a,{disabled:!0,index:i},a.a.createElement(r.a,{width:"100%",height:"100%",position:"relative"},a.a.createElement(LiveMap_LiveMap,null)),a.a.createElement(r.a,{width:"100%",height:"100%",position:"relative"},a.a.createElement(pe,null)))),a.a.createElement(r.a,{zIndex:100,boxShadow:3},a.a.createElement(d.a,{value:i,onChange:(t,e)=>{n(e)},showLabels:!0},a.a.createElement(m.a,{label:"Map",icon:a.a.createElement(C.a,null)}),a.a.createElement(m.a,{label:"Pilots",icon:a.a.createElement(f.a,null)})))):a.a.createElement(r.a,{width:"100%",flexGrow:1,display:"flex",overflow:"hidden"},a.a.createElement(r.a,{flexGrow:1,height:"100%"},a.a.createElement(LiveMap_LiveMap,null)),a.a.createElement(r.a,{width:"400px",height:"100%",zIndex:50,boxShadow:3},a.a.createElement(pe,null)));return a.a.createElement(r.a,{height:c,display:"flex",flexDirection:"column",overflow:"hidden"},a.a.createElement(r.a,{zIndex:100},a.a.createElement(Ye,null)),y)};var src_App=()=>a.a.createElement("div",{className:"App"},a.a.createElement(src_MainPage,null));i(233);i(234);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i(235).config(),function resolveBreakingChanges(){!function fixChosenPilots(){let t=Object(v.a)({},getChosenPilots()),e=!1;for(var i=0,n=[...Object.keys(t)];i<n.length;i++){let a=n[i],s=t[a];s!==Object(s)&&("string"==typeof s?(t[a]=defaultPilotEntry(s),e=!0):(t[a]=defaultPilotEntry(a),e=!0))}e&&setChosenPilots(t)}()}(),function processUrlParameters(){const t=new URLSearchParams(window.location.search);t.has("group")&&function processGroup(t){let e=Object(Be.a)(t),i=Object(v.a)({},getChosenPilots());Object.entries(e).forEach(([t,e])=>{t in i?null!=e&&(i[t]=Object(v.a)({},i[t],{name:e})):i[t]=defaultPilotEntry(null!=e?e:t)}),Object.keys(i).forEach(t=>{i[t]=Object(v.a)({},i[t],{shown:t in e})}),setChosenPilots(i)}(t.get("group")),window.location.href!==window.location.href.split("?")[0]&&(window.location.href=window.location.href.split("?")[0])}(),o.a.render(a.a.createElement(src_App,null),document.getElementById("root")),function unregister(){"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(t=>{t.unregister()})}()},81:function(t,e,i){"use strict";(function(t){i.d(e,"b",(function(){return encodeBase64})),i.d(e,"a",(function(){return decodeBase64}));var n=i(91);const encodeBase64=e=>{const a=function encodeUtf8(t){if("undefined"===typeof TextEncoder){return new(0,i(117).TextEncoder)("utf-8").encode(t)}return new TextEncoder("utf-8").encode(t)}(JSON.stringify(e)),s=Object(n.deflate)(a);return t.from(s).toString("base64")},decodeBase64=e=>{const a=t.from(e,"base64"),s=function decodeUtf8(t){if("undefined"===typeof TextDecoder){return new(0,i(117).TextDecoder)("utf-8").decode(t)}return new TextDecoder("utf-8").decode(t)}(Object(n.inflate)(a));return JSON.parse(s)}}).call(this,i(219).Buffer)}},[[159,1,2]]]);
//# sourceMappingURL=main.05234392.chunk.js.map