/*! For license information please see main.ed196104.chunk.js.LICENSE.txt */
(this["webpackJsonpxc-live-viewer"]=this["webpackJsonpxc-live-viewer"]||[]).push([[0],{101:function(t){t.exports=JSON.parse('[{"featureType":"all","stylers":[{"visibility":"simplified"},{"saturation":-40}]},{"featureType":"administrative.land_parcel","stylers":[{"visibility":"off"}]},{"featureType":"administrative.neighborhood","stylers":[{"visibility":"off"}]},{"featureType":"poi","elementType":"labels.text","stylers":[{"visibility":"off"}]},{"featureType":"road","elementType":"labels","stylers":[{"visibility":"off"}]},{"featureType":"water","elementType":"labels.text","stylers":[{"visibility":"off"}]}]')},135:function(t,e,a){t.exports=a(198)},161:function(t,e,a){},191:function(t,e,a){},192:function(t,e,a){},193:function(t,e,a){},198:function(t,e,a){"use strict";a.r(e);var i=a(0),n=a.n(i),s=a(11),o=a.n(s),l=a(7),r=a(259),c=a(98),h=a.n(c),u=a(20),p=a(236),d=a(256),g=a(257),m=a(121),f=a.n(m),b=a(120),v=a.n(b),y=(a(161),a(99));let k=null;var C=function useGoogleMapsApi(){const t=Object(i.useState)({ready:!1,error:!1}),e=Object(l.a)(t,2),a=e[0],n=e[1];return Object(i.useEffect)(()=>{null===k&&(k=new y.a({apiKey:"AIzaSyBCrP5uoEJXfEvz8f_y1HgzQnqUGHz0Aak"}).load());let t={gotCanceled:!1};return k.then(()=>{t.gotCanceled||(console.log("Google Maps API loaded."),n({ready:!0,error:!1}))}).catch(e=>{t.gotCanceled||(console.log("Error: Cannot load Google Maps API:",e),n({ready:!1,error:!0}))}),()=>{t.gotCanceled=!0}},[]),[a.ready,a.error,a.ready?window.google:null]},w=a(230),S=a(42),E=a(234),P=a(100),_=a.n(P);const O=Object(w.a)(t=>({progress:{margin:t.spacing(2)}})),LoadingPage=({message:t,hideIf:e,subRef:a})=>{const i=O();return n.a.createElement(r.a,{width:"100%",height:"100%",display:e?"none":"flex",alignItems:"center",justifyContent:"center",ref:a},n.a.createElement(r.a,{textAlign:"center"},n.a.createElement(E.a,{className:i.progress}),n.a.createElement(S.a,null,t)))},ErrorPage=({message:t,hideIf:e})=>{const a=O();return n.a.createElement(r.a,{width:"100%",height:"100%",display:e?"none":"flex",alignItems:"center",justifyContent:"center"},n.a.createElement(r.a,{textAlign:"center"},n.a.createElement(_.a,{fontSize:"large",color:"error",className:a.progress}),n.a.createElement(S.a,{color:"error"},t)))};var x=a(101);class PersistentState_PersistentState{constructor(t,e){this.getValue=()=>{const t=localStorage.getItem(this.key);this.locallyCachedJson!==t&&(this.locallyCachedJson=t,this.locallyCachedValue=JSON.parse(t));const e=this.locallyCachedValue;return null===e?this.initialValue:e},this._notifyAll=()=>{const t=this.getValue();var e=!0,a=!1,i=void 0;try{for(var n,s=this.callbacks[Symbol.iterator]();!(e=(n=s.next()).done);e=!0){(0,n.value)(t)}}catch(o){a=!0,i=o}finally{try{e||null==s.return||s.return()}finally{if(a)throw i}}},this.registerCallback=t=>{this.callbacks.includes(t)||this.callbacks.push(t)},this.unregisterCallback=t=>{const e=this.callbacks.indexOf(t);e>=0&&this.callbacks.splice(e,1)},this.setValue=t=>{null==t?localStorage.removeItem(this.key):localStorage.setItem(this.key,JSON.stringify(t)),this._notifyAll()},this.updateValue=t=>{this.setValue(t(this.getValue()))},this.use=()=>{const t=Object(i.useState)(this.getValue),e=Object(l.a)(t,2),a=e[0],n=e[1];return Object(i.useEffect)(()=>{const cb=t=>{n(t)};return this.registerCallback(cb),()=>this.unregisterCallback(cb)},[]),[a,this.setValue]},this.key=t,this.initialValue=e,this.callbacks=[],this.locallyCachedJson=null,this.locallyCachedValue=null}}const registerPersistentState=(t,e)=>new PersistentState_PersistentState(t,e),M="PATH_LENGTH",T="LIMIT_PATHS",A="LOW_LATENCY",I="ANIMATION_DELAY",D="FPS_LIMIT",L="FPS_RATE",F="GPS_ENABLED",createSetting=(t,e)=>registerPersistentState("SETTINGS_"+t,e),j={PATH_LENGTH:createSetting(M,15),LIMIT_PATHS:createSetting(T,!1),LOW_LATENCY:createSetting(A,!1),ANIMATION_DELAY:createSetting(I,80),FPS_LIMIT:createSetting(D,!0),FPS_RATE:createSetting(L,10),GPS_ENABLED:createSetting(F,!0)},getSetting=t=>j[t];class XContestSocket_XContestSocket{constructor(t,e,a,i){this.formatSubscribedFlights=()=>this.subscribedFlights.map(([t,e])=>({flightUuid:t,start:null===e?null:new Date(1e3*e).toISOString()})),this.refreshSubscribedFlights=()=>{if(this.sock.readyState===WebSocket.OPEN&&this.connected){const t=this.formatSubscribedFlights();this.sock.send(JSON.stringify({tag:"WebFollow",contents:t}))}},this.setSubscribedFlights=t=>{this.subscribedFlights=t,this.refreshSubscribedFlights()},this.onOpen=()=>{this.handleReset(),console.debug("WebSocket: Open!"),this.setConnectionState(H.ESTABLISHED),this.connected=!0,this.sock.send(JSON.stringify({tag:"WebFilterArea",area:[{lat:-90,lon:-180},{lat:90,lon:180}]})),this.sock.send(JSON.stringify({tag:"WebFilterContest",contents:"alpha9999"}));const t=this.formatSubscribedFlights();this.sock.send(JSON.stringify({tag:"WebFollow",contents:t}))},this.onMessage=t=>{console.debug("WebSocket: Message!"),this.setConnectionState(H.ACTIVE);let e=JSON.parse(t.data);clearTimeout(this.watchdog),this.watchdog=setTimeout(()=>{this.setConnectionState(H.INACTIVE)},7e4),this.processMessage(e)},this.onClose=t=>{this.connected=!1,console.debug("WebSocket: Close!"),this.setConnectionState(H.NO_CONNECTION),setTimeout(this.connect.bind(this),1e3)},this.onError=t=>{this.connected=!1,console.debug("WebSocket: Error!")},this.handleReset=()=>{console.log("TODO: handle reset!")},this.processMessage=t=>{if("tag"in t)switch(t.tag){case"LiveFlightInfos":this.dispatchInfoMessage(t.contents);break;case"LiveFlightChunk":this.dispatchTracklogMessage(t);break;case"LiveFlightLanded":this.dispatchFlightLandedMessage(t.flightUuid);break;default:console.warn("Warning: Unknown message tag '".concat(t.tag,"'!"),t)}else console.warn("Warning: Invalid message format!",t)},this.setConnectionState=t,this.dispatchInfoMessage=e,this.dispatchTracklogMessage=a,this.dispatchFlightLandedMessage=i,this.subscribedFlights=[],this.connect(),this.connected=!1,getSetting(M).registerCallback(this.refreshSubscribedFlights),getSetting(T).registerCallback(this.refreshSubscribedFlights)}connect(){"WebSocket"in window?(this.connected=!1,this.setConnectionState(H.CONNECTING),this.sock=new WebSocket("wss://live.xcontest.org/websock/webclient"),this.sock.onopen=this.onOpen,this.sock.onmessage=this.onMessage,this.sock.onclose=this.onClose,this.sock.onerror=this.onError):(this.setConnectionState(H.ERROR),alert("WebSocket NOT supported by your Browser!"))}}var V=a(8);const R=registerPersistentState("chosen-pilots",{}),getChosenPilotsObject=()=>R;function getChosenPilots(){return R.getValue()}function setChosenPilots(t){console.log("Selected pilots updated: ",t),R.setValue(t)}function setChosenPilotsAndUpdateNames(t=null){let e=!0;null===t&&(t=Object(V.a)({},getChosenPilots()),e=!1);const a=getXContestInterface().getPilotInfos();for(const i in t)if(i in a){const n=a[i].info.user.fullname;n!==t[i]&&(t[i]=n,e=!0)}e&&setChosenPilots(t)}const addPilots=t=>{const e=Object(V.a)({},getChosenPilots());let a=!1;var i=!0,n=!1,s=void 0;try{for(var o,l=t[Symbol.iterator]();!(i=(o=l.next()).done);i=!0){const t=o.value;t in e||(e[t]=t,a=!0)}}catch(r){n=!0,s=r}finally{try{i||null==l.return||l.return()}finally{if(n)throw s}}a&&setChosenPilotsAndUpdateNames(e)},removePilots=t=>{const e=Object(V.a)({},getChosenPilots());let a=!1;var i=!0,n=!1,s=void 0;try{for(var o,l=t[Symbol.iterator]();!(i=(o=l.next()).done);i=!0){const t=o.value;t in e&&(delete e[t],a=!0)}}catch(r){n=!0,s=r}finally{try{i||null==l.return||l.return()}finally{if(n)throw s}}a&&setChosenPilots(e)};const lerp=(t,e,a)=>null===e?t:null===t?e:(1-a)*t+a*e,spline=(t,e,a,i,n,s,o,l,r)=>{s-=e,l-=e;const c=((a-t)*(r-=e)+t*(i-=e)-a*(e=0))/(i-e),h=((n-a)*r+a*s-n*i)/(s-i),u=((o-n)*r+n*l-o*s)/(l-s),p=((h-c)*r+c*s-h*e)/(s-e),d=((u-h)*r+h*l-u*i)/(l-i);return((d-p)*r+p*s-d*i)/(s-i)},splineDerivative=(t,e,a,i,n,s,o,l,r)=>{s-=e,l-=e;const c=((a-t)*(r-=e)+t*(i-=e)-a*(e=0))/(i-e),h=((n-a)*r+a*s-n*i)/(s-i),u=((o-n)*r+n*l-o*s)/(l-s),p=(a-t)/(i-e),d=(n-a)/(s-i),g=(o-n)/(l-s),m=(d*r+h-p*r-c+p*s-d*e)/(s-e),f=(g*r+u-d*r-h+d*l-g*i)/(l-i);return(f*r+((u-h)*r+h*l-u*i)/(l-i)-m*r-((h-c)*r+c*s-h*e)/(s-e)+m*s-f*i)/(s-i)};class RunningDerivation{constructor(t,e=((t,e)=>e-t),a=(t=>null===t)){this.computeDiff=e,this.isInvalid=a,this.old_val=null,this.old_t=null,this.running_avg=null,this.smoothingFactor=t}update(t,e){if(null===this.old_val||null===t||null===this.old_t||null===e||this.isInvalid(this.old_val)||this.isInvalid(t)||this.old_t===this.new_t)return this.old_val=t,this.old_t=e,null;let a=e-this.old_t,i=this.computeDiff(this.old_val,t)/a,n=Math.pow(this.smoothingFactor,a);return null===this.running_avg?this.running_avg=i:this.running_avg=n*this.running_avg+(1-n)*i,this.old_val=t,this.old_t=e,this.running_avg}reset(){this.old_val=null,this.old_t=null,this.running_avg=null}}var N=a(27);var FindBisect=(t,e,a)=>{if(e<1)return 0;let i=-1,n=e,s=0,o=null;for(;i<n-1;)s=(i+n)/2|0,o=a(s),o<t?i=s:n=s;return n};const parseTime=t=>Math.round(Date.parse(t)/1e3);class FlightAnimationData_FlightAnimationData{constructor(){this.at=t=>this.data[t],this.findBisect=t=>FindBisect(t,this.data.length,t=>this.data[t].t),this.findForwardSwipe=(t,e)=>{let a=e;for(;a<this.data.length&&this.data[a].t<t;)a+=1;return a},this.getNewestTimestamp=()=>this.data.length<1?null:this.data[this.data.length-1].t,this.data=[],this.counter_gpsVario=new RunningDerivation(.7),this.counter_baroVarion=new RunningDerivation(.7),this.counter_velocity=new RunningDerivation(.7,(t,e)=>Object(N.getDistance)(t,e,.01),()=>!1)}clear(){this.data=[],this.counter_gpsVario=new RunningDerivation(.7),this.counter_baroVarion=new RunningDerivation(.7),this.counter_velocity=new RunningDerivation(.7,(t,e)=>Object(N.getDistance)(t,e,.01),()=>!1)}get length(){return this.data.length}isAfterLastElement(t){return this.data.length<=0||this.data[this.data.length-1].t<t}append(t){var e=!0,a=!1,i=void 0;try{for(var n,s=t[Symbol.iterator]();!(e=(n=s.next()).done);e=!0){const t=n.value,e=parseTime(t.timestamp),a={lat:t.lat,lng:t.lon},i=0===t.baroAlt?null:t.baroAlt,s=0===t.gpsAlt?null:t.gpsAlt,o=this.counter_gpsVario.update(s,e),l=this.counter_baroVarion.update(i,e),r=this.counter_velocity.update(a,e),c={baroAlt:i,gpsAlt:s,elevation:t.elevation,pos:a,gpsVario:o,baroVario:l,velocity:r,t:e};this.data.push(c)}}catch(o){a=!0,i=o}finally{try{e||null==s.return||s.return()}finally{if(a)throw i}}}replace(t){this.clear(),this.append(t)}insert(t){const e=[];var a=!0,i=!1,n=void 0;try{for(var s,o=t[Symbol.iterator]();!(a=(s=o.next()).done);a=!0){const t=s.value,a=parseTime(t.timestamp),i={lat:t.lat,lng:t.lon},n={baroAlt:0===t.baroAlt?null:t.baroAlt,gpsAlt:0===t.gpsAlt?null:t.gpsAlt,elevation:t.elevation,pos:i,gpsVario:null,baroVario:null,velocity:null,t:a};e.push(n)}}catch(m){i=!0,n=m}finally{try{a||null==o.return||o.return()}finally{if(i)throw n}}const l=this.data;this.data=[];let r=0,c=0;for(;!(r>=l.length&&c>=e.length);)if(r>=l.length)this.data.push(e[c]),c+=1;else if(c>=e.length)this.data.push(l[r]),r+=1;else{const t=l[r],a=e[c];a.t<t.t?(this.data.push(a),c+=1):t.t<a.t?(this.data.push(t),r+=1):(this.data.push(a),r+=1,c+=1)}this.counter_gpsVario.reset(),this.counter_baroVarion.reset(),this.counter_velocity.reset();var h=!0,u=!1,p=void 0;try{for(var d,g=this.data[Symbol.iterator]();!(h=(d=g.next()).done);h=!0){let t=d.value;const e=this.counter_gpsVario.update(t.gpsAlt,t.t),a=this.counter_baroVarion.update(t.baroAlt,t.t),i=this.counter_velocity.update(t.pos,t.t);t.gpsVario=e,t.baroVario=a,t.velocity=i}}catch(m){u=!0,p=m}finally{try{h||null==g.return||g.return()}finally{if(u)throw p}}}}class FlightAnimationDataCache{constructor(){this.reset=()=>{this.currentArrayPos=null,this.mapsPath=[],this.mapsPathNewestPos=0},this.currentArrayPos=null,this.mapsPath=[],this.mapsPathNewestPos=0}}class FlightAnimation_DataGens{static takeData(t){return{baroAlt:t.baroAlt,gpsAlt:t.gpsAlt,elevation:t.elevation,pos:{lat:t.pos.lat,lng:t.pos.lng},gpsVario:t.gpsVario,baroVario:t.baroVario,velocity:t.velocity}}static blendData(t,e,a){const i=(a-t.t)/(e.t-t.t);return{baroAlt:lerp(t.baroAlt,e.baroAlt,i),gpsAlt:lerp(t.gpsAlt,e.gpsAlt,i),elevation:lerp(t.elevation,e.elevation,i),pos:{lat:lerp(t.pos.lat,e.pos.lat,i),lng:lerp(t.pos.lng,e.pos.lng,i)},gpsVario:lerp(t.gpsVario,e.gpsVario,i),baroVario:lerp(t.baroVario,e.baroVario,i),velocity:lerp(t.velocity,e.velocity,i)}}static blendDataSpline(t,e,a,i,n){const s=(n-e.t)/(a.t-e.t);return{baroAlt:lerp(e.baroAlt,a.baroAlt,s),gpsAlt:lerp(e.gpsAlt,a.gpsAlt,s),elevation:lerp(e.elevation,a.elevation,s),pos:{lat:spline(t.pos.lat,t.t,e.pos.lat,e.t,a.pos.lat,a.t,i.pos.lat,i.t,n),lng:spline(t.pos.lng,t.t,e.pos.lng,e.t,a.pos.lng,a.t,i.pos.lng,i.t,n)},gpsVario:lerp(e.gpsVario,a.gpsVario,s),baroVario:lerp(e.baroVario,a.baroVario,s),velocity:lerp(e.velocity,a.velocity,s)}}static computeLinearVelocity(t,e){const a=t.t,i=e.t;if(a===i)return null;const n=i-a,s=t.pos,o=e.pos;return{lat:(o.lat-s.lat)/n,lng:(o.lng-s.lng)/n}}static computeSplineVelocity(t,e,a,i,n){const s=t.t,o=e.t,l=a.t,r=i.t,c=t.pos,h=e.pos,u=a.pos,p=i.pos;return{lat:splineDerivative(c.lat,s,h.lat,o,u.lat,l,p.lat,r,n),lng:splineDerivative(c.lng,s,h.lng,o,u.lng,l,p.lng,r,n)}}}FlightAnimation_DataGens.fallbackData=t=>({baroAlt:t.lastFix.baroAlt,gpsAlt:t.lastFix.gpsAlt,elevation:t.lastFix.elevation,pos:{lat:t.lastFix.lat,lng:t.lastFix.lon},gpsVario:null,baroVario:null,velocity:null});var G=class FlightAnimation_FlightAnimation{constructor(t){this.destroy=()=>{getSetting(I).unregisterCallback(this.updateSettings),getSetting(A).unregisterCallback(this.updateSettings),getSetting(M).unregisterCallback(this.updateSettings),getSetting(T).unregisterCallback(this.updateSettings)},this.updateSettings=()=>{this.settings={timeOffsetSeconds:getSetting(I).getValue(),lowLatencyMode:getSetting(A).getValue(),trackLengthMinutes:getSetting(M).getValue(),limitTracks:getSetting(T).getValue()},this.liveDataCache.reset(),this.flightInfoDataCache.reset()},this.updateInfos=t=>{this.landed|=t.landed,this.flightInfos=t,this.flightInfoData.replace(t.track),this.flightInfoDataCache.reset()},this.updateData=t=>{if(t.length<1)return;const e=parseTime(t[0].timestamp);this.liveData.isAfterLastElement(e)?this.liveData.append(t):(this.liveData.insert(t),this.liveDataCache.reset())},this.updateLanded=()=>{console.log("Received flight landed message!"),this.landed=!0},this.getInterpolatedData=(t,e,a)=>{if(t.length<1)return null;null===e.currentArrayPos?e.currentArrayPos=t.findBisect(a):e.currentArrayPos=t.findForwardSwipe(a,e.currentArrayPos);let i=null,n=!1,s=!1,o=null;if(e.currentArrayPos<=0)i=FlightAnimation_DataGens.takeData(t.at(0)),t.length>=2&&(o=FlightAnimation_DataGens.computeLinearVelocity(t.at(0),t.at(1))),s=!0;else if(e.currentArrayPos>=t.length)i=FlightAnimation_DataGens.takeData(t.at(t.length-1)),t.length>=2&&(o=FlightAnimation_DataGens.computeLinearVelocity(t.at(t.length-2),t.at(t.length-1))),n=!0;else{const n=t.at(e.currentArrayPos-1),s=t.at(e.currentArrayPos),l=e.currentArrayPos-2>=0?t.at(e.currentArrayPos-2):Object(V.a)({},n,{t:n.t-1}),r=e.currentArrayPos+1<t.length?t.at(e.currentArrayPos+1):Object(V.a)({},s,{t:s.t+1});i=FlightAnimation_DataGens.blendDataSpline(l,n,s,r,a),o=FlightAnimation_DataGens.computeSplineVelocity(l,n,s,r,a)}return[i,s,n,t.at(t.length-1).t,o]},this.getFallbackData=()=>[FlightAnimation_DataGens.fallbackData(this.flightInfos),!1,!0,parseTime(this.flightInfos.lastFix.timestamp),null],this.computeTrack=(t,e,a)=>{if(t.length<1)return null;const i=a-60*this.settings.trackLengthMinutes;let n=e.mapsPath;for(;e.mapsPathNewestPos<t.length&&t.at(e.mapsPathNewestPos).t<a;){const a=t.at(e.mapsPathNewestPos);n.push({lat:a.pos.lat,lng:a.pos.lng,timestamp:a.t,elevation:a.gpsAlt}),e.mapsPathNewestPos+=1}if(this.settings.limitTracks){const t=32;let a=0;for(;a+t-1<n.length&&n[a+t-1].timestamp<i;)a+=t;a>0&&(n=n.slice(a),e.mapsPath=n)}return n},this.updateAnimation=t=>{const e=this.settings.lowLatencyMode?t/1e3:t/1e3-this.settings.timeOffsetSeconds;let a=this.getInterpolatedData(this.liveData,this.liveDataCache,e);a||(a=this.getInterpolatedData(this.flightInfoData,this.flightInfoDataCache,e)),a||(a=this.getFallbackData());let i=this.computeTrack(this.liveData,this.liveDataCache,e);i||(i=this.computeTrack(this.flightInfoData,this.flightInfoDataCache,e)),i||(i=[]);let n=a,s=Object(l.a)(n,5),o=s[0],r=s[1],c=s[2],h=s[3],u=s[4];return this.settings.lowLatencyMode&&(c=!!this.landed||h<e-80),Object(V.a)({},o,{startOfTrack:r,endOfTrack:c,landed:this.landed,name:this.flightInfos.info.user.fullname,newestDataTimestamp:h,track:i,velocityVec:u})},this.getNewestTimestamp=()=>this.liveData.getNewestTimestamp(),this.liveData=new FlightAnimationData_FlightAnimationData,this.liveDataCache=new FlightAnimationDataCache,this.flightInfos=null,this.flightInfoData=new FlightAnimationData_FlightAnimationData,this.flightInfoDataCache=new FlightAnimationDataCache,this.landed=t.landed,this.updateInfos(t),this.settings={},this.updateSettings(),getSetting(I).registerCallback(this.updateSettings),getSetting(A).registerCallback(this.updateSettings),getSetting(M).registerCallback(this.updateSettings),getSetting(T).registerCallback(this.updateSettings)}};var W=class HighPrecisionTimeSync{constructor(t=20){this.get=(t,e)=>{let a=t+this.offset;const i=a-e;return(i>this.tolerance||i<-this.tolerance)&&(this.offset-=i,a=t+this.offset),a},this.offset=0,this.tolerance=t}};class XContestAnimation_XContestAnimation{constructor(t){this._nextUpdate=Date.now(),this.animationLoop=()=>{const t=Date.now(),e=1e3/this._setting_fps;if(!this._setting_limitFps||t>=this._nextUpdate){this._setting_limitFps&&(this._nextUpdate+=e,t>this._nextUpdate&&(this._nextUpdate=t));const a={};Object.keys(this._subscribedPilots).forEach(e=>{if(e in this._pilotInfos){const i=this._pilotInfos[e].flightId;if(i in this._flightAnimations){const n=this._flightAnimations[i];a[e]=n.updateAnimation(t)}}}),this._submitAnimationFrame(a)}requestAnimationFrame(this.animationLoop)},this._submitAnimationFrame=t=>{this._currentAnimationData=t;var e=!0,a=!1,i=void 0;try{for(var n,s=this._callbacks[Symbol.iterator]();!(e=(n=s.next()).done);e=!0){(0,n.value)(t)}}catch(o){a=!0,i=o}finally{try{e||null==s.return||s.return()}finally{if(a)throw i}}},this.setSubscribedPilots=t=>{this._subscribedPilots=t,this._updateImportantFlights()},this.pushNewInfo=t=>{console.log("newInfo: ",t),this._pilotInfos=t,this._updateImportantFlights(),Object.values(t).forEach(t=>{const e=t.flightId;e in this._flightAnimations&&this._flightAnimations[e].updateInfos(t)})},this.pushNewData=(t,e)=>{console.log("newTrackdata: ",t,e),t in this._flightAnimations&&this._flightAnimations[t].updateData(e)},this.pushFlightLanded=t=>{t in this._flightAnimations&&this._flightAnimations[t].updateLanded()},this.registerCallback=t=>{this._callbacks.includes(t)||this._callbacks.push(t),t(this._currentAnimationData)},this.unregisterCallback=t=>{const e=this._callbacks.indexOf(t);e>=0&&this._callbacks.splice(e,1)},this.getData=()=>this._currentAnimationData,this._updateImportantFlights=()=>{let t={};Object.values(this._pilotInfos).filter(t=>t.info.user.username in this._subscribedPilots).forEach(e=>{t[e.flightId]=e});let e=new Set(Object.keys(t));{const e=[];for(const a in this._flightAnimations)a in t||e.push(a);for(var a=0,i=e;a<i.length;a++){const t=i[a];console.log("Removing flightAnimation of '"+t+"' ..."),this._flightAnimations[t].destroy(),delete this._flightAnimations[t]}}if(Object.entries(t).forEach(([t,e])=>{t in this._flightAnimations||(this._flightAnimations[t]=new G(e))}),!function eqSet(t,e){if(t.size!==e.size)return!1;var a=!0,i=!1,n=void 0;try{for(var s,o=t[Symbol.iterator]();!(a=(s=o.next()).done);a=!0){const t=s.value;if(!e.has(t))return!1}}catch(l){i=!0,n=l}finally{try{a||null==o.return||o.return()}finally{if(i)throw n}}return!0}(e,this._subscribedFlights)){this._subscribedFlights=e;let t=[];console.log(this._flightAnimations),e.forEach(e=>{console.log(e,this._flightAnimations[e]),t.push([e,this._flightAnimations[e].getNewestTimestamp()])}),console.log("Changing flight subscribtion: ",this._subscribedFlights,e),this._setSubscribedFlightsCallback(t)}},this._currentAnimationData={},this._callbacks=[],this._subscribedPilots=getChosenPilots(),this._subscribedFlights=new Set,this._pilotInfos={},this._flightAnimations={},this._highPrecisionTimeSync=new W;const e=getSetting(D),a=getSetting(L);this._setting_limitFps=e.getValue(),this._setting_fps=a.getValue(),e.registerCallback(t=>{this._setting_limitFps=t}),a.registerCallback(t=>{this._setting_fps=t}),this._setSubscribedFlightsCallback=e=>{t(Array.from(e))},getChosenPilotsObject().registerCallback(this.setSubscribedPilots),requestAnimationFrame(this.animationLoop)}}var z=class EventfulState_EventfulState{constructor(t){this.set=t=>{this._callbackData=t;var e=!0,a=!1,i=void 0;try{for(var n,s=this._callbacks[Symbol.iterator]();!(e=(n=s.next()).done);e=!0){(0,n.value)(t)}}catch(o){a=!0,i=o}finally{try{e||null==s.return||s.return()}finally{if(a)throw i}}},this.getValue=()=>this._callbackData,this.registerCallback=t=>{this._callbacks.includes(t)||this._callbacks.push(t)},this.unregisterCallback=t=>{const e=this._callbacks.indexOf(t);e>=0&&this._callbacks.splice(e,1)},this.use=()=>{const t=Object(i.useState)(this._callbackData),e=Object(l.a)(t,2),a=e[0],n=e[1];return Object(i.useEffect)(()=>(this.registerCallback(n),()=>this.unregisterCallback(n)),[]),a},this._callbacks=[],this._callbackData=t}};const H={CONNECTING:"connecting",ERROR:"error",ESTABLISHED:"established",ACTIVE:"active",INACTIVE:"inactive",NO_CONNECTION:"no connection",NO_INFORMATION:"no information"};class XContestInterface_XContestInterface{constructor(){this.setSubscribedFlights=t=>{this.socket.setSubscribedFlights(t)},this.getPilotInfos=()=>this.pilots,this.onConnectionStateChanged=t=>{this.connectionState.set(t)},this.onInfoMessageReceived=t=>{this.pilots={};var e=!0,a=!1,i=void 0;try{for(var n,s=t[Symbol.iterator]();!(e=(n=s.next()).done);e=!0){const t=Object(l.a)(n.value,2),e=t[0],a=t[1];a.overriden||(a.flightId=e,this.pilots[a.info.user.username]=a)}}catch(o){a=!0,i=o}finally{try{e||null==s.return||s.return()}finally{if(a)throw i}}this.animation.pushNewInfo(this.pilots),this.pilotInfos.set(this.pilots),setChosenPilotsAndUpdateNames()},this.onTracklogMessageReceived=t=>{this.animation.pushNewData(t.flightUuid,t.trackChunk)},this.onFlightLandedMessageReceived=t=>{this.animation.pushFlightLanded(t)},this.pilots=[],this.connectionState=new z(H.NO_INFORMATION),this.pilotInfos=new z([]),this.socket=new XContestSocket_XContestSocket(this.onConnectionStateChanged,this.onInfoMessageReceived,this.onTracklogMessageReceived,this.onFlightLandedMessageReceived),this.animation=new XContestAnimation_XContestAnimation(this.setSubscribedFlights)}}let U=null;const getXContestInterface=()=>(U||(U=new XContestInterface_XContestInterface),U);function createRng(t){const e=function xmur3(t){for(var e=0,a=1779033703^t.length;e<t.length;e++)a=(a=Math.imul(a^t.charCodeAt(e),3432918353))<<13|a>>>19;return function(){return a=Math.imul(a^a>>>16,2246822507),a=Math.imul(a^a>>>13,3266489909),(a^=a>>>16)>>>0}}(t);return function sfc32(t,e,a,i){return function(){var n=(t>>>=0)+(e>>>=0)|0;return t=e^e>>>9,e=(a>>>=0)+(a<<3)|0,a=(a=a<<21|a>>>11)+(n=n+(i=(i>>>=0)+1|0)|0)|0,(n>>>0)/4294967296}}(e(),e(),e(),e())}var B=a(102),X=a.n(B);function string2color(t,e){const a=createRng(t),i=Math.min(Math.max(360*a(),0),360);return"#"+X.a.hsl.hex(i,100,e)}const getPilotIconColor=t=>string2color(t,70),getPilotIcon=(t,e,a,i,n,s)=>{if(e)return a?{path:"m 12.66,19.78 6.46,-4.61 C 19.67,14.78 20,14.15 20,13.48 20,11.77 18.08,10.79 16.7,11.77 L 12,15.12 7.3,11.77 c -1.38,-0.99 -3.3,0 -3.3,1.71 0,0.67 0.33,1.31 0.88,1.7 l 6.46,4.62 c 0.4,0.27 0.93,0.27 1.33,-0.01 z m 0,-8 6.46,-4.6 C 19.67,6.78 20,6.15 20,5.48 20,3.77 18.08,2.78 16.7,3.77 L 12,7.12 7.3,3.77 C 5.92,2.78 4,3.77 4,5.48 4,6.15 4.33,6.79 4.88,7.18 l 6.46,4.62 c 0.4,0.27 0.93,0.27 1.33,-0.01 z",fillColor:s,fillOpacity:1,anchor:{x:12,y:20},strokeWeight:1,scale:1.2}:{path:"M 12.747,2 C 12.492,1.998 12.234,2.006 11.973,2.023 8.105,2.256 6.071,4.458 5.904,8.427 H 9.806 C 9.839,7.06 10.64,6.025 12.041,5.859 c 1.401,-0.133 2.735,0.2 3.135,1.134 0.434,1.034 -0.534,2.234 -1.001,2.734 -0.867,0.934 -2.268,1.634 -3.002,2.635 -0.7,1.001 -0.834,2.302 -0.901,3.902 h 3.435 c 0.033,-1.034 0.1,-2.001 0.567,-2.635 0.767,-1.034 1.901,-1.501 2.835,-2.335 0.9,-0.767 1.868,-1.701 2.001,-3.168 C 19.642,4.093 16.568,2.023 12.747,2 Z M 12.074,17.731 A 2.168,2.134 0 0 0 9.906,19.865 2.168,2.134 0 0 0 12.074,22 2.168,2.134 0 0 0 14.242,19.865 2.168,2.134 0 0 0 12.074,17.731 Z",fillColor:s,fillOpacity:1,anchor:{x:12,y:12},strokeWeight:1,scale:1.2};if(t)return{path:"M 12,2 C 8.13,2 5,5.13 5,9 c 0,5.25 7,13 7,13 0,0 7,-7.75 7,-13 0,-3.87 -3.13,-7 -7,-7",fillColor:s,fillOpacity:1,anchor:{x:12,y:22},strokeWeight:1,scale:1.2};return{path:"M12.93 4.26l6.15 14.99c.34.83-.51 1.66-1.33 1.29l-5.34-2.36c-.26-.11-.55-.11-.81 0l-5.34 2.36c-.82.36-1.67-.46-1.33-1.29l6.15-14.99c.33-.83 1.51-.83 1.85 0z",fillColor:s,fillOpacity:1,anchor:{x:12,y:12},strokeWeight:1,scale:1.2,rotation:null===n?0:Object(N.getRhumbLineBearing)(i,{lat:i.lat+n.lat,lng:i.lng+n.lng})}};class MapViewportControllerService_MapViewportControllerService{constructor(){this.setFreeMode=()=>{this.state.updateValue(t=>Object(V.a)({},t,{enabled:!1}))},this.setSinglePilotMode=t=>{this.state.updateValue(e=>Object(V.a)({},e,{enabled:!0,followSinglePilot:t})),this._emitZoomToSinglePilot()},this._emitZoomToSinglePilot=()=>{var t=!0,e=!1,a=void 0;try{for(var i,n=this.mapControllers[Symbol.iterator]();!(t=(i=n.next()).done);t=!0){i.value.zoomToSinglePilot()}}catch(s){e=!0,a=s}finally{try{t||null==n.return||n.return()}finally{if(e)throw a}}},this.onAnimationFrame=t=>{this.state.updateValue(e=>{const a=Object(V.a)({},e);a.pilots=Object(V.a)({},a.pilots);for(const i in e.pilots)i in t||delete a.pilots[i];for(const i in t)i in a.pilots||(a.pilots[i]=!0);return a});var e=!0,a=!1,i=void 0;try{for(var n,s=this.mapControllers[Symbol.iterator]();!(e=(n=s.next()).done);e=!0){n.value.onAnimationFrame(t,this.state.getValue())}}catch(o){a=!0,i=o}finally{try{e||null==s.return||s.return()}finally{if(a)throw i}}},this.registerMapController=t=>{this.mapControllers.includes(t)||this.mapControllers.push(t)},this.unregisterMapController=t=>{const e=this.mapControllers.indexOf(t);e>=0&&this.mapControllers.splice(e,1)},this.mapControllers=[],this.state=registerPersistentState("viewport-state",{includeSelf:!0,enabled:!0,followSinglePilot:null,pilots:{}}),this.state.setValue(null),getXContestInterface().animation.registerCallback(this.onAnimationFrame)}}let J=null;const getMapViewportControllerService=()=>(J||(J=new MapViewportControllerService_MapViewportControllerService),J);class GoogleMapsTrack_GoogleMapsTrack{constructor(t,e,a,i,n){this.setMap=t=>{this.marker.setMap(t),this.track.setMap(t),this.newestTrackSegment.setMap(t)},this._updateTrack=t=>{if(!t||t.length<1)return;const e=t.length,a=t[0].timestamp,i=t[e-1].timestamp;if(a!==this.currentTrackVersion.startTime||i!==this.currentTrackVersion.endTime||e!==this.currentTrackVersion.length){if(a===this.currentTrackVersion.startTime&&e>this.currentTrackVersion.length&&i>this.currentTrackVersion.endTime){let a=this.track.getPath(),n=a.getLength();for(;n<e;){const e=t[n];n=a.push(new this.google.maps.LatLng(e.lat,e.lng))}return this.currentTrackVersion.endTime=i,void(this.currentTrackVersion.length=e)}this.currentTrackVersion.startTime=a,this.currentTrackVersion.endTime=i,this.currentTrackVersion.length=e,this.track.setPath(t)}},this._updateNewestSegment=(t,e)=>{null===this.newestTrackSegmentData&&(this.newestTrackSegment.setPath([t,e]),this.newestTrackSegmentData=[t,e]);const a=Object(l.a)(this.newestTrackSegmentData,2),i=a[0],n=a[1];this.newestTrackSegmentData=[t,e];const s=this.newestTrackSegment.getPath();if(t.lat!==i.lat||t.lng!==i.lng){const e=new this.google.maps.LatLng(t.lat,t.lng);s.setAt(0,e)}if(n.lat!==e.lat||n.lng!==e.lng){const t=new this.google.maps.LatLng(e.lat,e.lng);s.setAt(1,t)}},this.updateData=t=>{this.marker.setPosition(t.pos);let e=this.marker.getIcon();const a=getPilotIcon(t.startOfTrack,t.endOfTrack,t.landed,t.pos,t.velocityVec,this.pilotColor);if(((t,e)=>{for(let a in t)if(!(a in e))return!0;for(let a in e){if(!(a in t))return!0;if("anchor"===a){if(t[a].x!==e[a].x||t[a].y!==e[a].y)return!0}else if(t[a]!==e[a])return!0}return!1})(e,a)&&this.marker.setIcon(a),t.track.length>0){const e=t.track[t.track.length-1],a=t.pos;this._updateNewestSegment(a,e)}this._updateTrack(t.track)},this.google=t,this.pilotInfoWindow=n,this.pilotColor=getPilotIconColor(a.info.user.username),this.trackColor=string2color(a.info.user.username,40),this.pilotIcon=getPilotIcon(i.startOfTrack,i.endOfTrack,i.landed,i.pos,i.velocityVec,this.pilotColor),this.marker=new this.google.maps.Marker({map:e,position:i.pos,title:a.info.user.fullname,icon:this.pilotIcon}),this.marker.addListener("click",()=>{this.pilotInfoWindow.open(this.map,this.marker,a.info.user.username)}),this.marker.addListener("dblclick",()=>{getMapViewportControllerService().setSinglePilotMode(a.info.user.username)}),this.track=new this.google.maps.Polyline({map:e,path:[],strokeColor:this.trackColor}),this.currentTrackVersion={startTime:null,endTime:null,length:null},this.newestTrackSegment=new this.google.maps.Polyline({map:e,path:[],strokeColor:this.trackColor}),this.newestTrackSegmentData=null}}class MapPilotInfoWindow{constructor(t){this.open=(t,e,a)=>{this.currentPilot=a,this.infoWindow.open(t,e),this.updateContent()},this.close=()=>{this.infoWindow.close(),this.currentPilot=null,this.updateContent()},this.update=t=>{this.data=t,this.updateContent()},this.updateContent=()=>{if(null==this.infoWindow.anchor)return void(this.currentPilot=null);if(null===this.currentPilot)return;if(!(this.currentPilot in this.data))return this.currentPilot=null,void this.infoWindow.close();const t=this.data[this.currentPilot],e=null===t.gpsAlt?t.baroAlt:t.gpsAlt,a=Math.max(e-t.elevation,0);let i="";if(i+="<b>"+t.name+"</b><br>",i+=Math.round(e)+"m (",i+=Math.round(a)+"m)<br>",null!==t.baroVario&&!t.landed){const e=Math.round(10*t.baroVario);let a=Math.abs(e);a>99&&(a=99),i+="<span>"+((e>=0?"&plus;":"&minus;")+Math.floor(a/10)+"."+a%10+"m/s")+"</span>&nbsp;&nbsp;"}null===t.velocity||t.landed||(i+=Math.round(3.6*t.velocity)+"km/h"),this.infoWindow.getContent()!==i&&this.infoWindow.setContent(i)},this.google=t,this.infoWindow=new t.maps.InfoWindow({content:"- ERROR -",pixelOffset:new t.maps.Size(0,-5),disableAutoPan:!0}),this.data={},this.currentPilot=null}}class MapAnimator_MapAnimator{constructor(t,e){this.cleanupOldTracks=t=>{const e=[];for(const n in this.tracks)n in t||e.push(n);for(var a=0,i=e;a<i.length;a++){const t=i[a];this.tracks[t].setMap(null),delete this.tracks[t]}},this.update=t=>{const e=getXContestInterface().getPilotInfos();this.cleanupOldTracks(t),Object.entries(t).forEach(([t,a])=>{if(!(t in e))return;const i=e[t];t in this.tracks||(this.tracks[t]=new GoogleMapsTrack_GoogleMapsTrack(this.google,this.map,i,a,this.infoWindow)),this.tracks[t].updateData(a)}),this.infoWindow.update(t)},this.map=t,this.google=e,this.tracks={},this.infoWindow=new MapPilotInfoWindow(e)}}var q=a(30);a(191);class GPSProvider_GPSProvider{constructor(){this._updateGPSState=()=>{let t=getSetting(F).getValue(),e=this._callbacks.length>0,a=t&&e;null===this._watchId&&a&&navigator.geolocation&&(this._watchId=navigator.geolocation.watchPosition(this._onNewGPSData,this._onGPSError,{enableHighAccuracy:!0}),console.log("GPS: On")),null===this._watchId||a||(navigator.geolocation.clearWatch(this._watchId),this._watchId=null,this._setGPSData(null),console.log("GPS: Off"))},this._setGPSData=t=>{console.log("GPS DATA:",t),this._gpsData=t;var e=!0,a=!1,i=void 0;try{for(var n,s=this._callbacks[Symbol.iterator]();!(e=(n=s.next()).done);e=!0){(0,n.value)(t)}}catch(o){a=!0,i=o}finally{try{e||null==s.return||s.return()}finally{if(a)throw i}}},this._onNewGPSData=t=>{this._setGPSData(t)},this._onGPSError=()=>{this._setGPSData(null)},this.registerCallback=t=>{this._callbacks.includes(t)||this._callbacks.push(t),this._updateGPSState(),t(this._gpsData)},this.unregisterCallback=t=>{const e=this._callbacks.indexOf(t);e>=0&&this._callbacks.splice(e,1),this._updateGPSState()},this.getData=()=>this._gpsData,this._callbacks=[],this._watchId=null,this._gpsData=null,getSetting(F).registerCallback(this._updateGPSState),this._updateGPSState()}}let Y=null;const getGPSProvider=()=>(Y||(Y=new GPSProvider_GPSProvider),Y);class GoogleMapsController_GoogleMapsController{constructor(t,e){this.zoomToSinglePilot=()=>{this.map.getZoom()<12&&this.map.setZoom(12)},this.shutdown=()=>{getGPSProvider().unregisterCallback(this.onGpsUpdate)},this.onGpsUpdate=t=>{this.gpsState=t},this.onUserInput=()=>{this.insideMapsApiFunction||getMapViewportControllerService().setFreeMode()},this.updateViewport=t=>{const e=this.singlePersonMode;if(this.singlePersonMode=!1,0===t.length)return;if(1===t.length)return this.insideMapsApiFunction=!0,this.map.panTo(t[0]),this.insideMapsApiFunction=!1,e||this.zoomToSinglePilot(),void(this.singlePersonMode=!0);let a=new this.google.maps.LatLngBounds(t[0],t[0]);t.forEach(t=>a.extend(t)),this.insideMapsApiFunction=!0,this.map.fitBounds(a),this.insideMapsApiFunction=!1},this.onAnimationFrame=(t,e)=>{if(!this.viewportInitialized){let e=[];for(var a=0,i=Object.entries(t);a<i.length;a++){const t=Object(l.a)(i[a],2)[1];e.push(t.pos)}this.gpsState&&e.push({lat:this.gpsState.coords.latitude,lng:this.gpsState.coords.longitude}),0!==e.length&&(this.updateViewport(e),this.viewportInitialized=!0)}if(!e.enabled)return void this.updateViewport([]);if(null!==e.followSinglePilot){const a=e.followSinglePilot;if(a in t)return void this.updateViewport([t[a].pos])}let n=[];e.includeSelf&&this.gpsState&&n.push({lat:this.gpsState.coords.latitude,lng:this.gpsState.coords.longitude});for(var s=0,o=Object.entries(e.pilots);s<o.length;s++){const e=Object(l.a)(o[s],2),a=e[0];e[1]&&a in t&&n.push(t[a].pos)}this.updateViewport(n)},this.google=t,this.map=e,this.lastUpdate=Date.now(),this.gpsState=getGPSProvider().getData(),getGPSProvider().registerCallback(this.onGpsUpdate),this.viewportInitialized=!1,this.singlePersonMode=!1,this.userInputListeners=[e.addListener("dragstart",this.onUserInput),e.addListener("center_changed",this.onUserInput)],this.insideMapsApiFunction=!1}}a(192);const createSatelliteIcon=()=>(t=>{const e="http://www.w3.org/2000/svg";let a=document.createElementNS(e,"svg");a.setAttribute("width","24"),a.setAttribute("height","24"),a.setAttribute("viewBox","0 0 24 24");let i=document.createElementNS(e,"path");return i.setAttribute("d",t),a.appendChild(i),a})("M8.57 6H6v2.58c1.42 0 2.57-1.16 2.57-2.58zM12 6h-1.71c0 2.36-1.92 4.29-4.29 4.29V12c3.32 0 6-2.69 6-6zm2.14 5.86l-3 3.87L9 13.15 6 17h12z");var Z=Object(q.a)(()=>{const t=C(),e=Object(l.a)(t,3),a=e[0],s=e[1],o=e[2],c=Object(i.useRef)(),h=Object(i.useState)(null),u=Object(l.a)(h,2),p=u[0],d=u[1];return Object(i.useLayoutEffect)(()=>{a&&!p&&d(new o.maps.Map(c.current,{center:{lat:46.509012,lng:11.827984},mapTypeId:"terrain",zoom:5,maxZoom:15,disableDefaultUI:!0,zoomControl:!0,scaleControl:!0,fullscreenControl:!0,styles:x}))},[a,p,o,c]),Object(i.useEffect)(()=>{p&&o&&(p.addListener("maptypeid_changed",()=>{p.getMapTypeId()===o.maps.MapTypeId.TERRAIN?p.setOptions({maxZoom:15}):p.setOptions({maxZoom:50})}),p.controls[o.maps.ControlPosition.TOP_LEFT].push(function createSatelliteMapButton(t,e){var a=document.createElement("div"),i=document.createElement("div");return i.classList.add("custom-google-maps-button"),i.title="Toggle satellite view",i.appendChild(createSatelliteIcon()),a.appendChild(i),a.onclick=()=>{e.getMapTypeId()===t.maps.MapTypeId.HYBRID?e.setMapTypeId(t.maps.MapTypeId.TERRAIN):e.setMapTypeId(t.maps.MapTypeId.HYBRID)},a}(o,p)))}),Object(i.useEffect)(()=>{if(p&&o){const t=new MapAnimator_MapAnimator(p,o).update;getXContestInterface().animation.registerCallback(t);const e=function createGeolocationMarker(t,e){class GeolocationMarker extends t.maps.MVCObject{constructor(e,a,i,n){super(),this.outerMarker_=null,this.marker_=null,this.circle_=null,this.watchId_=-1;var s={clickable:!1,cursor:"pointer",draggable:!1,flat:!0,icon:{path:t.maps.SymbolPath.CIRCLE,fillColor:"#C8D6EC",fillOpacity:.7,scale:12,strokeWeight:0},position:new t.maps.LatLng(0,0),title:"Current location",zIndex:2},o={clickable:!1,cursor:"pointer",draggable:!1,flat:!0,icon:{path:t.maps.SymbolPath.CIRCLE,fillColor:"#4285F4",fillOpacity:1,scale:6,strokeColor:"white",strokeWeight:2},optimized:!1,position:new t.maps.LatLng(0,0),title:"Current location",zIndex:3};a&&(s=this.copyOptions_(s,a)),i&&(o=this.copyOptions_(o,i));var l={clickable:!1,radius:0,strokeColor:"1bb6ff",strokeOpacity:.4,fillColor:"61a0bf",fillOpacity:.4,strokeWeight:1,zIndex:1};n&&(l=this.copyOptions_(l,n)),this.outerMarker_=new t.maps.Marker(s),this.marker_=new t.maps.Marker(o),this.circle_=new t.maps.Circle(l),t.maps.MVCObject.prototype.set.call(this,"accuracy",null),t.maps.MVCObject.prototype.set.call(this,"position",null),t.maps.MVCObject.prototype.set.call(this,"map",null),this.set("minimum_accuracy",null),this.set("position_options",{enableHighAccuracy:!0,maximumAge:1e3}),this.circle_.bindTo("map",this.outerMarker_),this.circle_.bindTo("map",this.marker_),e&&this.setMap(e)}set(e,a){if(GeolocationMarker.invalidPropertiesExpr_.test(e))throw new Error("'"+e+"' is a read-only property.");"map"===e?this.setMap(a):t.maps.MVCObject.prototype.set.call(this,e,a)}getMap(){return this.get("map")}getPositionOptions(){return this.get("position_options")}setPositionOptions(t){this.set("position_options",t)}getPosition(){return this.get("position")}getBounds(){return this.get("position")?this.circle_.getBounds():null}getAccuracy(){return this.get("accuracy")}getMinimumAccuracy(){return this.get("minimum_accuracy")}setMinimumAccuracy(t){this.set("minimum_accuracy",t)}setMap(e){t.maps.MVCObject.prototype.set.call(this,"map",e),e?this.watchPosition_():(this.outerMarker_.unbind("position"),this.marker_.unbind("position"),this.circle_.unbind("center"),this.circle_.unbind("radius"),t.maps.MVCObject.prototype.set.call(this,"accuracy",null),t.maps.MVCObject.prototype.set.call(this,"position",null),navigator.geolocation.clearWatch(this.watchId_),this.watchId_=-1,this.outerMarker_.setMap(e),this.marker_.setMap(e))}setOuterMarkerOptions(t){this.outerMarker_.setOptions(this.copyOptions_({},t))}setMarkerOptions(t){this.marker_.setOptions(this.copyOptions_({},t))}setCircleOptions(t){this.circle_.setOptions(this.copyOptions_({},t))}updatePosition_(e){var a=new t.maps.LatLng(e.coords.latitude,e.coords.longitude),i=null==this.marker_.getMap();if(i){if(null!=this.getMinimumAccuracy()&&e.coords.accuracy>this.getMinimumAccuracy())return;this.outerMarker_.setMap(this.getMap()),this.marker_.setMap(this.getMap()),this.outerMarker_.bindTo("position",this),this.marker_.bindTo("position",this),this.circle_.bindTo("center",this,"position"),this.circle_.bindTo("radius",this,"accuracy")}this.getAccuracy()!==e.coords.accuracy&&t.maps.MVCObject.prototype.set.call(this,"accuracy",e.coords.accuracy),!i&&null!=this.getPosition()&&this.getPosition().equals(a)||t.maps.MVCObject.prototype.set.call(this,"position",a)}watchPosition_(){navigator.geolocation&&(this.watchId_=navigator.geolocation.watchPosition(this.updatePosition_.bind(this),this.geolocationError_.bind(this),this.getPositionOptions()))}geolocationError_(e){t.maps.event.trigger(this,"geolocation_error",e)}copyOptions_(t,e){for(var a in e)!0!==GeolocationMarker.DISALLOWED_OPTIONS[a]&&(t[a]=e[a]);return t}}return GeolocationMarker.DISALLOWED_OPTIONS={map:!0,position:!0,radius:!0},GeolocationMarker.invalidPropertiesExpr_=/^(?:position|accuracy)$/i,new GeolocationMarker(e)}(o,null);e.setPositionOptions({enableHighAccuracy:!0}),getSetting(F).getValue()&&e.setMap(p);const geolocationMarkerStateUpdater=t=>{t?e.setMap(p):e.setMap(null)};getSetting(F).registerCallback(geolocationMarkerStateUpdater);let a=new GoogleMapsController_GoogleMapsController(o,p);return getMapViewportControllerService().registerMapController(a),()=>{getMapViewportControllerService().unregisterMapController(a),a.shutdown(),getXContestInterface().animation.unregisterCallback(t),getSetting(F).unregisterCallback(geolocationMarkerStateUpdater),e.setMap(null)}}},[p,o]),n.a.createElement(n.a.Fragment,null,n.a.createElement(r.a,{width:"100%",height:"100%",display:a?"block":"none",ref:c}),n.a.createElement(LoadingPage,{message:"Loading Maps ...",hideIf:a||s}),n.a.createElement(ErrorPage,{message:"Unable to load map!",hideIf:!s}))}),K=a(247),$=a(111),Q=a.n($),tt=a(237),et=a(12),at=a(258),it=a(239),nt=a(240),st=a(235);const ot=[];window.addEventListener("popstate",()=>{0===ot.length&&console.warn("History was already 0!");const t=ot.pop();console.debug("- History size:",ot.length),ot.length>0&&window.history.pushState({},""),t&&t()},{passive:!0});var util_SubWindow=t=>{const e=Object(i.useState)(!1),a=Object(l.a)(e,2),s=a[0],o=a[1],r=Object(i.useState)(!1),c=Object(l.a)(r,2),h=c[0],u=c[1],p={push:t=>{const e=ot.length;ot.push(t),console.debug("+ History size:",ot.length),0===e&&window.history.pushState({},"")},pop:()=>{window.history.back()}};return t.open&&!s&&(h?t.onClose():(p.push(()=>{o(!1),t.onClose()}),o(!0),u(!0))),!h||s||t.open||u(!1),s&&!t.open&&p.pop(),n.a.createElement(st.a,{open:s,onClose:()=>{t.onClose()},fullScreen:t.fullScreen,maxWidth:t.maxWidth,fullWidth:t.fullWidth,classes:t.classes},t.children)};var lt=a(261);const getRotationStyle=t=>{const e="rotate("+t.toString()+"deg)";return{transform:e,WebkitTransform:e,MozTransform:e,msTransform:e,OTransform:e}};class LastFixState_LastFixState extends n.a.PureComponent{constructor(t){super(t),this.getMessage=({timestamp:t,endOfTrack:e,landed:a,relative:i,showLastFix:n})=>{if(null==t)return["","never"];let s=new Date(t).getTime()-Date.now(),o="";return o=i?function formatTimeDiff(t){let e="";t<0&&(t=-t,e="-");let a=Math.floor(t/1e3);if(a<90)return e+a+" sec";let i=Math.floor(a/60);if(i<60)return e+i+" min";let n=Math.floor(i/60);if(i-=60*n,n<24)return e+n+":"+i.toString().padStart(2,"0")+" h";let s=Math.floor(n/24);return n-=24*s,e+s+"d "+n+":"+i.toString().padStart(2,"0")+" h"}(s):function timestampToTimeString(t){return new Date(t).toLocaleTimeString()}(t),e&&a?["#346B8F","\u2714 "+o]:-s<12e4&&!e?i?n?["green","\u26ab LIVE ("+o+")"]:["green","\u26ab LIVE"]:["green","\u26ab "+o]:i?["red","! LIVE ("+o+")"]:["red","! "+o]},this.shallowRerender=t=>{if(null!==this.msgRef.current){const e=this.msgRef.current,a=this.getMessage(t),i=Object(l.a)(a,2),n=i[0],s=i[1];Object.assign(e.style,{color:n}),e.innerHTML!==s&&(e.innerHTML=s)}},this.msgRef=n.a.createRef()}render(){const t=this.getMessage(this.props),e=Object(l.a)(t,2),a=e[0],i=e[1];return n.a.createElement("span",{style:{color:a},ref:this.msgRef},i)}}class LastFixState_LastFixArrow extends n.a.PureComponent{constructor(t){super(t),this.onNewGPSDataReceived=t=>{this.gpsData=t,this.updateThroughRef()},this.setFix=t=>{this.lastFix=t,this.updateThroughRef()},this.updateThroughRef=()=>{if(this.arrowRef.current){const t=LastFixState_LastFixArrow.getArrowRotationStyle(this.gpsData,this.lastFix);Object.assign(this.arrowRef.current.style,t)}if(this.distanceRef.current){const t=LastFixState_LastFixArrow.getDistance(this.gpsData,this.lastFix);t!==this.distanceRef.current.innerHTML&&(this.distanceRef.current.innerHTML=t)}},this.gpsData=getGPSProvider().getData(),this.distanceRef=n.a.createRef(),this.arrowRef=n.a.createRef(),this.lastFix=this.props.lastFix}componentDidMount(){getGPSProvider().registerCallback(this.onNewGPSDataReceived)}componentWillUnmount(){getGPSProvider().unregisterCallback(this.onNewGPSDataReceived)}static getDistance(t,e){if(null===t||null===e)return"--km";const a=Object(N.getDistance)({lat:t.coords.latitude,lng:t.coords.longitude},e);return(Math.round(a/100)/10).toString()+"km"}static getArrowRotationStyle(t,e){if(null===t||null===e)return getRotationStyle(0);const a=Object(N.getRhumbLineBearing)({lat:t.coords.latitude,lng:t.coords.longitude},e);return getRotationStyle(a)}render(){return this.lastFix=this.props.lastFix,n.a.createElement(n.a.Fragment,null,n.a.createElement("span",{ref:this.distanceRef},LastFixState_LastFixArrow.getDistance(this.gpsData,this.lastFix))," ",n.a.createElement("div",{ref:this.arrowRef,style:Object(V.a)({display:"inline-block"},LastFixState_LastFixArrow.getArrowRotationStyle(this.gpsData,this.lastFix))},"\u2191"))}}const TableHeader=()=>n.a.createElement(lt.a,{component:"div",variant:"head",className:"MuiTableCell-stickyHeader",style:{height:37,display:"flex",alignItems:"center",boxSizing:"border-box"}},n.a.createElement("div",{style:{flex:"1"}},"Name"),n.a.createElement("div",{style:{width:"25%",textAlign:"right"}},"State"),n.a.createElement("div",{style:{width:"27%",textAlign:"right"}},"Country"));class PilotSelectorListRenderer_PilotSelectorListRow extends n.a.PureComponent{render(){const t=this.props,e=t.fullname,a=t.username,i=t.lastFix,s=t.timestamp,o=t.landed,l=t.iso,c=t.disabled;return n.a.createElement("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",boxSizing:"border-box",filter:c?"grayscale(100%) opacity(30%)":void 0}},n.a.createElement(r.a,{flex:"1",paddingLeft:1,paddingTop:1,paddingBottom:1},n.a.createElement(S.a,{variant:"body2"},e),n.a.createElement(S.a,{variant:"caption",color:"textSecondary",style:{paddingLeft:".5em"}},"[",a,"]")),n.a.createElement("div",{style:{width:"25%",textAlign:"right"}},n.a.createElement("div",null,n.a.createElement(S.a,{variant:"caption"},n.a.createElement(LastFixState_LastFixState,{timestamp:s,landed:o,endOfTrack:o,relative:!0}))),n.a.createElement("div",null,n.a.createElement(S.a,{variant:"caption"},n.a.createElement(LastFixState_LastFixArrow,{lastFix:i})))),n.a.createElement("div",{style:{width:"27%",textAlign:"right"}},n.a.createElement(r.a,{paddingRight:1,paddingLeft:1},l,n.a.createElement(r.a,{fontSize:"large",marginLeft:"4px",boxShadow:1,style:{verticalAlign:"middle"},className:"flag-icon flag-icon-"+l.toLowerCase()}))))}}const renderRow=({data:t,index:e,style:a})=>{const i=t.keys[e],s=t.data[i],o=s?s.info.user.fullname:"Offline User",l=s?s.info.user.username:i,r=s?s.lastFix:null,c=s?s.lastFix.timestamp:null,h=s?s.landed:null,u=s?s.info.user.nationality.iso:"--",p=-1!==t.selected.indexOf(i),d=-1!==t.alreadyAdded.indexOf(i);return n.a.createElement(lt.a,{component:"div",variant:"body",padding:"none",style:Object(V.a)({},a,{backgroundColor:p&&!d?"rgba(0, 0, 0, 0.04)":void 0}),onClick:()=>{d||t.onPilotClicked(i)}},n.a.createElement(PilotSelectorListRenderer_PilotSelectorListRow,{fullname:o,username:l,lastFix:r,timestamp:c,landed:h,iso:u,disabled:d}))};var rt=a(122),ct=a(105);const sortPilotList=(t,e)=>{if(e){const a={lat:e.coords.latitude,lng:e.coords.longitude};let i=Object.entries(t).map(([t,e])=>[t,Object(N.getDistance)(a,e.lastFix)]);return i.sort((t,e)=>t[1]-e[1]),i.map(t=>t[0])}{let e=Object.keys(t);return e.sort(),e}};class PilotSelectorList_PilotSelectorList extends n.a.PureComponent{constructor(t){super(t),this.startRendering=()=>{this.setState(t=>Object(V.a)({},t,{didMount:!0}))},this.updatePilotListIfNecessary=()=>{const t=sortPilotList(this.state.pilotInfos,this.gpsData);(function arraysEqual(t,e){if(!t||!e)return!1;if(t.length!==e.length)return!1;for(var a=0,i=t.length;a<i;a++)if(t[a]!==e[a])return!1;return!0})(this.state.sortedPilotList,t)||this.setState(e=>Object(V.a)({},e,{sortedPilotList:t}))},this.onNewGpsData=t=>{this.gpsData=t,this.updatePilotListIfNecessary()},this.onNewPilotInfos=t=>{this.setState(e=>Object(V.a)({},e,{pilotInfos:t,sortedPilotList:sortPilotList(t,this.gpsData)}))},this.onPilotClicked=t=>{this.props.onPilotClicked&&this.props.onPilotClicked(t)},this.state={didMount:!1},this.gpsData=getGPSProvider().getData();const e=getXContestInterface().pilotInfos.getValue();this.state={pilotInfos:e,sortedPilotList:sortPilotList(e,this.gpsData)}}componentDidMount(){getXContestInterface().pilotInfos.registerCallback(this.onNewPilotInfos),getGPSProvider().registerCallback(this.onNewGpsData),setTimeout(this.startRendering)}componentWillUnmount(){getXContestInterface().pilotInfos.unregisterCallback(this.onNewPilotInfos),getGPSProvider().unregisterCallback(this.onNewGpsData)}render(){if(!this.state.didMount)return n.a.createElement("div",{style:{width:"100%",display:"flex",justifyContent:"center",overflow:"hidden"}},n.a.createElement(E.a,{disableShrink:!0,style:{margin:"2em"}}));const t=((t,e,a)=>{const matchesSearch=t=>""===a||t.toLowerCase().includes(a.toLowerCase());let i=t.filter(t=>matchesSearch(e[t].info.user.username)||matchesSearch(e[t].info.user.fullname));return 0===i.length&&!/\s/.test(a)&&a.length>0&&i.push(a),i})(this.state.sortedPilotList,this.state.pilotInfos,this.props.search);return n.a.createElement(n.a.Fragment,null,n.a.createElement(TableHeader,null),n.a.createElement("div",{style:{flex:"1"}},n.a.createElement(ct.a,null,({height:e,width:a})=>n.a.createElement(rt.a,{width:a,height:e,itemCount:t.length,itemSize:57,itemData:{keys:t,data:this.state.pilotInfos,selected:this.props.selected,alreadyAdded:this.props.alreadyAdded,onPilotClicked:this.onPilotClicked},itemKey:(t,{keys:e})=>e[t]},renderRow))))}}const ht=Object(w.a)({fullHeightWindow:{height:"100%"}});var ut=Object(q.a)(t=>{const e=ht(),a=Object(u.a)(),s=Object(p.a)(a.breakpoints.down("xs")),o=Object(i.useState)([]),c=Object(l.a)(o,2),h=c[0],d=c[1],g=Object(i.useState)(""),m=Object(l.a)(g,2),f=m[0],b=m[1],v=h.length,closeWindow=()=>{b(""),d([]),t.onClose()};return n.a.createElement(util_SubWindow,{open:t.open,onClose:closeWindow,fullScreen:s,maxWidth:"xs",fullWidth:!0,classes:{paper:e.fullHeightWindow}},n.a.createElement(tt.a,{style:0===v?{}:"light"===a.palette.type?{color:a.palette.secondary.main,backgroundColor:Object(et.d)(a.palette.secondary.light,.85)}:{color:a.palette.text.primary,backgroundColor:a.palette.secondary.dark}},v>0?n.a.createElement(S.a,{component:"div",color:"inherit",variant:"subtitle1"},v," selected"):n.a.createElement(S.a,{component:"div",variant:"h6",id:"tableTitle"},"Add new pilots:")),n.a.createElement(r.a,{paddingLeft:"1em",paddingRight:"1em",paddingTop:"4px"},n.a.createElement(at.a,{margin:"dense",autoComplete:"off",variant:"outlined",id:"search_field",label:"Search",type:"search",fullWidth:!0,onChange:t=>b(t.target.value)})),n.a.createElement(r.a,{flex:"1 1 auto",marginY:"8px",display:"flex",flexDirection:"column",alignItems:"stretch"},n.a.createElement(PilotSelectorList_PilotSelectorList,{alreadyAdded:t.alreadyAdded,selected:h,onPilotClicked:t=>{const e=h.indexOf(t);let a=[];-1===e?a=a.concat(h,t):0===e?a=a.concat(h.slice(1)):e===h.length-1?a=a.concat(h.slice(0,-1)):e>0&&(a=a.concat(h.slice(0,e),h.slice(e+1))),d(a)},search:f})),n.a.createElement(it.a,null,n.a.createElement(nt.a,{onClick:closeWindow,color:"primary"},"Cancel"),n.a.createElement(nt.a,{disabled:0===v,onClick:()=>{t.onAddPilots(h),closeWindow()},color:"primary"},"Add")))}),pt=a(263),dt=a(238),gt=a(244),mt=a(245),ft=a(246),bt=a(242),vt=a(262),yt=a(243),kt=a(106),Ct=a.n(kt),wt=a(233),St=a(199);const Et=-1!==navigator.platform.indexOf("iPhone")||-1!==navigator.platform.indexOf("iPad")||-1!==navigator.platform.indexOf("iPod")?400:1e3;class ContextMenuHandler{constructor(t){this.onTouchStart=t=>{console.log(this.toString(),"onTouchStart"),this.contextMenuPossible=!0;const e=t.touches[0];this.longPressCountdown=setTimeout(()=>{this.contextMenuPossible=!1,this.callback(e),console.log(this.toString(),"CONTEXT_MENU")},Et)},this.onTouchMove=t=>{console.log(this.toString(),"onTouchMove"),clearTimeout(this.longPressCountdown)},this.onTouchCancel=t=>{console.log(this.toString(),"onTouchCancel"),this.contextMenuPossible=!1,clearTimeout(this.longPressCountdown)},this.onTouchEnd=t=>{console.log(this.toString(),"onTouchEnd"),this.contextMenuPossible=!1,clearTimeout(this.longPressCountdown)},this.onContextMenu=t=>{console.log(this.toString(),"onContextMenu"),this.contextMenuPossible=!1,clearTimeout(this.longPressCountdown),this.callback(t),t.preventDefault()},this.callback=t,this.longPressCountdown=null,this.contextMenuPossible=!1}}const Pt=Object(wt.a)(S.a)({overflow:"hidden",flex:"1"}),_t=Object(wt.a)(S.a)({marginRight:".2em",marginLeft:".5em"}),Ot=Object(wt.a)(S.a)({display:"flex",justifyContent:"space-between",paddingLeft:".5em"}),xt=Object(St.a)({root:{paddingLeft:"12px"},content:{overflow:"hidden",alignItems:"center",whiteSpace:"nowrap"}})(bt.a);class AnimatedPilotListEntry_AnimatedPilotListEntry extends n.a.PureComponent{constructor(t){super(t),this.extractImportantProps=t=>({height:null!==t.gpsAlt?t.gpsAlt:t.baroAlt,elevation:t.elevation,vario:t.baroVario,startOfTrack:t.startOfTrack,endOfTrack:t.endOfTrack,landed:t.landed,newestDataTimestamp:t.newestDataTimestamp,lat:t.pos.lat,lng:t.pos.lng,velocityLat:null===t.velocityVec?null:t.velocityVec.lat,velocityLng:null===t.velocityVec?null:t.velocityVec.lng,velocity:t.velocity}),this.propsChanged=t=>{const e=this.pilotProps;for(let a in e)if(!(a in t))return!0;for(let a in t){if(!(a in e))return!0;if(e[a]!==t[a])return!0}return!1},this.onNewGPSDataReceived=t=>{this.gpsData=t},this.onNewDataReceived=t=>{if(!(this.props.pilotId in t))return;const e=t[this.props.pilotId],a=this.extractImportantProps(e);this.propsChanged(a)?(this.pilotProps=a,this.shallowRerender(!0)):this.shallowRerender(!1)},this.shallowRerender=t=>{if(null!==this.heightRef.current&&t){const t=AnimatedPilotListEntry_AnimatedPilotListEntry.renderHeight(this.pilotProps);t!==this.heightRef.current.innerHTML&&(this.heightRef.current.innerHTML=t)}if(null!==this.lastFixRef.current&&t&&this.lastFixRef.current.setFix({lat:this.pilotProps.lat,lng:this.pilotProps.lng}),null!==this.iconRef.current&&t){let t=this.iconRef.current;const e=getPilotIcon(this.pilotProps.startOfTrack,this.pilotProps.endOfTrack,this.pilotProps.landed,{lat:this.pilotProps.lat,lng:this.pilotProps.lng},{lat:this.pilotProps.velocityLat,lng:this.pilotProps.velocityLng});if(t.childNodes.length>0){const a=t.childNodes[0];a.getAttribute("d")!==e.path&&a.setAttribute("d",e.path)}const a=void 0===e.rotation?0:e.rotation;Object.assign(t.style,getRotationStyle(a))}null!==this.liveStateRef.current&&this.liveStateRef.current.shallowRerender({timestamp:1e3*this.pilotProps.newestDataTimestamp,landed:this.pilotProps.landed,endOfTrack:this.pilotProps.endOfTrack,relative:!0,showLastFix:getSetting(A).getValue()})},this.gpsData=getGPSProvider().getData(),this.pilotColor=getPilotIconColor(this.props.pilotId),this.lastFixRef=n.a.createRef(),this.heightRef=n.a.createRef(),this.liveStateRef=n.a.createRef(),this.iconRef=n.a.createRef(),this.contextMenuHandler=new ContextMenuHandler(t=>{this.props.onContextMenuHandler(this.props.pilotId,{left:t.pageX,top:t.pageY},this.pilotProps)})}componentDidMount(){getXContestInterface().animation.registerCallback(this.onNewDataReceived),getGPSProvider().registerCallback(this.onNewGPSDataReceived)}componentWillUnmount(){getXContestInterface().animation.unregisterCallback(this.onNewDataReceived),getGPSProvider().unregisterCallback(this.onNewGPSDataReceived)}static renderHeight(t){const e=t.height;return Math.round(e)+"m ("+Math.round(Math.max(0,e-t.elevation))+"m)"}render(){{const t=getXContestInterface().animation.getData(),e=this.props.pilotId in t?t[this.props.pilotId]:null;this.pilotProps=this.extractImportantProps(e)}console.log("RENDER ",this.props.pilotId,this.state,this.props,this.pilotProps);const t=getPilotIcon(this.pilotProps.startOfTrack,this.pilotProps.endOfTrack,this.pilotProps.landed,{lat:this.pilotProps.lat,lng:this.pilotProps.lng},{lat:this.pilotProps.velocityLat,lng:this.pilotProps.velocityLng}),e=void 0===t.rotation?0:t.rotation;return n.a.createElement(vt.a,{TransitionProps:{unmountOnExit:!0},onContextMenu:this.contextMenuHandler.onContextMenu,onTouchStart:this.contextMenuHandler.onTouchStart,onTouchCancel:this.contextMenuHandler.onTouchCancel,onTouchEnd:this.contextMenuHandler.onTouchEnd,onTouchMove:this.contextMenuHandler.onTouchMove},n.a.createElement(xt,{expandIcon:n.a.createElement(Ct.a,null)},n.a.createElement("svg",{width:"30px",height:"30px",viewBox:"0 0 24 24",display:"block",style:Object(V.a)({flex:"0 0 auto"},getRotationStyle(e)),ref:this.iconRef},n.a.createElement("path",{d:t.path,fill:this.pilotColor,stroke:"black"})),n.a.createElement("div",{style:{flex:"1 1 auto",overflow:"hidden",marginLeft:"10px"}},n.a.createElement("div",{style:{width:"100%",display:"flex",overflow:"hidden"}},n.a.createElement(Pt,{variant:"body2"},this.props.pilotName),n.a.createElement(_t,{variant:"caption"},n.a.createElement(LastFixState_LastFixArrow,{ref:this.lastFixRef,lastFix:{lat:this.pilotProps.lat,lng:this.pilotProps.lng}}))),n.a.createElement(Ot,{variant:"caption"},n.a.createElement(LastFixState_LastFixState,{timestamp:1e3*this.pilotProps.newestDataTimestamp,landed:this.pilotProps.landed,endOfTrack:this.pilotProps.endOfTrack,relative:!0,ref:this.liveStateRef,showLastFix:getSetting(A).getValue()}),n.a.createElement("span",{ref:this.heightRef},AnimatedPilotListEntry_AnimatedPilotListEntry.renderHeight(this.pilotProps))))),n.a.createElement(yt.a,null,n.a.createElement(S.a,{style:{MozUserSelect:"none",WebkitUserSelect:"none",msUserSelect:"none"}},"TODO: Details")))}}var Mt=AnimatedPilotListEntry_AnimatedPilotListEntry,Tt=a(107),At=a.n(Tt),It=a(110),Dt=a.n(It),Lt=a(108),Ft=a.n(Lt),jt=a(109),Vt=a.n(jt);const Rt=registerPersistentState("global.tab_id",1);var Nt={TabID:Rt,switchToMap:()=>{Rt.setValue(0)}};class AnimatedPilotList_AnimatedPilotList extends n.a.PureComponent{constructor(t){super(t),this.getSortedPilotList=t=>{if(null===this.gpsData)return Object.keys(t);const e={lat:this.gpsData.coords.latitude,lng:this.gpsData.coords.longitude};let a=Object.entries(t).map(([t,a])=>[t,Object(N.getDistance)(e,a.pos)]);return a.sort((t,e)=>t[1]-e[1]),a.map(t=>t[0])},this.onAnimationFrame=t=>{const e=this.getSortedPilotList(t),a=e.filter(e=>t[e].endOfTrack&&t[e].landed),i=e.filter(e=>!(t[e].endOfTrack&&t[e].landed)).concat(a);let n=!1;if(i.length===this.state.onlinePilots.length){for(let s=0;s<i.length;s++)if(i[s]!==this.state.onlinePilots[s]){n=!0;break}}else n=!0;n&&this.setState(t=>Object(V.a)({},t,{onlinePilots:i}))},this.onNewGPSDataReceived=t=>{this.gpsData=t},this.removePilot=t=>{this.props.removePilots([t])},this.showContextMenu=(t,e,a)=>{this.setState(i=>Object(V.a)({},i,{contextMenu:{pilotId:t,pos:e,props:a}}))},this.hideContextMenu=()=>{this.setState(t=>Object(V.a)({},t,{contextMenu:null}))},this.contextMenu_delete=()=>{null!==this.state.contextMenu&&this.removePilot(this.state.contextMenu.pilotId),this.hideContextMenu()},this.contextMenu_navigateTo=()=>{if(null!==this.state.contextMenu){const t=this.state.contextMenu.props;!function navigateTo(t){-1!==navigator.platform.indexOf("iPhone")||-1!==navigator.platform.indexOf("iPad")||-1!==navigator.platform.indexOf("iPod")?window.open("https://maps.apple.com/maps?q="+t.lat.toString()+","+t.lng.toString()):window.open("https://maps.google.com/maps?q="+t.lat.toString()+","+t.lng.toString())}({lat:t.lat,lng:t.lng})}this.hideContextMenu()},this.contextMenu_showOnMap=()=>{if(null!==this.state.contextMenu){const t=this.state.contextMenu.pilotId;Nt.switchToMap(),getMapViewportControllerService().setSinglePilotMode(t)}this.hideContextMenu()},this.state={onlinePilots:[],contextMenu:null},this.gpsData=getGPSProvider().getData()}componentDidMount(){getXContestInterface().animation.registerCallback(this.onAnimationFrame),getGPSProvider().registerCallback(this.onNewGPSDataReceived)}componentWillUnmount(){getXContestInterface().animation.unregisterCallback(this.onAnimationFrame),getGPSProvider().unregisterCallback(this.onNewGPSDataReceived)}render(){let t=new Set(this.state.onlinePilots);const e=this.state.onlinePilots.filter(t=>t in this.props.pilots),a=Object.keys(this.props.pilots).filter(e=>!t.has(e)),getPilotName=t=>{const e=this.props.pilots[t];return void 0===e||null===e?t:e};return n.a.createElement(r.a,{height:"100%",bgcolor:"#eeeef5",overflow:"auto"},n.a.createElement(r.a,{margin:1},e.map(t=>n.a.createElement(Mt,{key:t,pilotId:t,pilotName:getPilotName(t),removePilot:this.removePilot,onContextMenuHandler:this.showContextMenu}))),n.a.createElement(r.a,{margin:1},a.map(t=>n.a.createElement(r.a,{key:t,onClick:()=>{this.removePilot(t)},display:"flex"},n.a.createElement(S.a,{variant:"body2"},getPilotName(t)),n.a.createElement(S.a,{variant:"caption",color:"textSecondary",style:{paddingLeft:".5em"}},"[",t,"]")))),n.a.createElement(pt.a,{open:null!==this.state.contextMenu,anchorReference:"anchorPosition",anchorPosition:null===this.state.contextMenu?null:this.state.contextMenu.pos,transformOrigin:{vertical:"top",horizontal:"right"},onClose:this.hideContextMenu},n.a.createElement(dt.a,{component:"nav",dense:!0},n.a.createElement(gt.a,{button:!0,onClick:this.contextMenu_showOnMap},n.a.createElement(mt.a,null,n.a.createElement(At.a,null)),n.a.createElement(ft.a,null,"Show Pilot on Map")),n.a.createElement(gt.a,{button:!0,disabled:!0},n.a.createElement(mt.a,null,n.a.createElement(Ft.a,null)),n.a.createElement(ft.a,null,"Live Navigation")),n.a.createElement(gt.a,{button:!0,onClick:this.contextMenu_navigateTo},n.a.createElement(mt.a,null,n.a.createElement(Vt.a,null)),n.a.createElement(ft.a,null,"Open in Maps")),n.a.createElement(gt.a,{button:!0,onClick:this.contextMenu_delete},n.a.createElement(mt.a,null,n.a.createElement(Dt.a,null)),n.a.createElement(ft.a,null,"Remove Pilot")))))}}var Gt=AnimatedPilotList_AnimatedPilotList;class Pilots_Pilots extends n.a.Component{constructor(t){super(t),this.openPilotSelector=()=>{!1===this.state.pilotSelectorOpen&&this.setState(t=>Object(V.a)({},t,{pilotSelectorOpen:!0}))},this.closePilotSelector=()=>{!0===this.state.pilotSelectorOpen&&this.setState(t=>Object(V.a)({},t,{pilotSelectorOpen:!1}))},this.chosenPilotsChanged=t=>{this.setState(e=>Object(V.a)({},e,{chosenPilots:t}))},this.state={pilotSelectorOpen:!1,chosenPilots:getChosenPilots()}}componentDidMount(){getChosenPilotsObject().registerCallback(this.chosenPilotsChanged)}componentWillUnmount(){getChosenPilotsObject().unregisterCallback(this.chosenPilotsChanged)}render(){return n.a.createElement(n.a.Fragment,null,n.a.createElement(Gt,{pilots:this.state.chosenPilots,removePilots:removePilots}),n.a.createElement(r.a,{position:"absolute",bottom:"16px",right:"16px"},n.a.createElement(K.a,{size:"small",color:"primary",onClick:this.openPilotSelector},n.a.createElement(Q.a,null))),n.a.createElement(ut,{open:this.state.pilotSelectorOpen,onClose:this.closePilotSelector,onAddPilots:addPilots,alreadyAdded:Object.keys(this.state.chosenPilots)}))}}var Wt=Pilots_Pilots,zt=a(250),Ht=a(201),Ut=a(255),Bt=a(119),Xt=a.n(Bt),Jt=a(117),qt=a.n(Jt),Yt=a(116),Zt=a.n(Yt),Kt=a(118),$t=a.n(Kt),Qt=a(54),te=a.n(Qt),ee=a(260),ae=a(114),ie=a.n(ae),ne=a(115),se=a.n(ne),oe=a(254),le=a(249),re=a(264),ce=a(248);class NumberInput_NumberInput extends n.a.PureComponent{constructor(...t){super(...t),this.state={internalUpdate:!1,value:null}}static getDerivedStateFromProps(t,e){const a=Object(V.a)({},e,{internalUpdate:!1});return e.internalUpdate||(a.value=t.value),a}render(){return n.a.createElement(at.a,{onChange:t=>{const e=t.target.value;e<this.props.min?(this.props.onChange(this.props.min),this.setState(t=>Object(V.a)({},t,{internalUpdate:!0,value:e}))):e>this.props.max?this.props.onChange(this.props.max):this.props.onChange(e)},variant:"outlined",disabled:this.props.disabled,margin:"dense",hiddenLabel:!0,type:"number",value:this.state.value,InputProps:{endAdornment:n.a.createElement(ce.a,{position:"end"},this.props.unit)},inputProps:{min:this.props.min,max:this.props.max}})}}const he=Object(q.a)(t=>{const e=getSetting(t.setting).use(),a=Object(l.a)(e,2),i=a[0],s=a[1],flipSetting=()=>s(!i);return n.a.createElement(gt.a,{button:!0,onClick:flipSetting},n.a.createElement(ft.a,{primary:t.primaryText,secondary:t.secondaryText}),n.a.createElement(le.a,null,n.a.createElement(re.a,{edge:"end",onChange:flipSetting,checked:i})))}),ue=Object(q.a)(t=>{const e=getSetting(t.setting).use(),a=Object(l.a)(e,2),i=a[0],s=a[1];return n.a.createElement(gt.a,{disabled:t.disabled},n.a.createElement(ft.a,{primary:t.primaryText,secondary:t.secondaryText}),n.a.createElement(le.a,null,n.a.createElement(NumberInput_NumberInput,{value:i,onChange:s,disabled:t.disabled,unit:t.unit,min:t.min,max:t.max})))});var pe=a(251),de=a(252),ge=a(253),me=a(112),fe=a.n(me),be=a(113),ve=a.n(be);var ye=Object(q.a)(t=>{const e=Object(i.useState)(!1),a=Object(l.a)(e,2),s=a[0],o=a[1];return n.a.createElement(n.a.Fragment,null,n.a.createElement(zt.a,{style:{position:"static"}},n.a.createElement(tt.a,null,n.a.createElement(Ht.a,{edge:"start",color:"inherit",onClick:t.onClose},n.a.createElement(fe.a,null)),n.a.createElement(r.a,{marginLeft:2,flexGrow:1},n.a.createElement(S.a,{variant:"h6"},"Settings")),n.a.createElement(Ht.a,{edge:"end",color:"inherit",onClick:()=>o(!0)},n.a.createElement(ve.a,null)))),n.a.createElement(util_SubWindow,{open:s,onClose:()=>o(!1)},n.a.createElement(pe.a,null,"Reset all settings?"),n.a.createElement(de.a,null,n.a.createElement(ge.a,null,"This sets all settings to their default values.")),n.a.createElement(it.a,null,n.a.createElement(nt.a,{onClick:()=>{Object.values(j).forEach(t=>t.setValue(null)),o(!1)},color:"primary"},"Yes"),n.a.createElement(nt.a,{onClick:()=>o(!1),color:"primary",autoFocus:!0},"No"))))});var SettingsPage_SettingsPage=t=>{const e=getSetting(T).use(),a=Object(l.a)(e,1)[0],i=getSetting(D).use(),s=Object(l.a)(i,1)[0];return n.a.createElement(util_SubWindow,{fullScreen:!0,open:t.open,onClose:t.onClose},n.a.createElement(ye,{onClose:t.onClose}),n.a.createElement(dt.a,null,n.a.createElement(he,{setting:A,primaryText:"Low Latency Mode",secondaryText:"disables animations"}),n.a.createElement(oe.a,null),n.a.createElement(he,{setting:T,primaryText:"Limit Track Length",secondaryText:"prevents map clutter"}),n.a.createElement(ue,{primaryText:"Track Length",secondaryText:"Valid: 1-999 min",setting:M,disabled:!a,unit:"min",min:1,max:999}),n.a.createElement(oe.a,null),n.a.createElement(he,{setting:D,primaryText:"Limit Framerate",secondaryText:"reduces energy consumption"}),n.a.createElement(ue,{primaryText:"Framerate",secondaryText:"Valid: 1-60 fps",setting:L,disabled:!s,unit:"fps",min:1,max:60}),n.a.createElement(oe.a,null),n.a.createElement(he,{setting:F,primaryText:"Enable GPS",secondaryText:"required for advanced features"})))};var pages_MainMenu=t=>{const e=Object(u.a)(),a=Object(i.useState)(!1),s=Object(l.a)(a,2),o=s[0],c=s[1];return n.a.createElement(n.a.Fragment,null,n.a.createElement(ee.a,{disableSwipeToOpen:!0,open:t.open,onOpen:()=>{},onClose:t.onClose},n.a.createElement(tt.a,{style:{backgroundColor:e.palette.primary.light,minWidth:"200px"},onClick:t.onClose},n.a.createElement(r.a,{flexGrow:1,clone:!0},n.a.createElement(S.a,{variant:"h6"},"Menu")),n.a.createElement(Ht.a,{edge:"end",color:"inherit"},n.a.createElement(ie.a,null))),n.a.createElement(dt.a,null,n.a.createElement(gt.a,{button:!0,onClick:()=>{t.onClose(),c(!0)}},n.a.createElement(mt.a,null,n.a.createElement(se.a,null)),n.a.createElement(ft.a,{primary:"Settings"})))),n.a.createElement(SettingsPage_SettingsPage,{open:o,onClose:()=>c(!1)}))};const ke=Object(w.a)(t=>({popover:{padding:t.spacing(1),align:"right"}})),LoadingBadge=t=>n.a.createElement(Ut.a,{anchorOrigin:{vertical:"bottom",horizontal:"right"},badgeContent:n.a.createElement(E.a,{disableShrink:t.disableShrink,color:"secondary",size:15,thickness:10})},t.children);var Ce=Object(q.a)(()=>{const t=ke(),e=getXContestInterface().connectionState.use(),a=n.a.useRef(),s=Object(i.useState)(null),o=Object(l.a)(s,2),c=o[0],h=o[1],u=Object(i.useState)(!1),p=Object(l.a)(u,2),d=p[0],g=p[1];n.a.useLayoutEffect(()=>{a.current&&a.current.updatePosition()},[e,c]);return n.a.createElement("div",null,n.a.createElement(zt.a,{position:"static"},n.a.createElement(tt.a,null,n.a.createElement(Ht.a,{edge:"start",color:"inherit",onClick:()=>g(!0)},n.a.createElement(Xt.a,null)),n.a.createElement(r.a,{marginLeft:2,flexGrow:1},n.a.createElement(S.a,{variant:"h6"},"XC Live Viewer")),n.a.createElement(Ht.a,{edge:"end",color:"inherit",onClick:t=>h(t.currentTarget)},(()=>{switch(e){case H.ACTIVE:return n.a.createElement(Zt.a,null);case H.CONNECTING:return n.a.createElement(LoadingBadge,null,n.a.createElement(te.a,null));case H.ERROR:return n.a.createElement(qt.a,{color:"error"});case H.ESTABLISHED:return n.a.createElement(LoadingBadge,{disableShrink:!0},n.a.createElement(te.a,null));case H.INACTIVE:return n.a.createElement($t.a,null);case H.NO_CONNECTION:default:return n.a.createElement(te.a,null)}})()))),n.a.createElement(pt.a,{open:Boolean(c),anchorEl:c,onClose:()=>h(null),anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},action:a},n.a.createElement(r.a,{className:t.popover},n.a.createElement(S.a,null,e))),n.a.createElement(pages_MainMenu,{open:d,onClose:()=>g(!1)}))});var src_MainPage=()=>{const t=Nt.TabID.use(),e=Object(l.a)(t,2),a=e[0],i=e[1],s=n.a.useState(0),o=Object(l.a)(s,2),c=o[0],m=o[1],b=Object(u.a)(),y=Object(p.a)(b.breakpoints.down("sm")),updateWindowHeight=()=>{m(window.innerHeight)};n.a.useLayoutEffect(()=>(updateWindowHeight(),window.addEventListener("resize",updateWindowHeight),()=>window.removeEventListener("resize",updateWindowHeight)),[]);const k=y?n.a.createElement(n.a.Fragment,null,n.a.createElement(r.a,{flexGrow:1,clone:!0,display:"flex"},n.a.createElement(h.a,{disabled:!0,index:a},n.a.createElement(r.a,{width:"100%",height:"100%",position:"relative"},n.a.createElement(Z,null)),n.a.createElement(r.a,{width:"100%",height:"100%",position:"relative"},n.a.createElement(Wt,null)))),n.a.createElement(r.a,{zIndex:100,boxShadow:3},n.a.createElement(d.a,{value:a,onChange:(t,e)=>i(e),showLabels:!0},n.a.createElement(g.a,{label:"Map",icon:n.a.createElement(v.a,null)}),n.a.createElement(g.a,{label:"Pilots",icon:n.a.createElement(f.a,null)})))):n.a.createElement(r.a,{width:"100%",flexGrow:1,display:"flex",overflow:"hidden"},n.a.createElement(r.a,{flexGrow:1,height:"100%"},n.a.createElement(Z,null)),n.a.createElement(r.a,{width:"450px",height:"100%",zIndex:50,boxShadow:3},n.a.createElement(Wt,null)));return n.a.createElement(r.a,{height:c,display:"flex",flexDirection:"column",overflow:"hidden"},n.a.createElement(r.a,{zIndex:100},n.a.createElement(Ce,null)),k)};var src_App=()=>n.a.createElement("div",{className:"App"},n.a.createElement(src_MainPage,null));a(193),a(194);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(195).config(),o.a.render(n.a.createElement(src_App,null),document.getElementById("root")),function unregister(){"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(t=>{t.unregister()})}()}},[[135,1,2]]]);
//# sourceMappingURL=main.ed196104.chunk.js.map